import{c as X,b as Y,r as t,j as a,m as j,B as F,f as Z,p as _}from"./index-e84ae47f.js";import{P as ee,C as ae}from"./CycleDatesEditor-4d5ec674.js";import{R as te}from"./RecordsList-8aa66fff.js";import{D as se}from"./computePeakStatuses-1cb03412.js";import{D as ie}from"./DeletionDialog-9bcd306e.js";import{u as re,D as oe,a as ne}from"./useCycleData-09262d0a.js";import{P as le}from"./badge-2d3d489e.js";import"./OverlapWarningDialog-cf4973a4.js";import"./eye-853f9d7c.js";import"./input-693389fa.js";import"./label-962136e3.js";import"./select-973da53b.js";import"./eye-off-dac0e639.js";const de=X("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),je=()=>{const{currentCycle:e,addOrUpdateDataPoint:C,deleteRecord:L,isLoading:T,updateCycleDates:w,checkCycleOverlap:x,forceUpdateCycleStart:E,refreshData:f}=re(),{toast:r}=Y(),[q,l]=t.useState(!1),[v,d]=t.useState(null),[c,D]=t.useState(null),[m,h]=t.useState(!1),[I,k]=t.useState(!1),[n,g]=t.useState(()=>(e==null?void 0:e.startDate)||""),[M,o]=t.useState(""),[b,N]=t.useState(null),[U,O]=t.useState(null),[A,y]=t.useState(!1),[z,p]=t.useState(!1);t.useEffect(()=>{g((e==null?void 0:e.startDate)||"")},[e==null?void 0:e.startDate]);const i=t.useCallback(()=>{N(null),O(null),y(!1)},[]),B=t.useCallback(()=>{g((e==null?void 0:e.startDate)||""),o(""),i(),k(!0)},[e==null?void 0:e.startDate,i]),u=t.useCallback(()=>{k(!1),o(""),i(),g((e==null?void 0:e.startDate)||"")},[e==null?void 0:e.startDate,i]),G=t.useCallback(()=>{i()},[i]),H=t.useCallback(async()=>{if(!n){o("La fecha de inicio es obligatoria");return}if(e!=null&&e.id){o(""),p(!0);try{const s=x?await x(e.id,n):null;if(s){N(n),O(s),y(!0),p(!1);return}await w(e.id,n),await f({silent:!0}),r({title:"Fecha de inicio actualizada",description:"El ciclo se ha ajustado a la nueva fecha de inicio."}),u()}catch(s){console.error("Error updating start date from records page:",s),o("No se pudo actualizar la fecha de inicio"),r({title:"Error",description:"No se pudo actualizar la fecha de inicio.",variant:"destructive"})}finally{p(!1)}}},[n,e==null?void 0:e.id,x,w,f,r,u]),V=t.useCallback(async()=>{if(!(e!=null&&e.id)||!b){i();return}p(!0),y(!1);try{await E(e.id,b),await f({silent:!0}),r({title:"Fecha de inicio actualizada",description:"El ciclo se ha ajustado a la nueva fecha de inicio."}),u()}catch(s){console.error("Error forcing start date from records page:",s),o("No se pudo actualizar la fecha de inicio"),r({title:"Error",description:"No se pudo actualizar la fecha de inicio.",variant:"destructive"})}finally{p(!1),i()}},[e==null?void 0:e.id,b,E,f,r,u,i]),P=t.useCallback(()=>{l(!1),d(null)},[]),$=s=>{d(s),l(!0)},J=s=>{const S=e.data.find(R=>R.id===s);D(S)},K=t.useCallback(s=>{d(s)},[]),Q=async(s,{keepFormOpen:S=!1}={})=>{h(!0);try{await C(s,v),S||(l(!1),d(null))}catch{r({title:"Error",description:"No se pudo guardar el registro",variant:"destructive"})}finally{h(!1)}},W=async()=>{if(c){h(!0);try{await L(c.id),D(null)}catch{r({title:"Error",description:"No se pudo eliminar el registro",variant:"destructive"})}finally{h(!1)}}};return T&&!(e!=null&&e.id)?a.jsxs("div",{className:"min-h-[100dvh] bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100 flex items-center justify-center",children:[a.jsx("div",{className:"pointer-events-none absolute inset-0",style:{background:"radial-gradient(65% 55% at 50% 32%, rgba(244,114,182,0.18) 0%, rgba(244,114,182,0.12) 35%, rgba(244,114,182,0.06) 60%, rgba(244,114,182,0) 100%)"}}),a.jsx("p",{className:"text-center text-slate-600 text-lg",children:"Cargando..."})]}):e!=null&&e.id?a.jsxs("div",{className:"min-h-[100dvh] bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100 relative",children:[a.jsx("div",{className:"pointer-events-none absolute inset-0",style:{background:"radial-gradient(65% 55% at 50% 32%, rgba(244,114,182,0.18) 0%, rgba(244,114,182,0.12) 35%, rgba(244,114,182,0.06) 60%, rgba(244,114,182,0) 100%)"}}),a.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-6 relative z-10",children:[a.jsxs(j.div,{className:"flex flex-col sm:flex-row justify-between items-center mb-6",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:[a.jsxs("h1",{className:"text-3xl sm:text-4xl font-bold text-slate-700 mb-4 sm:mb-0 flex items-center",children:[a.jsx(de,{className:"mr-3 h-8 w-8 text-pink-500"}),"Mis Registros"]}),a.jsxs("div",{className:"w-full sm:w-auto flex  gap-2 sm:items-center",children:[a.jsxs(F,{type:"button",variant:"outline",onClick:B,className:"border-pink-200 text-pink-600 hover:bg-pink-50",disabled:m||z,children:[a.jsx(ee,{className:"mr-2 h-4 w-4"}),"Editar fecha inicio"]}),a.jsxs(F,{type:"button",onClick:()=>{d(null),l(!0)},className:"bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white shadow-lg",disabled:m,style:{filter:"drop-shadow(0 6px 12px rgba(236, 72, 153, 0.3))"},children:[a.jsx(le,{className:"mr-2 h-4 w-4"}),"Añadir registro"]})]})]}),I&&a.jsx(j.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.4},children:a.jsx(ae,{cycle:e,startDate:n,endDate:e.endDate,onStartDateChange:s=>g(s),onSave:H,onCancel:u,isProcessing:z,dateError:M,includeEndDate:!1,showOverlapDialog:A,overlapCycle:U,onConfirmOverlap:V,onCancelOverlap:G,onClearError:()=>o(""),saveLabel:"Guardar cambios",title:"Editar fecha de inicio",description:"Actualiza la fecha de inicio del ciclo actual. Los registros se reorganizarán automáticamente."})}),a.jsx(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},children:a.jsx(te,{records:e.data,onEdit:$,onDelete:J,isProcessing:m})})]}),a.jsx(oe,{open:q,onOpenChange:s=>{s?l(!0):P()},children:a.jsx(ne,{hideClose:!0,className:"bg-white border-pink-100 text-gray-800 w-[90vw] sm:w-auto max-w-md sm:max-w-lg md:max-w-xl max-h-[85vh] overflow-y-auto p-4 sm:p-6 rounded-2xl",children:a.jsx(se,{onSubmit:Q,onCancel:P,initialData:v,cycleStartDate:e.startDate,cycleEndDate:e.endDate,isProcessing:m,isEditing:!!v,cycleData:e.data,onDateSelect:K})})}),a.jsx(ie,{isOpen:!!c,onClose:()=>D(null),onConfirm:W,title:"Eliminar registro",confirmLabel:"Eliminar registro",description:c?`¿Estás seguro de que quieres eliminar el registro del ${Z(_(c.isoDate),"dd/MM/yyyy")}? Esta acción no se puede deshacer.`:"",isProcessing:m})]}):a.jsxs("div",{className:"min-h-[100dvh] bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100 flex items-center justify-center",children:[a.jsx("div",{className:"pointer-events-none absolute inset-0",style:{background:"radial-gradient(65% 55% at 50% 32%, rgba(244,114,182,0.18) 0%, rgba(244,114,182,0.12) 35%, rgba(244,114,182,0.06) 60%, rgba(244,114,182,0) 100%)"}}),a.jsx("p",{className:"text-center text-slate-600 text-lg",children:"No hay ciclo activo."})]})};export{je as default};
