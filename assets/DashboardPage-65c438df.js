import{c as v,r as f,j as e,m as l}from"./index-58bd411e.js";import{D as M}from"./DataEntryForm-73151ae2.js";import{B as w}from"./button-aa6d80be.js";import{u as N}from"./useBackClose-898a3860.js";import{D as k,a as D,b as S,c as P,d as I,e as F}from"./dialog-f730b929.js";import{I as A}from"./input-bb23d33b.js";import{f as y,u as T,d as O,p as E,s as H}from"./useCycleData-13cb54d0.js";import{P as L}from"./plus-56670b3c.js";import"./label-8269a8d9.js";import"./select-a5f234f0.js";import"./fertilitySymbols-b3b31d09.js";const B=v("CalendarPlus",[["path",{d:"M21 13V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8",key:"3spt84"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["line",{x1:"19",x2:"19",y1:"16",y2:"22",key:"1ttwzi"}],["line",{x1:"16",x2:"22",y1:"19",y2:"19",key:"1g9955"}]]),$=v("FilePlus",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"12",x2:"12",y1:"18",y2:"12",key:"1tsf04"}],["line",{x1:"9",x2:"15",y1:"15",y2:"15",key:"110plj"}]]),j=({isOpen:a,onClose:n,onConfirm:o,currentCycleStartDate:x})=>{const[m,s]=f.useState(y(new Date,"yyyy-MM-dd"));N(a,n);const t=!x,h=()=>{o(m)},c=t?"":y(new Date(x),"dd/MM/yyyy"),r=(()=>{if(t)return"";const i=new Date(m);return i.setDate(i.getDate()-1),y(i,"dd/MM/yyyy")})();return e.jsx(k,{open:a,onOpenChange:n,children:e.jsxs(D,{className:"bg-white border-pink-100 text-gray-800",children:[e.jsxs(S,{children:[e.jsx(P,{children:"Iniciar nuevo ciclo"}),e.jsx(I,{className:"text-gray-600",children:t?"Este será tu primer ciclo. Selecciona la fecha de inicio.":`¿Estás seguro de que quieres iniciar un nuevo ciclo? Los datos del ciclo actual (${c} - ${r}) serán archivados.`})]}),e.jsxs("div",{className:"my-4 space-y-2",children:[e.jsx("label",{htmlFor:"startDate",className:"text-gray-700 text-sm",children:"Fecha de inicio del nuevo ciclo"}),e.jsx(A,{id:"startDate",type:"date",value:m,onChange:i=>s(i.target.value),max:y(new Date,"yyyy-MM-dd"),min:t?void 0:y(new Date(x),"yyyy-MM-dd"),className:"bg-gray-50 border-gray-200 text-gray-800"})]}),e.jsxs(F,{className:"sm:justify-end",children:[e.jsx(w,{variant:"outline",onClick:n,className:"border-gray-300 text-gray-700 hover:bg-gray-100",children:"Cancelar"}),e.jsx(w,{variant:"primary",onClick:h,className:"bg-pink-600 hover:bg-pink-700 text-white",children:t?"Iniciar ciclo":"Confirmar nuevo ciclo"})]})]})})},z=({cycleData:a})=>{const n=a.records||[],o=s=>{switch(s){case"red":return{main:"#ef4444",light:"#fee2e2",glow:"rgba(239, 68, 68, 0.3)"};case"white":return{main:"#f8fafc",light:"#ffe4e6",glow:"rgba(248, 250, 252, 0.3)"};case"green":return{main:"#22c55e",light:"#d1fae5",glow:"rgba(34, 197, 94, 0.3)"};case"spot":return{main:"#ec4899",light:"#fce7f3",glow:"rgba(236, 72, 153, 0.3)"};default:return{main:"#d1d5db",light:"#f8fafc",glow:"rgba(209, 213, 219, 0.3)"}}},m=(()=>{const s=Math.max(a.currentDay,28),t=45;return Array.from({length:s},(h,c)=>{const r=c+1,i=n.find(C=>C.cycleDay===r),p=c/s*2*Math.PI-Math.PI/2,g=50+t*Math.cos(p),d=50+t*Math.sin(p);let u=r<=a.currentDay&&i?o(i.fertility_symbol):{main:"#e5e7eb",light:"#f1f5f9",glow:"rgba(229, 231, 235, 0.3)"};const b=r===a.currentDay;return b&&!i&&(u={main:"#3b82f6",light:"#bfdbfe",glow:"rgba(59, 130, 246, 0.4)"}),{x:g,y:d,day:r,colors:u,isActive:r<=a.currentDay,isToday:b}})})();return e.jsxs("div",{className:"relative min-h-[100dvh] flex flex-col",children:[e.jsxs(l.div,{className:"px-4 pt-12 pb-4 text-center flex-shrink-0",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.4},children:[e.jsx("h1",{className:"text-xl font-bold text-gray-800 mb-1",children:new Date().toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long"})}),e.jsxs("p",{className:"text-sm font-medium text-pink-700 bg-white/20 backdrop-blur-sm rounded-full px-3 py-1.5 inline-block",children:["Día ",a.currentDay," del ciclo"]})]}),e.jsxs(l.div,{className:"px-4 flex-grow flex flex-col justify-start",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.4,delay:.1},children:[e.jsx("div",{className:"text-center mb-4 flex-shrink-0",children:e.jsxs(l.div,{className:"relative inline-flex items-center justify-center w-64 h-64 mb-4",initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200,damping:15,delay:.3},children:[e.jsxs("svg",{className:"w-full h-full",viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"16",fill:"none",stroke:"rgba(255, 255, 255, 0.2)",strokeWidth:"0.5"}),[7,14,21,28].map(s=>{const t=s/28*2*Math.PI-Math.PI/2,h=50+37*Math.cos(t),c=50+37*Math.sin(t),r=50+43*Math.cos(t),i=50+43*Math.sin(t);return e.jsx("line",{x1:h,y1:c,x2:r,y2:i,stroke:"rgba(255, 255, 255, 0.3)",strokeWidth:"0.5"},s)}),m.map((s,t)=>e.jsxs("g",{children:[e.jsx("circle",{cx:s.x+.3,cy:s.y+.3,r:s.isToday?3.5:2.5,fill:"rgba(0, 0, 0, 0.2)",opacity:s.isActive?1:.5}),e.jsx(l.circle,{cx:s.x,cy:s.y,r:s.isToday?3.5:2.5,fill:s.isActive?s.isToday?s.colors.light:s.colors.main:"#e5e7eb",stroke:s.colors.border||(s.isActive?"rgba(255,255,255,0.4)":"#cbd5e1"),strokeWidth:s.colors.border?.6:(s.isActive,.8),initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.6,delay:.8+t*.02,type:"spring",stiffness:400,damping:25},style:{filter:s.isActive?"drop-shadow(0 1px 3px rgba(0,0,0,0.3))":"drop-shadow(0 1px 2px rgba(0,0,0,0.2))"}}),s.isActive&&e.jsx(l.circle,{cx:s.x,cy:s.y,r:"0.6",fill:(s.colors.main==="#ffffff","#e5e7eb"),initial:{scale:0},animate:{scale:1},transition:{duration:.3,delay:1.2+t*.02}})]},t))]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsxs(l.div,{className:"text-center bg-white/10 backdrop-blur-md rounded-full p-4",initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{delay:1,type:"spring",stiffness:200},style:{filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.1))"},children:[e.jsx("span",{className:"text-3xl font-bold text-pink-700 block",children:a.currentDay}),e.jsx("span",{className:"text-xs text-pink-700 font-medium mt-0.5 block",children:"día del ciclo"})]}),e.jsx(l.div,{className:"mt-2 px-2.5 py-1 bg-white/20 backdrop-blur-sm rounded-full border border-white/30",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:1.3},style:{filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.1))"},children:e.jsx("span",{className:"text-xs font-medium text-gray-800",children:a.currentDay<=7?"Menstrual":a.currentDay<=14?"Folicular":a.currentDay<=21?"Ovulatoria":"Lútea"})})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mx-2 mb-20 flex-shrink-0",children:[e.jsxs(l.div,{className:"bg-gradient-to-br from-white/90 to-white/70 backdrop-blur-md rounded-3xl p-4 border border-white/40",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.4,delay:.5},style:{filter:"drop-shadow(0 8px 25px rgba(0,0,0,0.08))",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.7)"},children:[e.jsx("h3",{className:"text-xs font-bold text-gray-800 mb-3 text-center tracking-wide uppercase",children:"Símbolos"}),e.jsx("div",{className:"grid grid-cols-2 gap-2.5",children:[{color:"#ef4444",label:"Menstrual",symbol:"red"},{color:"#f8fafc",label:"Fértil",symbol:"white",stroke:"#e2e8f0"},{color:"#22c55e",label:"Infértil",symbol:"green"},{color:"#ec4899",label:"Spotting",symbol:"spot"}].map(s=>e.jsxs("div",{className:"flex flex-col items-center gap-1.5",children:[e.jsx("div",{className:"relative",children:e.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center",style:{background:`linear-gradient(135deg, ${s.color}dd, ${s.color})`},children:e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:s.color==="#f8fafc"?"#64748b":"rgba(255,255,255,0.9)",boxShadow:"0 1px 2px rgba(0,0,0,0.2)"}})})}),e.jsx("span",{className:"text-xs font-medium text-gray-700 text-center leading-none",children:s.label})]},s.symbol))}),e.jsxs("div",{className:"flex items-center justify-center gap-2 pt-3 mt-3 border-t border-gradient-to-r from-transparent via-gray-200 to-transparent",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-gradient-to-br from-blue-400 to-blue-500 flex items-center justify-center",children:e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-white shadow-sm"})}),e.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-blue-300/50 animate-pulse"})]}),e.jsx("span",{className:"text-xs font-semibold text-gray-700",children:"Hoy"})]})]}),e.jsxs(l.div,{className:"relative bg-gradient-to-br from-pink-50/80 to-rose-50/60 backdrop-blur-md rounded-3xl p-4 border border-pink-200/40",initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.4,delay:.6},style:{filter:"drop-shadow(0 8px 25px rgba(236,72,153,0.1))",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.8)"},children:[e.jsxs("h3",{className:"font-bold mb-3 text-gray-800 flex items-center gap-2 justify-center text-xs tracking-wide uppercase",children:[e.jsx("div",{className:"w-2.5 h-2.5 bg-gradient-to-br from-pink-500 to-rose-500 rounded-full shadow-sm"}),"Informacion del ciclo"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1.5",children:[e.jsx("div",{className:"w-1 h-1 bg-pink-400 rounded-full"}),e.jsx("div",{className:"font-bold text-pink-800 text-xs",children:"CPM"}),e.jsx("div",{className:"w-1 h-1 bg-pink-400 rounded-full"})]}),e.jsx("div",{className:"bg-white/60 backdrop-blur-sm px-3 py-1.5 rounded-full border border-gray-200/50 shadow-sm",children:e.jsx("span",{className:"text-xs text-gray-600 font-medium",children:"Sin datos"})})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1.5",children:[e.jsx("div",{className:"w-1 h-1 bg-pink-400 rounded-full"}),e.jsx("div",{className:"font-bold text-pink-800 text-xs",children:"T-8"}),e.jsx("div",{className:"w-1 h-1 bg-pink-400 rounded-full"})]}),e.jsx("div",{className:"bg-white/60 backdrop-blur-sm px-3 py-1.5 rounded-full border border-gray-200/50 shadow-sm",children:e.jsx("span",{className:"text-xs text-gray-600 font-medium",children:"Sin datos"})})]})]}),e.jsx("div",{className:"absolute top-2 right-2 w-2 h-2 bg-gradient-to-br from-pink-300/40 to-rose-400/40 rounded-full"})]})]})]})]})},W=({onAddRecord:a,onAddCycle:n})=>{const[o,x]=f.useState(!1);return e.jsxs("div",{className:"fixed bottom-[calc(var(--bottom-nav-height)+1rem)] right-6 flex flex-col items-end space-y-3 z-50",children:[o&&e.jsxs(e.Fragment,{children:[e.jsx(l.button,{onClick:a,className:"w-12 h-12 rounded-full bg-gradient-to-br from-pink-500 to-rose-500 text-white shadow-lg flex items-center justify-center",whileTap:{scale:.95},whileHover:{scale:1.05},initial:{opacity:0,y:20,scale:.8},animate:{opacity:1,y:0,scale:1},style:{filter:"drop-shadow(0 6px 12px rgba(236, 72, 153, 0.3))"},children:e.jsx($,{className:"h-5 w-5"})}),e.jsx(l.button,{onClick:n,className:"w-12 h-12 rounded-full bg-gradient-to-br from-purple-500 to-indigo-500 text-white shadow-lg flex items-center justify-center",whileTap:{scale:.95},whileHover:{scale:1.05},initial:{opacity:0,y:20,scale:.8},animate:{opacity:1,y:0,scale:1},style:{filter:"drop-shadow(0 6px 12px rgba(147, 51, 234, 0.3))"},children:e.jsx(B,{className:"h-5 w-5"})})]}),e.jsx(l.button,{onClick:()=>x(!o),className:"w-14 h-14 bg-gradient-to-br from-pink-500 to-rose-500 text-white rounded-full shadow-lg flex items-center justify-center",whileTap:{scale:.95},whileHover:{scale:1.05},initial:{scale:0},animate:{scale:1},style:{filter:"drop-shadow(0 6px 16px rgba(236, 72, 153, 0.4))"},children:e.jsx(L,{className:"h-6 w-6"})})]})},Z=()=>{const{currentCycle:a,addOrUpdateDataPoint:n,startNewCycle:o,isLoading:x}=T(),[m,s]=f.useState(!1),[t,h]=f.useState(!1),[c,r]=f.useState(!1);if(N(m,()=>s(!1)),x)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-rose-50 via-pink-50 to-rose-100 flex items-center justify-center",children:e.jsx("p",{className:"text-center text-gray-600 text-lg",children:"Cargando..."})});if(!(a!=null&&a.id))return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-rose-50 via-pink-50 to-rose-100 flex items-center justify-center",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("p",{className:"text-gray-600 text-lg",children:"No hay ciclo activo."}),e.jsx("button",{onClick:()=>r(!0),className:"px-6 py-3 rounded-lg bg-pink-600 hover:bg-pink-700 text-white shadow",children:"Iniciar ciclo"})]}),e.jsx(j,{isOpen:c,onClose:()=>r(!1),onConfirm:async d=>{await o(d),r(!1),s(!0)}})]});const i=O(H(new Date),E(a.startDate))+1,p=async d=>{h(!0);try{await n(d),s(!1)}finally{h(!1)}},g=async d=>{await o(d),r(!1),s(!0)};return e.jsxs("div",{className:"min-h-[100dvh] bg-gradient-to-br from-rose-50 via-pink-50 to-rose-100 relative overflow-x-hidden",children:[e.jsx("div",{className:"max-w-md mx-auto h-[100dvh]",children:e.jsx(l.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full",children:e.jsx(z,{cycleData:{...a,currentDay:i,records:a.data}})})}),e.jsx(k,{open:m,onOpenChange:d=>s(d),children:e.jsx(D,{hideClose:!0,className:"bg-white border-pink-100 text-gray-800 w-[90vw] sm:w-auto max-w-md sm:max-w-lg md:max-w-xl max-h-[85vh] overflow-y-auto p-4 sm:p-6 rounded-2xl",children:e.jsx(M,{onSubmit:p,onCancel:()=>s(!1),cycleStartDate:a.startDate,cycleEndDate:a.endDate,isProcessing:t})})}),e.jsx(W,{onAddRecord:()=>s(!0),onAddCycle:()=>r(!0)}),e.jsx(j,{isOpen:c,onClose:()=>r(!1),onConfirm:g,currentCycleStartDate:a.startDate})]})};export{Z as default};
