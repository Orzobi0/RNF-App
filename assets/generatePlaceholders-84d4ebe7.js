import{c as Mt,m as U,j as t,s as xt,p as Lt,r as R,h as At,f as jt,d as Gt}from"./index-00d866bf.js";import{g as It,i as Tt}from"./DataEntryForm-8cc4c6ac.js";import{C as St}from"./ChartTooltip-e7d15225.js";const te=Mt("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),Bt=({padding:e,chartWidth:a,chartHeight:C,tempMin:p,tempMax:E,tempRange:u,getY:d,getX:f,allDataPoints:k=[],responsiveFontSize:m,isFullScreen:W,showLeftLabels:G=!1,reduceMotion:o=!1})=>{const c={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.3,ease:"easeOut"}}},x=[];if(u>0){const l=u<=2.5?.1:.5;for(let j=p;j<=E+1e-9;j+=l)x.push(parseFloat(j.toFixed(1)))}else for(let l=35;l<=37.5+1e-9;l+=.5)x.push(parseFloat(l.toFixed(1)));const n=o?"g":U.g;return t.jsxs(t.Fragment,{children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"bgGradientChart",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(254, 242, 242, 0.95)"}),t.jsx("stop",{offset:"30%",stopColor:"rgba(255, 241, 242, 0.9)"}),t.jsx("stop",{offset:"70%",stopColor:"rgba(255, 245, 255, 0.95)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(254, 242, 242, 0.8)"})]}),t.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),t.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),t.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),t.jsxs("filter",{id:"chartGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsx("filter",{id:"textShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:t.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodColor:"rgba(255, 255, 255, 0.8)"})}),t.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[t.jsx("rect",{width:"6",height:"6",fill:"#f3f4f6"}),t.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(239,68,68,0.7)"})]})]}),t.jsx("rect",{x:e.left,y:e.top,width:a-e.left-e.right,height:C-e.top-e.bottom,fill:"url(#bgGradientChart)",opacity:2,rx:12,style:{filter:"drop-shadow(0 4px 12px rgba(244, 114, 182, 0.1))"}}),x.map((l,j)=>{const O=d(l),B=l.toFixed(1).endsWith(".0")||l.toFixed(1).endsWith(".5"),N=B?l.toFixed(1):`.${l.toFixed(1).split(".")[1]}`;return t.jsxs(n,{...o?{}:{variants:c},children:[t.jsx("line",{x1:e.left,y1:O,x2:a-e.right,y2:O,stroke:B?"rgba(244, 114, 182, 0.3)":"rgba(244, 114, 182, 0.15)",strokeWidth:B?2:1,strokeDasharray:B?"0":"4,4",style:{filter:B?"drop-shadow(0 1px 3px rgba(244, 114, 182, 0.15))":"none",opacity:B?1:.7}}),G&&t.jsx("text",{x:e.left-m(1),y:O+m(.35),textAnchor:"end",fontSize:m(B?1.1:1),fontWeight:B?"700":"600",fill:B?"#E91E63":"#EC4899",style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:N}),t.jsx("text",{x:a-e.right+m(1),y:O+m(.35),textAnchor:"start",fontSize:m(B?1.1:1),fontWeight:B?"700":"600",fill:B?"#E91E63":"#EC4899",style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:N})]},`temp-tick-${j}`)}),k.map((l,j)=>{const O=f(j);return t.jsx("line",{x1:O,y1:e.top,x2:O,y2:C-e.bottom,stroke:"rgba(244, 114, 182, 0.08)",strokeWidth:2.8,style:{filter:"drop-shadow(0 0 1px rgba(244, 114, 182, 0.05))"}},`day-grid-${j}`)}),t.jsx("rect",{x:e.left,y:e.top,width:a-e.left-e.right,height:C-e.top-e.bottom,fill:"none",stroke:"rgba(244, 114, 182, 0.4)",strokeWidth:2,rx:12,style:{filter:"drop-shadow(0 4px 12px rgba(244, 114, 182, 0.15))",strokeDasharray:"0"}}),G&&t.jsx(n,{...o?{}:{variants:c},children:t.jsx("text",{x:e.left+m(1.2),y:e.top+m(1.5),textAnchor:"middle",fontSize:m(1.4),fontWeight:"800",fill:"#E91E63",style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:"°C"})})]})},vt=({data:e,allDataPoints:a,getX:C,getY:p,baselineY:E,temperatureField:u="temperature",reduceMotion:d=!1})=>{if(!e||e.length<2)return null;let f="",k=null;const m=[];if(a.forEach((o,c)=>{const x=e.find(n=>n.id===o.id);if(x&&x[u]!==null&&x[u]!==void 0&&!x.ignored){const n=C(c),l=p(x[u]);m.push({x:n,y:l}),k!==null&&c===k+1?f+=` L ${n} ${l}`:f+=`${f?" ":""}M ${n} ${l}`,k=c}}),m.length<2)return null;const W=f.includes("L"),G=m.length>1?m.map(({x:o,y:c},x)=>`${x===0?"M":"L"} ${o} ${c}`).join(" "):"";return t.jsxs(t.Fragment,{children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),t.jsx("stop",{offset:"30%",stopColor:"#EC4899"}),t.jsx("stop",{offset:"70%",stopColor:"#E91E63"}),t.jsx("stop",{offset:"100%",stopColor:"#C2185B"})]}),t.jsxs("linearGradient",{id:"tempLineGradientChartGlow",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(244, 114, 182, 0.6)"}),t.jsx("stop",{offset:"30%",stopColor:"rgba(236, 72, 153, 0.7)"}),t.jsx("stop",{offset:"70%",stopColor:"rgba(233, 30, 99, 0.8)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(194, 24, 91, 0.6)"})]}),t.jsxs("filter",{id:"lineGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"4",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsx("filter",{id:"lineShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:t.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"3",floodColor:"rgba(244, 114, 182, 0.4)"})})]}),W&&(d?t.jsx("path",{d:f,fill:"none",stroke:"url(#tempLineGradientChartGlow)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:.4,style:{filter:"url(#lineGlow)"}}):t.jsx(U.path,{d:f,fill:"none",stroke:"url(#tempLineGradientChartGlow)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:.4,style:{filter:"url(#lineGlow)"},initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.4},transition:{duration:.8,ease:"easeInOut",delay:.2}})),G&&(d?t.jsx("path",{d:G,fill:"none",stroke:"#d587b1",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.65}):t.jsx(U.path,{d:G,fill:"none",stroke:"#d587b1",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.65,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.65},transition:{duration:.8,ease:"easeInOut"}})),W&&(d?t.jsx("path",{d:f,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#lineShadow)"}}):t.jsx(U.path,{d:f,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#lineShadow)"},initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:1},transition:{duration:1,ease:"easeInOut",delay:.4}})),W&&(d?t.jsx("path",{d:f,fill:"none",stroke:"rgba(255, 255, 255, 0.6)",strokeWidth:"0.3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.8}):t.jsx(U.path,{d:f,fill:"none",stroke:"rgba(255, 255, 255, 0.6)",strokeWidth:"0.3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.8,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.8},transition:{duration:1.2,ease:"easeInOut",delay:.6}}))]})},bt="#1565C0",wt="#2E7D32",Ct="#6A1B9A",Wt="#EFF6FF",Rt="#EEF2FF",Ot="#ECFDF5",$t="#F0FDFA",Nt="#F5F3FF",_t="#FAF5FF",Pt="rgba(148, 163, 184, 0.35)",Dt="rgba(226, 232, 240, 0.6)",Ft="rgba(148, 163, 184, 0.5)",Yt=e=>{if(!e)return"";const[a,C]=e.split("/");return`${parseInt(a,10)}/${parseInt(C,10)}`},gt=(e="",a,C,p="–")=>{if(!e)return[p,""];if(e.length<=a)return[e,""];if(C)return[e.slice(0,a),""];const E=e.indexOf(" ",a);return E===-1?[e.slice(0,a),e.slice(a)]:[e.slice(0,E),e.slice(E+1)]},mt=(e="",a,C="–")=>e?e.split(/\s+/).slice(0,a).join(" "):C,Ut=({data:e,getX:a,getY:C,isFullScreen:p,orientation:E,responsiveFontSize:u,onPointInteraction:d,clearActivePoint:f,activePoint:k,padding:m,chartHeight:W,chartWidth:G,temperatureField:o="temperature_chart",textRowHeight:c,compact:x=!1,reduceMotion:n=!1,showInterpretation:l=!1,ovulationDetails:j=null})=>{const O={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},B={hidden:{opacity:0,scale:.3},visible:{opacity:1,scale:1,transition:{duration:.6,ease:[.34,1.56,.64,1],type:"spring",stiffness:120,damping:12}}},N=W-m.bottom,Z=N+c*1,rt=N+c*2,_=N+c*3,P=N+c*(p?5:4.5),tt=N+c*(p?7:6),X=N+c*(p?9:7.5),J=G-m.left-m.right,z=c*(p?2:1.5),it=n?"g":U.g;return t.jsxs(t.Fragment,{children:[t.jsxs("defs",{children:[t.jsx("filter",{id:"rowShadowChart",x:"-10%",y:"-10%",width:"120%",height:"120%",children:t.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"4",floodColor:"rgba(244, 114, 182, 0.2)"})}),t.jsxs("filter",{id:"pointGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsxs("linearGradient",{id:"sensationGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:Wt}),t.jsx("stop",{offset:"100%",stopColor:Rt})]}),t.jsxs("linearGradient",{id:"appearanceGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:Ot}),t.jsx("stop",{offset:"100%",stopColor:$t})]}),t.jsxs("linearGradient",{id:"observationGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:Nt}),t.jsx("stop",{offset:"100%",stopColor:_t})]}),t.jsxs("radialGradient",{id:"tempPointGradientChart",cx:"30%",cy:"30%",children:[t.jsx("stop",{offset:"0%",stopColor:"#FCE7F3"}),t.jsx("stop",{offset:"40%",stopColor:"#F472B6"}),t.jsx("stop",{offset:"80%",stopColor:"#E91E63"}),t.jsx("stop",{offset:"100%",stopColor:"#C2185B"})]}),t.jsxs("radialGradient",{id:"tempPointIgnoredGradient",cx:"30%",cy:"30%",children:[t.jsx("stop",{offset:"0%",stopColor:"#FFFFFF"}),t.jsx("stop",{offset:"80%",stopColor:"#F8FAFC"}),t.jsx("stop",{offset:"100%",stopColor:"#E2E8F0"})]}),t.jsxs("radialGradient",{id:"ovulationPointGradient",cx:"30%",cy:"30%",children:[t.jsx("stop",{offset:"0%",stopColor:"#bfdbfe"}),t.jsx("stop",{offset:"45%",stopColor:"#60a5fa"}),t.jsx("stop",{offset:"85%",stopColor:"#2563eb"}),t.jsx("stop",{offset:"100%",stopColor:"#1d4ed8"})]})]}),!x&&t.jsxs("g",{children:[t.jsx("rect",{x:m.left,y:P-z/2,width:J,height:z,fill:"url(#sensationGradientChart)",rx:4,style:{filter:"url(#rowShadowChart)"}}),t.jsx("rect",{x:m.left,y:tt-z/2,width:J,height:z,fill:"url(#appearanceGradientChart)",rx:4,style:{filter:"url(#rowShadowChart)"}}),t.jsx("rect",{x:m.left,y:X-z/2,width:J,height:z,fill:"url(#observationGradientChart)",rx:4,style:{filter:"url(#rowShadowChart)"}})]}),p&&E!=="portrait"&&t.jsx(U.g,{variants:O,children:[{label:"Fecha",row:1,color:p?"#374151":"#6B7280"},{label:"Día",row:2,color:p?"#374151":"#6B7280"},{label:"Símbolo",row:3,color:p?"#374151":"#6B7280"},{label:"Sens.",row:p?5:4.5,color:bt},{label:"Apar.",row:p?7:6,color:wt},{label:"Observ.",row:p?9:7.5,color:Ct}].map(({label:i,row:H,color:L})=>t.jsx("text",{x:m.left-u(.5),y:N+c*H,textAnchor:"end",fontSize:u(1.05),fontWeight:"700",fill:L,style:{filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:i},i))}),e.map((i,H)=>{const L=a(H),y=i[o]!=null?C(i[o]):N,F=i.temperature_raw,Y=i.temperature_corrected,Q=i.use_corrected&&F!=null&&Y!=null&&Math.abs(Y-F)>.01,q=Q?C(F):null,lt=p?"#374151":"#6B7280",s=i[o]!=null,b=s||i.mucus_sensation||i.mucus_appearance||i.fertility_symbol,r=String(i.id||"").startsWith("placeholder-"),w=j==null?void 0:j.ovulationIndex,h=l&&(j==null?void 0:j.confirmed)&&w!=null&&!i.ignored&&s&&H===w,v=!b||r?{}:{pointerEvents:"all",style:{cursor:"pointer"},onMouseEnter:$=>d(i,H,$),onClick:$=>d(i,H,$)},S=It(i.fertility_symbol);let I="transparent";if(S!=null&&S.color){const $=S.color.replace(/^bg-/,"");$==="red-500"?I="#ef4444":$==="white"?I="#ffffff":$==="green-500"?I="#22c55e":$==="pink-300"&&(I="#f9a8d4")}const A=u(p?1.8:2),K=i.isoDate?Tt(xt(Lt(i.isoDate)),xt(new Date)):!1,st=p?4:7,et=2,[pt,at]=gt(p?mt(i.mucus_sensation,et,K?"":"–"):i.mucus_sensation,st,!1,K?"":"–"),[ct,dt]=gt(p?mt(i.mucus_appearance,et,K?"":"–"):i.mucus_appearance,st,!1,K?"":"–"),[ft,ht]=gt(p?mt(i.observations,et,""):i.observations,st,!1,"");return t.jsxs(it,{...n?{}:{variants:O},...v,children:[s&&t.jsxs(it,{...n?{}:{variants:B},children:[Q&&q!==null&&t.jsxs("g",{pointerEvents:"none",children:[t.jsx("line",{x1:L,y1:q,x2:L,y2:y,stroke:Pt,strokeWidth:1,strokeDasharray:"4 4"}),t.jsx("circle",{cx:L,cy:q,r:3.5,fill:Dt,stroke:Ft,strokeWidth:1}),t.jsx("circle",{cx:L,cy:q,r:1.2,fill:"rgba(255, 255, 255, 0.6)"})]}),t.jsx("circle",{cx:L,cy:y,r:h?2:1.5,fill:h?"rgba(59, 130, 246, 0.28)":"rgba(244, 114, 182, 0.2)",opacity:.85,style:{filter:"url(#pointGlow)"}}),t.jsx("circle",{cx:L,cy:y,r:h?4.2:3.5,fill:"none",stroke:i.ignored?"rgba(148, 163, 184, 0.4)":h?"rgba(37, 99, 235, 0.55)":"rgba(244, 114, 182, 0.3)",strokeWidth:h?2:1.5,opacity:h?.9:.6}),t.jsx("circle",{cx:L,cy:y,r:h?4.6:4,fill:i.ignored?"url(#tempPointIgnoredGradient)":h?"url(#ovulationPointGradient)":"url(#tempPointGradientChart)",stroke:i.use_corrected?"#F59E0B":i.ignored?"#94A3B8":h?"#1d4ed8":"#E91E63",strokeWidth:i.ignored?2:h?3.2:3,style:{filter:h?"drop-shadow(0 3px 8px rgba(37, 99, 235, 0.45))":"drop-shadow(0 3px 6px rgba(244, 114, 182, 0.4))",cursor:"pointer"},pointerEvents:"all",onMouseEnter:$=>d(i,H,$),onTouchStart:$=>d(i,H,$),onClick:$=>d(i,H,$)}),!i.ignored&&t.jsx("circle",{cx:L,cy:y,r:h?1.8:1.5,fill:h?"rgba(239, 246, 255, 0.95)":"rgba(255, 255, 255, 0.9)",style:{filter:h?"drop-shadow(0 1px 3px rgba(37, 99, 235, 0.45))":"drop-shadow(0 1px 2px rgba(244, 114, 182, 0.3))"}}),h&&t.jsx("circle",{cx:L,cy:y,r:6.5,fill:"none",stroke:"rgba(37, 99, 235, 0.35)",strokeWidth:1.2,strokeDasharray:"4 3"})]}),t.jsx("text",{x:L,y:Z,textAnchor:"middle",fontSize:u(1.05),fontWeight:"900",fill:lt,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:Yt(i.date)}),t.jsx("text",{x:L,y:rt,textAnchor:"middle",fontSize:u(1),fontWeight:"900",fill:lt,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:i.cycleDay}),!r&&(S.value!=="none"?t.jsxs("g",{children:[t.jsx("rect",{x:L-A/2+1,y:_-A*.75+1,width:A,height:A,fill:"rgba(0, 0, 0, 0.1)",rx:A*.3,opacity:.5}),t.jsx("rect",{x:L-A/2-4,y:_-A*.75,width:A*1.4,height:A,fill:S.pattern==="spotting-pattern"?"url(#spotting-pattern-chart)":I,stroke:S.value==="white"?"#CBD5E1":"rgba(233, 30, 99, 0.4)",strokeWidth:S.value==="white"?2:1,rx:A*.2,style:{filter:"drop-shadow(0 2px 4px rgba(244, 114, 182, 0.25))"}})]}):t.jsx("text",{x:L,y:_,textAnchor:"middle",fontSize:u(1),fill:lt,fontWeight:"500",style:{filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:"–"})),!x&&t.jsxs("text",{x:L,y:P,textAnchor:"middle",fontSize:u(.9),fontWeight:"700",fill:bt,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[t.jsx("tspan",{x:L,dy:0,children:pt}),at&&t.jsx("tspan",{x:L,dy:u(1.1),children:at})]}),!x&&t.jsxs("text",{x:L,y:tt,textAnchor:"middle",fontSize:u(.9),fontWeight:"700",fill:wt,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[t.jsx("tspan",{x:L,dy:0,children:ct}),dt&&t.jsx("tspan",{x:L,dy:u(1.1),children:dt})]}),!x&&t.jsxs("text",{x:L,y:X,textAnchor:"middle",fontSize:u(.9),fontWeight:"700",fill:Ct,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[t.jsx("tspan",{x:L,dy:0,children:ft}),ht&&t.jsx("tspan",{x:L,dy:u(1.1),children:ht})]})]},`pt-${H}-${i.isoDate||i.timestamp}`)})]})},Vt="#1565C0",Xt="#2E7D32",zt="#6A1B9A",Ht=({padding:e,chartHeight:a,tempMin:C,tempMax:p,tempRange:E,getY:u,responsiveFontSize:d,textRowHeight:f,isFullScreen:k})=>{const m={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},W=[];if(E>0){const o=E<=2.5?.1:.5;for(let c=C;c<=p+1e-9;c+=o)W.push(parseFloat(c.toFixed(1)))}else for(let o=35;o<=37.5+1e-9;o+=.5)W.push(parseFloat(o.toFixed(1)));const G=a-e.bottom;return t.jsxs("svg",{width:e.left,height:a,className:"font-sans pointer-events-none",children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"legendBgGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(255, 228, 230, 1)"}),t.jsx("stop",{offset:"30%",stopColor:"rgba(255, 229, 235, 1)  "}),t.jsx("stop",{offset:"70%",stopColor:"rgba(255, 241, 242, 1)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(255, 236, 240, 0.6)"})]}),t.jsxs("linearGradient",{id:"legendAccentGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),t.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),t.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),t.jsx("filter",{id:"legendShadowChart",x:"-20%",y:"-20%",width:"140%",height:"140%",children:t.jsx("feDropShadow",{dx:"0",dy:"3",stdDeviation:"4",floodColor:"rgba(244, 114, 182, 0.2)"})}),t.jsx("filter",{id:"textShadowLegend",x:"-50%",y:"-50%",width:"200%",height:"200%",children:t.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodColor:"rgba(255, 255, 255, 0.9)"})})]}),t.jsx("rect",{x:0,y:G+f*.5,width:e.left,height:f*(k?9.5:8),fill:"url(#legendBgGradientChart)",rx:12,style:{filter:"url(#legendShadowChart)"}}),W.map((o,c)=>{const x=u(o),n=o.toFixed(1).endsWith(".0")||o.toFixed(1).endsWith(".5"),l=n?o.toFixed(1):`.${o.toFixed(1).split(".")[1]}`;return t.jsx(U.g,{variants:m,children:t.jsx("text",{x:e.left-d(1.2),y:x+d(.35),textAnchor:"end",fontSize:d(n?1.15:1),fontWeight:n?"800":"700",fill:n?"#E91E63":"#EC4899",style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:l})},`temp-tick-fixed-${c}`)}),t.jsx(U.g,{variants:m,children:[{label:"Fecha",row:1,color:"#374151",icon:null},{label:"Día",row:2,color:"#374151",icon:null},{label:"Símbolo",row:3,color:"#374151",icon:null},{label:"Sens.",row:k?5:4.5,color:Vt,icon:"◊"},{label:"Apar.",row:k?7:6,color:Xt,icon:"○"},{label:"Observ.",row:k?9:7.5,color:zt,icon:"✦"}].map(({label:o,row:c,color:x,icon:n})=>t.jsxs("g",{children:[n&&t.jsx("text",{x:e.left-d(2.8),y:G+f*c,textAnchor:"middle",fontSize:d(.8),fontWeight:"600",fill:x,opacity:.7,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:n}),t.jsx("text",{x:e.left-d(.8),y:G+f*c,textAnchor:"end",fontSize:d(1.05),fontWeight:"800",fill:x,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:o})]},o))})]})},kt=35.5,Et=37.5,Zt=(e=[])=>{var G;const a=o=>o&&o.displayTemperature!=null&&!o.ignored,p=[];let E=null,u=null,d=null;const f=o=>{if(!o||o.length!==6)return null;const c=o.map(n=>n.temp);return c.some(n=>!Number.isFinite(n))?null:{baselineTemp:c.reduce((n,l)=>l>n?l:n,c[0]),baselineStartIndex:o[0].index}};for(let o=0;o<e.length;o++){const c=e[o];if(!a(c))continue;const x=c.displayTemperature;if(Number.isFinite(x)){if(p.length===6){const n=f(p);if(n&&(E=n.baselineTemp,u=n.baselineStartIndex,x>E)){d=o;break}}p.push({index:o,temp:x}),p.length>6&&p.shift()}}if(E==null&&p.length===6){const o=f(p);o&&(E=o.baselineTemp,u=o.baselineStartIndex)}const k={confirmed:!1,confirmationIndex:null,infertileStartIndex:null,rule:null,highSequenceIndices:[],ovulationIndex:null};if(E==null||d==null)return{baselineTemp:E,baselineStartIndex:u,firstHighIndex:d,ovulationDetails:k};const m=o=>{if(!o||o.length<3)return null;const c=E+.2,x=o.slice(0,3);if(x.length<3)return null;const n=x[2];if(n.temp>=c)return{confirmationIndex:n.index,usedIndices:x.map(l=>l.index),rule:"3-high"};if(o.length>=5){const l=o[3],j=o[4];if(l&&j&&l.temp>E&&j.temp>=c)return{confirmationIndex:j.index,usedIndices:o.slice(0,5).map(O=>O.index),rule:"5-high"}}return null};let W=k;for(let o=d;o<e.length;o++){const c=e[o];if(!a(c)||c.displayTemperature<=E)continue;const x=[];for(let l=o;l<e.length&&x.length<5;l++){const j=e[l];if(!a(j)||j.displayTemperature<=E)break;x.push({index:l,temp:j.displayTemperature})}const n=m(x);if(n){W={confirmed:!0,confirmationIndex:n.confirmationIndex,infertileStartIndex:n.confirmationIndex+1,rule:n.rule,highSequenceIndices:n.usedIndices,ovulationIndex:d??((G=n.usedIndices)!=null&&G.length?n.usedIndices[0]:null)};break}}return{baselineTemp:E,baselineStartIndex:u,firstHighIndex:d,ovulationDetails:W}},qt=(e,a,C,p,E,u=5,d=!1)=>{const f=R.useRef(null),k=R.useRef(null),[m,W]=R.useState({width:0,height:0}),[G,o]=R.useState(null),[c,x]=R.useState({x:0,y:0}),n=R.useMemo(()=>{const s=r=>{if(r==null||r==="")return null;const w=parseFloat(String(r).replace(",","."));return Number.isFinite(w)?w:null},b=r=>{if(!r)return null;const w=s(r.temperature),h=s(r.temperature_corrected);return r.use_corrected&&h!==null?h:w!==null?w:h!==null?h:null};return e.map(r=>{const w=[r==null?void 0:r.temperature_chart,r==null?void 0:r.temperature_raw,r==null?void 0:r.temperature_corrected];let h=null;for(const v of w)if(v!=null&&v!==""){h=v;break}if(h==null&&Array.isArray(r==null?void 0:r.measurements)){const S=r.measurements.find(I=>I&&I.selected&&b(I)!==null)||r.measurements.find(I=>b(I)!==null);S&&(h=b(S))}return{...r,displayTemperature:s(h)}})},[e]);R.useLayoutEffect(()=>{const s=()=>{if(!f.current)return;const r=f.current.parentElement||f.current;let w=r.clientWidth||600,h=r.clientHeight||400,v=f.current.clientWidth>0?f.current.clientWidth:w,S,I;if(a){let A=window.innerWidth,K=window.innerHeight;if(d&&K>A&&([A,K]=[K,A]),v=A,C==="portrait"&&!d){const st=Math.max(30,A*.05);S=(A-st)/u*e.length}else S=A/u*e.length;I=K}else S=v/u*e.length,I=h;W({width:S,height:I})};s(),window.addEventListener("resize",s);let b;if(f.current){const r=f.current.parentElement||f.current;b=new ResizeObserver(s),b.observe(r)}return()=>{window.removeEventListener("resize",s),b&&b.disconnect()}},[a,e.length,u,C,d]);const l=R.useMemo(()=>n.filter(s=>s&&s.isoDate&&!s.ignored&&s.displayTemperature!==null&&s.displayTemperature!==void 0),[n]),j=R.useMemo(()=>n.filter(s=>s&&s.isoDate),[n]),{baselineTemp:O,baselineStartIndex:B,firstHighIndex:N,ovulationDetails:Z}=R.useMemo(()=>Zt(n),[n]),{tempMin:rt,tempMax:_}=R.useMemo(()=>{const s=l.map(w=>w.displayTemperature).filter(w=>w!=null);if(s.length===0)return{tempMin:kt,tempMax:Et};let b=Math.min(...s,kt),r=Math.max(...s,Et);if(b=Math.floor(b*2)/2,r=Math.ceil(r*2)/2,r-b<2){const w=(b+r)/2;b=w-1,r=w+1}return{tempMin:b,tempMax:r}},[l]),P=_-rt,tt=m.width,X=m.height,J=9,z=(s=1)=>{if(!a)return J*s;const b=Math.min(tt,X);return Math.max(8,Math.min(J*s,b/(j.length>0?40/s:40)))},it=z(a?1.6:2.5),i=d||C==="landscape",L=it*(i?9:5),y={top:a?Math.max(i?6:12,X*(i?.015:.03)):12,right:a?Math.max(i?35:30,tt*(i?.02:.05)):50,bottom:(a?Math.max(i?0:40,X*(i?0:.11)):60)+L+25,left:a?Math.max(i?45:20,tt*(i?.02:.05)):50},F=s=>{if(s==null||P===0)return X-y.bottom;const b=X-y.top-y.bottom;return b<=0?X-y.bottom:X-y.bottom-(s-rt)/P*b},Y=s=>{const b=a&&!(d||C==="landscape")?5:10,r=a&&!(d||C==="landscape")?25:0,w=tt-y.left-y.right-b-r*(j.length-1);if(w<=0)return y.left+b+r*s;const h=j.length>1?j.length-1:1;return h===0||j.length===0?y.left+b+r*s:y.left+b+s*(w/(j.length===1?1:h))+r*s},Q=(s,b,r)=>{if(!s||String(s.id).startsWith("placeholder-")){q();return}const w=f.current.getBoundingClientRect();let h,v;if(r.type.startsWith("touch")){const A=r.changedTouches[0];h=A.clientX,v=A.clientY}else h=r.clientX,v=r.clientY;const S=Y(b),I=F(s.displayTemperature);x({svgX:S,svgY:I,clientX:h-w.left+f.current.scrollLeft,clientY:v-w.top+f.current.scrollTop}),o(s)};R.useEffect(()=>{const s=b=>{var r;if(k.current&&!k.current.contains(b.target)){const w=(r=f.current)==null?void 0:r.querySelectorAll("circle, text, rect");let h=!1;if(w){for(let v of w)if(v.contains(b.target)){h=!0;break}}h||o(null)}};return G&&(document.addEventListener("mousedown",s),document.addEventListener("touchstart",s)),()=>{document.removeEventListener("mousedown",s),document.removeEventListener("touchstart",s)}},[G]);const q=()=>{o(null)};return{chartRef:f,tooltipRef:k,dimensions:m,activePoint:G,tooltipPosition:c,processedData:n,validDataForLine:l,allDataPoints:j,tempMin:rt,tempMax:_,tempRange:P,padding:y,textRowHeight:it,setActivePoint:o,getY:F,getX:Y,handlePointInteraction:Q,clearActivePoint:q,handleToggleIgnore:s=>{p&&s&&(p(E,s),o(null))},responsiveFontSize:z,baselineTemp:O,baselineStartIndex:B,firstHighIndex:N,ovulationDetails:Z}},ee=({data:e,isFullScreen:a,orientation:C,onToggleIgnore:p,onEdit:E,cycleId:u,initialScrollIndex:d=0,visibleDays:f=5,showInterpretation:k=!1,reduceMotion:m=!1,forceLandscape:W=!1})=>{const{chartRef:G,tooltipRef:o,dimensions:c,activePoint:x,tooltipPosition:n,allDataPoints:l,validDataForLine:j,tempMin:O,tempMax:B,tempRange:N,padding:Z,textRowHeight:rt,getY:_,getX:P,handlePointInteraction:tt,handleToggleIgnore:X,responsiveFontSize:J,clearActivePoint:z,setActivePoint:it,baselineTemp:i,baselineStartIndex:H,firstHighIndex:L,ovulationDetails:y}=qt(e,a,C,p,u,f,W);if(!l||l.length===0)return t.jsxs("div",{className:"text-center p-8",children:[t.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-pink-100 to-rose-100 rounded-full mb-4",children:t.jsx("svg",{className:"w-8 h-8 text-pink-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),t.jsx("p",{className:"text-slate-400 font-medium",children:"No hay datos para mostrar en el gráfico"})]});const F=c.width,Y=c.height,Q=i!=null?_(i):null,q=!!(y!=null&&y.confirmed),lt=i!=null,s=P(0),b=l.length>0?P(l.length-1):F-Z.right,r=q?"#F59E0B":"#94A3B8",w=q?"6 4":"4 4",h=q?1:.7,v=3,S=F===0,I=Y-Z.bottom,A=R.useMemo(()=>{const T=new Map;return j.forEach(M=>{M&&M.id!=null&&T.set(M.id,M)}),T},[j]),K=R.useMemo(()=>{if(!k||!(y!=null&&y.confirmed))return[];const T=[];let M=[],ot=null;for(let g=0;g<l.length;g++){const D=l[g],V=A.get(D==null?void 0:D.id);if(!(V&&g<=y.confirmationIndex)){M.length>0&&(T.push(M),M=[]),ot=null;continue}const ut=P(g),yt=_(V.displayTemperature);M.length>0&&ot!==null&&g!==ot+1&&(T.push(M),M=[]),M.push({x:ut,y:yt,index:g}),ot=g}return M.length>0&&T.push(M),T.filter(g=>g.length>=2).map(g=>{let D=`M ${g[0].x} ${I} L ${g[0].x} ${g[0].y}`;for(let V=1;V<g.length;V++){const nt=g[V];D+=` L ${nt.x} ${nt.y}`}return D+=` L ${g[g.length-1].x} ${I} Z`,D})},[k,y,l,A,P,_,I]),st=R.useMemo(()=>{if(!k||!(y!=null&&y.confirmed))return[];if(y.infertileStartIndex==null)return[];const T=[];let M=[],ot=null;for(let g=0;g<l.length;g++){const D=l[g],V=A.get(D==null?void 0:D.id);if(!(V&&g>=y.infertileStartIndex)){M.length>0&&(T.push(M),M=[]),ot=null;continue}const ut=P(g),yt=_(V.displayTemperature);M.length>0&&ot!==null&&g!==ot+1&&(T.push(M),M=[]),M.push({x:ut,y:yt,index:g}),ot=g}return M.length>0&&T.push(M),T.filter(g=>g.length>=2).map(g=>{let D=`M ${g[0].x} ${I} L ${g[0].x} ${g[0].y}`;for(let V=1;V<g.length;V++){const nt=g[V];D+=` L ${nt.x} ${nt.y}`}return D+=` L ${g[g.length-1].x} ${I} Z`,D})},[k,y,l,A,P,_,I]),[et,pt]=R.useState({w:typeof window<"u"?window.innerWidth:0,h:typeof window<"u"?window.innerHeight:0}),at=et.w<et.h;R.useEffect(()=>{const T=()=>pt({w:window.innerWidth,h:window.innerHeight});return window.addEventListener("resize",T),window.addEventListener("orientationchange",T),()=>{window.removeEventListener("resize",T),window.removeEventListener("orientationchange",T)}},[]),R.useEffect(()=>{if(!G.current)return;const T=G.current.clientWidth/f;G.current.scrollLeft=Math.max(0,T*d)},[d,f,c.width,C]);const ct=W&&at,dt=ct,ft="w-full h-full bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100",ht=a?`${ft} min-h-full ${dt?"flex items-stretch justify-start overflow-y-auto overflow-x-hidden":"flex items-center justify-start overflow-x-auto overflow-y-hidden"}`:`${ft} overflow-x-auto overflow-y-hidden border border-pink-100/50`,$=!a||C==="portrait";return t.jsxs(U.div,{className:"relative w-full h-full",initial:!1,children:[$&&t.jsx("div",{className:"absolute left-0 top-0 h-full bg-transparent pointer-events-none z-10",style:{width:Z.left},children:t.jsx(Ht,{padding:Z,chartHeight:Y,tempMin:O,tempMax:B,tempRange:N,getY:_,responsiveFontSize:J,textRowHeight:rt,isFullScreen:a})}),t.jsxs(U.div,{ref:G,className:`relative p-0 ${a?"":"rounded-2xl"} ${ht}`,style:{boxShadow:a?"inset 0 1px 3px rgba(244, 114, 182, 0.1)":"0 8px 32px rgba(244, 114, 182, 0.12), 0 2px 8px rgba(244, 114, 182, 0.08)",...ct?{position:"absolute",top:0,left:0,width:`${et.h}px`,height:`${et.w}px`,transform:"rotate(90deg) translateY(-100%)",transformOrigin:"top left"}:{}},initial:!1,children:[S&&t.jsx("div",{className:"flex items-center justify-center w-full h-full text-slate-400",children:"Cargando..."}),t.jsxs(U.svg,{width:F,height:Y,className:"font-sans flex-shrink-0",viewBox:`0 0 ${F} ${Y}`,preserveAspectRatio:"xMidYMid meet",initial:!1,children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),t.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),t.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),t.jsxs("linearGradient",{id:"tempAreaGradientChart",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(244,114,182,0.25)"}),t.jsx("stop",{offset:"50%",stopColor:"rgba(236,72,153,0.15)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(233,30,99,0.05)"})]}),t.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[t.jsx("rect",{width:"6",height:"6",fill:"#f3f4f6"}),t.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(239,68,68,0.7)"})]}),t.jsxs("filter",{id:"chartShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsxs("filter",{id:"baselineGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsxs("linearGradient",{id:"fertileAreaGradient",x1:"0%",y1:"100%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(253, 224, 255, 0.9)"}),t.jsx("stop",{offset:"65%",stopColor:"rgba(249, 168, 212, 0.6)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(236, 72, 153, 0.28)"})]}),t.jsxs("linearGradient",{id:"infertileAreaGradient",x1:"0%",y1:"100%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(109, 189, 245, 0.48)"}),t.jsx("stop",{offset:"50%",stopColor:"rgba(111, 168, 220, 0.48)"}),t.jsx("stop",{offset:"80%",stopColor:"rgba(120, 143, 207, 0.48)"})]})]}),t.jsx("rect",{width:"100%",height:"100%",fill:"transparent"}),t.jsx(Bt,{padding:Z,chartWidth:F,chartHeight:Y,tempMin:O,tempMax:B,tempRange:N,getY:_,getX:P,allDataPoints:l,responsiveFontSize:J,isFullScreen:a,showLeftLabels:!$,reduceMotion:m}),k&&(y==null?void 0:y.confirmed)&&t.jsxs(t.Fragment,{children:[K.map((T,M)=>t.jsx("path",{d:T,fill:"url(#fertileAreaGradient)",opacity:.65,pointerEvents:"none"},`fertile-area-${M}`)),st.map((T,M)=>t.jsx("path",{d:T,fill:"url(#infertileAreaGradient)",opacity:.6,pointerEvents:"none"},`infertile-area-${M}`))]}),k&&lt&&Q!==null&&(m?t.jsx("line",{x1:s,y1:Q,x2:b,y2:Q,stroke:r,strokeWidth:v,strokeDasharray:w,opacity:h}):t.jsx(U.path,{d:`M ${s} ${Q} L ${b} ${Q}`,stroke:r,strokeWidth:v,strokeDasharray:w,opacity:h,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:h},transition:{duration:4,ease:"easeInOut",delay:.5}})),t.jsx(vt,{data:j,allDataPoints:l,getX:P,getY:_,baselineY:Y-Z.bottom,temperatureField:"displayTemperature",reduceMotion:m}),t.jsx(Ut,{data:l,getX:P,getY:_,isFullScreen:a,orientation:C,responsiveFontSize:J,onPointInteraction:tt,clearActivePoint:z,activePoint:x,padding:Z,chartHeight:Y,chartWidth:F,temperatureField:"displayTemperature",textRowHeight:rt,compact:!1,reduceMotion:m,showInterpretation:k,ovulationDetails:y})]}),x&&t.jsx(U.div,{ref:o,initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:10},transition:{duration:.2,ease:"easeOut"},children:t.jsx(St,{point:x,position:n,chartWidth:F,chartHeight:Y,onToggleIgnore:X,onEdit:E,onClose:z})})]})]})};function oe(e,a){if(!e||!a)return[];const C=typeof e=="string"?Lt(e):e;return[...Array(a)].map((p,E)=>{const u=At(C,E),d=jt(u,"yyyy-MM-dd"),f=jt(u,"dd/MM"),k=Gt(xt(u),xt(C))+1;return{date:f,isoDate:d,cycleDay:k,temperature:null,mucusSensation:null,mucusAppearance:null,id:`placeholder-${d}`,ignored:!1}})}export{ee as F,te as R,oe as g};
