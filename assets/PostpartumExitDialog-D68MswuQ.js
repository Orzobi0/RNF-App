import{c as X,j as e,B as c,k as f,C as Y,o as n,f as m,g as B,r as $}from"./index-Do8Ydwb3.js";import{b as Z,c as J,d as K,e as Q,i as ve,u as re}from"./useBackClose-CETyKRQ2.js";import{O as le}from"./DeletionDialog-eRV-pJhK.js";import{l as w,i as T}from"./badge-DykpjFnT.js";import{i as je,D as ie,a as ne,b as oe,c as ce,d as de,e as fe}from"./useCycleData-Dq0sFEDe.js";const ke=X("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),Oe=X("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]),Ne=X("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),se=s=>{if(!s)return"";const l=new Date(s);if(Number.isNaN(l.getTime()))return s;const u=String(l.getDate()).padStart(2,"0"),i=String(l.getMonth()+1).padStart(2,"0"),h=String(l.getFullYear());return`${u}/${i}/${h}`},Ee=({cycle:s,startDate:l,endDate:u,onStartDateChange:i,onEndDateChange:h,onSave:d,onCancel:L,isProcessing:y=!1,dateError:g="",includeEndDate:b=!0,showOverlapDialog:C=!1,overlapCycle:o=null,onConfirmOverlap:q,onCancelOverlap:I,title:H="Editar fechas del ciclo",description:V="Actualiza las fechas de inicio y fin del ciclo. Guarda los cambios cuando termines.",saveLabel:W="Guardar",cancelLabel:S="Cancelar",onClearError:v,className:z="mb-6 mx-auto w-full max-w-xl",onDeleteCycle:r,deleteTitle:x="Eliminar ciclo",deleteDescription:M="Esta acción no se puede deshacer. Se eliminarán todos los registros asociados.",deleteLabel:ue="Eliminar ciclo",isDeletingCycle:he=!1,onUndoCycle:_,isUndoingCycle:k=!1,otherCycles:me=[]})=>{const U=s?.startDate?se(s.startDate):null,xe=s?.endDate?se(s.endDate):"En curso",ee=U?`Fecha actual: ${U}${b?` — ${xe}`:""}`:null,p=t=>{if(!t)return null;const a=m(t);return B(a)?n(a):null},E=p(l),A=p(u),O=p(s?.startDate),te=p(s?.endDate),ae=(s?.data??[]).map(t=>p(t?.isoDate)).filter(Boolean),j=me.filter(t=>t?.id&&s?.id&&t.id!==s.id).map(t=>{const a=p(t?.startDate),G=p(t?.endDate);return a?{from:a,to:G??a}:null}).filter(Boolean),N=O?{from:O,to:te??O}:void 0,P=(t,a)=>!!(a?.from&&T(t,a.from)),R=(t,a)=>a?.to?T(t,a.to)&&!T(a.from,a.to):!1,F=(t,a)=>!a?.from||!a?.to||T(a.from,a.to)?!1:je(t,a.from)&&ve(t,a.to),D=(t,a,G)=>a.some(be=>G(t,be)),pe=t=>{v&&v(),i?.(t.target.value)},ye=t=>{v&&v(),h?.(t.target.value)},ge=t=>{t.preventDefault(),d?.()};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`${z} rounded-3xl border border-rose-100 bg-white/90 p-5 shadow-md`,children:e.jsx("form",{onSubmit:ge,className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-titulo mb-1",children:H}),e.jsx("p",{className:"text-sm text-slate-600",children:V}),ee&&e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:ee}),e.jsxs("div",{className:`grid ${b?"grid-cols-2 gap-4":"grid-cols-1 gap-4"}`,children:[e.jsxs("label",{className:"flex h-full flex-col text-sm text-slate-700",children:["Inicio del ciclo",e.jsxs(Z,{children:[e.jsx(J,{asChild:!0,children:e.jsxs(c,{type:"button",variant:"outline",className:"mt-1 w-full justify-start border-fertiliapp-suave bg-white text-left font-normal text-slate-800",children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),E?f(E,"PPP",{locale:w}):"Selecciona una fecha"]})}),e.jsx(K,{className:"w-auto p-0",align:"start",children:e.jsx(Q,{mode:"single",selected:E,onSelect:t=>{t&&pe({target:{value:f(n(t),"yyyy-MM-dd")}})},locale:w,initialFocus:!0,defaultMonth:E??O??new Date,enableSwipeNavigation:!0,modifiers:{hasRecord:ae,inActiveCycleStart:t=>P(t,N),inActiveCycleMiddle:t=>F(t,N),inActiveCycleEnd:t=>R(t,N),inOtherCycleStart:t=>D(t,j,P),inOtherCycleMiddle:t=>D(t,j,F),inOtherCycleEnd:t=>D(t,j,R)},modifiersClassNames:{hasRecord:'relative after:content-[""] after:absolute after:inset-x-0 after:bottom-1 after:mx-auto after:h-1.5 after:w-1.5 after:rounded-full after:bg-fertiliapp-fuerte',inActiveCycleStart:"in-cycle-range-start",inActiveCycleMiddle:"in-cycle-range-middle",inActiveCycleEnd:"in-cycle-range-end",inOtherCycleStart:"in-other-cycle-range-start",inOtherCycleMiddle:"in-other-cycle-range-middle",inOtherCycleEnd:"in-other-cycle-range-end"}})})]})]}),b&&e.jsxs("label",{className:"flex h-full flex-col text-sm text-slate-700",children:["Fin del ciclo",e.jsxs(Z,{children:[e.jsx(J,{asChild:!0,children:e.jsxs(c,{type:"button",variant:"outline",className:"mt-1 w-full justify-start border-fertiliapp-suave bg-white text-left font-normal text-slate-800",children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),A?f(A,"PPP",{locale:w}):"Selecciona una fecha"]})}),e.jsx(K,{className:"w-auto p-0",align:"start",children:e.jsx(Q,{mode:"single",selected:A,onSelect:t=>{t&&ye({target:{value:f(n(t),"yyyy-MM-dd")}})},locale:w,initialFocus:!0,defaultMonth:A??te??O??new Date,enableSwipeNavigation:!0,modifiers:{hasRecord:ae,inActiveCycleStart:t=>P(t,N),inActiveCycleMiddle:t=>F(t,N),inActiveCycleEnd:t=>R(t,N),inOtherCycleStart:t=>D(t,j,P),inOtherCycleMiddle:t=>D(t,j,F),inOtherCycleEnd:t=>D(t,j,R)},modifiersClassNames:{hasRecord:'relative after:content-[""] after:absolute after:inset-x-0 after:bottom-1 after:mx-auto after:h-1.5 after:w-1.5 after:rounded-full after:bg-fertiliapp-fuerte',inActiveCycleStart:"in-cycle-range-start",inActiveCycleMiddle:"in-cycle-range-middle",inActiveCycleEnd:"in-cycle-range-end",inOtherCycleStart:"in-other-cycle-range-start",inOtherCycleMiddle:"in-other-cycle-range-middle",inOtherCycleEnd:"in-other-cycle-range-end"}})})]})]})]}),g&&e.jsx("p",{className:"mt-2 text-sm text-red-500",children:g}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-3 justify-center",children:[e.jsx(c,{type:"button",variant:"outline",onClick:L,className:"border-fertiliapp-suave text-titulo hover:brightness-95",disabled:y||k,children:S}),e.jsx(c,{type:"submit",className:"bg-fertiliapp-fuerte text-white shadow hover:brightness-95",disabled:y||k,children:W})]}),_&&e.jsxs("div",{className:"mt-4 rounded-3xl bg-amber-50 p-4 text-left",children:[e.jsx("h3",{className:"font-semibold text-slate-800 mb-2",children:"Deshacer ciclo"}),e.jsx("p",{className:"text-sm text-slate-700 mb-3",children:"Une el ciclo actual con el anterior y mueve todos los registros."}),e.jsx(c,{type:"button",onClick:_,disabled:y||k,className:"w-full sm:w-auto bg-amber-500 hover:brightness-95 text-white shadow-md",children:k?"Deshaciendo…":"Deshacer ciclo"})]}),r&&e.jsxs("div",{className:"mt-6 rounded-3xl bg-alerta-2-suave p-4 text-left",children:[e.jsx("h3",{className:"font-semibold text-slate-800 mb-2",children:x}),M&&e.jsx("p",{className:"text-sm text-slate-800 mb-3",children:M}),e.jsxs(c,{type:"button",onClick:r,disabled:y||he||k,className:"w-full sm:w-auto bg-alerta-2 hover:brightness-95 text-white shadow-md",children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),ue]})]})]})})}),e.jsx(le,{isOpen:C,conflictCycle:o,onCancel:I,onConfirm:q})]})},Ae=({isOpen:s,onClose:l,onConfirm:u,currentCycleStartDate:i,currentCycleRecords:h=[]})=>{const[d,L]=$.useState(f(new Date,"yyyy-MM-dd")),[y,g]=$.useState(!1),[b,C]=$.useState(null);re(s,l);const o=!i,q=$.useMemo(()=>{if(o||!d||!h.length)return!1;const r=n(m(d));return B(r)?h.some(x=>{if(!x?.isoDate)return!1;const M=n(m(x.isoDate));return B(M)?M.getTime()>=r.getTime():!1}):!1},[h,o,d]),I=()=>{if(!o&&q){C(d),g(!0);return}u(d)},H=()=>{b&&(g(!1),u(b),C(null))},V=o?"":f(m(i),"dd/MM/yyyy"),W=(()=>{if(o)return"";const r=new Date(d);return r.setDate(r.getDate()-1),f(r,"dd/MM/yyyy")})(),S=d?n(m(d)):null,v=h.map(r=>{if(!r?.isoDate)return null;const x=n(m(r.isoDate));return B(x)?x:null}).filter(Boolean),z=i?{from:n(m(i)),to:n(new Date)}:void 0;return e.jsxs(e.Fragment,{children:[e.jsx(ie,{open:s,onOpenChange:l,children:e.jsxs(ne,{className:"bg-white border-pink-100 text-gray-800 rounded-3xl",children:[e.jsxs(oe,{children:[e.jsx(ce,{children:"Iniciar nuevo ciclo"}),e.jsx(de,{className:"text-gray-600",children:o?"Este será tu primer ciclo. Selecciona la fecha de inicio.":`¿Estás seguro de que quieres iniciar un nuevo ciclo? Los datos del ciclo actual (${V} - ${W}) serán archivados.`})]}),e.jsxs("div",{className:"my-4 space-y-2",children:[e.jsx("label",{htmlFor:"startDate",className:"text-gray-700 text-sm",children:"Fecha de inicio del nuevo ciclo"}),e.jsxs(Z,{children:[e.jsx(J,{asChild:!0,children:e.jsxs(c,{type:"button",variant:"outline",className:"mt-1 w-full justify-start border-gray-200 bg-gray-50 text-left font-normal text-gray-800",children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),S?f(S,"PPP",{locale:w}):"Selecciona una fecha"]})}),e.jsx(K,{className:"w-auto p-0",align:"start",children:e.jsx(Q,{mode:"single",selected:S,onSelect:r=>{r&&L(f(n(r),"yyyy-MM-dd"))},locale:w,initialFocus:!0,disabled:[{after:n(new Date)},...o?[]:[{before:n(m(i))}]],modifiers:{hasRecord:v,inActiveCycle:z},modifiersClassNames:{hasRecord:'relative after:content-[""] after:absolute after:inset-x-0 after:bottom-1 after:mx-auto after:h-1.5 after:w-1.5 after:rounded-full after:bg-fertiliapp-fuerte',inActiveCycle:"in-cycle-soft-outline"}})})]})]}),e.jsxs(fe,{className:"sm:justify-end",children:[e.jsx(c,{variant:"outline",onClick:l,className:"border-gray-300 text-subtitulo hover:brightness-95",children:"Cancelar"}),e.jsx(c,{variant:"primary",onClick:I,className:"bg-fertiliapp-fuerte hover:brightness-95 text-white",children:o?"Iniciar ciclo":"Confirmar nuevo ciclo"})]})]})}),e.jsx(le,{isOpen:y,onCancel:()=>{g(!1),C(null)},onConfirm:H,conflictCycle:o?null:{startDate:i,endDate:null},message:"Este nuevo ciclo actual coincide en fechas con el ciclo anterior. Los registros se pasarán al nuevo ciclo si continúas. ¿Deseas continuar?"})]})},Pe=({isOpen:s,onClose:l,onConfirm:u})=>(re(s,l),e.jsx(ie,{open:s,onOpenChange:i=>{i||l()},children:e.jsxs(ne,{className:"bg-white/95 backdrop-blur border border-fertiliapp-fuerte text-slate-700",children:[e.jsxs(oe,{children:[e.jsx(ce,{className:"text-lg font-semibold text-fertiliapp-fuerte",children:"Modo postparto activado"}),e.jsx(de,{className:"text-slate-600",children:"Se ha añadido un nuevo ciclo. ¿Deseas desactivar el modo postparto?"})]}),e.jsxs(fe,{className:"sm:justify-end gap-2",children:[e.jsx(c,{type:"button",variant:"outline",onClick:l,className:"border-pink-200 text-fertiliapp-fuerte hover:bg-pink-50 hover:text-fertiliapp-fuerte",children:"No"}),e.jsx(c,{type:"button",onClick:u,className:"bg-fertiliapp-fuerte hover:brightness-95 text-white shadow-lg",children:"Sí"})]})]})}));export{Ee as C,ke as L,Ae as N,Pe as P,Ne as T,Oe as a};
