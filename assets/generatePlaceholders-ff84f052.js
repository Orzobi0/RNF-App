import{c as xt,m as P,j as t,r as N}from"./index-b896ef43.js";import{g as pt,i as ut}from"./DataEntryForm-99bdedea.js";import{s as Q,p as dt,b as yt,f as rt,d as mt}from"./useCycleData-4dcbf14b.js";import{C as gt}from"./ChartTooltip-6a801a66.js";const Pt=xt("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),jt=({padding:e,chartWidth:i,chartHeight:u,tempMin:x,tempMax:T,tempRange:h,getY:f,getX:a,allDataPoints:k=[],responsiveFontSize:p,isFullScreen:W,showLeftLabels:C=!1,reduceMotion:c=!1})=>{const m={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.3,ease:"easeOut"}}},v=[];if(h>0){const j=h<=2.5?.1:.5;for(let M=x;M<=T+1e-9;M+=j)v.push(parseFloat(M.toFixed(1)))}else for(let j=35;j<=37.5+1e-9;j+=.5)v.push(parseFloat(j.toFixed(1)));const b=c?"g":P.g;return t.jsxs(t.Fragment,{children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"bgGradientChart",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(254, 242, 242, 0.95)"}),t.jsx("stop",{offset:"30%",stopColor:"rgba(255, 241, 242, 0.9)"}),t.jsx("stop",{offset:"70%",stopColor:"rgba(255, 245, 255, 0.95)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(254, 242, 242, 0.8)"})]}),t.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),t.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),t.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),t.jsxs("filter",{id:"chartGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsx("filter",{id:"textShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:t.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodColor:"rgba(255, 255, 255, 0.8)"})}),t.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[t.jsx("rect",{width:"6",height:"6",fill:"#f3f4f6"}),t.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(239,68,68,0.7)"})]})]}),t.jsx("rect",{x:e.left,y:e.top,width:i-e.left-e.right,height:u-e.top-e.bottom,fill:"url(#bgGradientChart)",opacity:2,rx:12,style:{filter:"drop-shadow(0 4px 12px rgba(244, 114, 182, 0.1))"}}),v.map((j,M)=>{const L=f(j),A=j.toFixed(1).endsWith(".0")||j.toFixed(1).endsWith(".5"),$=A?j.toFixed(1):`.${j.toFixed(1).split(".")[1]}`;return t.jsxs(b,{...c?{}:{variants:m},children:[t.jsx("line",{x1:e.left,y1:L,x2:i-e.right,y2:L,stroke:A?"rgba(244, 114, 182, 0.3)":"rgba(244, 114, 182, 0.15)",strokeWidth:A?2:1,strokeDasharray:A?"0":"4,4",style:{filter:A?"drop-shadow(0 1px 3px rgba(244, 114, 182, 0.15))":"none",opacity:A?1:.7}}),C&&t.jsx("text",{x:e.left-p(1),y:L+p(.35),textAnchor:"end",fontSize:p(A?1.1:1),fontWeight:A?"700":"600",fill:A?"#E91E63":"#EC4899",style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:$}),t.jsx("text",{x:i-e.right+p(1),y:L+p(.35),textAnchor:"start",fontSize:p(A?1.1:1),fontWeight:A?"700":"600",fill:A?"#E91E63":"#EC4899",style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:$})]},`temp-tick-${M}`)}),k.map((j,M)=>{const L=a(M);return t.jsx("line",{x1:L,y1:e.top,x2:L,y2:u-e.bottom,stroke:"rgba(244, 114, 182, 0.08)",strokeWidth:2.8,style:{filter:"drop-shadow(0 0 1px rgba(244, 114, 182, 0.05))"}},`day-grid-${M}`)}),t.jsx("rect",{x:e.left,y:e.top,width:i-e.left-e.right,height:u-e.top-e.bottom,fill:"none",stroke:"rgba(244, 114, 182, 0.4)",strokeWidth:2,rx:12,style:{filter:"drop-shadow(0 4px 12px rgba(244, 114, 182, 0.15))",strokeDasharray:"0"}}),C&&t.jsx(b,{...c?{}:{variants:m},children:t.jsx("text",{x:e.left+p(1.2),y:e.top+p(1.5),textAnchor:"middle",fontSize:p(1.4),fontWeight:"800",fill:"#E91E63",style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:"°C"})})]})},wt=({data:e,allDataPoints:i,getX:u,getY:x,baselineY:T,temperatureField:h="temperature",reduceMotion:f=!1})=>{if(!e||e.length<2)return null;let a="",k=null;return i.forEach((p,W)=>{const C=e.find(c=>c.id===p.id);if(C&&C[h]!==null&&C[h]!==void 0&&!C.ignored){const c=u(W),m=x(C[h]);k!==null&&W===k+1?a+=` L ${c} ${m}`:a+=`${a?" ":""}M ${c} ${m}`,k=W}}),a.includes("L")?t.jsxs(t.Fragment,{children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),t.jsx("stop",{offset:"30%",stopColor:"#EC4899"}),t.jsx("stop",{offset:"70%",stopColor:"#E91E63"}),t.jsx("stop",{offset:"100%",stopColor:"#C2185B"})]}),t.jsxs("linearGradient",{id:"tempLineGradientChartGlow",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(244, 114, 182, 0.6)"}),t.jsx("stop",{offset:"30%",stopColor:"rgba(236, 72, 153, 0.7)"}),t.jsx("stop",{offset:"70%",stopColor:"rgba(233, 30, 99, 0.8)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(194, 24, 91, 0.6)"})]}),t.jsxs("filter",{id:"lineGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"4",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsx("filter",{id:"lineShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:t.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"3",floodColor:"rgba(244, 114, 182, 0.4)"})})]}),f?t.jsx("path",{d:a,fill:"none",stroke:"url(#tempLineGradientChartGlow)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:.4,style:{filter:"url(#lineGlow)"}}):t.jsx(P.path,{d:a,fill:"none",stroke:"url(#tempLineGradientChartGlow)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:.4,style:{filter:"url(#lineGlow)"},initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.4},transition:{duration:.8,ease:"easeInOut",delay:.2}}),f?t.jsx("path",{d:a,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#lineShadow)"}}):t.jsx(P.path,{d:a,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#lineShadow)"},initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:1},transition:{duration:1,ease:"easeInOut",delay:.4}}),f?t.jsx("path",{d:a,fill:"none",stroke:"rgba(255, 255, 255, 0.6)",strokeWidth:"0.3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.8}):t.jsx(P.path,{d:a,fill:"none",stroke:"rgba(255, 255, 255, 0.6)",strokeWidth:"0.3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.8,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.8},transition:{duration:1.2,ease:"easeInOut",delay:.6}})]}):null},nt="#1565C0",it="#2E7D32",lt="#6A1B9A",bt="#EFF6FF",Ct="#EEF2FF",Et="#ECFDF5",kt="#F0FDFA",Lt="#F5F3FF",Mt="#FAF5FF",vt="rgba(148, 163, 184, 0.35)",At="rgba(226, 232, 240, 0.6)",Bt="rgba(148, 163, 184, 0.5)",Gt=e=>{if(!e)return"";const[i,u]=e.split("/");return`${parseInt(i,10)}/${parseInt(u,10)}`},tt=(e="",i,u,x="–")=>{if(!e)return[x,""];if(e.length<=i)return[e,""];if(u)return[e.slice(0,i),""];const T=e.indexOf(" ",i);return T===-1?[e.slice(0,i),e.slice(i)]:[e.slice(0,T),e.slice(T+1)]},et=(e="",i,u="–")=>e?e.split(/\s+/).slice(0,i).join(" "):u,Tt=({data:e,getX:i,getY:u,isFullScreen:x,orientation:T,responsiveFontSize:h,onPointInteraction:f,clearActivePoint:a,activePoint:k,padding:p,chartHeight:W,chartWidth:C,temperatureField:c="temperature_chart",textRowHeight:m,compact:v=!1,reduceMotion:b=!1})=>{const j={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},M={hidden:{opacity:0,scale:.3},visible:{opacity:1,scale:1,transition:{duration:.6,ease:[.34,1.56,.64,1],type:"spring",stiffness:120,damping:12}}},L=W-p.bottom,A=L+m*1,$=L+m*2,S=L+m*3,V=L+m*(x?5:4.5),I=L+m*(x?7:6),R=L+m*(x?9:7.5),H=C-p.left-p.right,Y=m*(x?2:1.5),X=b?"g":P.g;return t.jsxs(t.Fragment,{children:[t.jsxs("defs",{children:[t.jsx("filter",{id:"rowShadowChart",x:"-10%",y:"-10%",width:"120%",height:"120%",children:t.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"4",floodColor:"rgba(244, 114, 182, 0.2)"})}),t.jsxs("filter",{id:"pointGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsxs("linearGradient",{id:"sensationGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:bt}),t.jsx("stop",{offset:"100%",stopColor:Ct})]}),t.jsxs("linearGradient",{id:"appearanceGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:Et}),t.jsx("stop",{offset:"100%",stopColor:kt})]}),t.jsxs("linearGradient",{id:"observationGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:Lt}),t.jsx("stop",{offset:"100%",stopColor:Mt})]}),t.jsxs("radialGradient",{id:"tempPointGradientChart",cx:"30%",cy:"30%",children:[t.jsx("stop",{offset:"0%",stopColor:"#FCE7F3"}),t.jsx("stop",{offset:"40%",stopColor:"#F472B6"}),t.jsx("stop",{offset:"80%",stopColor:"#E91E63"}),t.jsx("stop",{offset:"100%",stopColor:"#C2185B"})]}),t.jsxs("radialGradient",{id:"tempPointIgnoredGradient",cx:"30%",cy:"30%",children:[t.jsx("stop",{offset:"0%",stopColor:"#FFFFFF"}),t.jsx("stop",{offset:"80%",stopColor:"#F8FAFC"}),t.jsx("stop",{offset:"100%",stopColor:"#E2E8F0"})]})]}),!v&&t.jsxs("g",{children:[t.jsx("rect",{x:p.left,y:V-Y/2,width:H,height:Y,fill:"url(#sensationGradientChart)",rx:4,style:{filter:"url(#rowShadowChart)"}}),t.jsx("rect",{x:p.left,y:I-Y/2,width:H,height:Y,fill:"url(#appearanceGradientChart)",rx:4,style:{filter:"url(#rowShadowChart)"}}),t.jsx("rect",{x:p.left,y:R-Y/2,width:H,height:Y,fill:"url(#observationGradientChart)",rx:4,style:{filter:"url(#rowShadowChart)"}})]}),x&&T!=="portrait"&&t.jsx(P.g,{variants:j,children:[{label:"Fecha",row:1,color:x?"#374151":"#6B7280"},{label:"Día",row:2,color:x?"#374151":"#6B7280"},{label:"Símbolo",row:3,color:x?"#374151":"#6B7280"},{label:"Sens.",row:x?5:4.5,color:nt},{label:"Apar.",row:x?7:6,color:it},{label:"Observ.",row:x?9:7.5,color:lt}].map(({label:r,row:U,color:y})=>t.jsx("text",{x:p.left-h(.5),y:L+m*U,textAnchor:"end",fontSize:h(1.05),fontWeight:"700",fill:y,style:{filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:r},r))}),e.map((r,U)=>{const y=i(U),B=r[c]!=null?u(r[c]):L,D=r.temperature_raw,F=r.temperature_corrected,z=r.use_corrected&&D!=null&&F!=null&&Math.abs(F-D)>.01,q=z?u(D):null,K=x?"#374151":"#6B7280",s=r[c]!=null,n=s||r.mucus_sensation||r.mucus_appearance||r.fertility_symbol,o=String(r.id||"").startsWith("placeholder-"),d=!n||o?{}:{pointerEvents:"all",style:{cursor:"pointer"},onMouseEnter:_=>f(r,U,_),onClick:_=>f(r,U,_)},l=pt(r.fertility_symbol);let w="transparent";if(l!=null&&l.color){const _=l.color.replace(/^bg-/,"");_==="red-500"?w="#ef4444":_==="white"?w="#ffffff":_==="green-500"?w="#22c55e":_==="pink-300"&&(w="#f9a8d4")}const g=h(x?1.8:2),E=r.isoDate?ut(Q(dt(r.isoDate)),Q(new Date)):!1,G=x?4:9,O=2,[J,Z]=tt(x?et(r.mucus_sensation,O,E?"":"–"):r.mucus_sensation,G,!1,E?"":"–"),[ht,ot]=tt(x?et(r.mucus_appearance,O,E?"":"–"):r.mucus_appearance,G,!1,E?"":"–"),[ft,st]=tt(x?et(r.observations,O,""):r.observations,G,!1,"");return t.jsxs(X,{...b?{}:{variants:j},...d,children:[s&&t.jsxs(X,{...b?{}:{variants:M},children:[z&&q!==null&&t.jsxs("g",{pointerEvents:"none",children:[t.jsx("line",{x1:y,y1:q,x2:y,y2:B,stroke:vt,strokeWidth:1,strokeDasharray:"4 4"}),t.jsx("circle",{cx:y,cy:q,r:3.5,fill:At,stroke:Bt,strokeWidth:1}),t.jsx("circle",{cx:y,cy:q,r:1.2,fill:"rgba(255, 255, 255, 0.6)"})]}),t.jsx("circle",{cx:y,cy:B,r:1.5,fill:"rgba(244, 114, 182, 0.2)",opacity:.8,style:{filter:"url(#pointGlow)"}}),t.jsx("circle",{cx:y,cy:B,r:3.5,fill:"none",stroke:r.ignored?"rgba(148, 163, 184, 0.4)":"rgba(244, 114, 182, 0.3)",strokeWidth:1.5,opacity:.6}),t.jsx("circle",{cx:y,cy:B,r:4,fill:r.ignored?"url(#tempPointIgnoredGradient)":"url(#tempPointGradientChart)",stroke:r.use_corrected?"#F59E0B":r.ignored?"#94A3B8":"#E91E63",strokeWidth:r.ignored?2:3,style:{filter:"drop-shadow(0 3px 6px rgba(244, 114, 182, 0.4))",cursor:"pointer"},pointerEvents:"all",onMouseEnter:_=>f(r,U,_),onTouchStart:_=>f(r,U,_),onClick:_=>f(r,U,_)}),!r.ignored&&t.jsx("circle",{cx:y,cy:B,r:1.5,fill:"rgba(255, 255, 255, 0.9)",style:{filter:"drop-shadow(0 1px 2px rgba(244, 114, 182, 0.3))"}})]}),t.jsx("text",{x:y,y:A,textAnchor:"middle",fontSize:h(1.05),fontWeight:"900",fill:K,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:Gt(r.date)}),t.jsx("text",{x:y,y:$,textAnchor:"middle",fontSize:h(1),fontWeight:"900",fill:K,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:r.cycleDay}),!o&&(l.value!=="none"?t.jsxs("g",{children:[t.jsx("rect",{x:y-g/2+1,y:S-g*.75+1,width:g,height:g,fill:"rgba(0, 0, 0, 0.1)",rx:g*.3,opacity:.5}),t.jsx("rect",{x:y-g/2-4,y:S-g*.75,width:g*1.4,height:g,fill:l.pattern==="spotting-pattern"?"url(#spotting-pattern-chart)":w,stroke:l.value==="white"?"#CBD5E1":"rgba(233, 30, 99, 0.4)",strokeWidth:l.value==="white"?2:1,rx:g*.2,style:{filter:"drop-shadow(0 2px 4px rgba(244, 114, 182, 0.25))"}})]}):t.jsx("text",{x:y,y:S,textAnchor:"middle",fontSize:h(1),fill:K,fontWeight:"500",style:{filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:"–"})),!v&&t.jsxs("text",{x:y,y:V,textAnchor:"middle",fontSize:h(.9),fontWeight:"700",fill:nt,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[t.jsx("tspan",{x:y,dy:0,children:J}),Z&&t.jsx("tspan",{x:y,dy:h(1.1),children:Z})]}),!v&&t.jsxs("text",{x:y,y:I,textAnchor:"middle",fontSize:h(.9),fontWeight:"700",fill:it,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[t.jsx("tspan",{x:y,dy:0,children:ht}),ot&&t.jsx("tspan",{x:y,dy:h(1.1),children:ot})]}),!v&&t.jsxs("text",{x:y,y:R,textAnchor:"middle",fontSize:h(.9),fontWeight:"700",fill:lt,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[t.jsx("tspan",{x:y,dy:0,children:ft}),st&&t.jsx("tspan",{x:y,dy:h(1.1),children:st})]})]},`pt-${U}-${r.isoDate||r.timestamp}`)})]})},Wt="#1565C0",Rt="#2E7D32",Dt="#6A1B9A",Ot=({padding:e,chartHeight:i,tempMin:u,tempMax:x,tempRange:T,getY:h,responsiveFontSize:f,textRowHeight:a,isFullScreen:k})=>{const p={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},W=[];if(T>0){const c=T<=2.5?.1:.5;for(let m=u;m<=x+1e-9;m+=c)W.push(parseFloat(m.toFixed(1)))}else for(let c=35;c<=37.5+1e-9;c+=.5)W.push(parseFloat(c.toFixed(1)));const C=i-e.bottom;return t.jsxs("svg",{width:e.left,height:i,className:"font-sans pointer-events-none",children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"legendBgGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(255, 228, 230, 1)"}),t.jsx("stop",{offset:"30%",stopColor:"rgba(255, 229, 235, 1)  "}),t.jsx("stop",{offset:"70%",stopColor:"rgba(255, 241, 242, 1)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(255, 236, 240, 0.6)"})]}),t.jsxs("linearGradient",{id:"legendAccentGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),t.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),t.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),t.jsx("filter",{id:"legendShadowChart",x:"-20%",y:"-20%",width:"140%",height:"140%",children:t.jsx("feDropShadow",{dx:"0",dy:"3",stdDeviation:"4",floodColor:"rgba(244, 114, 182, 0.2)"})}),t.jsx("filter",{id:"textShadowLegend",x:"-50%",y:"-50%",width:"200%",height:"200%",children:t.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodColor:"rgba(255, 255, 255, 0.9)"})})]}),t.jsx("rect",{x:0,y:C+a*.5,width:e.left,height:a*(k?9.5:8),fill:"url(#legendBgGradientChart)",rx:12,style:{filter:"url(#legendShadowChart)"}}),W.map((c,m)=>{const v=h(c),b=c.toFixed(1).endsWith(".0")||c.toFixed(1).endsWith(".5"),j=b?c.toFixed(1):`.${c.toFixed(1).split(".")[1]}`;return t.jsx(P.g,{variants:p,children:t.jsx("text",{x:e.left-f(1.2),y:v+f(.35),textAnchor:"end",fontSize:f(b?1.15:1),fontWeight:b?"800":"700",fill:b?"#E91E63":"#EC4899",style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:j})},`temp-tick-fixed-${m}`)}),t.jsx(P.g,{variants:p,children:[{label:"Fecha",row:1,color:"#374151",icon:null},{label:"Día",row:2,color:"#374151",icon:null},{label:"Símbolo",row:3,color:"#374151",icon:null},{label:"Sens.",row:k?5:4.5,color:Wt,icon:"◊"},{label:"Apar.",row:k?7:6,color:Rt,icon:"○"},{label:"Observ.",row:k?9:7.5,color:Dt,icon:"✦"}].map(({label:c,row:m,color:v,icon:b})=>t.jsxs("g",{children:[b&&t.jsx("text",{x:e.left-f(2.8),y:C+a*m,textAnchor:"middle",fontSize:f(.8),fontWeight:"600",fill:v,opacity:.7,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:b}),t.jsx("text",{x:e.left-f(.8),y:C+a*m,textAnchor:"end",fontSize:f(1.05),fontWeight:"800",fill:v,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:c})]},c))})]})},at=35.5,ct=37.5,Nt=(e,i,u,x,T,h=5,f=!1)=>{const a=N.useRef(null),k=N.useRef(null),[p,W]=N.useState({width:0,height:0}),[C,c]=N.useState(null),[m,v]=N.useState({x:0,y:0}),b=N.useMemo(()=>{const s=o=>{if(o==null||o==="")return null;const d=parseFloat(String(o).replace(",","."));return Number.isFinite(d)?d:null},n=o=>{if(!o)return null;const d=s(o.temperature),l=s(o.temperature_corrected);return o.use_corrected&&l!==null?l:d!==null?d:l!==null?l:null};return e.map(o=>{const d=[o==null?void 0:o.temperature_chart,o==null?void 0:o.temperature_raw,o==null?void 0:o.temperature_corrected];let l=null;for(const w of d)if(w!=null&&w!==""){l=w;break}if(l==null&&Array.isArray(o==null?void 0:o.measurements)){const g=o.measurements.find(E=>E&&E.selected&&n(E)!==null)||o.measurements.find(E=>n(E)!==null);g&&(l=n(g))}return{...o,displayTemperature:s(l)}})},[e]);N.useLayoutEffect(()=>{const s=()=>{if(!a.current)return;const o=a.current.parentElement||a.current;let d=o.clientWidth||600,l=o.clientHeight||400,w=a.current.clientWidth>0?a.current.clientWidth:d,g,E;if(i){let G=window.innerWidth,O=window.innerHeight;if(f&&O>G&&([G,O]=[O,G]),w=G,u==="portrait"&&!f){const J=Math.max(30,G*.05);g=(G-J)/h*e.length}else g=G/h*e.length;E=O}else g=w/h*e.length,E=l;W({width:g,height:E})};s(),window.addEventListener("resize",s);let n;if(a.current){const o=a.current.parentElement||a.current;n=new ResizeObserver(s),n.observe(o)}return()=>{window.removeEventListener("resize",s),n&&n.disconnect()}},[i,e.length,h,u,f]);const j=N.useMemo(()=>b.filter(s=>s&&s.isoDate&&!s.ignored&&s.displayTemperature!==null&&s.displayTemperature!==void 0),[b]),M=N.useMemo(()=>b.filter(s=>s&&s.isoDate),[b]),{baselineTemp:L,baselineStartIndex:A}=N.useMemo(()=>{const s=n=>n&&n.displayTemperature!=null&&!n.ignored;for(let n=0;n<b.length;n++){const o=b[n];if(!s(o))continue;const d=[];let l=null,w=null;for(let g=n-1;g>=0&&d.length<6;g--){const E=b[g];s(E)&&(d.unshift({index:g,temp:E.displayTemperature}),(l===null||E.displayTemperature>l)&&(l=E.displayTemperature,w=g))}if(!(d.length<6)&&!(l===null||!Number.isFinite(l)||w===null||!Number.isFinite(w))&&o.displayTemperature>l)return{baselineTemp:l,baselineStartIndex:w}}return{baselineTemp:null,baselineStartIndex:null}},[b]),{tempMin:$,tempMax:S}=N.useMemo(()=>{const s=j.map(d=>d.displayTemperature).filter(d=>d!=null);if(s.length===0)return{tempMin:at,tempMax:ct};let n=Math.min(...s,at),o=Math.max(...s,ct);if(n=Math.floor(n*2)/2,o=Math.ceil(o*2)/2,o-n<2){const d=(n+o)/2;n=d-1,o=d+1}return{tempMin:n,tempMax:o}},[j]),V=S-$,I=p.width,R=p.height,H=9,Y=(s=1)=>{if(!i)return H*s;const n=Math.min(I,R);return Math.max(8,Math.min(H*s,n/(M.length>0?40/s:40)))},X=Y(i?1.6:2.5),r=f||u==="landscape",y=X*(r?9:5),B={top:i?Math.max(r?6:12,R*(r?.015:.03)):12,right:i?Math.max(r?35:30,I*(r?.02:.05)):50,bottom:(i?Math.max(r?0:40,R*(r?0:.11)):60)+y+25,left:i?Math.max(r?45:20,I*(r?.02:.05)):50},D=s=>{if(s==null||V===0)return R-B.bottom;const n=R-B.top-B.bottom;return n<=0?R-B.bottom:R-B.bottom-(s-$)/V*n},F=s=>{const n=i&&!(f||u==="landscape")?5:10,o=i&&!(f||u==="landscape")?25:0,d=I-B.left-B.right-n-o*(M.length-1);if(d<=0)return B.left+n+o*s;const l=M.length>1?M.length-1:1;return l===0||M.length===0?B.left+n+o*s:B.left+n+s*(d/(M.length===1?1:l))+o*s},z=(s,n,o)=>{if(!s||String(s.id).startsWith("placeholder-")){q();return}const d=a.current.getBoundingClientRect();let l,w;if(o.type.startsWith("touch")){const G=o.changedTouches[0];l=G.clientX,w=G.clientY}else l=o.clientX,w=o.clientY;const g=F(n),E=D(s.displayTemperature);v({svgX:g,svgY:E,clientX:l-d.left+a.current.scrollLeft,clientY:w-d.top+a.current.scrollTop}),c(s)};N.useEffect(()=>{const s=n=>{var o;if(k.current&&!k.current.contains(n.target)){const d=(o=a.current)==null?void 0:o.querySelectorAll("circle, text, rect");let l=!1;if(d){for(let w of d)if(w.contains(n.target)){l=!0;break}}l||c(null)}};return C&&(document.addEventListener("mousedown",s),document.addEventListener("touchstart",s)),()=>{document.removeEventListener("mousedown",s),document.removeEventListener("touchstart",s)}},[C]);const q=()=>{c(null)};return{chartRef:a,tooltipRef:k,dimensions:p,activePoint:C,tooltipPosition:m,processedData:b,validDataForLine:j,allDataPoints:M,tempMin:$,tempMax:S,tempRange:V,padding:B,textRowHeight:X,setActivePoint:c,getY:D,getX:F,handlePointInteraction:z,clearActivePoint:q,handleToggleIgnore:s=>{x&&s&&(x(T,s),c(null))},responsiveFontSize:Y,baselineTemp:L,baselineStartIndex:A}},$t=({data:e,isFullScreen:i,orientation:u,onToggleIgnore:x,onEdit:T,cycleId:h,initialScrollIndex:f=0,visibleDays:a=5,showInterpretation:k=!1,reduceMotion:p=!1,forceLandscape:W=!1})=>{const{chartRef:C,tooltipRef:c,dimensions:m,activePoint:v,tooltipPosition:b,allDataPoints:j,validDataForLine:M,tempMin:L,tempMax:A,tempRange:$,padding:S,textRowHeight:V,getY:I,getX:R,handlePointInteraction:H,handleToggleIgnore:Y,responsiveFontSize:X,clearActivePoint:r,setActivePoint:U,baselineTemp:y,baselineStartIndex:B}=Nt(e,i,u,x,h,a,W);if(!j||j.length===0)return t.jsxs("div",{className:"text-center p-8",children:[t.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-pink-100 to-rose-100 rounded-full mb-4",children:t.jsx("svg",{className:"w-8 h-8 text-pink-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),t.jsx("p",{className:"text-slate-400 font-medium",children:"No hay datos para mostrar en el gráfico"})]});const D=m.width,F=m.height,z=y!=null?I(y):null,q=y!=null&&Number.isFinite(B),K=R(0),s=D===0,[n,o]=N.useState({w:typeof window<"u"?window.innerWidth:0,h:typeof window<"u"?window.innerHeight:0}),d=n.w<n.h;N.useEffect(()=>{const O=()=>o({w:window.innerWidth,h:window.innerHeight});return window.addEventListener("resize",O),window.addEventListener("orientationchange",O),()=>{window.removeEventListener("resize",O),window.removeEventListener("orientationchange",O)}},[]),N.useEffect(()=>{if(!C.current)return;const O=C.current.clientWidth/a;C.current.scrollLeft=Math.max(0,O*f)},[f,a,m.width,u]);const l=W&&d,w=l,g="w-full h-full bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100",E=i?`${g} min-h-full ${w?"flex items-stretch justify-start overflow-y-auto overflow-x-hidden":"flex items-center justify-start overflow-x-auto overflow-y-hidden"}`:`${g} overflow-x-auto overflow-y-hidden border border-pink-100/50`,G=!i||u==="portrait";return t.jsxs(P.div,{className:"relative w-full h-full",initial:!1,children:[G&&t.jsx("div",{className:"absolute left-0 top-0 h-full bg-transparent pointer-events-none z-10",style:{width:S.left},children:t.jsx(Ot,{padding:S,chartHeight:F,tempMin:L,tempMax:A,tempRange:$,getY:I,responsiveFontSize:X,textRowHeight:V,isFullScreen:i})}),t.jsxs(P.div,{ref:C,className:`relative p-0 ${i?"":"rounded-2xl"} ${E}`,style:{boxShadow:i?"inset 0 1px 3px rgba(244, 114, 182, 0.1)":"0 8px 32px rgba(244, 114, 182, 0.12), 0 2px 8px rgba(244, 114, 182, 0.08)",...l?{position:"absolute",top:0,left:0,width:`${n.h}px`,height:`${n.w}px`,transform:"rotate(90deg) translateY(-100%)",transformOrigin:"top left"}:{}},initial:!1,children:[s&&t.jsx("div",{className:"flex items-center justify-center w-full h-full text-slate-400",children:"Cargando..."}),t.jsxs(P.svg,{width:D,height:F,className:"font-sans flex-shrink-0",viewBox:`0 0 ${D} ${F}`,preserveAspectRatio:"xMidYMid meet",initial:!1,children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),t.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),t.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),t.jsxs("linearGradient",{id:"tempAreaGradientChart",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(244,114,182,0.25)"}),t.jsx("stop",{offset:"50%",stopColor:"rgba(236,72,153,0.15)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(233,30,99,0.05)"})]}),t.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[t.jsx("rect",{width:"6",height:"6",fill:"#f3f4f6"}),t.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(239,68,68,0.7)"})]}),t.jsxs("filter",{id:"chartShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsxs("filter",{id:"baselineGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),t.jsx("rect",{width:"100%",height:"100%",fill:"transparent"}),t.jsx(jt,{padding:S,chartWidth:D,chartHeight:F,tempMin:L,tempMax:A,tempRange:$,getY:I,getX:R,allDataPoints:j,responsiveFontSize:X,isFullScreen:i,showLeftLabels:!G,reduceMotion:p}),k&&q&&(p?t.jsx("line",{x1:K,y1:z,x2:D-S.right,y2:z,stroke:"#F59E0B",strokeWidth:3,strokeDasharray:"6 4"}):t.jsx(P.path,{d:`M ${K} ${z} L ${D-S.right} ${z}`,stroke:"#F59E0B",strokeWidth:3,strokeDasharray:"6 4",initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:1},transition:{duration:4,ease:"easeInOut",delay:.5}})),t.jsx(wt,{data:M,allDataPoints:j,getX:R,getY:I,baselineY:F-S.bottom,temperatureField:"displayTemperature",reduceMotion:p}),t.jsx(Tt,{data:j,getX:R,getY:I,isFullScreen:i,orientation:u,responsiveFontSize:X,onPointInteraction:H,clearActivePoint:r,activePoint:v,padding:S,chartHeight:F,chartWidth:D,temperatureField:"displayTemperature",textRowHeight:V,compact:!1,reduceMotion:p})]}),v&&t.jsx(P.div,{ref:c,initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:10},transition:{duration:.2,ease:"easeOut"},children:t.jsx(gt,{point:v,position:b,chartWidth:D,chartHeight:F,onToggleIgnore:Y,onEdit:T,onClose:r})})]})]})};function Yt(e,i){if(!e||!i)return[];const u=typeof e=="string"?dt(e):e;return[...Array(i)].map((x,T)=>{const h=yt(u,T),f=rt(h,"yyyy-MM-dd"),a=rt(h,"dd/MM"),k=mt(Q(h),Q(u))+1;return{date:a,isoDate:f,cycleDay:k,temperature:null,mucusSensation:null,mucusAppearance:null,id:`placeholder-${f}`,ignored:!1}})}export{$t as F,Pt as R,Yt as g};
