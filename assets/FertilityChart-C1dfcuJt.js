import{m as Ct,j as t,R as en,r as u,o as ge,f as Ue,W as nn}from"./index-ByFXgX-t.js";import{a as xn,g as mn}from"./computePeakStatuses-hwVxT-Am.js";import{i as sn}from"./useCycleData-BwqH7MfP.js";import{i as gn}from"./badge-CetW1kHg.js";import{u as yn,C as bn}from"./useFertilityChart-B4dbAta_.js";const In=({padding:n,chartWidth:s,chartHeight:k,tempMin:f,tempMax:H,tempRange:d,getY:V,getX:ct,allDataPoints:M=[],visibleRange:S=null,responsiveFontSize:Y,isFullScreen:gt,showLeftLabels:O=!1,reduceMotion:J=!1,isScrolling:F=!1,graphBottomY:it,chartAreaHeight:p,rowsZoneHeight:j})=>{const c={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.3,ease:"easeOut"}}},T=[];if(d>0){const R=d<=2.5?.1:.5;for(let at=f;at<=H+1e-9;at+=R)T.push(parseFloat(at.toFixed(1)))}else for(let R=35.8;R<=37.2+1e-9;R+=.1)T.push(parseFloat(R.toFixed(1)));const g=M.length,yt=g>60||F,bt=J||yt?"g":Ct.g,Lt=Number.isInteger(S?.startIndex)?S.startIndex:0,m=Number.isInteger(S?.endIndex)?S.endIndex:Math.max(g-1,0),rt=g?Math.max(0,Math.min(g-1,Lt)):0,l=g?Math.max(rt,Math.min(g-1,m)):-1;return t.jsxs(t.Fragment,{children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"bgGradientChart",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"#fffbfc"}),t.jsx("stop",{offset:"50%",stopColor:"#fff5f7"}),t.jsx("stop",{offset:"100%",stopColor:"#fff1f3"})]}),t.jsxs("linearGradient",{id:"dataZoneGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"#fff7fb"}),t.jsx("stop",{offset:"50%",stopColor:"#ffe4f0"}),t.jsx("stop",{offset:"100%",stopColor:"#fff7fb"})]}),t.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"#f472b6"}),t.jsx("stop",{offset:"30%",stopColor:"#ec4899"}),t.jsx("stop",{offset:"70%",stopColor:"#db2777"}),t.jsx("stop",{offset:"100%",stopColor:"#be185d"})]}),t.jsxs("filter",{id:"softShadow",children:[t.jsx("feGaussianBlur",{in:"SourceAlpha",stdDeviation:"2"}),t.jsx("feOffset",{dx:"0",dy:"1",result:"offsetblur"}),t.jsx("feComponentTransfer",{children:t.jsx("feFuncA",{type:"linear",slope:"0.2"})}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsxs("filter",{id:"pointGlow",children:[t.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsx("filter",{id:"textShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:t.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodColor:"rgba(255, 255, 255, 0.8)"})}),t.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[t.jsx("rect",{width:"6",height:"6",fill:"#ef4444"}),t.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(255,255,255,0.85)"})]})]}),t.jsx("rect",{x:n.left,y:n.top,width:s-n.left-n.right,height:p,fill:"url(#bgGradientChart)",opacity:2,rx:12,style:{filter:"drop-shadow(0 4px 12px rgba(244, 114, 182, 0.1))"}}),t.jsx("rect",{x:n.left,y:n.top,width:s-n.left-n.right,height:p,fill:"white",stroke:"url(#tempLineGradientChart)",strokeWidth:"1",strokeOpacity:"0.2",rx:"12",style:{filter:"url(#softShadow)"}}),t.jsx("rect",{x:n.left,y:it,width:s-n.left-n.right,height:j,fill:"url(#dataZoneGradient)",rx:"8",style:{filter:"drop-shadow(0 -1px 2px rgba(244, 114, 182, 0.05))"}}),T.map((R,at)=>{const X=V(R),N=R.toFixed(1).endsWith(".0")||R.toFixed(1).endsWith(".5"),C=N?R.toFixed(1):`.${R.toFixed(1).split(".")[1]}`;return t.jsxs(bt,{...J||yt?{}:{variants:c},children:[t.jsx("line",{x1:n.left,y1:X,x2:s-n.right,y2:X,stroke:N?"#f9a8d4":"#fce7f3",strokeWidth:N?1.5:1,opacity:N?.5:.3,strokeDasharray:N?"0":"4,4",style:{filter:N&&!yt?"drop-shadow(0 1px 3px rgba(244, 114, 182, 0.15))":"none",opacity:N?1:.7}}),O&&t.jsx("text",{x:n.left-Y(1),y:X+Y(.35),textAnchor:"end",fontSize:Y(N?1.1:1),fontWeight:N?"700":"600",fill:N?"#be185d":"#db2777",opacity:N?.9:.7,style:{filter:yt?"none":"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:C}),t.jsx("text",{x:s-n.right+Y(1),y:X+Y(.35),textAnchor:"start",fontSize:Y(N?1.1:1),fontWeight:N?"700":"600",fill:N?"#be185d":"#db2777",opacity:N?.9:.7,style:{filter:yt?"none":"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:C})]},`temp-tick-${at}`)}),g>0&&Array.from({length:l-rt+1},(R,at)=>{const X=rt+at,N=ct(X);return t.jsx("line",{x1:N,y1:n.top,x2:N,y2:it,stroke:"#fce7f3",strokeWidth:"1",opacity:"0.6",style:{filter:yt?"none":"drop-shadow(0 0 1px rgba(244, 114, 182, 0.05))"}},`day-grid-${X}`)}),t.jsx("rect",{x:n.left,y:n.top,width:s-n.left-n.right,height:p,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"2",strokeOpacity:"0.4",rx:"12"}),t.jsx("rect",{x:n.left+1,y:n.top+1,width:s-n.left-n.right-2,height:p-2,fill:"none",stroke:"white",strokeWidth:"0.5",rx:"11",opacity:"0.9"}),O&&t.jsx(bt,{...J||yt?{}:{variants:c},children:t.jsx("text",{x:n.left+Y(1.2),y:n.top+Y(1.5),textAnchor:"middle",fontSize:Y(1.4),fontWeight:"800",fill:"#be185d",style:{filter:yt?"none":"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:"°C"})})]})},jn=({data:n,allDataPoints:s,getX:k,getY:f,baselineY:H,temperatureField:d="temperature",reduceMotion:V=!1,connectGaps:ct=!0})=>{if(!n||n.length<2)return null;const{pathD:M,thinPathD:S,hasContinuousSegment:Y}=u.useMemo(()=>{const gt=new Map(n.map(p=>[p.id,p]));let O="",J=null;const F=[];if(s.forEach((p,j)=>{const c=gt.get(p.id);if(c&&c[d]!==null&&c[d]!==void 0&&!c.ignored){const T=k(j),g=f(c[d]);F.push({x:T,y:g}),J!==null&&j===J+1?O+=` L ${T} ${g}`:O+=`${O?" ":""}M ${T} ${g}`,J=j}}),F.length<2)return{pathD:"",thinPathD:"",hasContinuousSegment:!1};const it=ct&&F.length>1?F.map(({x:p,y:j},c)=>`${c===0?"M":"L"} ${p} ${j}`).join(" "):"";return{pathD:O,thinPathD:it,hasContinuousSegment:O.includes("L")}},[s,n,k,f,d,ct]);return M?t.jsxs(t.Fragment,{children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"#f472b6"}),t.jsx("stop",{offset:"30%",stopColor:"#ec4899"}),t.jsx("stop",{offset:"70%",stopColor:"#db2777"}),t.jsx("stop",{offset:"100%",stopColor:"#be185d"})]}),t.jsx("filter",{id:"lineShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:t.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"3",floodColor:"rgba(244, 114, 182, 0.4)"})})]}),Y&&(V?t.jsx("path",{d:M,fill:"none",stroke:"url(#tempLineGradientChartGlow)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:.4,style:{filter:"url(#lineGlow)"}}):t.jsx(Ct.path,{d:M,fill:"none",stroke:"url(#tempLineGradientChartGlow)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:.4,style:{filter:"url(#lineGlow)"},initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.4},transition:{duration:.8,ease:"easeInOut",delay:.2}})),S&&(V?t.jsx("path",{d:S,fill:"none",stroke:"#d587b1",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.65}):t.jsx(Ct.path,{d:S,fill:"none",stroke:"#d587b1",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.65,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.65},transition:{duration:.8,ease:"easeInOut"}})),Y&&(V?t.jsx("path",{d:M,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#lineShadow)"}}):t.jsx(Ct.path,{d:M,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#lineShadow)"},initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:1},transition:{duration:1,ease:"easeInOut",delay:.4}}))]}):null},wn=en.memo(jn),qe="var(--color-sensacion-fuerte)",Ke="var(--color-apariencia-fuerte)",Ze="var(--color-observaciones-fuerte)",Ge="#be123c",kn="rgba(148, 163, 184, 0.35)",Mn="rgba(226, 232, 240, 0.6)",Sn="rgba(148, 163, 184, 0.5)",Je="✖",_e="#7f1d1d",He="#ec4899",Cn="drop-shadow(0 2px 4px rgba(244, 114, 182, 0.35))",Ln="#be185d",vn="#2563eb",Rn="#be185d",Nn="rgba(244, 114, 182, 0.35)",Qe=n=>{if(!n)return"";const[s,k]=n.split("/");return`${parseInt(s,10)}/${parseInt(k,10)}`},me='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',On=()=>{if(typeof document>"u")return(k,f)=>{const H=/(\d+(?:\.\d+)?)px/.exec(f||""),d=H?Number(H[1]):12;return k.length*d*.6};const s=document.createElement("canvas").getContext("2d");return s?(k,f)=>(s.font=f,s.measureText(k).width):(k,f)=>{const H=/(\d+(?:\.\d+)?)px/.exec(f||""),d=H?Number(H[1]):12;return k.length*d*.6}},ze=(n,s,k)=>`${s} ${n}px ${k}`,tn=(n="",{maxWidth:s,maxLines:k=2,fontSize:f,fontWeight:H=700,fontFamily:d=me,fallback:V="–",measureTextWidth:ct})=>{if(!n)return[V,...Array.from({length:Math.max(0,k-1)},()=>"")];const M=ze(f,H,d),S=p=>ct(p,M),Y=String(n).trim(),gt=/\s/.test(Y),O=gt?Y.split(/\s+/):Array.from(Y),J=gt?" ":"",F=[],it=p=>{const j=Array.from(p);let c="";for(;j.length;){const T=c+j[0];if(S(T)<=s||!c){if(c=T,j.shift(),S(c)>s&&c.length>1){j.unshift(...Array.from(c.slice(1))),c=c[0];break}}else break}return[c,j.join("")]};for(;O.length&&F.length<k;){let p="";for(;O.length;){const j=O[0],c=p?`${p}${J}${j}`:j;if(S(c)<=s){p=c,O.shift();continue}if(!p)if(gt){const[T,g]=it(j);p=T,g?O[0]=g:O.shift()}else{const[T,g]=it(j);p=T,g?O[0]=g:O.shift()}break}F.push(p),!p&&O.length&&F.push(O.shift())}if(O.length&&F.length){const p=F.length-1;let j=F[p]||"";for(;j&&S(`${j}…`)>s;)j=j.slice(0,-1);F[p]=j?`${j}…`:"…"}for(;F.length<k;)F.push("");return F};function Ye(n="",s,k="–"){return n?n.split(/\s+/).slice(0,s).join(" "):k}const An=({data:n,getX:s,getY:k,isFullScreen:f,orientation:H,responsiveFontSize:d,onPointInteraction:V,clearActivePoint:ct,activePoint:M,visibleRange:S=null,padding:Y,chartHeight:gt,chartWidth:O,temperatureField:J="temperature_chart",textRowHeight:F,compact:it=!1,reduceMotion:p=!1,isScrolling:j=!1,showInterpretation:c=!1,ovulationDetails:T=null,firstHighIndex:g=null,baselineIndices:dt=[],graphBottomLift:yt=0,graphBottomY:bt,rowsZoneHeight:Lt,showRelationsRow:m=!1,autoLabelStep:rt=!1,isArchivedCycle:l=!1})=>{const R={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},at={hidden:{opacity:0,scale:.3},visible:{opacity:1,scale:1,transition:{duration:.6,ease:[.34,1.56,.64,1],type:"spring",stiffness:120,damping:12}}},X=bt,N=f?9:7.5,C=f?1:.75,Qt=m?N+(f?2:1.5):null,Et=N+C,Q=Math.max(1,Math.floor(Lt/Et)),It=Math.max(F,Q),Re=X+It*1,te=X+It*2,Ut=X+It*3,ce=X+It*(f?5:4.5),Ne=X+It*(f?7:6),ye=X+It*(f?9:7.5),be=m?ye+It*(f?2:1.5):null,h=Array.isArray(n)?n.length:0,ft=h>60||j||l,Gt=p||ft?"g":Ct.g,$t=O-Y.left-Y.right,zt=It*(f?2:1.5),_t=Math.min(Math.max(zt*.46,14),12),ee=Number.isInteger(S?.startIndex)?S.startIndex:0,ne=Number.isInteger(S?.endIndex)?S.endIndex:Math.max(h-1,0),Vt=h?Math.max(0,Math.min(h-1,ee)):0,se=h?Math.max(Vt,Math.min(h-1,ne)):-1,Ie=u.useMemo(()=>ge(new Date),[]),jt=u.useMemo(()=>On(),[]),oe=u.useRef(new Map),de=h>0?$t/h:$t,Dt=2,je=Math.min(12,Math.max(4,de*.12)),vt=Math.max(0,de-je*2),Tt=d(.95),tt=d(.9),ht=d(.9),Wt=d(.9),Rt=d(.8),re=d(.8),Ht=d(.8),ae=u.useMemo(()=>{if(!rt||h<2)return 1;const x=Math.abs(s(1)-s(0));if(!Number.isFinite(x)||x<=0)return 1;const o=n?.find(I=>I?.date||I?.cycleDay!=null)??{},i=Qe(o?.date||"00/00"),U=String(o?.cycleDay??h??""),W=d(1.05),G=d(1),et=jt(i,ze(W,900,me)),nt=jt(U,ze(G,900,me)),ut=Math.max(et,nt)+d(.8);return Math.max(1,Math.ceil(ut/x))},[rt,h,s,n,jt,d]),we=u.useMemo(()=>{if(!c)return new Map;const x=Array.isArray(T?.highSequenceIndices)?T.highSequenceIndices:[],o=U=>{const W=n?.[U],G=W?.calcTemperature!=null?W.calcTemperature:W?.displayTemperature,et=W?.ignoredForCalc!=null?W.ignoredForCalc:W?.ignored;return W&&Number.isFinite(G)&&!et},i=new Map;return x.forEach((U,W)=>{const G=Number(U);Number.isInteger(G)&&G>=0&&G<h&&!i.has(G)&&o(G)&&i.set(G,W+1)}),i},[c,T,h,n]),fe=u.useMemo(()=>{if(!c)return new Map;const x=Array.isArray(dt)?dt:[];if(!x.length)return new Map;const o=new Set,i=[],U=I=>{const L=n?.[I],lt=L?.calcTemperature!=null?L.calcTemperature:L?.displayTemperature,Ft=L?.ignoredForCalc!=null?L.ignoredForCalc:L?.ignored;return L&&Number.isFinite(lt)&&!Ft},W=I=>{for(let L=I;L>=0;L-=1)if(U(L))return L;return null},G=I=>{const L=Number(I);Number.isInteger(L)&&L>=0&&L<h&&!o.has(L)&&U(L)&&(o.add(L),i.push(L))};if(x.forEach(I=>{G(I)}),g!=null){const I=Number(g);if(Number.isInteger(I)){const L=W(I-1);L!=null&&G(L)}}if(!i.length)return new Map;const et=[...i].sort((I,L)=>I-L),nt=new Map;let ut=1;for(let I=et.length-1;I>=0&&!(ut>6);I-=1)nt.set(et[I],ut),ut+=1;return nt},[c,dt,h,g,n]),ke=ft?"none":"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))",Pt=ft?"none":"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))",Yt=ft?"none":"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))",ie=ft?"none":Cn,he=ft?"none":"drop-shadow(0 2px 4px rgba(244, 114, 182, 0.25))",Oe=ft?"none":"drop-shadow(0 1px 3px rgba(37, 99, 235, 0.45))",Bt=ft?"none":"drop-shadow(0 2px 4px rgba(37, 99, 235, 0.3))",ue=u.useCallback((x,o,i,U)=>{const W=tn(x,{maxWidth:vt,maxLines:3,fontSize:i,fontWeight:700,fontFamily:me,fallback:o,measureTextWidth:jt});return W[2]?{lines:tn(x,{maxWidth:vt,maxLines:3,fontSize:U,fontWeight:700,fontFamily:me,fallback:o,measureTextWidth:jt}),fontSize:U}:{lines:W,fontSize:i}},[vt,jt]);u.useEffect(()=>{oe.current.clear()},[h,vt,tt,ht,Wt]);const le=u.useCallback((x,o,i,U,W)=>{const G=oe.current.get(x);if(G)return G;const et=ue(o,i,U,W);return oe.current.set(x,et),et},[ue]),Me=u.useMemo(()=>!h||se<Vt?[]:Array.from({length:se-Vt+1},(x,o)=>Vt+o),[se,Vt,h]);return t.jsxs(t.Fragment,{children:[t.jsxs("defs",{children:[t.jsx("filter",{id:"rowShadowChart",x:"-10%",y:"-10%",width:"120%",height:"120%",children:t.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"4",floodColor:"rgba(244, 114, 182, 0.2)"})}),t.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[t.jsx("rect",{width:"6",height:"6",fill:"#fb7185"}),t.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(255,255,255,0.85)"})]}),t.jsxs("filter",{id:"pointGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsxs("radialGradient",{id:"tempPointGradientChart",cx:"30%",cy:"30%",children:[t.jsx("stop",{offset:"0%",stopColor:"#FDF2F8"}),t.jsx("stop",{offset:"50%",stopColor:"#F9A8D4"}),t.jsx("stop",{offset:"85%",stopColor:"#EC4899"}),t.jsx("stop",{offset:"100%",stopColor:"#DB2777"})]}),t.jsxs("radialGradient",{id:"tempPointIgnoredGradient",cx:"30%",cy:"30%",children:[t.jsx("stop",{offset:"0%",stopColor:"#FFFFFF"}),t.jsx("stop",{offset:"80%",stopColor:"#F8FAFC"}),t.jsx("stop",{offset:"100%",stopColor:"#E2E8F0"})]}),t.jsxs("radialGradient",{id:"ovulationPointGradient",cx:"30%",cy:"30%",children:[t.jsx("stop",{offset:"0%",stopColor:"#dbeafe"}),t.jsx("stop",{offset:"50%",stopColor:"#93c5fd"}),t.jsx("stop",{offset:"85%",stopColor:"#3b82f6"}),t.jsx("stop",{offset:"100%",stopColor:"#2563eb"})]})]}),f&&H!=="portrait"&&t.jsx(Gt,{...p||ft?{}:{variants:R},children:[{label:"Fecha",row:1,color:f?"#374151":"#6B7280"},{label:"Día",row:2,color:f?"#374151":"#6B7280"},{label:"Símbolo",row:3,color:f?"#374151":"#6B7280"},{label:"Sens.",row:f?5:4.5,color:qe},{label:"Apar.",row:f?7:6,color:Ke},{label:"Observ.",row:f?9:7.5,color:Ze},...m&&Qt!=null?[{label:"RS",row:Qt,color:Ge}]:[]].map(({label:x,row:o,color:i})=>t.jsx("text",{x:Y.left-d(.5),y:X+It*o,textAnchor:"end",fontSize:d(1.05),fontWeight:"700",fill:i,style:{filter:ke,fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:x},x))}),Me.map(x=>{const o=n[x];if(!o)return null;const i=s(x),U=o[J]!=null?k(o[J]):X,W=o.temperature_raw,G=o.temperature_corrected,et=o.use_corrected&&W!=null&&G!=null&&Math.abs(G-W)>.01,nt=et?k(W):null,ut="#60666f",I=o[J]!=null,L=o.use_corrected&&G!=null&&o[J]===G,lt=o.ignored||o.use_corrected&&!L,Ft=!!(o.had_relations??o.hadRelations);I||o.mucus_sensation||o.mucus_appearance||o.fertility_symbol;const A=!rt||x%ae===0||x===h-1,Se=String(o.id||"").startsWith("placeholder-"),pe=T?.peakDayIndex,kt=c&&pe!=null&&!lt&&I&&x===pe,Xt=xn(o.fertility_symbol),qt=mn(Xt.value),Ae=Xt.pattern==="spotting-pattern"?"url(#spotting-pattern-chart)":qt.main,Ee=qt.border==="none"?"none":qt.border||Nn,Ce=qt.border==="none"?0:Xt.value==="white"?1.6:1,Nt=o.isoDate?sn(ge(Ue(o.isoDate)),ge(new Date)):!1,st=d(f?1.8:2),xe=Ut-st*.75+st/2+2,xt=o.peakStatus?String(o.peakStatus).toUpperCase():null,Mt=xt==="P"||xt==="X",Kt=xt&&!Mt,$e=Mt?Je:xt||"–",Le=Mt||["1","2","3"].includes(xt),De=!Se&&Xt.value!=="none",We=!!o.isoDate&&!Nt?{pointerEvents:"all",style:{cursor:"pointer"},onClick:Jt=>V(o,x,Jt),"data-chart-interactive":"true"}:{},e=(o.isoDate?gn(Ue(o.isoDate),Ie):!1)?Rn:ut,r=we.has(x),a=r?we.get(x):null,y=fe.has(x),v=y?fe.get(x):null,E=d(f?.75:1.2),$=Math.max(.5,E*.18),D=U-E*(f?2.6:1.8),_=U+E*(f?1.9:1.6),P=f?Ye(o.mucus_sensation,Dt,Nt?"":"–"):o.mucus_sensation,w=f?Ye(o.mucus_appearance,Dt,Nt?"":"–"):o.mucus_appearance,b=f?Ye(o.observations,Dt,""):o.observations,z=`${o.isoDate||o.id||x}`,B=le(`${z}-sens-${vt}-${tt}-${Rt}-${P??""}`,P,Nt?"":"–",tt,Rt),ot=le(`${z}-apar-${vt}-${ht}-${re}-${w??""}`,w,Nt?"":"–",ht,re),Z=le(`${z}-obs-${vt}-${Wt}-${Ht}-${b??""}`,b,"",Wt,Ht),[pt,wt,mt]=B.lines,[K,Ot,St]=ot.lines,[ve,At,Zt]=Z.lines,on=B.fontSize,rn=ot.fontSize,an=Z.fontSize,Pe=(Jt,Fe,pn)=>Math.max(1,[Jt,Fe,pn].filter(Xe=>Xe&&String(Xe).trim()!=="").length),ln=Pe(pt,wt,mt),cn=Pe(K,Ot,St),dn=Pe(ve,At,Zt),Be=(Jt,Fe)=>Jt-(Fe-1)*Tt/2,fn=Be(ce,ln),hn=Be(Ne,cn),un=Be(ye,dn);return t.jsxs(Gt,{...p||ft?{}:{variants:R},...We,children:[I&&t.jsxs(Gt,{...p||ft?{}:{variants:at},children:[et&&nt!==null&&t.jsxs("g",{pointerEvents:"none",children:[t.jsx("line",{x1:i,y1:nt,x2:i,y2:U,stroke:kn,strokeWidth:1,strokeDasharray:"4 4"}),t.jsx("circle",{cx:i,cy:nt,r:3,fill:Mn,stroke:Sn,strokeWidth:1}),t.jsx("circle",{cx:i,cy:nt,r:1,fill:"rgba(255, 255, 255, 0.6)"})]}),t.jsx("circle",{cx:i,cy:U,r:kt?3.5:2.8,fill:lt?"url(#tempPointIgnoredGradient)":kt?"url(#ovulationPointGradient)":"url(#tempPointGradientChart)",stroke:o.use_corrected&&L?"#941616":lt?"#94A3B8":kt?"#1d4ed8":"#E91E63",sstrokeWidth:lt?1.5:kt?2.2:2,style:{filter:kt?Bt:he,cursor:"pointer"},pointerEvents:"all",onClick:Jt=>V(o,x,Jt),"data-chart-interactive":"true"}),!lt&&t.jsx("circle",{cx:i,cy:U,r:kt?1.2:.9,fill:kt?"rgba(239, 246, 255, 0.95)":"rgba(255, 255, 255, 0.9)",style:{filter:kt?Oe:Pt}}),c&&I&&!lt&&r&&t.jsx("g",{pointerEvents:"none",children:t.jsx("text",{x:i,y:D,textAnchor:"middle",fontSize:E,fontWeight:"900",fill:Ln,strokeWidth:$,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',paintOrder:"stroke",filter:Pt},children:a})}),c&&I&&!lt&&y&&t.jsx("g",{pointerEvents:"none",children:t.jsx("text",{x:i,y:_,textAnchor:"middle",fontSize:E,fontWeight:"800",fill:vn,stroke:"#ffffff",strokeWidth:$,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',paintOrder:"stroke",filter:Pt},children:v})})]}),A&&t.jsx("text",{x:i,y:Re,textAnchor:"middle",fontSize:d(1.05),fontWeight:"900",fill:e,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:Pt},children:Qe(o.date)}),A&&t.jsx("text",{x:i,y:te,textAnchor:"middle",fontSize:d(1),fontWeight:"900",fill:e,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:Pt},children:o.cycleDay}),De?t.jsxs("g",{children:[t.jsx("rect",{x:i-st/2+1,y:Ut-st*.75+1,width:st,height:st,fill:"rgba(0, 0, 0, 0.1)",rx:st*.3,opacity:.5}),t.jsx("rect",{x:i-st/2-4,y:Ut-st*.75,width:st*1.4,height:st,fill:Ae,stroke:Ee,strokeWidth:Ce,rx:st*.2,style:{filter:he}}),xt&&t.jsx("g",{pointerEvents:"none",children:Mt?t.jsx("text",{x:i,y:xe,textAnchor:"middle",fontSize:d(1.35),fontWeight:"900",fill:He,stroke:"#fff",strokeWidth:1.5,paintOrder:"stroke",style:{filter:ie},children:Je}):t.jsx("text",{x:i,y:xe,textAnchor:"middle",fontSize:d(xt?1.1:1),fontWeight:"800",fill:_e,style:{filter:Yt},children:xt})})]}):t.jsxs("g",{children:[Le&&t.jsx("rect",{x:i-st/2-4,y:Ut-st*.75,width:st*1.4,height:st,fill:"transparent",stroke:Mt?He:_e,strokeWidth:1,rx:st*.2}),t.jsx("text",{x:i,y:xe,textAnchor:"middle",fontSize:d(Mt?1.35:Kt?1.1:1),fill:Mt?He:Kt?_e:ut,fontWeight:Mt?"900":Kt?"800":"500",style:{filter:Mt?ie:Kt?Yt:Pt},children:$e})]}),!it&&t.jsxs("text",{x:i,y:fn,textAnchor:"middle",fontSize:on,fontWeight:"700",fill:qe,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:Yt},children:[t.jsx("tspan",{x:i,dy:0,children:pt}),wt&&t.jsx("tspan",{x:i,dy:Tt,children:wt}),mt&&t.jsx("tspan",{x:i,dy:Tt,children:mt})]}),!it&&t.jsxs("text",{x:i,y:hn,textAnchor:"middle",fontSize:rn,fontWeight:"700",fill:Ke,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:Yt},children:[t.jsx("tspan",{x:i,dy:0,children:K}),Ot&&t.jsx("tspan",{x:i,dy:Tt,children:Ot}),St&&t.jsx("tspan",{x:i,dy:Tt,children:St})]}),!it&&t.jsxs("text",{x:i,y:un,textAnchor:"middle",fontSize:an,fontWeight:"700",fill:Ze,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:Yt},children:[t.jsx("tspan",{x:i,dy:0,children:ve}),At&&t.jsx("tspan",{x:i,dy:Tt,children:At}),Zt&&t.jsx("tspan",{x:i,dy:Tt,children:Zt})]}),m&&be!=null&&Ft&&t.jsx("g",{transform:`translate(${i-_t/2}, ${be-_t/2})`,role:"img","aria-label":`Relación registrada el ${o.isoDate||`día ${x+1}`}`,children:t.jsx(nn,{width:_t,height:_t,color:Ge,fill:Ge})})]},`pt-${x}-${o.isoDate||o.timestamp}`)})]})},En=(n,s)=>{if(n.data!==s.data||n.getX!==s.getX||n.getY!==s.getY||n.isFullScreen!==s.isFullScreen||n.orientation!==s.orientation||n.responsiveFontSize!==s.responsiveFontSize||n.onPointInteraction!==s.onPointInteraction||n.clearActivePoint!==s.clearActivePoint||n.chartHeight!==s.chartHeight||n.chartWidth!==s.chartWidth||n.temperatureField!==s.temperatureField||n.textRowHeight!==s.textRowHeight||n.compact!==s.compact||n.reduceMotion!==s.reduceMotion||n.isScrolling!==s.isScrolling||n.showInterpretation!==s.showInterpretation||n.ovulationDetails!==s.ovulationDetails||n.firstHighIndex!==s.firstHighIndex||n.baselineIndices!==s.baselineIndices||n.graphBottomLift!==s.graphBottomLift||n.graphBottomY!==s.graphBottomY||n.rowsZoneHeight!==s.rowsZoneHeight||n.showRelationsRow!==s.showRelationsRow||n.autoLabelStep!==s.autoLabelStep||n.isArchivedCycle!==s.isArchivedCycle)return!1;const k=n.visibleRange,f=s.visibleRange;if(k?.startIndex!==f?.startIndex||k?.endIndex!==f?.endIndex)return!1;const H=n.padding,d=s.padding;return!(H!==d&&(!H||!d||H.left!==d.left||H.right!==d.right||H.top!==d.top||H.bottom!==d.bottom))},$n=en.memo(An,En),Dn="var(--color-sensacion-fuerte)",Tn="var(--color-apariencia-fuerte)",Wn="var(--color-observaciones-fuerte)",Pn=({padding:n,chartHeight:s,tempMin:k,tempMax:f,tempRange:H,getY:d,responsiveFontSize:V,textRowHeight:ct,isFullScreen:M,reduceMotion:S=!1,graphBottomY:Y,rowsZoneHeight:gt,showRelationsRow:O=!1})=>{const J={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},F=[];if(H>0){const m=H<=2.5?.1:.5;for(let rt=k;rt<=f+1e-9;rt+=m)F.push(parseFloat(rt.toFixed(1)))}else for(let m=35.8;m<=37.2+1e-9;m+=.1)F.push(parseFloat(m.toFixed(1)));const it=Y,p=M?9:7.5,j=M?1:.75,c=O?p+(M?2:1.5):null,T=p+j,g=Math.max(1,Math.floor(gt/T)),dt=Math.max(ct,g),yt=u.useMemo(()=>{const m=[{label:"Fecha",row:1,color:"#374151",icon:null},{label:"Día",row:2,color:"#374151",icon:null},{label:"Símbolo",row:3,color:"#374151",icon:null},{label:"Sens.",row:M?5:4.5,color:Dn,icon:{type:"text",value:"◊"}},{label:"Apar.",row:M?7:6,color:Tn,icon:{type:"text",value:"○"}},{label:"Obs.",row:M?9:7.5,color:Wn,icon:{type:"text",value:"✦"}}];return O&&c!=null&&m.push({label:"RS",row:c,color:"#f44336",icon:{type:"heart"}}),m},[M,c,O]),bt=S?"g":Ct.g,Lt=S?{}:{variants:J};return t.jsxs("svg",{width:n.left,height:s,className:"font-sans pointer-events-none",children:[t.jsx("defs",{children:t.jsx("filter",{id:"textShadowLegend",x:"-50%",y:"-50%",width:"200%",height:"200%",children:t.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodColor:"rgba(255, 255, 255, 0.9)"})})}),F.map((m,rt)=>{const l=d(m),R=m.toFixed(1).endsWith(".0")||m.toFixed(1).endsWith(".5"),at=R?m.toFixed(1):`.${m.toFixed(1).split(".")[1]}`;return t.jsx(bt,{...Lt,children:t.jsx("text",{x:n.left-V(1.2),y:l+V(.35),textAnchor:"end",fontSize:V(R?1.15:1),fontWeight:R?"800":"700",fill:R?"#be185d":"#db2777",opacity:R?1:.85,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:at})},`temp-tick-fixed-${rt}`)}),t.jsx(bt,{...Lt,children:yt.map(({label:m,row:rt,color:l,icon:R})=>{const at=n.left-V(2.8),X=it+dt*rt,N=V(.95);return t.jsxs("g",{children:[R?.type==="text"&&t.jsx("text",{x:at,y:X,textAnchor:"middle",fontSize:V(.8),fontWeight:"600",fill:l,opacity:.7,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:R.value}),R?.type==="heart"&&t.jsx("g",{transform:`translate(${at-N/2}, ${X-N/2})`,opacity:.7,children:t.jsx(nn,{width:N,height:N,color:l,fill:l,"aria-hidden":"true"})}),t.jsx("text",{x:n.left-V(.8),y:it+dt*rt,textAnchor:"end",fontSize:V(1.05),fontWeight:"800",fill:l,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:m})]},m)})})]})},Yn=({data:n,isFullScreen:s,orientation:k,onToggleIgnore:f,onEdit:H,onTogglePeak:d,cycleId:V,initialScrollIndex:ct=0,visibleDays:M=5,showInterpretation:S=!1,reduceMotion:Y=!1,forceLandscape:gt=!1,currentPeakIsoDate:O=null,showRelationsRow:J=!1,fertilityStartConfig:F=null,fertilityCalculatorCycles:it=[],fertilityCalculatorCandidates:p=null,onShowPhaseInfo:j=null,isArchivedCycle:c=!1,cycleEndDate:T=null,exportMode:g=!1})=>{const{chartRef:dt,tooltipRef:yt,dimensions:bt,activePoint:Lt,activeIndex:m,tooltipPosition:rt,allDataPoints:l,validDataForLine:R,tempMin:at,tempMax:X,tempRange:N,padding:C,textRowHeight:Qt,getY:Et,getX:Q,handlePointInteraction:It,handleToggleIgnore:Re,responsiveFontSize:te,clearActivePoint:Ut,baselineTemp:ce,baselineStartIndex:Ne,baselineIndices:ye,firstHighIndex:be,ovulationDetails:h,fertilityStart:q,hasAnyObservation:ft,graphBottomInset:Gt,todayIndex:$t}=yn(n,s,k,f,V,M,gt,F,it,p,J,g),zt=Y||g,_t=u.useRef(null);if(!_t.current){const e=Math.random().toString(36).slice(2,10);_t.current=`fertility-chart-${V??"default"}-${e}`}const ee=_t.current,ne=u.useCallback((e,r)=>{if(r<=(c?220:120))return r;const y=c?e>=20?2:3:e>=20?1:2,v=Math.ceil(e*y),E=Math.min(v,c?48:24);return Math.max(E,12)},[c]),Vt=u.useMemo(()=>{const e=l.length;if(!e)return{startIndex:0,endIndex:-1};const r=ne(M,e),a=Math.max(0,Math.floor(ct)-r),y=Math.min(e-1,Math.floor(ct)+M+r);return{startIndex:a,endIndex:y}},[l.length,ne,ct,M]),[se,Ie]=u.useState(Vt),jt=u.useRef(null),[oe,de]=u.useState(!1),Dt=u.useRef(null),je=u.useRef(null),vt=u.useCallback(e=>{const r=l.length;if(!Number.isFinite(e)||r===0)return null;if(r===1)return 0;let a=0,y=r-1;for(;a<=y;){const $=Math.floor((a+y)/2);Q($)<e?a=$+1:y=$-1}const v=Math.min(Math.max(a,0),r-1),E=Math.max(v-1,0);return Math.abs(Q(E)-e)<=Math.abs(Q(v)-e)?E:v},[l,Q]),Tt=u.useCallback(e=>{if(g||e.target?.closest?.('[data-chart-interactive="true"]'))return;const a=je.current;if(!a)return;let y=null;const v=a.getScreenCTM();if(v){const _=a.createSVGPoint();_.x=e.clientX,_.y=e.clientY,y=_.matrixTransform(v.inverse()).x}if(!Number.isFinite(y)){const _=a.getBoundingClientRect();if(!_.width)return;const P=a.viewBox?.baseVal?.width||a.clientWidth||_.width;y=(e.clientX-_.left)/_.width*P}const E=vt(y);if(E==null)return;const $=l[E];!$||$.isoDate&&sn(ge(Ue($.isoDate)),ge(new Date))||It($,E,e)},[l,g,vt,It]);if(!l||l.length===0)return t.jsxs("div",{className:"text-center p-8",children:[t.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-pink-100 to-rose-100 rounded-full mb-4",children:t.jsx("svg",{className:"w-8 h-8 text-pink-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),t.jsx("p",{className:"text-slate-400 font-medium",children:"No hay datos para mostrar en el gráfico"})]});const tt=bt.width,ht=bt.contentHeight??bt.height,Wt=bt.scrollableContentHeight??ht,Rt=ht-C.bottom-(Gt||0),re=Math.max(ht-Rt,0),Ht=ce!=null?Et(ce):null,ae=!!h?.confirmed,we=ce!=null&&ae,fe=Q(0),ke=l.length>0?Q(l.length-1):tt-C.right,Pt=ae?"#F59E0B":"#94A3B8",Yt=ae?"6 4":"4 4",ie=ae?1:.7,he=3,Oe=tt===0,Bt=m!=null?Q(m):null,ue=m!=null?m>0?Q(m-1):Bt:null,le=m!=null?m<l.length-1?Q(m+1):Bt:null,Me=Math.max((tt-C.left-C.right)/Math.max(l.length,1),0),x=m!=null?Math.max((le!=null&&ue!=null?le-ue:0)||Me,Me,0):0,o=u.useMemo(()=>{const e=new Map;return R.forEach(r=>{r&&r.id!=null&&e.set(r.id,r)}),e},[R]),i=u.useMemo(()=>Number.isInteger(q?.fertileStartFinalIndex)?q.fertileStartFinalIndex:null,[q]),U=Math.max(ht-C.top-C.bottom-(Gt||0),0),W=u.useCallback(e=>!Number.isFinite(e)||!l.length||e<=0?C.left:Q(e),[l,Q,C.left]),G=u.useCallback(e=>!Number.isFinite(e)||!l.length||e>=l.length-1?tt-C.right:Q(e+1),[l,tt,Q,C.right]),et=u.useCallback((e,r,{inclusiveEnd:a=!0}={})=>{if(!Number.isFinite(e)||!Number.isFinite(r)||l.length===0)return null;const y=b=>Math.max(0,Math.min(l.length-1,Math.floor(b))),v=b=>Math.max(0,Math.min(l.length-1,Math.floor(b))),E=b=>Math.max(0,Math.min(l.length,Math.floor(b))),$=y(e),D=a?v(r):E(r),_=$<=0?C.left:W($);let P;a?P=D>=l.length-1?tt-C.right:G(D):D<=0?P=C.left:D>=l.length?P=tt-C.right:P=W(D);const w=Math.max(P-_,0);return w<=0?null:{x:_,width:w}},[l,tt,W,G,C.left,C.right]),nt=l.length>0?l.length-1:null,ut=u.useMemo(()=>{if(!c||!T||nt==null)return null;const e=typeof T=="string"?T:null;if(!e)return null;const r=l.findIndex(a=>a?.isoDate===e);if(r>=0)return Math.min(r,nt);for(let a=l.length-1;a>=0;a-=1){const y=l[a]?.isoDate;if(typeof y=="string"&&y<=e)return Math.min(a,nt)}return null},[c,T,l,nt]),I=u.useMemo(()=>nt==null?null:c?Number.isInteger(ut)?Math.min(ut,nt):nt:Number.isInteger($t)?Math.min($t,nt):nt,[ut,c,$t,nt]),L=u.useMemo(()=>c?Number.isInteger(ut)?ut:Number.isInteger(I)?I:null:Number.isInteger($t)?$t:null,[ut,c,I,$t]),lt=U>0?C.top+U*.5:null,Ft=lt!=null?Math.max(Rt-lt,0):0,A=u.useMemo(()=>{if(!S||!ft)return null;const e=q?.debug,r=Number.isInteger(e?.mucusInfertileStartIndex)?e.mucusInfertileStartIndex:null,a=Number.isInteger(q?.fertileWindow?.temperatureInfertileStartIndex)?q.fertileWindow.temperatureInfertileStartIndex:null,y=[r,a].filter(At=>Number.isInteger(At)).sort((At,Zt)=>At-Zt)[0],v=Number.isInteger(y)?y:Number.isInteger(e?.postOvulatoryStartIndex)?e.postOvulatoryStartIndex:null,E=Number.isInteger(r)&&Number.isInteger(a)?Math.max(r,a):null,$=Number.isInteger(E)?E:Number.isInteger(e?.absoluteStartIndex)?e.absoluteStartIndex:null,D={confirmed:!!h?.confirmed,rule:h?.rule??null,baselineTemp:h?.baselineTemp??null,baselineIndices:Array.isArray(h?.baselineIndices)?h.baselineIndices:[],firstHighIndex:Number.isInteger(h?.firstHighIndex)?h.firstHighIndex:null,highSequenceIndices:Array.isArray(h?.highSequenceIndices)?h.highSequenceIndices:[],confirmationIndex:Number.isInteger(h?.confirmationIndex)?h.confirmationIndex:null,startIndex:a},_={peakDayIndex:Number.isInteger(h?.peakDayIndex)?h.peakDayIndex:null,thirdDayIndex:Number.isInteger(h?.thirdDayIndex)?h.thirdDayIndex:null,startIndex:r},P=a!=null,w=r!=null;if(!P&&!w)return null;const b=Number.isInteger(v)?v:null;if(b==null)return null;let z="pending",B="",ot="Infertilidad postovulatoria",Z="Fase postovulatoria: se ha cumplido un criterio de cierre; falta el segundo para confirmar la infertilidad absoluta.";const pt="Infertilidad absoluta",wt="Fase postovulatoria alcanzada (se ha confirmado día pico y subida de temperatura).",mt="Confirmación completa: doble criterio (día pico + temperatura).";let K=ot,Ot=Z,St=B,ve="pending";return P&&w?(z="absolute",ot=pt,Z=mt,B=wt,Number.isInteger(a)&&(!Number.isInteger(r)||a<=r)?(D.rule,St=`Temperatura confirmada el ${D.confirmationIndex!=null?`D${D.confirmationIndex+1}`:"—"}. A la espera de determinación del día pico.`,Ot=St,K="Infertilidad estimada por temperatura"):(St=`Alcanzado ${_.thirdDayIndex!=null?"3° día postpico":"4º día postpico"} tras alcanzar día pico el ${_.peakDayIndex+1} del ciclo`,Ot=St,K="Infertilidad estimada por moco")):P?(D.rule,B=`Temperatura confirmada el ${D.confirmationIndex!=null?`D${D.confirmationIndex+1}`:"—"}. A la espera de determinación del día pico.`,Z=B,ot="Infertilidad estimada por temperatura",St=B,Ot=Z,K=ot):(B=`Alcanzado ${_.thirdDayIndex!=null?"3° día postpico":"4º día postpico"} tras seleccionar día pico el ${_.peakDayIndex+1} del ciclo`,Z=B,ot="Infertilidad estimada por moco",St=B,Ot=Z,K=ot),{phase:"postOvulatory",status:z,startIndex:b,absoluteStartIndex:$,estimated:{status:ve,label:K,tooltip:Ot,message:St},absolute:{label:pt,tooltip:mt,message:wt},reasons:{type:"post",status:z,mucus:_,temperature:D},message:B,label:ot,tooltip:Z}},[S,ft,h,q]),Se=u.useMemo(()=>{if(!S||U<=0||lt==null||Ft<=0||l.length===0)return[];const e=[],r=l.length-1,a=Number.isInteger(I)&&I>=0?Math.min(I,r):r,y=(w,b)=>{if(!A)return;const z=A.startIndex,B=Number.isInteger(A.absoluteStartIndex)?A.absoluteStartIndex:null,ot=A.estimated??A,Z=A.absolute??A,pt=B??z,wt=A.status==="absolute"?r:Math.min(r,b);if(B!=null&&B>z){const mt=Math.min(B-1,b),K=et(z,mt);K&&w.push({key:"post-pending",phase:"postOvulatory",status:ot.status??"pending",bounds:K,startIndex:z,endIndex:mt,displayLabel:ot.label,tooltip:ot.tooltip,message:ot.message,reasons:A.reasons})}if(pt<=wt){const mt=et(pt,wt);mt&&w.push({key:"post-absolute",phase:"postOvulatory",status:B!=null?"absolute":A.status,bounds:mt,startIndex:pt,endIndex:wt,displayLabel:B!=null?Z.label:A.label,tooltip:B!=null?Z.tooltip:A.tooltip,message:B!=null?Z.message:A.message,reasons:A.reasons})}},v=Number.isInteger(i),E=Number.isFinite(A?.startIndex);if(!v&&!E){const w=Math.min(a,r);if(w<0)return e;const b=et(0,w);return b&&e.push({key:"relative-default",phase:"relativeInfertile",status:"default",bounds:b,startIndex:0,endIndex:w,displayLabel:"Relativamente infértil",tooltip:"Relativamente infértil (preovulatoria: sin día fértil por CPM/T-8 ni signos de moco fértil)",message:"Relativamente infértil",reasons:{type:"relative",fertileStartFinalIndex:null,aggregate:q?.aggregate??null,bipScore:q?.debug?.bipScore??null}}),e}if(!v&&E){const w=A.startIndex,b=Math.min(w-1,a);if(b>=0){const z=et(0,b);z&&e.push({key:"no-fertile-window",phase:"nodata",status:"no-fertile-window",bounds:z,startIndex:0,endIndex:b,displayLabel:"Sin ventana fértil identificable",tooltip:"Sin ventana fértil identificable",message:"Sin ventana fértil identificable",reasons:{type:"nofertile",status:"no-fertile-window",message:"No se ha identificado un inicio fértil claro en este ciclo (ni por moco, ni por calculadora, ni por marcador explícito)."}})}return Number.isFinite(A.startIndex)&&A.startIndex<=r&&y(e,a),e}if(v&&i>0){const w=Math.min(i-1,a);if(w>=0){const b=et(0,w);b&&e.push({key:"relative",phase:"relativeInfertile",status:"default",bounds:b,startIndex:0,endIndex:w,displayLabel:"Relativamente infértil",tooltip:"Relativamente infértil (fase relativamente infértil preovulatoria)",message:"Relativamente infértil",reasons:{type:"relative",fertileStartFinalIndex:i,aggregate:q?.aggregate??null,bipScore:q?.debug?.bipScore??null}})}}const $=v?Math.max(i,0):0,D=A?.startIndex,_=Number.isFinite(D)&&D!=null?Math.min(D-1,r):r,P=Math.min(_,a);if(P>=$){const w=et($,P);if(w){const b=Number.isInteger(q?.debug?.explicitStartDay)?q.debug.explicitStartDay:null,z=q?.aggregate?.usedCandidates??[],B=z.some(pt=>pt?.kind==="profile"),ot=z.some(pt=>pt?.kind==="calculator");let Z=null;v&&b!=null&&b===i?Z="marker":B?Z="profiles":ot&&(Z="calculator"),e.push({key:"fertile",phase:"fertile",status:"default",bounds:w,startIndex:$,endIndex:P,displayLabel:"Fértil",tooltip:"Fértil",message:"Fértil",reasons:{type:"fertile",startIndex:$,endIndex:P,source:Z,details:q?.debug??null,notes:q?.aggregate?.notes??[],statusSummary:q?.currentAssessment??null,dailyAssessments:q?.dailyAssessments??[],window:q?.fertileWindow??null,aggregate:q?.aggregate??null}})}}return A&&Number.isFinite(A.startIndex)&&A.startIndex<=r&&y(e,a),e},[S,U,lt,Ft,l.length,i,q,A,ft,et,I]),pe=`${ee}-phase-relative-gradient`,kt=`${ee}-phase-fertile-gradient`,Xt=`${ee}-phase-post-pending-gradient`,qt=`${ee}-phase-post-absolute-gradient`,Ae=e=>e.phase==="relativeInfertile"?"#065F46":e.phase==="fertile"?"#9D174D":e.phase==="postOvulatory"?e.status==="pending"?"#075985":"#1E3A8A":e.phase==="nodata"?"#475569":"hsl(var(--foreground))",Ee="0 1px 1px var(--phase-text-shadow, rgba(15, 23, 42, 0.2))",Ce=u.useMemo(()=>{if(!S||!h?.confirmed)return null;const e=Array.isArray(h?.highSequenceIndices)?h.highSequenceIndices:[];if(e.length<2)return null;const r=e.map(a=>{if(a==null||a<0||a>=l.length)return null;const y=l[a],v=o.get(y?.id);return!v||!Number.isFinite(v.displayTemperature)?null:{x:Q(a),y:Et(v.displayTemperature)}}).filter(Boolean);return r.length<2?null:r.map(({x:a,y},v)=>`${v===0?"M":"L"} ${a} ${y}`).join(" ")},[S,h,l,o,Q,Et]),[Nt,st]=u.useState({w:typeof window<"u"?window.innerWidth:0,h:typeof window<"u"?window.innerHeight:0}),xe=Nt.w<Nt.h;u.useEffect(()=>{const e=()=>st({w:window.innerWidth,h:window.innerHeight});return window.addEventListener("resize",e),window.addEventListener("orientationchange",e),()=>{window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e)}},[]);const xt=u.useCallback((e=0)=>{const r=dt.current;if(!r)return;const a=l.length;if(!a){Ie({startIndex:0,endIndex:-1});return}const y=r.clientWidth||1,E=y/Math.max(M,1)||1,$=ne(M,a),D=Math.floor(e/E),_=Math.floor((e+y)/E);let P=D-$,w=_+$;P=Math.max(0,P),w=Math.min(a-1,w),Ie(b=>b.startIndex===P&&b.endIndex===w?b:{startIndex:P,endIndex:w})},[l.length,ne,M]);u.useEffect(()=>{if(!dt.current)return;const e=dt.current.clientWidth/M;dt.current.scrollLeft=Math.max(0,e*ct),xt(dt.current.scrollLeft)},[ct,M,bt.width,k,xt]),u.useEffect(()=>{const e=dt.current;if(!e)return;const r=()=>{de(!0),Dt.current&&window.clearTimeout(Dt.current),Dt.current=window.setTimeout(()=>de(!1),140),!jt.current&&(jt.current=window.requestAnimationFrame(()=>{jt.current=null,xt(e.scrollLeft)}))};return e.addEventListener("scroll",r,{passive:!0}),xt(e.scrollLeft),()=>{e.removeEventListener("scroll",r),Dt.current&&window.clearTimeout(Dt.current),jt.current&&(window.cancelAnimationFrame(jt.current),jt.current=null)}},[xt]);const Mt=!g&&s&&gt&&xe,Kt=gt?"landscape":k,$e=Mt,Le="w-full h-full bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100",De=s?`${Le} h-full ${$e?"overflow-y-auto overflow-x-auto":"overflow-x-auto overflow-y-auto"}`:`${Le} overflow-x-auto overflow-y-visible border border-pink-100/50`,Te=!s||Kt==="portrait",We=g?()=>{}:It,Ve=g?()=>{}:Ut;return t.jsx(Ct.div,{className:"relative w-full h-full",initial:!1,children:t.jsxs(Ct.div,{ref:dt,className:`relative p-0 ${s?"":"rounded-2xl"} ${De}`,style:{touchAction:"auto",boxShadow:s?"inset 0 1px 3px rgba(244, 114, 182, 0.1)":"0 8px 32px rgba(244, 114, 182, 0.12), 0 2px 8px rgba(244, 114, 182, 0.08)",...Mt?{position:"absolute",top:"50%",left:"50%",width:`${Nt.h}px`,height:`${Nt.w}px`,transform:"translate(-50%, -50%) rotate(90deg)",transformOrigin:"center center"}:{}},initial:!1,children:[Oe&&t.jsx("div",{className:"flex items-center justify-center w-full h-full text-slate-400",children:"Cargando..."}),t.jsx("div",{className:"inline-block",style:{width:tt,height:ht},children:t.jsx("div",{className:"relative h-full overflow-y-auto",style:{height:ht,maxHeight:Wt},children:t.jsxs("div",{className:"relative",style:{width:tt,height:Wt},children:[Te&&t.jsx("div",{className:"absolute left-0 top-0 h-full bg-transparent pointer-events-none z-10",style:{width:C.left},children:t.jsx(Pn,{padding:C,chartHeight:Wt,tempMin:at,tempMax:X,tempRange:N,getY:Et,responsiveFontSize:te,textRowHeight:Qt,isFullScreen:s,reduceMotion:zt,graphBottomY:Rt,rowsZoneHeight:re,showRelationsRow:J})}),t.jsxs(Ct.svg,{ref:je,width:tt,height:Wt,className:"font-sans flex-shrink-0",viewBox:`0 0 ${tt} ${Wt}`,preserveAspectRatio:"xMidYMid meet",onClick:Tt,initial:!1,children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),t.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),t.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),t.jsxs("linearGradient",{id:"tempAreaGradientChart",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(244, 114, 182, 0.18)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(244, 114, 182, 0.02)"})]}),t.jsxs("linearGradient",{id:pe,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"var(--phase-rel)",stopOpacity:"0"}),t.jsx("stop",{offset:"100%",stopColor:"var(--phase-rel)",stopOpacity:"var(--phase-rel-stop, 0.28)"})]}),t.jsxs("linearGradient",{id:kt,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"var(--phase-fertile)",stopOpacity:"0"}),t.jsx("stop",{offset:"100%",stopColor:"var(--phase-fertile)",stopOpacity:"var(--phase-fertile-stop, 0.27)"})]}),t.jsxs("linearGradient",{id:Xt,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"var(--phase-post)",stopOpacity:"0"}),t.jsx("stop",{offset:"100%",stopColor:"var(--phase-post)",stopOpacity:"var(--phase-post-stop, 0.45)"})]}),t.jsxs("linearGradient",{id:qt,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"var(--phase-post-abs)",stopOpacity:"0"}),t.jsx("stop",{offset:"100%",stopColor:"var(--phase-post-abs)",stopOpacity:"var(--phase-post-abs-stop, 0.7)"})]}),t.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[t.jsx("rect",{width:"6",height:"6",fill:"#ef4444"}),t.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(255,255,255,0.85)"})]}),t.jsxs("filter",{id:"chartShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsxs("filter",{id:"baselineGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),t.jsx("rect",{width:"100%",height:"100%",fill:"transparent"}),t.jsx(In,{padding:C,chartWidth:tt,chartHeight:ht,tempMin:at,tempMax:X,tempRange:N,getY:Et,getX:Q,allDataPoints:l,visibleRange:se,responsiveFontSize:te,isFullScreen:s,showLeftLabels:!Te,reduceMotion:zt,isScrolling:oe,graphBottomY:Rt,chartAreaHeight:Math.max(ht-C.top-C.bottom-(Gt||0),0),rowsZoneHeight:re}),S&&Se.length>0&&lt!=null&&Ft>0&&t.jsx("g",{children:Se.map(e=>{const r=lt,a=Ft,v=e.phase==="postOvulatory"?e.status==="pending"?`url(#${Xt})`:`url(#${qt})`:e.phase==="relativeInfertile"?`url(#${pe})`:e.phase==="fertile"?`url(#${kt})`:e.phase==="nodata"?"rgba(203, 213, 225, 0.2)":`url(#${kt})`,E=s?14:13,$=Math.max(te(1.1),E),D=e.bounds.width<120,_=Math.max(e.bounds.width-16,0),P=Math.max($*.58,1),w=Math.max(1,Math.floor(_/P)),b=e.tooltip??e.displayLabel??e.message??"";let z=e.displayLabel??e.message??"";if(D&&z.length>w){const K=Math.max(w-1,1);z=`${z.slice(0,K).trimEnd()}${z.length>K?"…":""}`}const B=D?e.bounds.x+8:e.bounds.x+e.bounds.width/2,ot=D?"start":"middle",Z=r+a/2,pt=Ae(e),wt=K=>{typeof K?.stopPropagation=="function"&&K.stopPropagation(),typeof j=="function"&&j({phase:e.phase,status:e.status,reasons:e.reasons,message:e.message,startIndex:e.startIndex,endIndex:e.endIndex,limitIndex:L,label:e.displayLabel??e.message??null})},mt=K=>{(K.key==="Enter"||K.key===" ")&&(K.preventDefault(),wt(K))};return t.jsxs("g",{children:[t.jsx("rect",{x:e.bounds.x,y:r,width:e.bounds.width,height:a,fill:v,pointerEvents:"none"}),t.jsxs("text",{x:B,y:Z,fill:pt,fontSize:$,fontWeight:600,dominantBaseline:"middle",textAnchor:ot,role:"button","aria-label":b,tabIndex:0,"data-chart-interactive":"true",onClick:wt,onKeyDown:mt,style:{cursor:"pointer",userSelect:"none",lineHeight:1.2,textShadow:Ee},pointerEvents:"auto",children:[t.jsx("title",{children:b}),z]})]},e.key)})}),S&&we&&Ht!==null&&(zt?t.jsx("line",{x1:fe,y1:Ht,x2:ke,y2:Ht,stroke:Pt,strokeWidth:he,strokeDasharray:Yt,opacity:ie}):t.jsx(Ct.path,{d:`M ${fe} ${Ht} L ${ke} ${Ht}`,stroke:Pt,strokeWidth:he,strokeDasharray:Yt,opacity:ie,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:ie},transition:{duration:4,ease:"easeInOut",delay:.5}})),t.jsx(wn,{data:R,allDataPoints:l,getX:Q,getY:Et,baselineY:Rt,temperatureField:"displayTemperature",reduceMotion:zt,connectGaps:!g}),Ce&&t.jsx("g",{pointerEvents:"none",children:t.jsx("path",{d:Ce,fill:"none",stroke:"#cc0e93",strokeWidth:4,strokeLinecap:"round",strokeLinejoin:"round",opacity:.9})}),m!==null&&Bt!==null&&x>0&&t.jsx("g",{pointerEvents:"none",children:(()=>{const e=Rt,r=Math.max(3,Math.min(14,x*.4)),a=Math.max(r*2,Qt*.85);return t.jsxs(t.Fragment,{children:[t.jsx("line",{x1:Bt,y1:0,x2:Bt,y2:e,stroke:"rgba(235, 171, 204,0.15)",strokeWidth:r}),t.jsx("line",{x1:Bt,y1:e,x2:Bt,y2:ht,stroke:"rgba(235, 171, 204,0.15)",strokeWidth:a})]})})()}),t.jsx($n,{data:l,getX:Q,getY:Et,isFullScreen:s,orientation:Kt,responsiveFontSize:te,onPointInteraction:We,clearActivePoint:Ve,activePoint:Lt,visibleRange:se,padding:C,chartHeight:ht,chartWidth:tt,temperatureField:"displayTemperature",textRowHeight:Qt,graphBottomY:Rt,rowsZoneHeight:re,compact:!1,reduceMotion:zt,isScrolling:oe,showInterpretation:S,ovulationDetails:h,baselineStartIndex:Ne,firstHighIndex:be,baselineIndices:ye,graphBottomLift:Gt,showRelationsRow:J,autoLabelStep:g,isArchivedCycle:c})]})]})})}),!g&&Lt&&t.jsx(Ct.div,{ref:yt,initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:10},transition:{duration:.12,ease:"easeOut"},children:t.jsx(bn,{point:Lt,position:rt,chartWidth:tt,chartHeight:ht,onToggleIgnore:Re,onEdit:H,onClose:Ut,onTogglePeak:d,currentPeakIsoDate:O})})]})})};export{Yn as F};
