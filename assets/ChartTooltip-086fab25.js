import{r as g,j as e,m as t,B as i,f as se,p as te}from"./index-24043ae7.js";import{e as ae,B as re}from"./badge-e36f7fd8.js";import{g as ie,X as le,C as W,P as _,T as oe,a as ne}from"./computePeakStatuses-a8c393d1.js";import{E as de}from"./eye-61791957.js";import{E as ce}from"./eye-off-b85355d3.js";const ve=({point:s,position:r,chartWidth:u,chartHeight:f,onToggleIgnore:p,onEdit:l,onClose:o,onTogglePeak:y,currentPeakIsoDate:E})=>{if(!s)return null;const j=.6,F=200,M=120,x=F*j,q=M*j,v=g.useRef(null),[w,G]=g.useState(q),[h,N]=g.useState(!1);g.useEffect(()=>{v.current&&G(v.current.offsetHeight),N(!1)},[s]);const I=r.clientX>u*.66,J=r.clientY+w>f;let n=I?r.clientX-x-10:r.clientX+10,d=J?r.clientY:r.clientY+10;n+x>u&&(n=u-x-10),d+w>f&&(d=f-w-10),n<10&&(n=10),d<10&&(d=10);const c=!s.id||String(s.id).startsWith("placeholder-"),T=s.temperature_chart??s.displayTemperature??null,k=ie(s.fertility_symbol),$=s.timestamp||s.isoDate,C=s.mucus_sensation??s.mucusSensation??"",B=s.mucus_appearance??s.mucusAppearance??"",S=s.observations??"",L=k&&k.value!=="none",H=T!=null,K=!!(C&&C.trim()||B&&B.trim()),X=!!(S&&S.trim()),U=!(H||L||K||X),A=s.peakStatus||(s.peak_marker==="peak"?"P":null),O=A&&{P:"Día pico",1:"Post pico 1",2:"Post pico 2",3:"Post pico 3"}[A]||null,P=!!(y&&s.isoDate),z=!!E,a=z&&s.isoDate===E||A==="P"||s.peak_marker==="peak",Z=z&&!a,R="Día pico",b=a?"Quitar día pico":z?"Actualizar día pico":"Marcar día pico",ee=a?"bg-rose-600 text-white border border-rose-600 hover:bg-rose-700 focus-visible:ring-rose-400":Z?"bg-amber-400 text-amber-900 border border-amber-300 hover:bg-amber-500 hover:text-white focus-visible:ring-amber-300":"bg-rose-500 text-white border border-rose-500 hover:bg-rose-600 focus-visible:ring-rose-300",Y=[["flex items-center justify-center gap-2 px-3 py-2 rounded-xl text-sm font-semibold","transition-all duration-200 shadow-sm hover:shadow-md","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-300"].join(" "),ee,h?"opacity-70 cursor-not-allowed":null].filter(Boolean).join(" "),Q=async()=>{if(!(!y||h)){N(!0);try{await y(s,!a),o&&o()}catch(D){console.error("Error toggling peak marker from tooltip:",D)}finally{N(!1)}}},V=()=>{l&&(l(s),o&&o())},m=(D=>{switch(D){case"red":return{bg:"bg-red-500",light:"bg-red-50",border:"border-red-200",text:"text-red-700",glow:"shadow-red-200/50"};case"white":return{bg:"bg-slate-100 border-2 border-slate-300",light:"bg-slate-50",border:"border-slate-200",text:"text-slate-700",glow:"shadow-slate-200/50"};case"green":return{bg:"bg-green-500",light:"bg-green-50",border:"border-green-200",text:"text-green-700",glow:"shadow-green-200/50"};case"yellow":return{bg:"bg-yellow-400",light:"bg-yellow-50",border:"border-yellow-200",text:"text-yellow-700",glow:"shadow-yellow-200/50"};case"spot":return{bg:"bg-red-500 pattern-bg",light:"bg-red-50",border:"border-red-200",text:"text-red-700",glow:"shadow-red-200/50"};default:return{bg:"bg-gray-400",light:"bg-gray-50",border:"border-gray-200",text:"text-gray-700",glow:"shadow-gray-200/50"}}})(s.fertility_symbol);return e.jsxs(t.div,{ref:v,initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:20},transition:{duration:.25,ease:[.16,1,.3,1]},className:"absolute z-50",style:{top:d,left:n,width:x},children:[e.jsx("div",{className:"origin-top-left",style:{transform:`scale(${j})`,width:F,minHeight:M},children:e.jsxs("div",{className:"relative bg-gradient-to-br from-white/98 to-rose-50/95 backdrop-blur-xl rounded-3xl border border-pink-100 shadow-2xl overflow-hidden",children:[e.jsx(i,{variant:"ghost",size:"icon",onClick:o,className:"absolute top-2 right-2 text-gray-400 hover:text-pink-600 hover:bg-pink-50/80 rounded-full w-6 h-6 transition-all duration-200",children:e.jsx(le,{size:20})}),e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"mb-2",children:e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx("div",{className:"w-5 h-5 bg-gradient-to-br from-pink-500 to-rose-500 rounded-full absolute top-2 left-2 flex items-center justify-center shadow-lg",children:e.jsx(W,{className:"w-2 h-2 text-white",fill:"currentColor"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-center text-lg text-gray-800",children:$?se(te($),"dd/MM",{locale:ae}):"Fecha"}),e.jsxs("p",{className:"text-sm text-pink-600 font-medium",children:["Día ",s.cycleDay||"N/A"," del ciclo"]}),O&&e.jsx("div",{className:"mt-1 flex justify-center",children:e.jsx(re,{className:"bg-rose-100 text-rose-600 border border-rose-200 px-2 py-0 text-[11px]",children:O})})]})]})}),U?e.jsxs("div",{className:"pt-1 space-y-3",children:[e.jsx(t.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:.1},className:"rounded-xl border border-dashed border-pink-200 bg-pink-50/60 p-2 text-center",children:e.jsx("p",{className:"text-sm font-semibold text-pink-600",children:"Sin datos registrados para este día."})}),l&&e.jsx(t.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:.15},className:"flex justify-center",children:e.jsxs(i,{onClick:V,variant:"outline",size:"sm",className:"flex items-center gap-2 px-2 py-2 bg-white/80 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 border-gray-200 hover:border-blue-300 text-gray-700 hover:text-blue-700 rounded-xl transition-all duration-200 shadow-sm hover:shadow-md",children:[e.jsx(_,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Añadir datos"})]})}),P&&e.jsx(t.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:.2},className:"flex justify-center",children:e.jsx(i,{onClick:Q,variant:a?"outline":"default",size:"sm",disabled:h,className:Y,"aria-label":b,title:b,"aria-pressed":a,children:e.jsx("span",{className:"font-medium",children:R})})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1",children:[H&&e.jsx(t.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1},className:"bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl p-1 border border-amber-100/50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gradient-to-br from-amber-500 to-orange-600 rounded-lg flex items-center justify-center shadow-md",children:e.jsx(oe,{className:"w-4 h-4 text-white"})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-md font-bold text-gray-800",children:parseFloat(T).toFixed(2)}),e.jsx("span",{className:"text-md text-gray-600",children:"°C"}),s.use_corrected&&e.jsx("div",{className:"w-2 h-2 bg-amber-500 rounded-full shadow-[0_0_4px_rgba(245,158,11,0.65)]",title:"Temperatura corregida"})]})})]})}),L&&e.jsx(t.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.15},className:`${m.light} rounded-xl p-1 ${m.border} border`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-6 h-6 ${m.bg} rounded-lg flex items-center justify-center shadow-lg ${m.glow} shadow-lg`,children:e.jsx("div",{className:"w-2 h-2 bg-white/90 rounded-full shadow-sm"})}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("span",{className:`text-md font-semibold ${m.text}`,children:k.label})})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsx(t.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.2},className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-1 border border-blue-100/50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center shadow-md",children:e.jsx(ne,{className:"w-4 h-4 text-white"})}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("span",{className:"text-md font-semibold text-blue-800",children:C||"-"})})]})}),e.jsx(t.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.25},className:"bg-gradient-to-r from-emerald-50 to-teal-50 rounded-xl p-1 border border-emerald-100/50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-lg flex items-center justify-center shadow-md",children:e.jsx(W,{className:"w-4 h-4 text-white"})}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("span",{className:"text-md font-semibold text-green-800",children:B||"-"})})]})}),X&&e.jsx(t.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.3},className:"bg-gradient-to-r from-violet-50 to-purple-50 rounded-xl p-1 border border-violet-100/50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gradient-to-br from-violet-500 to-purple-600 rounded-lg flex items-center justify-center shadow-md",children:e.jsx(_,{className:"w-4 h-4 text-white"})}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("span",{className:"text-sm font-semibold text-violet-800",children:S})})]})})]})]}),(l||p&&!c&&s.id||P&&!c)&&e.jsxs(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"flex justify-center gap-3 pt-1 border-t border-gray-100",children:[l&&e.jsxs(i,{onClick:V,variant:"outline",size:"sm",className:"flex items-center gap-2 px-2 py-2 bg-white/80 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 border-gray-200 hover:border-blue-300 text-gray-700 hover:text-blue-700 rounded-xl transition-all duration-200 shadow-sm hover:shadow-md",children:[e.jsx(_,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:c?"Añadir datos":"Editar"})]}),P&&!c&&e.jsx(i,{onClick:Q,variant:a?"outline":"default",size:"sm",disabled:h,className:Y,"aria-label":b,title:b,"aria-pressed":a,children:e.jsx("span",{className:"font-medium",children:R})}),p&&!c&&s.id&&e.jsx(i,{onClick:()=>p(s.id),variant:"outline",size:"sm",className:`flex items-center gap-2 px-2 py-2 rounded-xl transition-all duration-200 shadow-sm hover:shadow-md ${s.ignored?"bg-green-50 hover:bg-green-100 border-green-200 hover:border-green-300 text-green-700":"bg-red-50 hover:bg-red-100 border-red-200 hover:border-red-300 text-red-700"}`,children:s.ignored?e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Mostrar"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Ocultar"})]})})]})]})]})]})}),e.jsx("div",{className:"absolute -inset-2 bg-gradient-to-br from-pink-200/25 to-rose-300/25 rounded-3xl blur-2xl -z-10"})]})};export{ve as C};
