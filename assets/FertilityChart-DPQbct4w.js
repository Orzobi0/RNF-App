import{m as Ct,j as t,R as en,r as g,o as Fe,f as qe,V as nn}from"./index-Do8Ydwb3.js";import{a as pn,g as xn}from"./computePeakStatuses-DaIqHORZ.js";import{i as mn}from"./useCycleData-Dq0sFEDe.js";import{i as gn}from"./badge-DykpjFnT.js";import{u as yn,C as bn}from"./useFertilityChart-D3HVJDKg.js";const In=({padding:n,chartWidth:s,chartHeight:w,tempMin:h,tempMax:P,tempRange:d,getY:H,getX:it,allDataPoints:M=[],visibleRange:k=null,responsiveFontSize:B,isFullScreen:ht,showLeftLabels:N=!1,reduceMotion:q=!1,isScrolling:D=!1,graphBottomY:ot,chartAreaHeight:x,rowsZoneHeight:I})=>{const c={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.3,ease:"easeOut"}}},$=[];if(d>0){const v=d<=2.5?.1:.5;for(let st=h;st<=P+1e-9;st+=v)$.push(parseFloat(st.toFixed(1)))}else for(let v=35.8;v<=37.2+1e-9;v+=.1)$.push(parseFloat(v.toFixed(1)));const j=M.length,ut=j>60||D,pt=q||ut?"g":Ct.g,Lt=Number.isInteger(k?.startIndex)?k.startIndex:0,m=Number.isInteger(k?.endIndex)?k.endIndex:Math.max(j-1,0),tt=j?Math.max(0,Math.min(j-1,Lt)):0,l=j?Math.max(tt,Math.min(j-1,m)):-1;return t.jsxs(t.Fragment,{children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"bgGradientChart",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"#fffbfc"}),t.jsx("stop",{offset:"50%",stopColor:"#fff5f7"}),t.jsx("stop",{offset:"100%",stopColor:"#fff1f3"})]}),t.jsxs("linearGradient",{id:"dataZoneGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"#fff7fb"}),t.jsx("stop",{offset:"50%",stopColor:"#ffe4f0"}),t.jsx("stop",{offset:"100%",stopColor:"#fff7fb"})]}),t.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"#f472b6"}),t.jsx("stop",{offset:"30%",stopColor:"#ec4899"}),t.jsx("stop",{offset:"70%",stopColor:"#db2777"}),t.jsx("stop",{offset:"100%",stopColor:"#be185d"})]}),t.jsxs("filter",{id:"softShadow",children:[t.jsx("feGaussianBlur",{in:"SourceAlpha",stdDeviation:"2"}),t.jsx("feOffset",{dx:"0",dy:"1",result:"offsetblur"}),t.jsx("feComponentTransfer",{children:t.jsx("feFuncA",{type:"linear",slope:"0.2"})}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsxs("filter",{id:"pointGlow",children:[t.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsx("filter",{id:"textShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:t.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodColor:"rgba(255, 255, 255, 0.8)"})}),t.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[t.jsx("rect",{width:"6",height:"6",fill:"#ef4444"}),t.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(255,255,255,0.85)"})]})]}),t.jsx("rect",{x:n.left,y:n.top,width:s-n.left-n.right,height:x,fill:"url(#bgGradientChart)",opacity:2,rx:12,style:{filter:"drop-shadow(0 4px 12px rgba(244, 114, 182, 0.1))"}}),t.jsx("rect",{x:n.left,y:n.top,width:s-n.left-n.right,height:x,fill:"white",stroke:"url(#tempLineGradientChart)",strokeWidth:"1",strokeOpacity:"0.2",rx:"12",style:{filter:"url(#softShadow)"}}),t.jsx("rect",{x:n.left,y:ot,width:s-n.left-n.right,height:I,fill:"url(#dataZoneGradient)",rx:"8",style:{filter:"drop-shadow(0 -1px 2px rgba(244, 114, 182, 0.05))"}}),$.map((v,st)=>{const Y=H(v),R=v.toFixed(1).endsWith(".0")||v.toFixed(1).endsWith(".5"),C=R?v.toFixed(1):`.${v.toFixed(1).split(".")[1]}`;return t.jsxs(pt,{...q||ut?{}:{variants:c},children:[t.jsx("line",{x1:n.left,y1:Y,x2:s-n.right,y2:Y,stroke:R?"#f9a8d4":"#fce7f3",strokeWidth:R?1.5:1,opacity:R?.5:.3,strokeDasharray:R?"0":"4,4",style:{filter:R&&!ut?"drop-shadow(0 1px 3px rgba(244, 114, 182, 0.15))":"none",opacity:R?1:.7}}),N&&t.jsx("text",{x:n.left-B(1),y:Y+B(.35),textAnchor:"end",fontSize:B(R?1.1:1),fontWeight:R?"700":"600",fill:R?"#be185d":"#db2777",opacity:R?.9:.7,style:{filter:ut?"none":"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:C}),t.jsx("text",{x:s-n.right+B(1),y:Y+B(.35),textAnchor:"start",fontSize:B(R?1.1:1),fontWeight:R?"700":"600",fill:R?"#be185d":"#db2777",opacity:R?.9:.7,style:{filter:ut?"none":"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:C})]},`temp-tick-${st}`)}),j>0&&Array.from({length:l-tt+1},(v,st)=>{const Y=tt+st,R=it(Y);return t.jsx("line",{x1:R,y1:n.top,x2:R,y2:ot,stroke:"#fce7f3",strokeWidth:"1",opacity:"0.6",style:{filter:ut?"none":"drop-shadow(0 0 1px rgba(244, 114, 182, 0.05))"}},`day-grid-${Y}`)}),t.jsx("rect",{x:n.left,y:n.top,width:s-n.left-n.right,height:x,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"2",strokeOpacity:"0.4",rx:"12"}),t.jsx("rect",{x:n.left+1,y:n.top+1,width:s-n.left-n.right-2,height:x-2,fill:"none",stroke:"white",strokeWidth:"0.5",rx:"11",opacity:"0.9"}),N&&t.jsx(pt,{...q||ut?{}:{variants:c},children:t.jsx("text",{x:n.left+B(1.2),y:n.top+B(1.5),textAnchor:"middle",fontSize:B(1.4),fontWeight:"800",fill:"#be185d",style:{filter:ut?"none":"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:"°C"})})]})},jn=({data:n,allDataPoints:s,getX:w,getY:h,baselineY:P,temperatureField:d="temperature",reduceMotion:H=!1,connectGaps:it=!0})=>{if(!n||n.length<2)return null;const{pathD:M,thinPathD:k,hasContinuousSegment:B}=g.useMemo(()=>{const ht=new Map(n.map(x=>[x.id,x]));let N="",q=null;const D=[];if(s.forEach((x,I)=>{const c=ht.get(x.id);if(c&&c[d]!==null&&c[d]!==void 0&&!c.ignored){const $=w(I),j=h(c[d]);D.push({x:$,y:j}),q!==null&&I===q+1?N+=` L ${$} ${j}`:N+=`${N?" ":""}M ${$} ${j}`,q=I}}),D.length<2)return{pathD:"",thinPathD:"",hasContinuousSegment:!1};const ot=it&&D.length>1?D.map(({x,y:I},c)=>`${c===0?"M":"L"} ${x} ${I}`).join(" "):"";return{pathD:N,thinPathD:ot,hasContinuousSegment:N.includes("L")}},[s,n,w,h,d,it]);return M?t.jsxs(t.Fragment,{children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"#f472b6"}),t.jsx("stop",{offset:"30%",stopColor:"#ec4899"}),t.jsx("stop",{offset:"70%",stopColor:"#db2777"}),t.jsx("stop",{offset:"100%",stopColor:"#be185d"})]}),t.jsx("filter",{id:"lineShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:t.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"3",floodColor:"rgba(244, 114, 182, 0.4)"})})]}),B&&(H?t.jsx("path",{d:M,fill:"none",stroke:"url(#tempLineGradientChartGlow)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:.4,style:{filter:"url(#lineGlow)"}}):t.jsx(Ct.path,{d:M,fill:"none",stroke:"url(#tempLineGradientChartGlow)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:.4,style:{filter:"url(#lineGlow)"},initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.4},transition:{duration:.8,ease:"easeInOut",delay:.2}})),k&&(H?t.jsx("path",{d:k,fill:"none",stroke:"#d587b1",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.65}):t.jsx(Ct.path,{d:k,fill:"none",stroke:"#d587b1",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.65,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.65},transition:{duration:.8,ease:"easeInOut"}})),B&&(H?t.jsx("path",{d:M,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#lineShadow)"}}):t.jsx(Ct.path,{d:M,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#lineShadow)"},initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:1},transition:{duration:1,ease:"easeInOut",delay:.4}}))]}):null},wn=en.memo(jn),Xe="var(--color-sensacion-fuerte)",Ke="var(--color-apariencia-fuerte)",Ze="var(--color-observaciones-fuerte)",Ge="#be123c",Mn="rgba(148, 163, 184, 0.35)",kn="rgba(226, 232, 240, 0.6)",Sn="rgba(148, 163, 184, 0.5)",Je="✖",_e="#7f1d1d",He="#ec4899",Cn="drop-shadow(0 2px 4px rgba(244, 114, 182, 0.35))",Ln="#be185d",vn="#2563eb",Rn="#be185d",On="rgba(244, 114, 182, 0.35)",Qe=n=>{if(!n)return"";const[s,w]=n.split("/");return`${parseInt(s,10)}/${parseInt(w,10)}`},ye='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',Nn=()=>{if(typeof document>"u")return(w,h)=>{const P=/(\d+(?:\.\d+)?)px/.exec(h||""),d=P?Number(P[1]):12;return w.length*d*.6};const s=document.createElement("canvas").getContext("2d");return s?(w,h)=>(s.font=h,s.measureText(w).width):(w,h)=>{const P=/(\d+(?:\.\d+)?)px/.exec(h||""),d=P?Number(P[1]):12;return w.length*d*.6}},Ue=(n,s,w)=>`${s} ${n}px ${w}`,tn=(n="",{maxWidth:s,maxLines:w=2,fontSize:h,fontWeight:P=700,fontFamily:d=ye,fallback:H="–",measureTextWidth:it})=>{if(!n)return[H,...Array.from({length:Math.max(0,w-1)},()=>"")];const M=Ue(h,P,d),k=x=>it(x,M),B=String(n).trim(),ht=/\s/.test(B),N=ht?B.split(/\s+/):Array.from(B),q=ht?" ":"",D=[],ot=x=>{const I=Array.from(x);let c="";for(;I.length;){const $=c+I[0];if(k($)<=s||!c){if(c=$,I.shift(),k(c)>s&&c.length>1){I.unshift(...Array.from(c.slice(1))),c=c[0];break}}else break}return[c,I.join("")]};for(;N.length&&D.length<w;){let x="";for(;N.length;){const I=N[0],c=x?`${x}${q}${I}`:I;if(k(c)<=s){x=c,N.shift();continue}if(!x)if(ht){const[$,j]=ot(I);x=$,j?N[0]=j:N.shift()}else{const[$,j]=ot(I);x=$,j?N[0]=j:N.shift()}break}D.push(x),!x&&N.length&&D.push(N.shift())}if(N.length&&D.length){const x=D.length-1;let I=D[x]||"";for(;I&&k(`${I}…`)>s;)I=I.slice(0,-1);D[x]=I?`${I}…`:"…"}for(;D.length<w;)D.push("");return D};function Ye(n="",s,w="–"){return n?n.split(/\s+/).slice(0,s).join(" "):w}const An=({data:n,getX:s,getY:w,isFullScreen:h,orientation:P,responsiveFontSize:d,onPointInteraction:H,clearActivePoint:it,activePoint:M,visibleRange:k=null,padding:B,chartHeight:ht,chartWidth:N,temperatureField:q="temperature_chart",textRowHeight:D,compact:ot=!1,reduceMotion:x=!1,isScrolling:I=!1,showInterpretation:c=!1,ovulationDetails:$=null,firstHighIndex:j=null,baselineIndices:lt=[],graphBottomLift:ut=0,graphBottomY:pt,rowsZoneHeight:Lt,showRelationsRow:m=!1,autoLabelStep:tt=!1,isArchivedCycle:l=!1})=>{const v={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},st={hidden:{opacity:0,scale:.3},visible:{opacity:1,scale:1,transition:{duration:.6,ease:[.34,1.56,.64,1],type:"spring",stiffness:120,damping:12}}},Y=pt,R=h?9:7.5,C=h?1:.75,Zt=m?R+(h?2:1.5):null,$t=R+C,rt=Math.max(1,Math.floor(Lt/$t)),jt=Math.max(D,rt),Re=Y+jt*1,Jt=Y+jt*2,Gt=Y+jt*3,ce=Y+jt*(h?5:4.5),Oe=Y+jt*(h?7:6),be=Y+jt*(h?9:7.5),Ie=m?be+jt*(h?2:1.5):null,u=Array.isArray(n)?n.length:0,ct=u>60||I||l,Bt=x||ct?"g":Ct.g,Et=N-B.left-B.right,_t=jt*(h?2:1.5),Ft=Math.min(Math.max(_t*.46,14),12),Qt=Number.isInteger(k?.startIndex)?k.startIndex:0,te=Number.isInteger(k?.endIndex)?k.endIndex:Math.max(u-1,0),Ht=u?Math.max(0,Math.min(u-1,Qt)):0,ee=u?Math.max(Ht,Math.min(u-1,te)):-1,je=g.useMemo(()=>Fe(new Date),[]),xt=g.useMemo(()=>Nn(),[]),ne=g.useRef(new Map),de=u>0?Et/u:Et,Dt=2,et=Math.min(12,Math.max(4,de*.12)),J=Math.max(0,de-et*2),mt=d(.95),wt=d(.9),Yt=d(.9),Tt=d(.9),Ut=d(.8),we=d(.8),fe=d(.8),Me=g.useMemo(()=>{if(!tt||u<2)return 1;const p=Math.abs(s(1)-s(0));if(!Number.isFinite(p)||p<=0)return 1;const o=n?.find(L=>L?.date||L?.cycleDay!=null)??{},i=Qe(o?.date||"00/00"),A=String(o?.cycleDay??u??""),y=d(1.05),O=d(1),X=xt(i,Ue(y,900,ye)),Mt=xt(A,Ue(O,900,ye)),dt=Math.max(X,Mt)+d(.8);return Math.max(1,Math.ceil(dt/p))},[tt,u,s,n,xt,d]),he=g.useMemo(()=>{if(!c)return new Map;const p=Array.isArray($?.highSequenceIndices)?$.highSequenceIndices:[],o=A=>{const y=n?.[A],O=y?.calcTemperature!=null?y.calcTemperature:y?.displayTemperature,X=y?.ignoredForCalc!=null?y.ignoredForCalc:y?.ignored;return y&&Number.isFinite(O)&&!X},i=new Map;return p.forEach((A,y)=>{const O=Number(A);Number.isInteger(O)&&O>=0&&O<u&&!i.has(O)&&o(O)&&i.set(O,y+1)}),i},[c,$,u,n]),ue=g.useMemo(()=>{if(!c)return new Map;const p=Array.isArray(lt)?lt:[];if(!p.length)return new Map;const o=new Set,i=[],A=L=>{const r=n?.[L],yt=r?.calcTemperature!=null?r.calcTemperature:r?.displayTemperature,Vt=r?.ignoredForCalc!=null?r.ignoredForCalc:r?.ignored;return r&&Number.isFinite(yt)&&!Vt},y=L=>{for(let r=L;r>=0;r-=1)if(A(r))return r;return null},O=L=>{const r=Number(L);Number.isInteger(r)&&r>=0&&r<u&&!o.has(r)&&A(r)&&(o.add(r),i.push(r))};if(p.forEach(L=>{O(L)}),j!=null){const L=Number(j);if(Number.isInteger(L)){const r=y(L-1);r!=null&&O(r)}}if(!i.length)return new Map;const X=[...i].sort((L,r)=>L-r),Mt=new Map;let dt=1;for(let L=X.length-1;L>=0&&!(dt>6);L-=1)Mt.set(X[L],dt),dt+=1;return Mt},[c,lt,u,j,n]),pe=ct?"none":"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))",Wt=ct?"none":"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))",zt=ct?"none":"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))",vt=ct?"none":Cn,xe=ct?"none":"drop-shadow(0 2px 4px rgba(244, 114, 182, 0.25))",ke=ct?"none":"drop-shadow(0 1px 3px rgba(37, 99, 235, 0.45))",Se=ct?"none":"drop-shadow(0 2px 4px rgba(37, 99, 235, 0.3))",me=g.useCallback((p,o,i,A)=>{const y=tn(p,{maxWidth:J,maxLines:3,fontSize:i,fontWeight:700,fontFamily:ye,fallback:o,measureTextWidth:xt});return y[2]?{lines:tn(p,{maxWidth:J,maxLines:3,fontSize:A,fontWeight:700,fontFamily:ye,fallback:o,measureTextWidth:xt}),fontSize:A}:{lines:y,fontSize:i}},[J,xt]);g.useEffect(()=>{ne.current.clear()},[u,J,wt,Yt,Tt]);const se=g.useCallback((p,o,i,A,y)=>{const O=ne.current.get(p);if(O)return O;const X=me(o,i,A,y);return ne.current.set(p,X),X},[me]),Pt=g.useMemo(()=>!u||ee<Ht?[]:Array.from({length:ee-Ht+1},(p,o)=>Ht+o),[ee,Ht,u]);return t.jsxs(t.Fragment,{children:[t.jsxs("defs",{children:[t.jsx("filter",{id:"rowShadowChart",x:"-10%",y:"-10%",width:"120%",height:"120%",children:t.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"4",floodColor:"rgba(244, 114, 182, 0.2)"})}),t.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[t.jsx("rect",{width:"6",height:"6",fill:"#fb7185"}),t.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(255,255,255,0.85)"})]}),t.jsxs("filter",{id:"pointGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsxs("radialGradient",{id:"tempPointGradientChart",cx:"30%",cy:"30%",children:[t.jsx("stop",{offset:"0%",stopColor:"#FDF2F8"}),t.jsx("stop",{offset:"50%",stopColor:"#F9A8D4"}),t.jsx("stop",{offset:"85%",stopColor:"#EC4899"}),t.jsx("stop",{offset:"100%",stopColor:"#DB2777"})]}),t.jsxs("radialGradient",{id:"tempPointIgnoredGradient",cx:"30%",cy:"30%",children:[t.jsx("stop",{offset:"0%",stopColor:"#FFFFFF"}),t.jsx("stop",{offset:"80%",stopColor:"#F8FAFC"}),t.jsx("stop",{offset:"100%",stopColor:"#E2E8F0"})]}),t.jsxs("radialGradient",{id:"ovulationPointGradient",cx:"30%",cy:"30%",children:[t.jsx("stop",{offset:"0%",stopColor:"#dbeafe"}),t.jsx("stop",{offset:"50%",stopColor:"#93c5fd"}),t.jsx("stop",{offset:"85%",stopColor:"#3b82f6"}),t.jsx("stop",{offset:"100%",stopColor:"#2563eb"})]})]}),h&&P!=="portrait"&&t.jsx(Bt,{...x||ct?{}:{variants:v},children:[{label:"Fecha",row:1,color:h?"#374151":"#6B7280"},{label:"Día",row:2,color:h?"#374151":"#6B7280"},{label:"Símbolo",row:3,color:h?"#374151":"#6B7280"},{label:"Sens.",row:h?5:4.5,color:Xe},{label:"Apar.",row:h?7:6,color:Ke},{label:"Observ.",row:h?9:7.5,color:Ze},...m&&Zt!=null?[{label:"RS",row:Zt,color:Ge}]:[]].map(({label:p,row:o,color:i})=>t.jsx("text",{x:B.left-d(.5),y:Y+jt*o,textAnchor:"end",fontSize:d(1.05),fontWeight:"700",fill:i,style:{filter:pe,fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:p},p))}),Pt.map(p=>{const o=n[p];if(!o)return null;const i=s(p),A=o[q]!=null?w(o[q]):Y,y=o.temperature_raw,O=o.temperature_corrected,X=o.use_corrected&&y!=null&&O!=null&&Math.abs(O-y)>.01,Mt=X?w(y):null,dt="#60666f",L=o[q]!=null,r=o.use_corrected&&O!=null&&o[q]===O,yt=o.ignored||o.use_corrected&&!r,Vt=!!(o.had_relations??o.hadRelations);L||o.mucus_sensation||o.mucus_appearance||o.fertility_symbol;const oe=!tt||p%Me===0||p===u-1,Ce=String(o.id||"").startsWith("placeholder-"),ge=$?.peakDayIndex,Rt=c&&ge!=null&&!yt&&L&&p===ge,re=pn(o.fertility_symbol),qt=xn(re.value),ae=re.pattern==="spotting-pattern"?"url(#spotting-pattern-chart)":qt.main,Ne=qt.border==="none"?"none":qt.border||On,Ae=qt.border==="none"?0:re.value==="white"?1.6:1,kt=o.isoDate?mn(Fe(qe(o.isoDate)),Fe(new Date)):!1,K=d(h?1.8:2),ie=Gt-K*.75+K/2+2,Ot=o.peakStatus?String(o.peakStatus).toUpperCase():null,bt=Ot==="P"||Ot==="X",le=Ot&&!bt,Le=bt?Je:Ot||"–",$e=bt||["1","2","3"].includes(Ot),Ee=!Ce&&re.value!=="none",a=!!o.isoDate&&!kt?{pointerEvents:"all",style:{cursor:"pointer"},onClick:Kt=>H(o,p,Kt)}:{},T=(o.isoDate?gn(qe(o.isoDate),je):!1)?Rn:dt,F=he.has(p),at=F?he.get(p):null,nt=ue.has(p),W=nt?ue.get(p):null,Z=d(h?.75:1.2),G=Math.max(.5,Z*.18),S=A-Z*(h?2.6:1.8),b=A+Z*(h?1.9:1.6),_=h?Ye(o.mucus_sensation,Dt,kt?"":"–"):o.mucus_sensation,E=h?Ye(o.mucus_appearance,Dt,kt?"":"–"):o.mucus_appearance,Q=h?Ye(o.observations,Dt,""):o.observations,z=`${o.isoDate||o.id||p}`,ft=se(`${z}-sens-${J}-${wt}-${Ut}-${_??""}`,_,kt?"":"–",wt,Ut),It=se(`${z}-apar-${J}-${Yt}-${we}-${E??""}`,E,kt?"":"–",Yt,we),gt=se(`${z}-obs-${J}-${Tt}-${fe}-${Q??""}`,Q,"",Tt,fe),[V,Nt,St]=ft.lines,[ve,At,Xt]=It.lines,[ze,De,Te]=gt.lines,sn=ft.fontSize,on=It.fontSize,rn=gt.fontSize,We=(Kt,Be,un)=>Math.max(1,[Kt,Be,un].filter(Ve=>Ve&&String(Ve).trim()!=="").length),an=We(V,Nt,St),ln=We(ve,At,Xt),cn=We(ze,De,Te),Pe=(Kt,Be)=>Kt-(Be-1)*mt/2,dn=Pe(ce,an),fn=Pe(Oe,ln),hn=Pe(be,cn);return t.jsxs(Bt,{...x||ct?{}:{variants:v},...a,children:[L&&t.jsxs(Bt,{...x||ct?{}:{variants:st},children:[X&&Mt!==null&&t.jsxs("g",{pointerEvents:"none",children:[t.jsx("line",{x1:i,y1:Mt,x2:i,y2:A,stroke:Mn,strokeWidth:1,strokeDasharray:"4 4"}),t.jsx("circle",{cx:i,cy:Mt,r:3,fill:kn,stroke:Sn,strokeWidth:1}),t.jsx("circle",{cx:i,cy:Mt,r:1,fill:"rgba(255, 255, 255, 0.6)"})]}),t.jsx("circle",{cx:i,cy:A,r:Rt?3.5:2.8,fill:yt?"url(#tempPointIgnoredGradient)":Rt?"url(#ovulationPointGradient)":"url(#tempPointGradientChart)",stroke:o.use_corrected&&r?"#941616":yt?"#94A3B8":Rt?"#1d4ed8":"#E91E63",sstrokeWidth:yt?1.5:Rt?2.2:2,style:{filter:Rt?Se:xe,cursor:"pointer"},pointerEvents:"all",onClick:Kt=>H(o,p,Kt)}),!yt&&t.jsx("circle",{cx:i,cy:A,r:Rt?1.2:.9,fill:Rt?"rgba(239, 246, 255, 0.95)":"rgba(255, 255, 255, 0.9)",style:{filter:Rt?ke:Wt}}),c&&L&&!yt&&F&&t.jsx("g",{pointerEvents:"none",children:t.jsx("text",{x:i,y:S,textAnchor:"middle",fontSize:Z,fontWeight:"900",fill:Ln,strokeWidth:G,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',paintOrder:"stroke",filter:Wt},children:at})}),c&&L&&!yt&&nt&&t.jsx("g",{pointerEvents:"none",children:t.jsx("text",{x:i,y:b,textAnchor:"middle",fontSize:Z,fontWeight:"800",fill:vn,stroke:"#ffffff",strokeWidth:G,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',paintOrder:"stroke",filter:Wt},children:W})})]}),oe&&t.jsx("text",{x:i,y:Re,textAnchor:"middle",fontSize:d(1.05),fontWeight:"900",fill:T,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:Wt},children:Qe(o.date)}),oe&&t.jsx("text",{x:i,y:Jt,textAnchor:"middle",fontSize:d(1),fontWeight:"900",fill:T,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:Wt},children:o.cycleDay}),Ee?t.jsxs("g",{children:[t.jsx("rect",{x:i-K/2+1,y:Gt-K*.75+1,width:K,height:K,fill:"rgba(0, 0, 0, 0.1)",rx:K*.3,opacity:.5}),t.jsx("rect",{x:i-K/2-4,y:Gt-K*.75,width:K*1.4,height:K,fill:ae,stroke:Ne,strokeWidth:Ae,rx:K*.2,style:{filter:xe}}),Ot&&t.jsx("g",{pointerEvents:"none",children:bt?t.jsx("text",{x:i,y:ie,textAnchor:"middle",fontSize:d(1.35),fontWeight:"900",fill:He,stroke:"#fff",strokeWidth:1.5,paintOrder:"stroke",style:{filter:vt},children:Je}):t.jsx("text",{x:i,y:ie,textAnchor:"middle",fontSize:d(Ot?1.1:1),fontWeight:"800",fill:_e,style:{filter:zt},children:Ot})})]}):t.jsxs("g",{children:[$e&&t.jsx("rect",{x:i-K/2-4,y:Gt-K*.75,width:K*1.4,height:K,fill:"transparent",stroke:bt?He:_e,strokeWidth:1,rx:K*.2}),t.jsx("text",{x:i,y:ie,textAnchor:"middle",fontSize:d(bt?1.35:le?1.1:1),fill:bt?He:le?_e:dt,fontWeight:bt?"900":le?"800":"500",style:{filter:bt?vt:le?zt:Wt},children:Le})]}),!ot&&t.jsxs("text",{x:i,y:dn,textAnchor:"middle",fontSize:sn,fontWeight:"700",fill:Xe,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:zt},children:[t.jsx("tspan",{x:i,dy:0,children:V}),Nt&&t.jsx("tspan",{x:i,dy:mt,children:Nt}),St&&t.jsx("tspan",{x:i,dy:mt,children:St})]}),!ot&&t.jsxs("text",{x:i,y:fn,textAnchor:"middle",fontSize:on,fontWeight:"700",fill:Ke,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:zt},children:[t.jsx("tspan",{x:i,dy:0,children:ve}),At&&t.jsx("tspan",{x:i,dy:mt,children:At}),Xt&&t.jsx("tspan",{x:i,dy:mt,children:Xt})]}),!ot&&t.jsxs("text",{x:i,y:hn,textAnchor:"middle",fontSize:rn,fontWeight:"700",fill:Ze,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:zt},children:[t.jsx("tspan",{x:i,dy:0,children:ze}),De&&t.jsx("tspan",{x:i,dy:mt,children:De}),Te&&t.jsx("tspan",{x:i,dy:mt,children:Te})]}),m&&Ie!=null&&Vt&&t.jsx("g",{transform:`translate(${i-Ft/2}, ${Ie-Ft/2})`,role:"img","aria-label":`Relación registrada el ${o.isoDate||`día ${p+1}`}`,children:t.jsx(nn,{width:Ft,height:Ft,color:Ge,fill:Ge})})]},`pt-${p}-${o.isoDate||o.timestamp}`)})]})},$n=(n,s)=>{if(n.data!==s.data||n.getX!==s.getX||n.getY!==s.getY||n.isFullScreen!==s.isFullScreen||n.orientation!==s.orientation||n.responsiveFontSize!==s.responsiveFontSize||n.onPointInteraction!==s.onPointInteraction||n.clearActivePoint!==s.clearActivePoint||n.chartHeight!==s.chartHeight||n.chartWidth!==s.chartWidth||n.temperatureField!==s.temperatureField||n.textRowHeight!==s.textRowHeight||n.compact!==s.compact||n.reduceMotion!==s.reduceMotion||n.isScrolling!==s.isScrolling||n.showInterpretation!==s.showInterpretation||n.ovulationDetails!==s.ovulationDetails||n.firstHighIndex!==s.firstHighIndex||n.baselineIndices!==s.baselineIndices||n.graphBottomLift!==s.graphBottomLift||n.graphBottomY!==s.graphBottomY||n.rowsZoneHeight!==s.rowsZoneHeight||n.showRelationsRow!==s.showRelationsRow||n.autoLabelStep!==s.autoLabelStep||n.isArchivedCycle!==s.isArchivedCycle)return!1;const w=n.visibleRange,h=s.visibleRange;if(w?.startIndex!==h?.startIndex||w?.endIndex!==h?.endIndex)return!1;const P=n.padding,d=s.padding;return!(P!==d&&(!P||!d||P.left!==d.left||P.right!==d.right||P.top!==d.top||P.bottom!==d.bottom))},En=en.memo(An,$n),Dn="var(--color-sensacion-fuerte)",Tn="var(--color-apariencia-fuerte)",Wn="var(--color-observaciones-fuerte)",Pn=({padding:n,chartHeight:s,tempMin:w,tempMax:h,tempRange:P,getY:d,responsiveFontSize:H,textRowHeight:it,isFullScreen:M,reduceMotion:k=!1,graphBottomY:B,rowsZoneHeight:ht,showRelationsRow:N=!1})=>{const q={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},D=[];if(P>0){const m=P<=2.5?.1:.5;for(let tt=w;tt<=h+1e-9;tt+=m)D.push(parseFloat(tt.toFixed(1)))}else for(let m=35.8;m<=37.2+1e-9;m+=.1)D.push(parseFloat(m.toFixed(1)));const ot=B,x=M?9:7.5,I=M?1:.75,c=N?x+(M?2:1.5):null,$=x+I,j=Math.max(1,Math.floor(ht/$)),lt=Math.max(it,j),ut=g.useMemo(()=>{const m=[{label:"Fecha",row:1,color:"#374151",icon:null},{label:"Día",row:2,color:"#374151",icon:null},{label:"Símbolo",row:3,color:"#374151",icon:null},{label:"Sens.",row:M?5:4.5,color:Dn,icon:{type:"text",value:"◊"}},{label:"Apar.",row:M?7:6,color:Tn,icon:{type:"text",value:"○"}},{label:"Obs.",row:M?9:7.5,color:Wn,icon:{type:"text",value:"✦"}}];return N&&c!=null&&m.push({label:"RS",row:c,color:"#f44336",icon:{type:"heart"}}),m},[M,c,N]),pt=k?"g":Ct.g,Lt=k?{}:{variants:q};return t.jsxs("svg",{width:n.left,height:s,className:"font-sans pointer-events-none",children:[t.jsx("defs",{children:t.jsx("filter",{id:"textShadowLegend",x:"-50%",y:"-50%",width:"200%",height:"200%",children:t.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodColor:"rgba(255, 255, 255, 0.9)"})})}),D.map((m,tt)=>{const l=d(m),v=m.toFixed(1).endsWith(".0")||m.toFixed(1).endsWith(".5"),st=v?m.toFixed(1):`.${m.toFixed(1).split(".")[1]}`;return t.jsx(pt,{...Lt,children:t.jsx("text",{x:n.left-H(1.2),y:l+H(.35),textAnchor:"end",fontSize:H(v?1.15:1),fontWeight:v?"800":"700",fill:v?"#be185d":"#db2777",opacity:v?1:.85,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:st})},`temp-tick-fixed-${tt}`)}),t.jsx(pt,{...Lt,children:ut.map(({label:m,row:tt,color:l,icon:v})=>{const st=n.left-H(2.8),Y=ot+lt*tt,R=H(.95);return t.jsxs("g",{children:[v?.type==="text"&&t.jsx("text",{x:st,y:Y,textAnchor:"middle",fontSize:H(.8),fontWeight:"600",fill:l,opacity:.7,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:v.value}),v?.type==="heart"&&t.jsx("g",{transform:`translate(${st-R/2}, ${Y-R/2})`,opacity:.7,children:t.jsx(nn,{width:R,height:R,color:l,fill:l,"aria-hidden":"true"})}),t.jsx("text",{x:n.left-H(.8),y:ot+lt*tt,textAnchor:"end",fontSize:H(1.05),fontWeight:"800",fill:l,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:m})]},m)})})]})},Yn=({data:n,isFullScreen:s,orientation:w,onToggleIgnore:h,onEdit:P,onTogglePeak:d,cycleId:H,initialScrollIndex:it=0,visibleDays:M=5,showInterpretation:k=!1,reduceMotion:B=!1,forceLandscape:ht=!1,currentPeakIsoDate:N=null,showRelationsRow:q=!1,fertilityStartConfig:D=null,fertilityCalculatorCycles:ot=[],fertilityCalculatorCandidates:x=null,onShowPhaseInfo:I=null,isArchivedCycle:c=!1,cycleEndDate:$=null,exportMode:j=!1})=>{const{chartRef:lt,tooltipRef:ut,dimensions:pt,activePoint:Lt,activeIndex:m,tooltipPosition:tt,allDataPoints:l,validDataForLine:v,tempMin:st,tempMax:Y,tempRange:R,padding:C,textRowHeight:Zt,getY:$t,getX:rt,handlePointInteraction:jt,handleToggleIgnore:Re,responsiveFontSize:Jt,clearActivePoint:Gt,baselineTemp:ce,baselineStartIndex:Oe,baselineIndices:be,firstHighIndex:Ie,ovulationDetails:u,fertilityStart:U,hasAnyObservation:ct,graphBottomInset:Bt,todayIndex:Et}=yn(n,s,w,h,H,M,ht,D,ot,x,q,j),_t=B||j,Ft=g.useRef(null);if(!Ft.current){const e=Math.random().toString(36).slice(2,10);Ft.current=`fertility-chart-${H??"default"}-${e}`}const Qt=Ft.current,te=g.useCallback((e,a)=>{if(a<=(c?220:120))return a;const T=c?e>=20?2:3:e>=20?1:2,F=Math.ceil(e*T),at=Math.min(F,c?48:24);return Math.max(at,12)},[c]),Ht=g.useMemo(()=>{const e=l.length;if(!e)return{startIndex:0,endIndex:-1};const a=te(M,e),f=Math.max(0,Math.floor(it)-a),T=Math.min(e-1,Math.floor(it)+M+a);return{startIndex:f,endIndex:T}},[l.length,te,it,M]),[ee,je]=g.useState(Ht),xt=g.useRef(null),[ne,de]=g.useState(!1),Dt=g.useRef(null);if(!l||l.length===0)return t.jsxs("div",{className:"text-center p-8",children:[t.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-pink-100 to-rose-100 rounded-full mb-4",children:t.jsx("svg",{className:"w-8 h-8 text-pink-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),t.jsx("p",{className:"text-slate-400 font-medium",children:"No hay datos para mostrar en el gráfico"})]});const et=pt.width,J=pt.contentHeight??pt.height,mt=pt.scrollableContentHeight??J,wt=J-C.bottom-(Bt||0),Yt=Math.max(J-wt,0),Tt=ce!=null?$t(ce):null,Ut=!!u?.confirmed,we=ce!=null&&Ut,fe=rt(0),Me=l.length>0?rt(l.length-1):et-C.right,he=Ut?"#F59E0B":"#94A3B8",ue=Ut?"6 4":"4 4",pe=Ut?1:.7,Wt=3,zt=et===0,vt=m!=null?rt(m):null,xe=m!=null?m>0?rt(m-1):vt:null,ke=m!=null?m<l.length-1?rt(m+1):vt:null,Se=Math.max((et-C.left-C.right)/Math.max(l.length,1),0),me=m!=null?Math.max((ke!=null&&xe!=null?ke-xe:0)||Se,Se,0):0,se=g.useMemo(()=>{const e=new Map;return v.forEach(a=>{a&&a.id!=null&&e.set(a.id,a)}),e},[v]),Pt=g.useMemo(()=>Number.isInteger(U?.fertileStartFinalIndex)?U.fertileStartFinalIndex:null,[U]),p=Math.max(J-C.top-C.bottom-(Bt||0),0),o=g.useCallback(e=>!Number.isFinite(e)||!l.length||e<=0?C.left:rt(e),[l,rt,C.left]),i=g.useCallback(e=>!Number.isFinite(e)||!l.length||e>=l.length-1?et-C.right:rt(e+1),[l,et,rt,C.right]),A=g.useCallback((e,a,{inclusiveEnd:f=!0}={})=>{if(!Number.isFinite(e)||!Number.isFinite(a)||l.length===0)return null;const T=b=>Math.max(0,Math.min(l.length-1,Math.floor(b))),F=b=>Math.max(0,Math.min(l.length-1,Math.floor(b))),at=b=>Math.max(0,Math.min(l.length,Math.floor(b))),nt=T(e),W=f?F(a):at(a),Z=nt<=0?C.left:o(nt);let G;f?G=W>=l.length-1?et-C.right:i(W):W<=0?G=C.left:W>=l.length?G=et-C.right:G=o(W);const S=Math.max(G-Z,0);return S<=0?null:{x:Z,width:S}},[l,et,o,i,C.left,C.right]),y=l.length>0?l.length-1:null,O=g.useMemo(()=>{if(!c||!$||y==null)return null;const e=typeof $=="string"?$:null;if(!e)return null;const a=l.findIndex(f=>f?.isoDate===e);if(a>=0)return Math.min(a,y);for(let f=l.length-1;f>=0;f-=1){const T=l[f]?.isoDate;if(typeof T=="string"&&T<=e)return Math.min(f,y)}return null},[c,$,l,y]),X=g.useMemo(()=>y==null?null:c?Number.isInteger(O)?Math.min(O,y):y:Number.isInteger(Et)?Math.min(Et,y):y,[O,c,Et,y]),Mt=g.useMemo(()=>c?Number.isInteger(O)?O:Number.isInteger(X)?X:null:Number.isInteger(Et)?Et:null,[O,c,X,Et]),dt=p>0?C.top+p*.5:null,L=dt!=null?Math.max(wt-dt,0):0,r=g.useMemo(()=>{if(!k||!ct)return null;const e=U?.debug,a=Number.isInteger(e?.mucusInfertileStartIndex)?e.mucusInfertileStartIndex:null,f=Number.isInteger(U?.fertileWindow?.temperatureInfertileStartIndex)?U.fertileWindow.temperatureInfertileStartIndex:null,T=[a,f].filter(At=>Number.isInteger(At)).sort((At,Xt)=>At-Xt)[0],F=Number.isInteger(T)?T:Number.isInteger(e?.postOvulatoryStartIndex)?e.postOvulatoryStartIndex:null,at=Number.isInteger(a)&&Number.isInteger(f)?Math.max(a,f):null,nt=Number.isInteger(at)?at:Number.isInteger(e?.absoluteStartIndex)?e.absoluteStartIndex:null,W={confirmed:!!u?.confirmed,rule:u?.rule??null,baselineTemp:u?.baselineTemp??null,baselineIndices:Array.isArray(u?.baselineIndices)?u.baselineIndices:[],firstHighIndex:Number.isInteger(u?.firstHighIndex)?u.firstHighIndex:null,highSequenceIndices:Array.isArray(u?.highSequenceIndices)?u.highSequenceIndices:[],confirmationIndex:Number.isInteger(u?.confirmationIndex)?u.confirmationIndex:null,startIndex:f},Z={peakDayIndex:Number.isInteger(u?.peakDayIndex)?u.peakDayIndex:null,thirdDayIndex:Number.isInteger(u?.thirdDayIndex)?u.thirdDayIndex:null,startIndex:a},G=f!=null,S=a!=null;if(!G&&!S)return null;const b=Number.isInteger(F)?F:null;if(b==null)return null;let _="pending",E="",Q="Infertilidad postovulatoria",z="Fase postovulatoria: se ha cumplido un criterio de cierre; falta el segundo para confirmar la infertilidad absoluta.";const ft="Infertilidad absoluta",It="Fase postovulatoria alcanzada (se ha confirmado día pico y subida de temperatura).",gt="Confirmación completa: doble criterio (día pico + temperatura).";let V=Q,Nt=z,St=E,ve="pending";return G&&S?(_="absolute",Q=ft,z=gt,E=It,Number.isInteger(f)&&(!Number.isInteger(a)||f<=a)?(W.rule,St=`Temperatura confirmada el ${W.confirmationIndex!=null?`D${W.confirmationIndex+1}`:"—"}. A la espera de determinación del día pico.`,Nt=St,V="Infertilidad estimada por temperatura"):(St=`Alcanzado ${Z.thirdDayIndex!=null?"3° día postpico":"4º día postpico"} tras alcanzar día pico el ${Z.peakDayIndex+1} del ciclo`,Nt=St,V="Infertilidad estimada por moco")):G?(W.rule,E=`Temperatura confirmada el ${W.confirmationIndex!=null?`D${W.confirmationIndex+1}`:"—"}. A la espera de determinación del día pico.`,z=E,Q="Infertilidad estimada por temperatura",St=E,Nt=z,V=Q):(E=`Alcanzado ${Z.thirdDayIndex!=null?"3° día postpico":"4º día postpico"} tras seleccionar día pico el ${Z.peakDayIndex+1} del ciclo`,z=E,Q="Infertilidad estimada por moco",St=E,Nt=z,V=Q),{phase:"postOvulatory",status:_,startIndex:b,absoluteStartIndex:nt,estimated:{status:ve,label:V,tooltip:Nt,message:St},absolute:{label:ft,tooltip:gt,message:It},reasons:{type:"post",status:_,mucus:Z,temperature:W},message:E,label:Q,tooltip:z}},[k,ct,u,U]),yt=g.useMemo(()=>{if(!k||p<=0||dt==null||L<=0||l.length===0)return[];const e=[],a=l.length-1,f=Number.isInteger(X)&&X>=0?Math.min(X,a):a,T=(S,b)=>{if(!r)return;const _=r.startIndex,E=Number.isInteger(r.absoluteStartIndex)?r.absoluteStartIndex:null,Q=r.estimated??r,z=r.absolute??r,ft=E??_,It=r.status==="absolute"?a:Math.min(a,b);if(E!=null&&E>_){const gt=Math.min(E-1,b),V=A(_,gt);V&&S.push({key:"post-pending",phase:"postOvulatory",status:Q.status??"pending",bounds:V,startIndex:_,endIndex:gt,displayLabel:Q.label,tooltip:Q.tooltip,message:Q.message,reasons:r.reasons})}if(ft<=It){const gt=A(ft,It);gt&&S.push({key:"post-absolute",phase:"postOvulatory",status:E!=null?"absolute":r.status,bounds:gt,startIndex:ft,endIndex:It,displayLabel:E!=null?z.label:r.label,tooltip:E!=null?z.tooltip:r.tooltip,message:E!=null?z.message:r.message,reasons:r.reasons})}},F=Number.isInteger(Pt),at=Number.isFinite(r?.startIndex);if(!F&&!at){const S=Math.min(f,a);if(S<0)return e;const b=A(0,S);return b&&e.push({key:"relative-default",phase:"relativeInfertile",status:"default",bounds:b,startIndex:0,endIndex:S,displayLabel:"Relativamente infértil",tooltip:"Relativamente infértil (preovulatoria: sin día fértil por CPM/T-8 ni signos de moco fértil)",message:"Relativamente infértil",reasons:{type:"relative",fertileStartFinalIndex:null,aggregate:U?.aggregate??null,bipScore:U?.debug?.bipScore??null}}),e}if(!F&&at){const S=r.startIndex,b=Math.min(S-1,f);if(b>=0){const _=A(0,b);_&&e.push({key:"no-fertile-window",phase:"nodata",status:"no-fertile-window",bounds:_,startIndex:0,endIndex:b,displayLabel:"Sin ventana fértil identificable",tooltip:"Sin ventana fértil identificable",message:"Sin ventana fértil identificable",reasons:{type:"nofertile",status:"no-fertile-window",message:"No se ha identificado un inicio fértil claro en este ciclo (ni por moco, ni por calculadora, ni por marcador explícito)."}})}return Number.isFinite(r.startIndex)&&r.startIndex<=a&&T(e,f),e}if(F&&Pt>0){const S=Math.min(Pt-1,f);if(S>=0){const b=A(0,S);b&&e.push({key:"relative",phase:"relativeInfertile",status:"default",bounds:b,startIndex:0,endIndex:S,displayLabel:"Relativamente infértil",tooltip:"Relativamente infértil (fase relativamente infértil preovulatoria)",message:"Relativamente infértil",reasons:{type:"relative",fertileStartFinalIndex:Pt,aggregate:U?.aggregate??null,bipScore:U?.debug?.bipScore??null}})}}const nt=F?Math.max(Pt,0):0,W=r?.startIndex,Z=Number.isFinite(W)&&W!=null?Math.min(W-1,a):a,G=Math.min(Z,f);if(G>=nt){const S=A(nt,G);if(S){const b=Number.isInteger(U?.debug?.explicitStartDay)?U.debug.explicitStartDay:null,_=U?.aggregate?.usedCandidates??[],E=_.some(ft=>ft?.kind==="profile"),Q=_.some(ft=>ft?.kind==="calculator");let z=null;F&&b!=null&&b===Pt?z="marker":E?z="profiles":Q&&(z="calculator"),e.push({key:"fertile",phase:"fertile",status:"default",bounds:S,startIndex:nt,endIndex:G,displayLabel:"Fértil",tooltip:"Fértil",message:"Fértil",reasons:{type:"fertile",startIndex:nt,endIndex:G,source:z,details:U?.debug??null,notes:U?.aggregate?.notes??[],statusSummary:U?.currentAssessment??null,dailyAssessments:U?.dailyAssessments??[],window:U?.fertileWindow??null,aggregate:U?.aggregate??null}})}}return r&&Number.isFinite(r.startIndex)&&r.startIndex<=a&&T(e,f),e},[k,p,dt,L,l.length,Pt,U,r,ct,A,X]),Vt=`${Qt}-phase-relative-gradient`,oe=`${Qt}-phase-fertile-gradient`,Ce=`${Qt}-phase-post-pending-gradient`,ge=`${Qt}-phase-post-absolute-gradient`,Rt=e=>e.phase==="relativeInfertile"?"#065F46":e.phase==="fertile"?"#9D174D":e.phase==="postOvulatory"?e.status==="pending"?"#075985":"#1E3A8A":e.phase==="nodata"?"#475569":"hsl(var(--foreground))",re="0 1px 1px var(--phase-text-shadow, rgba(15, 23, 42, 0.2))",qt=g.useMemo(()=>{if(!k||!u?.confirmed)return null;const e=Array.isArray(u?.highSequenceIndices)?u.highSequenceIndices:[];if(e.length<2)return null;const a=e.map(f=>{if(f==null||f<0||f>=l.length)return null;const T=l[f],F=se.get(T?.id);return!F||!Number.isFinite(F.displayTemperature)?null:{x:rt(f),y:$t(F.displayTemperature)}}).filter(Boolean);return a.length<2?null:a.map(({x:f,y:T},F)=>`${F===0?"M":"L"} ${f} ${T}`).join(" ")},[k,u,l,se,rt,$t]),[ae,Ne]=g.useState({w:typeof window<"u"?window.innerWidth:0,h:typeof window<"u"?window.innerHeight:0}),Ae=ae.w<ae.h;g.useEffect(()=>{const e=()=>Ne({w:window.innerWidth,h:window.innerHeight});return window.addEventListener("resize",e),window.addEventListener("orientationchange",e),()=>{window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e)}},[]);const kt=g.useCallback((e=0)=>{const a=lt.current;if(!a)return;const f=l.length;if(!f){je({startIndex:0,endIndex:-1});return}const T=a.clientWidth||1,at=T/Math.max(M,1)||1,nt=te(M,f),W=Math.floor(e/at),Z=Math.floor((e+T)/at);let G=W-nt,S=Z+nt;G=Math.max(0,G),S=Math.min(f-1,S),je(b=>b.startIndex===G&&b.endIndex===S?b:{startIndex:G,endIndex:S})},[l.length,te,M]);g.useEffect(()=>{if(!lt.current)return;const e=lt.current.clientWidth/M;lt.current.scrollLeft=Math.max(0,e*it),kt(lt.current.scrollLeft)},[it,M,pt.width,w,kt]),g.useEffect(()=>{const e=lt.current;if(!e)return;const a=()=>{de(!0),Dt.current&&window.clearTimeout(Dt.current),Dt.current=window.setTimeout(()=>de(!1),140),!xt.current&&(xt.current=window.requestAnimationFrame(()=>{xt.current=null,kt(e.scrollLeft)}))};return e.addEventListener("scroll",a,{passive:!0}),kt(e.scrollLeft),()=>{e.removeEventListener("scroll",a),Dt.current&&window.clearTimeout(Dt.current),xt.current&&(window.cancelAnimationFrame(xt.current),xt.current=null)}},[kt]);const K=!j&&s&&ht&&Ae,ie=ht?"landscape":w,Ot=K,bt="w-full h-full bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100",le=s?`${bt} h-full ${Ot?"overflow-y-auto overflow-x-auto":"overflow-x-auto overflow-y-auto"}`:`${bt} overflow-x-auto overflow-y-visible border border-pink-100/50`,Le=!s||ie==="portrait",$e=j?()=>{}:jt,Ee=j?()=>{}:Gt;return t.jsx(Ct.div,{className:"relative w-full h-full",initial:!1,children:t.jsxs(Ct.div,{ref:lt,className:`relative p-0 ${s?"":"rounded-2xl"} ${le}`,style:{touchAction:"auto",boxShadow:s?"inset 0 1px 3px rgba(244, 114, 182, 0.1)":"0 8px 32px rgba(244, 114, 182, 0.12), 0 2px 8px rgba(244, 114, 182, 0.08)",...K?{position:"absolute",top:"50%",left:"50%",width:`${ae.h}px`,height:`${ae.w}px`,transform:"translate(-50%, -50%) rotate(90deg)",transformOrigin:"center center"}:{}},initial:!1,children:[zt&&t.jsx("div",{className:"flex items-center justify-center w-full h-full text-slate-400",children:"Cargando..."}),t.jsx("div",{className:"inline-block",style:{width:et,height:J},children:t.jsx("div",{className:"relative h-full overflow-y-auto",style:{height:J,maxHeight:mt},children:t.jsxs("div",{className:"relative",style:{width:et,height:mt},children:[Le&&t.jsx("div",{className:"absolute left-0 top-0 h-full bg-transparent pointer-events-none z-10",style:{width:C.left},children:t.jsx(Pn,{padding:C,chartHeight:mt,tempMin:st,tempMax:Y,tempRange:R,getY:$t,responsiveFontSize:Jt,textRowHeight:Zt,isFullScreen:s,reduceMotion:_t,graphBottomY:wt,rowsZoneHeight:Yt,showRelationsRow:q})}),t.jsxs(Ct.svg,{width:et,height:mt,className:"font-sans flex-shrink-0",viewBox:`0 0 ${et} ${mt}`,preserveAspectRatio:"xMidYMid meet",initial:!1,children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),t.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),t.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),t.jsxs("linearGradient",{id:"tempAreaGradientChart",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(244, 114, 182, 0.18)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(244, 114, 182, 0.02)"})]}),t.jsxs("linearGradient",{id:Vt,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"var(--phase-rel)",stopOpacity:"0"}),t.jsx("stop",{offset:"100%",stopColor:"var(--phase-rel)",stopOpacity:"var(--phase-rel-stop, 0.28)"})]}),t.jsxs("linearGradient",{id:oe,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"var(--phase-fertile)",stopOpacity:"0"}),t.jsx("stop",{offset:"100%",stopColor:"var(--phase-fertile)",stopOpacity:"var(--phase-fertile-stop, 0.27)"})]}),t.jsxs("linearGradient",{id:Ce,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"var(--phase-post)",stopOpacity:"0"}),t.jsx("stop",{offset:"100%",stopColor:"var(--phase-post)",stopOpacity:"var(--phase-post-stop, 0.45)"})]}),t.jsxs("linearGradient",{id:ge,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"var(--phase-post-abs)",stopOpacity:"0"}),t.jsx("stop",{offset:"100%",stopColor:"var(--phase-post-abs)",stopOpacity:"var(--phase-post-abs-stop, 0.7)"})]}),t.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[t.jsx("rect",{width:"6",height:"6",fill:"#ef4444"}),t.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(255,255,255,0.85)"})]}),t.jsxs("filter",{id:"chartShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsxs("filter",{id:"baselineGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),t.jsx("rect",{width:"100%",height:"100%",fill:"transparent"}),t.jsx(In,{padding:C,chartWidth:et,chartHeight:J,tempMin:st,tempMax:Y,tempRange:R,getY:$t,getX:rt,allDataPoints:l,visibleRange:ee,responsiveFontSize:Jt,isFullScreen:s,showLeftLabels:!Le,reduceMotion:_t,isScrolling:ne,graphBottomY:wt,chartAreaHeight:Math.max(J-C.top-C.bottom-(Bt||0),0),rowsZoneHeight:Yt}),k&&yt.length>0&&dt!=null&&L>0&&t.jsx("g",{children:yt.map(e=>{const a=dt,f=L,F=e.phase==="postOvulatory"?e.status==="pending"?`url(#${Ce})`:`url(#${ge})`:e.phase==="relativeInfertile"?`url(#${Vt})`:e.phase==="fertile"?`url(#${oe})`:e.phase==="nodata"?"rgba(203, 213, 225, 0.2)":`url(#${oe})`,at=s?14:13,nt=Math.max(Jt(1.1),at),W=e.bounds.width<120,Z=Math.max(e.bounds.width-16,0),G=Math.max(nt*.58,1),S=Math.max(1,Math.floor(Z/G)),b=e.tooltip??e.displayLabel??e.message??"";let _=e.displayLabel??e.message??"";if(W&&_.length>S){const V=Math.max(S-1,1);_=`${_.slice(0,V).trimEnd()}${_.length>V?"…":""}`}const E=W?e.bounds.x+8:e.bounds.x+e.bounds.width/2,Q=W?"start":"middle",z=a+f/2,ft=Rt(e),It=V=>{typeof V?.stopPropagation=="function"&&V.stopPropagation(),typeof I=="function"&&I({phase:e.phase,status:e.status,reasons:e.reasons,message:e.message,startIndex:e.startIndex,endIndex:e.endIndex,limitIndex:Mt,label:e.displayLabel??e.message??null})},gt=V=>{(V.key==="Enter"||V.key===" ")&&(V.preventDefault(),It(V))};return t.jsxs("g",{children:[t.jsx("rect",{x:e.bounds.x,y:a,width:e.bounds.width,height:f,fill:F,pointerEvents:"none"}),t.jsxs("text",{x:E,y:z,fill:ft,fontSize:nt,fontWeight:600,dominantBaseline:"middle",textAnchor:Q,role:"button","aria-label":b,tabIndex:0,onClick:It,onKeyDown:gt,style:{cursor:"pointer",userSelect:"none",lineHeight:1.2,textShadow:re},pointerEvents:"auto",children:[t.jsx("title",{children:b}),_]})]},e.key)})}),k&&we&&Tt!==null&&(_t?t.jsx("line",{x1:fe,y1:Tt,x2:Me,y2:Tt,stroke:he,strokeWidth:Wt,strokeDasharray:ue,opacity:pe}):t.jsx(Ct.path,{d:`M ${fe} ${Tt} L ${Me} ${Tt}`,stroke:he,strokeWidth:Wt,strokeDasharray:ue,opacity:pe,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:pe},transition:{duration:4,ease:"easeInOut",delay:.5}})),t.jsx(wn,{data:v,allDataPoints:l,getX:rt,getY:$t,baselineY:wt,temperatureField:"displayTemperature",reduceMotion:_t,connectGaps:!j}),qt&&t.jsx("g",{pointerEvents:"none",children:t.jsx("path",{d:qt,fill:"none",stroke:"#cc0e93",strokeWidth:4,strokeLinecap:"round",strokeLinejoin:"round",opacity:.9})}),m!==null&&vt!==null&&me>0&&t.jsx("g",{pointerEvents:"none",children:(()=>{const e=wt,a=Math.max(3,Math.min(14,me*.4)),f=Math.max(a*2,Zt*.85);return t.jsxs(t.Fragment,{children:[t.jsx("line",{x1:vt,y1:0,x2:vt,y2:e,stroke:"rgba(235, 171, 204,0.15)",strokeWidth:a}),t.jsx("line",{x1:vt,y1:e,x2:vt,y2:J,stroke:"rgba(235, 171, 204,0.15)",strokeWidth:f})]})})()}),t.jsx(En,{data:l,getX:rt,getY:$t,isFullScreen:s,orientation:ie,responsiveFontSize:Jt,onPointInteraction:$e,clearActivePoint:Ee,activePoint:Lt,visibleRange:ee,padding:C,chartHeight:J,chartWidth:et,temperatureField:"displayTemperature",textRowHeight:Zt,graphBottomY:wt,rowsZoneHeight:Yt,compact:!1,reduceMotion:_t,isScrolling:ne,showInterpretation:k,ovulationDetails:u,baselineStartIndex:Oe,firstHighIndex:Ie,baselineIndices:be,graphBottomLift:Bt,showRelationsRow:q,autoLabelStep:j,isArchivedCycle:c})]})]})})}),!j&&Lt&&t.jsx(Ct.div,{ref:ut,initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:10},transition:{duration:.12,ease:"easeOut"},children:t.jsx(bn,{point:Lt,position:tt,chartWidth:et,chartHeight:J,onToggleIgnore:Re,onEdit:P,onClose:Gt,onTogglePeak:d,currentPeakIsoDate:N})})]})})};export{Yn as F};
