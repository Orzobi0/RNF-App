import{c as zt,h as ss,i as ns,r as a,p as rs,d as ls,s as os,e as is,a as us,b as cs,u as ds,f as Te,g as wt,k as Ct,l as St,j as e,m as H,B as Ce,n as ms}from"./index-2f41c8cd.js";import{N as ma,L as fa,C as fs,P as ps}from"./NewCycleDialog-c52b1f5b.js";import{i as ya,C as Xt,D as xs,c as hs,g as bs,a as gs,A as pa}from"./computePeakStatuses-8ec0bab9.js";import{u as ys,D as ot,a as it,b as At,c as Bt,d as xa,e as _t}from"./useCycleData-9f76d19f.js";import{c as vs,u as Ns,C as ws}from"./useFertilityChart-b6d45542.js";import{I as Rt}from"./input-c95d25ec.js";import{L as Lt}from"./label-270ed458.js";import{e as ha,P as js}from"./badge-4c7d2230.js";import"./OverlapWarningDialog-038e0dd4.js";import"./checkbox-2e1f35be.js";import"./eye-fe5b932b.js";const ba=zt("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]),Cs=zt("CalendarPlus",[["path",{d:"M21 13V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8",key:"3spt84"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["line",{x1:"19",x2:"19",y1:"16",y2:"22",key:"1ttwzi"}],["line",{x1:"16",x2:"22",y1:"19",y2:"19",key:"1g9955"}]]),ga=zt("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),Ss=zt("FilePlus",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"12",x2:"12",y1:"18",y2:"12",key:"1tsf04"}],["line",{x1:"9",x2:"15",y1:"15",y2:"15",key:"110plj"}]]);function Ds(){!ss.current&&ns();const[y]=a.useState(rs.current);return y}const Fs="metrics",Ms="summary",Jt=async(y,r)=>{if(!y||!r||typeof r!="object")throw new Error("A valid userId and data object are required to save metrics.");const $=ls(is,`users/${y}/${Fs}`,Ms);await os($,r,{merge:!0})},jt=20;function ks({cycleCount:y,deduction:r}){return typeof r=="number"&&Number.isFinite(r)?r:(typeof y=="number"&&Number.isFinite(y)?y:0)>=12?20:21}function Is({computedCpmData:y,cpmSelection:r,isManualCpm:$,manualCpmBaseValue:O,manualCpmValue:Le,formatNumber:ne}){var fe;const X=typeof((fe=y.shortestCycle)==null?void 0:fe.duration)=="number"&&Number.isFinite(y.shortestCycle.duration)?y.shortestCycle.duration:null,Y=typeof y.value=="number"&&Number.isFinite(y.value)?y.value:null,B=$&&r==="manual",T=r==="auto",de=r==="none",F=B?O:T?X:null,me=B?Le:T?Y:null,re=ne(F,{maximumFractionDigits:0}),G=ne(me,{maximumFractionDigits:2}),Se=`Ciclo más corto: ${re??"—"}`,ze=`CPM = ${G??"—"}`;let K="Sin datos disponibles",_=!0;if(typeof me=="number"&&Number.isFinite(me)){if(B)typeof O=="number"&&Number.isFinite(O)?(K=`${ne(O,{maximumFractionDigits:0})??`${O}`} − ${jt}`,_=!1):(K="Valor definido manualmente",_=!0);else if(T&&typeof X=="number"&&Number.isFinite(X)){const le=ks({cycleCount:y.cycleCount??0,deduction:y.deduction});K=`${ne(X,{maximumFractionDigits:0})??`${X}`} − ${le}`,_=!1}}return(typeof me!="number"||!Number.isFinite(me))&&(K="Sin datos disponibles",_=!0),{title:"CPM",baseText:Se,finalText:ze,microCopy:K,microCopyMuted:_,modeLabel:de?"Sin usar":B?"Manual":"Auto",microCopyId:"cpm-metric-microcopy",baseValue:F,finalValue:me,baseFormatted:re,finalFormatted:G,isManual:B}}function Ts({computedT8Data:y,t8Selection:r,isManualT8:$,manualT8BaseValue:O,manualT8Value:Le,formatNumber:ne}){var le;const X=typeof((le=y.earliestCycle)==null?void 0:le.riseDay)=="number"&&Number.isFinite(y.earliestCycle.riseDay)?y.earliestCycle.riseDay:null,Y=typeof y.value=="number"&&Number.isFinite(y.value)?y.value:null,B=y&&typeof y.canCompute=="boolean"?y.canCompute:!0,T=$&&r==="manual",de=r==="auto"&&B,F=r==="none",me=T?O:de?X:null,re=T?Le:de?Y:null,G=ne(me,{maximumFractionDigits:0}),Se=ne(re,{maximumFractionDigits:0}),ze=`Día de subida: ${G??"—"}`,K=`T-8 = ${Se??"—"}`;let _="Sin datos disponibles",pe=!0;return typeof re=="number"&&Number.isFinite(re)&&(T?typeof O=="number"&&Number.isFinite(O)?(_=`${ne(O,{maximumFractionDigits:0})??`${O}`} − 8`,pe=!1):(_="Valor definido manualmente",pe=!0):de&&typeof X=="number"&&Number.isFinite(X)&&(_=`${ne(X,{maximumFractionDigits:0})??`${X}`} − 8`,pe=!1)),(typeof re!="number"||!Number.isFinite(re))&&(_="Sin datos disponibles",pe=!0),{title:"T-8",baseText:ze,finalText:K,microCopy:_,microCopyMuted:pe,modeLabel:F?"Sin usar":T?"Manual":"Auto",microCopyId:"t8-metric-microcopy",baseValue:me,finalValue:re,baseFormatted:G,finalFormatted:Se,isManual:T}}const Es=({cycleData:y,onEdit:r,onTogglePeak:$,currentPeakIsoDate:O,onEditStartDate:Le=()=>{},handleOpenCpmDialog:ne=()=>{},handleOpenT8Dialog:X=()=>{},cpmMetric:Y={},t8Metric:B={}})=>{var L,ce;const T=y.records||[],[de,F]=a.useState(null),[me,re]=a.useState({clientX:0,clientY:0}),[G,Se]=a.useState(!1),[ze,K]=a.useState(!1),[_,pe]=a.useState([]),fe=a.useRef(!0),le=a.useRef(null),xe=a.useRef(null),Xe=a.useRef(new Map),ut=a.useRef(null),he=Ds(),i=y.startDate?Te(y.startDate):null,v=St(new Date),oe=a.useMemo(()=>hs(T),[T]);a.useEffect(()=>{const n=Xe.current,x=new Map,f=[];T.forEach(g=>{if(!g)return;let N=g.cycleDay;if(!N&&i&&g.isoDate)try{N=Ct(Te(g.isoDate),i)+1}catch{N=null}if(!N)return;const U=JSON.stringify({temp:g.displayTemperature??g.temperature_chart??null,symbol:g.fertility_symbol??null,sensation:g.mucus_sensation??g.mucusSensation??"",appearance:g.mucus_appearance??g.mucusAppearance??"",observations:g.observations??"",relations:g.had_relations??g.hadRelations??!1,updatedAt:g.updatedAt??g.timestamp??null});if(x.set(N,U),n.size>0){const S=n.get(N);(!S||S!==U)&&f.push(N)}}),Xe.current=x,!he&&f.length&&pe(g=>{const N=new Set(g);return f.forEach(U=>N.add(U)),Array.from(N)})},[i,he,T]),a.useEffect(()=>{if(he||_.length===0)return;const n=setTimeout(()=>{pe([])},1400);return ut.current=n,()=>{ut.current&&clearTimeout(ut.current)}},[he,_]);const Q=28,Ee=140,P=Ee+15,ie=P*2,De=a.useMemo(()=>{const n=T.reduce((x,f)=>{const g=(f==null?void 0:f.cycleDay)??null;if(g)return Math.max(x,g);if(!i||!(f!=null&&f.isoDate))return x;try{const N=Te(f.isoDate),U=Ct(N,i)+1;return Number.isFinite(U)?Math.max(x,U):x}catch(N){return console.error("Error calculating record day for wheel:",N),x}},0);return Math.max(y.currentDay,n,Q)},[y.currentDay,T,i,Q]),W=Math.max(De-Q,0),M=W>0,$e=a.useMemo(()=>M?Math.max(0,Math.min(Math.max(y.currentDay-Q,0),W)):0,[y.currentDay,M,W,Q]),[E,Z]=a.useState($e);a.useEffect(()=>{fe.current||(fe.current=!0)},[$e,E]),a.useEffect(()=>{if(!M){fe.current=!0,Z(0);return}Z(n=>{const x=Math.min(n,W),f=Math.max(0,Math.min(Math.max(y.currentDay-Q,0),W)),g=y.currentDay>=x+1&&y.currentDay<=x+Q;return fe.current?g?x!==n?x:n:f:(fe.current=!0,f)})},[M,W,y.currentDay,Q]);const Oe=a.useCallback(n=>Math.max(0,Math.min(n,W)),[W]),A=a.useCallback(n=>{!M||n===0||Z(x=>Oe(x+n))},[Oe,M]),ee=a.useRef(0),R=a.useRef(0),be=a.useCallback(n=>{!M||n===0||(R.current+=n,!ee.current&&(ee.current=requestAnimationFrame(()=>{const x=Math.sign(R.current);Z(f=>Oe(f+x)),R.current=0,ee.current=0})))},[M,Oe]),z=a.useCallback(n=>{if(!M)return;n.preventDefault();const x=Math.abs(n.deltaY)>Math.abs(n.deltaX)?n.deltaY:n.deltaX;x!==0&&be(x>0?1:-1)},[A,M]),Ae=a.useCallback(n=>{var x,f;M&&(le.current=((f=(x=n.touches)==null?void 0:x[0])==null?void 0:f.clientX)??null)},[M]),te=a.useCallback(n=>{var g,N;if(!M||le.current===null)return;const x=((N=(g=n.touches)==null?void 0:g[0])==null?void 0:N.clientX)??null;if(x===null)return;const f=x-le.current;Math.abs(f)<24||(be(f<0?1:-1),le.current=x)},[A,M]),Ye=a.useCallback(()=>{le.current=null},[]),V=a.useCallback(n=>({...bs(n),...n==="spot"?{pattern:"url(#spotting-pattern-dashboard)"}:{}}),[]),Ve=a.useMemo(()=>T.reduce((n,x)=>{if(!x)return n;const f=Number(x.cycleDay);if(Number.isFinite(f)&&f>0)return n.has(f)||n.set(f,x),n;if(!i||!x.isoDate)return n;try{const g=Te(x.isoDate),N=Ct(g,i)+1;Number.isFinite(N)&&N>0&&!n.has(N)&&n.set(N,{...x,cycleDay:N})}catch(g){console.error("Error mapping record by day for wheel:",g)}return n},new Map),[T,i]),Dt={main:"#b4a9b0",light:"#c1b6bd",glow:"rgba(212, 194, 206, 0.16)",border:"#c1b6bd"},Mt=(()=>Array.from({length:Q},(n,x)=>{const f=E+x+1,g=Ve.get(f)??null,N=i?ms(i,f-1):null,U=N?wt(N,"yyyy-MM-dd"):null,S=N?ya(St(N),v):!1,ae=g?{...g,cycleDay:g.cycleDay??f}:null,ft=(x+E)/Q*2*Math.PI-Math.PI/2,pt=P+Ee*Math.cos(ft),Vt=P+Ee*Math.sin(ft);let Ie=f<=y.currentDay&&ae?V(ae.fertility_symbol):Dt;!ae&&f<y.currentDay?Ie={main:"transparent",light:"transparent",glow:"rgba(180, 169, 176, 0.1)",border:"rgba(180, 169, 176, 0.4)"}:(S||f>y.currentDay)&&(Ie={main:"transparent",light:"transparent",glow:"rgba(251, 192, 203, 0.1)",border:"rgba(252, 170, 185, 0.35)"});const xt=f===y.currentDay;xt&&(ae?Ie={...V(ae.fertility_symbol),border:"rgba(251, 113, 133, 0.8)"}:Ie={main:"transparent",light:"transparent",glow:"rgba(251, 113, 133, 0.4)",border:"rgba(251, 113, 133, 0.8)"});const ht=U&&oe[U]||null;return{x:pt,y:Vt,day:f,colors:Ie,isActive:f<=y.currentDay,isToday:xt,hasRecord:!!ae,record:ae,isoDate:U,canShowPlaceholder:!!(!ae&&U&&!S),peakStatus:ht}}))(),He=a.useMemo(()=>new Set(_),[_]),ct=E*360/Q,Ke=-ct*Math.PI/180,dt=Math.cos(Ke),We=Math.sin(Ke),Fe=a.useCallback((n,x)=>{const f=n-P,g=x-P;return{x:P+f*dt-g*We,y:P+f*We+g*dt}},[P,dt,We]),mt=2*Math.PI/Q,ue=-Math.PI/2-mt/2,Me=Ee-18,Be=Ee+10,ge=P+Me*Math.cos(ue),_e=P+Me*Math.sin(ue),ye=P+Be*Math.cos(ue),ke=P+Be*Math.sin(ue);a.useEffect(()=>{M&&F(null)},[E,M]);const qe=(n,x)=>{if(x.stopPropagation(),!xe.current){F(null);return}const f=xe.current.getBoundingClientRect();let g,N;x.touches&&x.touches[0]?(g=x.touches[0].clientX,N=x.touches[0].clientY):(g=x.clientX,N=x.clientY);const U=n.canShowPlaceholder&&n.isoDate?{id:`placeholder-${n.isoDate}`,isoDate:n.isoDate,cycleDay:n.day,fertility_symbol:null,mucus_sensation:"",mucusSensation:"",mucus_appearance:"",mucusAppearance:"",observations:"",temperature_chart:null,displayTemperature:null,ignored:!1,peakStatus:n.peakStatus,peak_marker:n.peakStatus==="P"?"peak":null}:null,S=n.record?{...n.record,cycleDay:n.record.cycleDay??n.day,peakStatus:n.peakStatus,peak_marker:n.record.peak_marker??(n.peakStatus==="P"?"peak":null)}:U;if(S&&O&&S.isoDate===O&&(S.peak_marker="peak",S.peakStatus=S.peakStatus||"P"),!S){F(null);return}re({clientX:g-f.left,clientY:N-f.top}),F(S)};return a.useEffect(()=>{if(!de)return;const n=x=>{xe.current&&!xe.current.contains(x.target)&&F(null)};return document.addEventListener("mousedown",n),document.addEventListener("touchstart",n),()=>{document.removeEventListener("mousedown",n),document.removeEventListener("touchstart",n)}},[de]),e.jsxs("div",{className:"relative flex flex-col space-y-4",children:[e.jsxs(H.div,{className:"relative overflow-hidden px-4 pt-4 pb-3 text-center flex-shrink-0",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.4},children:[e.jsx("h1",{className:"text-xl font-bold text-titulo mb-1",children:new Date().toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long"})}),e.jsxs("button",{type:"button",onClick:Le,className:"inline-flex items-center gap-1.5 rounded-full bg-white/60 px-3 py-1.5 text-sm font-semibold text-subtitulo shadow-sm transition-colors focus:outline-none focus:ring-2 focus:ring-rose-300 focus:ring-offset-2 focus:ring-offset-transparent hover:bg-white",title:"Editar fecha de inicio del ciclo",children:[e.jsx(ps,{className:"w-4 h-4"}),"Ciclo actual"]})]}),e.jsxs(H.div,{className:"px-4 flex-grow flex flex-col justify-start mt-2",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.4,delay:.1},children:[e.jsxs("div",{className:"relative overflow-hidden rounded-[75px]   p-4  mb-4",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[e.jsx("div",{className:"absolute inset-0 "}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 h-1/2 "})]}),e.jsx("div",{className:"relative text-center flex-shrink-0",children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(H.div,{ref:xe,className:"relative inline-flex items-center justify-center mb-4 drop-shadow-[0_15px_35px_rgba(221,86,101,0.22)]",style:{width:ie,height:ie},initial:{opacity:0},animate:{opacity:1},transition:{duration:.18,ease:"easeOut"},onWheel:z,onTouchStart:Ae,onTouchMove:te,onTouchEnd:Ye,children:[e.jsxs("svg",{className:"w-full h-full wheel-no-tap",viewBox:`0 0 ${ie} ${ie}`,onClick:()=>F(null),children:[e.jsxs("defs",{children:[e.jsxs("pattern",{id:"spotting-pattern-dashboard",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[e.jsx("rect",{width:"6",height:"6",fill:"#ef4444"}),e.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(255,255,255,0.85)"})]}),e.jsxs("radialGradient",{id:"ringGlow",cx:"50%",cy:"50%",r:"78%",fx:"30%",fy:"20%",children:[e.jsx("stop",{offset:"0%",stopColor:"#FFE7E8",stopOpacity:"0.98"}),e.jsx("stop",{offset:"60%",stopColor:"#FFC0C1",stopOpacity:"0.95"}),e.jsx("stop",{offset:"100%",stopColor:"#FFB5B3",stopOpacity:"0.95"})]}),e.jsxs("filter",{id:"circleDepthShadow",children:[e.jsx("feDropShadow",{dx:"0",dy:"10",stdDeviation:"10",floodColor:"rgba(221,86,101,0.22)",floodOpacity:"1"}),e.jsx("feDropShadow",{dx:"0",dy:"4",stdDeviation:"4",floodColor:"rgba(221,86,101,0.18)",floodOpacity:"1"})]}),e.jsx("filter",{id:"dotShadow",x:"-30%",y:"-30%",width:"160%",height:"160%",colorInterpolationFilters:"sRGB",children:e.jsx("feDropShadow",{dx:"0",dy:"0.8",stdDeviation:"0.8",floodColor:"#000",floodOpacity:"0.22"})}),e.jsx("filter",{id:"whiteSymbolShadow",children:e.jsx("feDropShadow",{dx:"0",dy:"0.5",stdDeviation:"0.8",floodColor:"rgba(189,16,44,0.3)"})}),e.jsx("filter",{id:"activePointHighlight",children:e.jsx("feDropShadow",{dx:"0",dy:"-1",stdDeviation:"0.5",floodColor:"rgba(255,255,255,0.7)",floodOpacity:"1"})}),e.jsxs("filter",{id:"bevel",children:[e.jsx("feFlood",{floodColor:"rgba(255,255,255,0.4)",result:"top"}),e.jsx("feFlood",{floodColor:"rgba(0,0,0,0.2)",result:"bottom"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"top"}),e.jsx("feMergeNode",{in:"bottom"}),e.jsx("feMergeNode",{})]})]})]}),e.jsx("circle",{cx:P,cy:P,r:Ee-28,fill:"url(#ringGlow)",stroke:"rgba(255,225,228,0.8)",strokeWidth:1.2,filter:"url(#circleDepthShadow)"}),M&&e.jsx("line",{x1:ge,y1:_e,x2:ye,y2:ke,stroke:"rgba(244,63,94,0.55)",strokeWidth:5,strokeLinecap:"round",opacity:.8}),e.jsx(H.g,{transition:{type:"tween",duration:.18,ease:[.2,.8,.2,1]},initial:!1,animate:fe.current?{rotate:-ct}:!1,style:{transformOrigin:"center",transformBox:"view-box",willChange:"transform"},children:Mt.map((n,x)=>e.jsxs("g",{children:[e.jsx("g",{filter:n.isActive?"url(#activePointHighlight)":n.isToday?"url(#bevel)":void 0,children:e.jsx(H.circle,{cx:n.x,cy:n.y,r:n.isToday?12:11,fill:n.colors.pattern||(n.isActive?n.colors.main:"rgba(255,255,255,0.001)"),stroke:n.colors.border&&n.colors.border!=="none"?n.colors.border:"rgba(255,255,255,0.3)",strokeWidth:n.colors.border&&n.colors.border!=="none"?n.isToday?2.2:1.2:0,filter:n.fertilitysymbol==="white"?"url(#whiteSymbolShadow)":n.isActive?"url(#dotShadow)":void 0,strokeLinecap:"round",onClick:f=>qe(n,f),initial:!1,animate:{scale:1,opacity:1,y:0},transition:{duration:.5,ease:"easeOut"},whileTap:he||!fe.current?void 0:{y:2,scale:.75,opacity:.95,transition:{duration:.08,ease:"easeOut"}},style:{cursor:"pointer"}})}),!he&&He.has(n.day)&&e.jsxs(H.g,{pointerEvents:"none",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{transformOrigin:`${n.x}px ${n.y}px`},children:[e.jsx(H.circle,{cx:n.x,cy:n.y-12,r:4,fill:n.colors.main,initial:{y:-18,scale:.5,opacity:0},animate:{y:[-18,0,2],scale:[.5,1.05,.8],opacity:[0,1,0]},transition:{duration:.6,ease:"easeOut",times:[0,.6,1]}}),e.jsx(H.circle,{cx:n.x,cy:n.y,r:n.isToday?12:10,stroke:n.colors.border==="none"?n.colors.main:n.colors.border||n.colors.main,strokeWidth:2,fill:"none",initial:{scale:.5,opacity:.9},animate:{scale:1.4,opacity:0},transition:{duration:.55,ease:[.16,1,.3,1],delay:.05}}),e.jsx(H.circle,{cx:n.x,cy:n.y,r:n.isToday?14:12,stroke:n.colors.border==="none"?n.colors.main:n.colors.border||n.colors.main,strokeWidth:1.5,fill:"none",initial:{scale:.6,opacity:.6},animate:{scale:1.9,opacity:0},transition:{duration:.9,ease:"easeOut",delay:.1}})]},`dot-splash-${n.day}`),n.isToday&&e.jsx("circle",{cx:n.x,cy:n.y,r:8.5,fill:"none",stroke:"rgba(244,63,94,0.8)",strokeWidth:3,className:"animate-pulse",style:{pointerEvents:"none"}})]},x))}),Mt.map((n,x)=>{if(!n.peakStatus)return null;const{x:f,y:g}=Fe(n.x,n.y);return n.peakStatus==="P"?e.jsx("text",{x:f,y:g+4,textAnchor:"middle",fontSize:"14",fontWeight:"900",fill:"#ec4899",style:{pointerEvents:"none"},children:"✖"}):e.jsx("text",{x:f,y:g+4,textAnchor:"middle",fontSize:"12",fontWeight:"800",fill:"#7f1d1d",style:{pointerEvents:"none"},children:n.peakStatus})})]}),de&&e.jsx("div",{onClick:n=>n.stopPropagation(),children:e.jsx(ws,{point:de,position:me,chartWidth:((L=xe.current)==null?void 0:L.clientWidth)||0,chartHeight:((ce=xe.current)==null?void 0:ce.clientHeight)||0,onEdit:r,onClose:()=>F(null),onTogglePeak:$,currentPeakIsoDate:O})}),e.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none",children:e.jsxs(H.div,{className:"flex flex-col items-center gap-2",initial:{opacity:0},animate:{opacity:1},transition:{duration:.2,delay:.2,ease:"easeOut"},children:[e.jsx("div",{className:"flex items-center justify-center ",children:e.jsx("p",{className:"text-6xl font-semibold text-fertiliapp-fuerte leading-none",children:y.currentDay})}),e.jsx("p",{className:"mt-1 text-[15px] font-medium uppercase tracking-wide text-fertiliapp-fuerte",children:"DÍA DEL CICLO"})]})})]}),M&&e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("button",{type:"button",className:"p-2 rounded-full text-fertiliapp-fuerte shadow-xs transition hover:border hover:bg-fertiliapp-fuerte/20",onClick:()=>A(-1),disabled:E===0,children:e.jsx(gs,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-medium text-fertiliapp-fuerte",children:["Día ",E+1]}),e.jsx("span",{className:"text-xs text-fertiliapp-fuerte",children:"•"}),e.jsxs("span",{className:"text-xs font-medium text-fertiliapp-fuerte",children:["Día ",Math.min(E+Q,De)]})]}),e.jsx("input",{type:"range",min:0,max:W,value:E,onChange:n=>Z(Oe(Number(n.target.value))),className:"w-40 range-fertiliapp"})]}),e.jsx("button",{type:"button",className:"p-2 rounded-full text-fertiliapp-fuerte shadow-xs transition hover:border hover:bg-fertiliapp-fuerte/20",onClick:()=>be(1),disabled:E===W,children:e.jsx(Xt,{className:"w-4 h-4"})})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mx-2 mb-6 mt-2 flex-shrink-0 items-start",children:[e.jsxs(H.div,{className:`relative overflow-hidden rounded-3xl bg-white/60 border border-secundario-suave shadow-[0_14px_35px_rgba(148,163,184,0.18)] backdrop-blur-md p-1 transition-[width] duration-300 ease-in-out mx-auto ${G?"w-full":"w-[80%]"}`,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.4,delay:.5},children:[e.jsxs("button",{type:"button",onClick:()=>Se(n=>!n),className:"group flex w-full items-center justify-between gap-3 rounded-2xl px-3 py-2 text-left transition",children:[e.jsx("span",{className:"text-sm font-semibold text-slate-700 tracking-tight uppercase",children:"SÍMBOLOS"}),e.jsx("div",{className:"absolute top-4.5 right-4 w-1.5 h-1.5 bg-secundario rounded-full"})]}),e.jsx(pa,{initial:!1,children:G&&e.jsx(H.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.25,ease:"easeInOut"},className:"grid grid-cols-2 gap-2.5 rounded-3xl bg-white/40 p-2 overflow-hidden",children:[{label:"Menstrual",color:"#fb7185"},{label:"Moco (Fértil)",color:"#fcebf1",stroke:"#ffcfd6"},{label:"Seco",color:"#22c55e"},{label:"Moco (No fértil)",color:"#f1c232",stroke:"#fef08a"},{label:"Spotting",color:"#ef4444",stroke:"#fee2e2",pattern:!0},{label:"Hoy",isToday:!0}].map(n=>e.jsxs("div",{className:"flex flex-col items-center gap-1.5",children:[n.isToday?e.jsxs("div",{className:"relative flex items-center justify-center",children:[e.jsx("div",{className:"w-5 h-5 rounded-full border border-rose-400/80 bg-transparent"}),e.jsx("div",{className:"absolute inset-0 -m-1 rounded-full border-[3px] border-rose-500/80 animate-pulse"})]}):e.jsx("div",{className:`w-5 h-5 rounded-full border ${n.pattern?"pattern-bg":""}`,style:{backgroundColor:n.color,borderColor:n.stroke||"transparent"}}),e.jsx("span",{className:`text-xs font-medium text-center leading-none ${n.isToday?"text-gray-700 font-semibold":"text-gray-700"}`,children:n.label})]},n.label))},"symbols")})]}),e.jsxs(H.div,{className:`relative overflow-hidden rounded-3xl bg-white/60 border border-secundario-suave shadow-[0_14px_35px_rgba(148,163,184,0.18)] backdrop-blur-md p-1 transition-[width] duration-300 ease-in-out mx-auto ${ze?"w-full":"w-[80%]"}`,initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.4,delay:.6},children:[e.jsxs("button",{type:"button",onClick:()=>K(n=>!n),className:"group flex w-full items-center justify-between gap-3 rounded-2xl px-3 py-2 text-left transition",children:[e.jsx("span",{className:"text-sm font-semibold text-slate-800 tracking-tight uppercase",children:"CÁLCULO"}),e.jsx("div",{className:"absolute top-4.5 right-4 w-1.5 h-1.5 bg-secundario rounded-full"})]}),e.jsx(pa,{initial:!1,children:ze&&e.jsxs(H.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.25,ease:"easeInOut"},className:"grid grid-cols-2 gap-2.5 rounded-3xl bg-white/40 p-2 overflow-hidden",children:[e.jsxs("button",{type:"button",onClick:ne,className:"flex flex-col items-center gap-1.5","aria-label":"Editar CPM (Ciclo más corto)",children:[e.jsx("span",{className:"flex items-center justify-center text-[10px] font-medium text-gray-700 leading-tight text-center h-8",children:"Ciclo más corto"}),e.jsx("div",{className:"h-10 flex items-end",children:e.jsx("div",{className:"flex items-center justify-center rounded-full border border-rose-200/70 bg-white/70 shadow-sm w-10 h-10 text-base font-bold text-rose-700",children:(Y==null?void 0:Y.baseFormatted)??"—"})})]}),e.jsxs("button",{type:"button",onClick:ne,className:"flex flex-col items-center gap-1.5","aria-label":"Editar CPM (resultado)",children:[e.jsx("span",{className:"flex items-center justify-center text-[10px] font-medium text-gray-700 leading-tight text-center h-8",children:"CPM"}),e.jsx("div",{className:"h-10 flex items-end",children:e.jsx("div",{className:"flex items-center justify-center rounded-full border border-rose-200/70 bg-white/80 shadow-sm w-10 h-10 text-sm font-semibold text-rose-700",children:(Y==null?void 0:Y.finalFormatted)??"—"})}),e.jsx("span",{className:"text-[9px] font-semibold text-rose-600 mt-0.5",children:(Y==null?void 0:Y.modeLabel)??"Auto"})]}),e.jsxs("button",{type:"button",onClick:X,className:"flex flex-col items-center gap-1.5","aria-label":"Editar T-8 (Día de subida)",children:[e.jsx("span",{className:"flex items-center justify-center text-[10px] font-medium text-gray-700 leading-tight text-center h-8",children:"Día de subida"}),e.jsx("div",{className:"h-10 flex items-end",children:e.jsx("div",{className:"flex items-center justify-center rounded-full border border-rose-200/70 bg-white/70 shadow-sm w-10 h-10 text-base font-bold text-rose-700",children:(B==null?void 0:B.baseFormatted)??"—"})})]}),e.jsxs("button",{type:"button",onClick:X,className:"flex flex-col items-center gap-1.5","aria-label":"Editar T-8 (resultado)",children:[e.jsx("span",{className:"flex items-center justify-center text-[10px] font-medium text-gray-700 leading-tight text-center h-8",children:"T-8"}),e.jsx("div",{className:"h-10 flex items-end",children:e.jsx("div",{className:"flex items-center justify-center rounded-full border border-rose-200/70 bg-white/80 shadow-sm w-10 h-10 text-sm font-semibold text-rose-700",children:(B==null?void 0:B.finalFormatted)??"—"})}),e.jsx("span",{className:"text-[9px] font-semibold text-rose-600 mt-0.5",children:(B==null?void 0:B.modeLabel)??"Auto"})]})]},"calc-card")})]})]})]})]})},Ps=({onAddRecord:y,onAddCycle:r})=>{const[$,O]=a.useState(!1);return e.jsxs("div",{className:"fixed right-4 top-12 md:top-6 flex flex-col-reverse items-end space-y-2 z-50",children:[$&&e.jsxs("div",{className:"flex flex-col space-y-2 mt-1",children:[e.jsxs(H.button,{onClick:y,className:"flex items-center gap-1 px-4 h-10 rounded-full bg-fertiliapp-fuerte hover:brightness-50 text-white/90 shadow-sm shadow-[#DD5665]",whileTap:{scale:.8},whileHover:{scale:1.05},initial:{opacity:0,y:20,scale:.8},animate:{opacity:1,y:0,scale:1},style:{filter:"drop-shadow(0 6px 12px rgba(244, 114, 182, 0.28))"},children:[e.jsx(Ss,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm font-medium tracking-tight",children:"Añadir registro"})]}),e.jsxs(H.button,{onClick:r,className:"flex items-center gap-3 px-4 h-10 rounded-full bg-white/80 hover:brightness-50 text-fertiliapp-fuerte shadow-sm shadow-[#DD5665]",whileTap:{scale:.95},whileHover:{scale:1.05},initial:{opacity:0,y:20,scale:.8},animate:{opacity:1,y:0,scale:1},style:{filter:"drop-shadow(0 6px 12px rgba(244, 114, 182, 0.2))"},children:[e.jsx(Cs,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm font-medium tracking-tight",children:"Nuevo ciclo"})]})]}),e.jsx(H.button,{onClick:()=>O(!$),className:"flex items-center justify-center rounded-full bg-white/80 border border-fertiliapp-fuerte text-fertiliapp-fuerte hover:brightness-95 shadow-sm shadow-[#5BA9B8] w-12 h-12 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-300 focus-visible:ring-offset-2",whileTap:{scale:.95},whileHover:{scale:1.05},initial:{scale:0},animate:{scale:1},style:{filter:"drop-shadow(0 4px 12px rgba(221, 86, 101, 0.35))"},children:e.jsx(H.span,{animate:{rotate:$?135:0},transition:{type:"spring",stiffness:260,damping:20},children:e.jsx(js,{className:"h-5 w-5"})})})]})},Ws=()=>{const y=us(),{currentCycle:r,archivedCycles:$,addOrUpdateDataPoint:O,startNewCycle:Le,isLoading:ne,updateCycleDates:X,checkCycleOverlap:Y,forceUpdateCycleStart:B,refreshData:T,setCycleIgnoreForAutoCalculations:de}=ys(),{toast:F}=cs(),[me,re]=a.useState(!1),[G,Se]=a.useState(()=>(r==null?void 0:r.startDate)||""),[ze,K]=a.useState(""),[_,pe]=a.useState(null),[fe,le]=a.useState(null),[xe,Xe]=a.useState(!1),[ut,he]=a.useState(!1),{user:i,preferences:v,savePreferences:oe}=ds(),[Q,Ee]=a.useState(!1),[Pe,P]=a.useState(""),[ie,De]=a.useState(""),[W,M]=a.useState(""),[$e,E]=a.useState(""),[Z,Oe]=a.useState(null),[A,ee]=a.useState(null),[R,be]=a.useState(null),[z,Ae]=a.useState(!1),[te,Ye]=a.useState("auto"),[V,Ve]=a.useState("auto"),[Dt,Ft]=a.useState(!1),[Mt,He]=a.useState(!1),[ct,Ke]=a.useState(!1),[dt,We]=a.useState(!1),[Fe,mt]=a.useState(""),[ue,Me]=a.useState(""),[Be,ge]=a.useState(""),[_e,ye]=a.useState(""),[ke,qe]=a.useState(null),[L,ce]=a.useState(null),[n,x]=a.useState(null),[f,g]=a.useState(!1),[N,U]=a.useState("auto"),[S,ae]=a.useState("auto"),[ft,pt]=a.useState(!1),[Vt,Ie]=a.useState(!1),[xt,ht]=a.useState(!1),[Yt,Kt]=a.useState([]),Ge=a.useRef(!1),Qe=a.useRef(!1),Ut=a.useRef(null),qt=a.useRef(!1),Gt=a.useRef(!1),ve=a.useMemo(()=>i!=null&&i.uid?`rnf_manual_cpm_${i.uid}`:null,[i==null?void 0:i.uid]),Ne=a.useMemo(()=>i!=null&&i.uid?`rnf_manual_cpm_base_${i.uid}`:null,[i==null?void 0:i.uid]),we=a.useMemo(()=>i!=null&&i.uid?`rnf_manual_t8_${i.uid}`:null,[i==null?void 0:i.uid]),je=a.useMemo(()=>i!=null&&i.uid?`rnf_manual_t8_base_${i.uid}`:null,[i==null?void 0:i.uid]),bt=a.useCallback(async t=>{if(!(!(i!=null&&i.uid)||!oe)&&["auto","manual","none"].includes(t))try{await oe({cpmMode:t})}catch(s){console.error("Failed to persist CPM mode",s)}},[oe,i==null?void 0:i.uid]),gt=a.useCallback(async t=>{if(!(!(i!=null&&i.uid)||!oe)&&["auto","manual","none"].includes(t))try{await oe({t8Mode:t})}catch(s){console.error("Failed to persist T-8 mode",s)}},[oe,i==null?void 0:i.uid]);a.useEffect(()=>{Ge.current=!1},[ve]),a.useEffect(()=>{Qe.current=!1},[we]),a.useEffect(()=>{if(!Ne){ee(null);return}const t=v==null?void 0:v.manualCpmBase;if(t!==void 0){if(typeof t=="number"&&Number.isFinite(t)){if(ee(t),typeof window<"u")try{localStorage.setItem(Ne,JSON.stringify({value:t}))}catch(s){console.error("Failed to sync manual CPM base value to local storage",s)}}else if(ee(null),typeof window<"u")try{localStorage.removeItem(Ne)}catch(s){console.error("Failed to clear manual CPM base value from local storage",s)}return}if(!(typeof window>"u"))try{const s=localStorage.getItem(Ne);if(s){const l=JSON.parse(s);l&&typeof l.value=="number"&&Number.isFinite(l.value)?ee(l.value):ee(null)}else ee(null)}catch(s){console.error("Failed to restore manual CPM base value from local storage",s)}},[Ne,v==null?void 0:v.manualCpmBase]),a.useEffect(()=>{if(!je){ce(null);return}const t=v==null?void 0:v.manualT8Base;if(t!==void 0){if(typeof t=="number"&&Number.isFinite(t)){if(ce(t),typeof window<"u")try{localStorage.setItem(je,JSON.stringify({value:t}))}catch(s){console.error("Failed to sync manual T-8 base value to local storage",s)}}else if(ce(null),typeof window<"u")try{localStorage.removeItem(je)}catch(s){console.error("Failed to clear manual T-8 base value from local storage",s)}return}if(!(typeof window>"u"))try{const s=localStorage.getItem(je);if(s){const l=JSON.parse(s);l&&typeof l.value=="number"&&Number.isFinite(l.value)?ce(l.value):ce(null)}else ce(null)}catch(s){console.error("Failed to restore manual T-8 base value from local storage",s)}},[je,v==null?void 0:v.manualT8Base]);const Ze=a.useCallback(async({finalValue:t,baseValue:s})=>{if(!(i!=null&&i.uid)||!oe)return;const l=t==null?null:Number(t),o=s===void 0?void 0:s==null?null:Number(s),u={manualCpm:l};o!==void 0&&(u.manualCpmBase=o);try{await oe(u),ve&&typeof window<"u"&&(u.manualCpm===null?localStorage.removeItem(ve):localStorage.setItem(ve,JSON.stringify({value:u.manualCpm}))),o!==void 0&&Ne&&typeof window<"u"&&(o===null?localStorage.removeItem(Ne):localStorage.setItem(Ne,JSON.stringify({value:o}))),await Jt(i.uid,{manual:{cpm:{value:l,base:o===void 0?A:o}},manualUpdatedAt:new Date().toISOString()})}catch(c){throw console.error("Failed to persist manual CPM value in profile",c),c}},[Ne,A,ve,oe,i==null?void 0:i.uid]),et=a.useCallback(async({finalValue:t,baseValue:s})=>{if(!(i!=null&&i.uid)||!oe)return;const l=t==null?null:Number(t),o=s===void 0?void 0:s==null?null:Number(s),u={manualT8:l};o!==void 0&&(u.manualT8Base=o);try{await oe(u),we&&typeof window<"u"&&(u.manualT8===null?localStorage.removeItem(we):localStorage.setItem(we,JSON.stringify({value:u.manualT8}))),o!==void 0&&je&&typeof window<"u"&&(o===null?localStorage.removeItem(je):localStorage.setItem(je,JSON.stringify({value:o}))),await Jt(i.uid,{manual:{t8:{value:l,riseDay:o===void 0?L:o}},manualUpdatedAt:new Date().toISOString()})}catch(c){throw console.error("Failed to persist manual T-8 value in profile",c),c}},[je,L,we,oe,i==null?void 0:i.uid]);a.useEffect(()=>{if(!ve){be(null),Ae(!1),Ge.current=!1;return}const t=v==null?void 0:v.manualCpm;if(typeof t=="number"&&Number.isFinite(t)){if(be(t),Ae(!0),typeof window<"u")try{localStorage.setItem(ve,JSON.stringify({value:t}))}catch(s){console.error("Failed to sync manual CPM value to local storage",s)}return}if(t===null&&(be(null),Ae(!1),typeof window<"u"))try{localStorage.removeItem(ve)}catch(s){console.error("Failed to clear manual CPM value from local storage",s)}},[ve,v==null?void 0:v.manualCpm]),a.useEffect(()=>{if(!we){x(null),g(!1),Qe.current=!1;return}const t=v==null?void 0:v.manualT8;if(typeof t=="number"&&Number.isFinite(t)){if(x(t),g(!0),typeof window<"u")try{localStorage.setItem(we,JSON.stringify({value:t}))}catch(s){console.error("Failed to sync manual T-8 value to local storage",s)}return}if(t===null&&(x(null),g(!1),typeof window<"u"))try{localStorage.removeItem(we)}catch(s){console.error("Failed to clear manual T-8 value from local storage",s)}},[we,v==null?void 0:v.manualT8]),a.useEffect(()=>{if(!ve||Ge.current||!(i!=null&&i.uid))return;if((v==null?void 0:v.manualCpm)!==void 0){Ge.current=!0;return}if(typeof window>"u"){Ge.current=!0;return}try{const s=localStorage.getItem(ve);if(s){const l=JSON.parse(s);if(l&&typeof l.value=="number"&&Number.isFinite(l.value)){be(l.value),Ae(!0);let o=A;try{if(Ne){const u=localStorage.getItem(Ne);if(u){const c=JSON.parse(u);c&&typeof c.value=="number"&&Number.isFinite(c.value)?o=c.value:o=null}}}catch(u){console.error("Failed to read manual CPM base value from local storage",u)}ee(typeof o=="number"&&Number.isFinite(o)?o:null),Ze({finalValue:l.value,baseValue:o}).catch(u=>console.error("Failed to migrate manual CPM value to profile storage",u))}}}catch(s){console.error("Failed to restore manual CPM value from local storage",s)}finally{Ge.current=!0}},[Ne,A,ve,Ze,v==null?void 0:v.manualCpm,i==null?void 0:i.uid]),a.useEffect(()=>{if(!we||Qe.current||!(i!=null&&i.uid))return;if((v==null?void 0:v.manualT8)!==void 0){Qe.current=!0;return}if(typeof window>"u"){Qe.current=!0;return}try{const s=localStorage.getItem(we);if(s){const l=JSON.parse(s);if(l&&typeof l.value=="number"&&Number.isFinite(l.value)){x(l.value),g(!0);let o=L;try{if(je){const u=localStorage.getItem(je);if(u){const c=JSON.parse(u);c&&typeof c.value=="number"&&Number.isFinite(c.value)?o=c.value:o=null}}}catch(u){console.error("Failed to read manual T-8 base value from local storage",u)}ce(typeof o=="number"&&Number.isFinite(o)?o:null),et({finalValue:l.value,baseValue:o}).catch(u=>console.error("Failed to migrate manual T-8 value to profile storage",u))}}}catch(s){console.error("Failed to restore manual T-8 value from local storage",s)}finally{Qe.current=!0}},[je,L,we,et,v==null?void 0:v.manualT8,i==null?void 0:i.uid]),a.useEffect(()=>{Se((r==null?void 0:r.startDate)||"")},[r==null?void 0:r.startDate]);const Ht=a.useCallback(t=>{if(!(t!=null&&t.startDate))return null;try{const s=Te(t.startDate);if(Number.isNaN(s.getTime()))return null;const l=wt(s,"dd/MM/yyyy",{locale:ha});if(!t.endDate)return`${l} - En curso`;const o=Te(t.endDate);if(Number.isNaN(o.getTime()))return l;const u=wt(o,"dd/MM/yyyy",{locale:ha});return`${l} - ${u}`}catch{return null}},[]),kt=a.useMemo(()=>{const t=[];if(Array.isArray($)&&$.length>0&&$.forEach((s,l)=>{const o=Ht(s);t.push({...s,displayName:s.name||o||`Ciclo archivado ${l+1}`,dateRangeLabel:o,source:"archived",ignoredForAutoCalculations:!!s.ignoredForAutoCalculations})}),r!=null&&r.id){const s=Ht(r);t.push({...r,displayName:r.name||s||"Ciclo actual",dateRangeLabel:s,source:"current",ignoredForAutoCalculations:!!r.ignoredForAutoCalculations})}return t},[$,r,Ht]),b=a.useMemo(()=>{const l=[...kt.map(m=>{if(!m.startDate||!m.endDate)return null;try{const C=Te(m.startDate),I=Te(m.endDate);if(Number.isNaN(C.getTime())||Number.isNaN(I.getTime())||ya(C,I))return null;const p=Ct(St(I),St(C))+1;return!Number.isFinite(p)||p<=0?null:{...m,duration:p,ignoredForAutoCalculations:!!m.ignoredForAutoCalculations}}catch(C){return console.error("Failed to compute cycle duration for CPM calculation",C),null}}).filter(Boolean)].sort((m,C)=>{const I=typeof m.duration=="number"&&Number.isFinite(m.duration)?m.duration:Number.POSITIVE_INFINITY,p=typeof C.duration=="number"&&Number.isFinite(C.duration)?C.duration:Number.POSITIVE_INFINITY;return I-p}).map(m=>{const C=!!m.ignoredForAutoCalculations;return{...m,isIgnored:C,isIncluded:!C}}),o=l.filter(m=>m.isIncluded),u=l.length-o.length,c=o.length;if(c<6)return{value:null,cycleCount:c,shortestCycle:null,deduction:null,canCompute:!1,cyclesConsidered:l,ignoredCount:u};const d=o[0]??null,j=c>=12?20:21,w=typeof(d==null?void 0:d.duration)=="number"&&Number.isFinite(d.duration)?d.duration-j:null;return{value:w,cycleCount:c,shortestCycle:d,deduction:j,canCompute:w!==null,cyclesConsidered:l,ignoredCount:u}},[kt]),h=a.useMemo(()=>{const t=p=>{if(p==null||p==="")return null;const k=Number.parseFloat(String(p).replace(",","."));return Number.isFinite(k)?k:null},s=p=>{if(!p)return null;const k=t(p.temperature),D=t(p.temperature_corrected);return p.use_corrected&&D!==null?D:k!==null?k:D!==null?D:null},l=p=>{const k=[p==null?void 0:p.temperature_chart,p==null?void 0:p.temperature_raw,p==null?void 0:p.temperature_corrected];for(const D of k){const q=t(D);if(q!==null)return q}if(Array.isArray(p==null?void 0:p.measurements)){const q=p.measurements.find(se=>se&&se.selected&&s(se)!==null)||p.measurements.find(se=>s(se)!==null);if(q){const se=s(q);if(se!==null)return se}}return null},o=p=>{if(!p)return null;try{const k=Te(p);return Number.isNaN(k.getTime())?null:k}catch{return null}},u=kt.filter(p=>p&&p.startDate&&Array.isArray(p.data)&&p.data.length>0).sort((p,k)=>{const D=o(p.startDate),q=o(k.startDate);return!D&&!q?0:D?q?q-D:-1:1}),c=[],d=[];for(const p of u){const k=p.data.filter(Nt=>Nt&&Nt.isoDate).map(Nt=>({...Nt,displayTemperature:l(Nt)}));if(k.length===0)continue;const{ovulationDetails:D}=vs(k);if(!(D!=null&&D.confirmed))continue;const q=Number.isInteger(D==null?void 0:D.ovulationIndex)?D.ovulationIndex:Number.isInteger(D==null?void 0:D.confirmationIndex)?D.confirmationIndex:null;if(q==null||q<0||q>=k.length)continue;const se=k[q],$t=Number(se==null?void 0:se.cycleDay);if(!Number.isFinite($t)||$t<=0)continue;const as=Math.max(1,$t-8),Ot=!!p.ignoredForAutoCalculations,da={cycleId:p.id,riseDay:$t,t8Day:as,displayName:p.displayName||p.name||"Ciclo sin nombre",dateRangeLabel:p.dateRangeLabel,isIgnored:Ot,isIncluded:!Ot,ignoredForAutoCalculations:Ot};c.push(da),!Ot&&d.length<12&&d.push(da)}const j=d.length,w=c.reduce((p,k)=>p+(k.isIgnored?1:0),0);if(j===0)return{value:null,cycleCount:j,earliestCycle:null,cyclesConsidered:c,canCompute:!1,rawValue:null,ignoredCount:w};const m=d.reduce((p,k)=>k.t8Day<p.t8Day?k:p),C=m.t8Day,I=j>=6;return{value:I?C:null,cycleCount:j,earliestCycle:m,cyclesConsidered:c,canCompute:I,rawValue:C,ignoredCount:w}},[kt]);a.useEffect(()=>{if(qt.current||!v)return;let t=v==null?void 0:v.cpmMode;["auto","manual","none"].includes(t)||(t=z?"manual":b.canCompute?"auto":"none"),Ye(t),Ve(t),qt.current=!0},[b.canCompute,z,v]),a.useEffect(()=>{if(Gt.current||!v)return;let t=v==null?void 0:v.t8Mode;["auto","manual","none"].includes(t)||(t=f?"manual":h.canCompute?"auto":"none"),U(t),ae(t),Gt.current=!0},[h.canCompute,f,v]),a.useEffect(()=>{var c;if(!(i!=null&&i.uid)){Ut.current=null;return}const t=d=>typeof d=="number"&&Number.isFinite(d)?d:null,s=d=>d?{id:d.id??null,name:d.name??null,displayName:d.displayName??null,startDate:d.startDate??null,endDate:d.endDate??null,duration:t(d.duration),source:d.source??null,dateRangeLabel:d.dateRangeLabel??null}:null,l=d=>d?{id:d.id??null,name:d.name??null,displayName:d.displayName??null,startDate:d.startDate??null,endDate:d.endDate??null,riseDay:t(d.riseDay),t8Day:t(d.t8Day),source:d.source??null,dateRangeLabel:d.dateRangeLabel??null}:null,o={automatic:{cpm:{value:t(b==null?void 0:b.value),cycleCount:t(b==null?void 0:b.cycleCount)??0,ignoredCount:t(b==null?void 0:b.ignoredCount)??0,deduction:t(b==null?void 0:b.deduction),canCompute:!!(b!=null&&b.canCompute),shortestCycle:s(b==null?void 0:b.shortestCycle)},t8:{value:t(h==null?void 0:h.value),cycleCount:t(h==null?void 0:h.cycleCount)??0,ignoredCount:t(h==null?void 0:h.ignoredCount)??0,canCompute:!!(h!=null&&h.canCompute),riseDay:t((c=h==null?void 0:h.earliestCycle)==null?void 0:c.riseDay),earliestCycle:l(h==null?void 0:h.earliestCycle)}}},u=JSON.stringify(o);Ut.current!==u&&(Ut.current=u,Jt(i.uid,{...o,automaticUpdatedAt:new Date().toISOString()}).catch(d=>{console.error("Failed to persist automatic metrics snapshot",d)}))},[b,h,i==null?void 0:i.uid]);const J=a.useMemo(()=>{const t=b.cycleCount??0,s=`${t} ciclo${t===1?"":"s"}`,l=6,o=["auto","manual","none"].includes(te)?te:"auto",u=o==="manual"&&z?"Manual":o==="auto"&&b.canCompute?"Automático":o==="none"?"Sin usar":"Automático",c=b.cyclesConsidered??[],d=!!b.canCompute,j=b.ignoredCount??0,w=typeof b.deduction=="number"&&Number.isFinite(b.deduction)?b.deduction:null,m=b.shortestCycle??null,C=typeof b.value=="number"&&Number.isFinite(b.value)?b.value:null;let I;if(t===0)I=j>0?"Todos los ciclos disponibles están ignorados para el cálculo automático.":"Aún no hay ciclos finalizados con fecha de finalización.";else if(!d)I=`Hay ${s} finalizado${t===1?"":"s"}. Se necesitan ${l} para calcular el CPM automáticamente.`,j>0&&(I+=` (${j} ciclo${j===1?"":"s"} ignorado${j===1?"":"s"}).`);else{const p=(m==null?void 0:m.dateRangeLabel)||(m==null?void 0:m.displayName)||(m==null?void 0:m.name)||"Ciclo sin nombre",k=typeof(m==null?void 0:m.duration)=="number"&&Number.isFinite(m.duration)?`${m.duration} días`:"duración desconocida",D=[`Calculado con ${s}.`,`Ciclo más corto: ${p} (${k}).`];w!==null&&D.push(`Deducción aplicada: ${w} días.`),C!==null&&D.push(`Resultado: ${C} días.`),j>0&&D.push(`${j} ciclo${j===1?"":"s"} ignorado${j===1?"":"s"}.`),I=D.join(" ")}return{sourceLabel:u,summary:I,highlightLabel:s,cycleCount:t,requiredCycles:l,canCompute:d,detailsAvailable:c.length>0,cycles:c,deduction:w,shortestCycle:m,value:C,ignoredCount:j}},[b,te,z]),Wt=a.useMemo(()=>{var p,k,D,q;const t=h.cycleCount,s=`${t} ciclo${t===1?"":"s"}`,l=6,o=["auto","manual","none"].includes(N)?N:"auto",u=o==="manual"&&f?"Manual":o==="auto"&&h.canCompute?"Automático":o==="none"?"Sin usar":"Automático",c=h.ignoredCount??0,d=((p=h.earliestCycle)==null?void 0:p.displayName)||((k=h.earliestCycle)==null?void 0:k.name)||"Ciclo sin nombre",j=(D=h.earliestCycle)==null?void 0:D.riseDay,w=typeof j=="number"&&Number.isFinite(j)?`Día ${j}`:"día desconocido",m=(q=h.earliestCycle)==null?void 0:q.t8Day,C=typeof m=="number"&&Number.isFinite(m)?`T-8 Día ${m}`:null;let I;if(t===0)I=c>0?"Los ciclos disponibles están ignorados para el cálculo automático.":"Aún no hay ciclos con ovulación confirmada por temperatura.";else if(!h.canCompute)I=`Hay ${s} con ovulación confirmada por temperatura (se necesitan ${l}).`,c>0&&(I+=` ${c} ciclo${c===1?"":"s"} ignorado${c===1?"":"s"}.`);else{const se=[`${d} (${w}${C?` → ${C}`:""}).`];c>0&&se.push(`${c} ciclo${c===1?"":"s"} ignorado${c===1?"":"s"}.`),I=se.join(" ")}return{sourceLabel:u,summary:I,highlightLabel:s,cycleCount:t,requiredCycles:l,ignoredCount:c}},[h,f,N]),Ue=a.useCallback((t,s)=>typeof t!="number"||!Number.isFinite(t)?null:t.toLocaleString("es-ES",s),[]),va=a.useMemo(()=>Is({computedCpmData:b,cpmSelection:te,isManualCpm:z,manualCpmBaseValue:A,manualCpmValue:R,formatNumber:Ue}),[b,te,Ue,z,A,R]),Na=a.useMemo(()=>Ts({computedT8Data:h,t8Selection:N,isManualT8:f,manualT8BaseValue:L,manualT8Value:n,formatNumber:Ue}),[h,Ue,f,L,n,N]),wa=Ue(J.value,{maximumFractionDigits:1})??(typeof J.value=="number"&&Number.isFinite(J.value)?`${J.value}`:"—");Ue(R,{maximumFractionDigits:1})??(typeof R=="number"&&Number.isFinite(R)&&`${R}`);const Qt=["auto","manual","none"].includes(te)?te:"auto",It=Qt==="manual"?z?"manual":"none":Qt==="auto"&&b.canCompute?"auto":"none",ja=It==="manual"?"Manual":It==="auto"?"Automático":"Sin usar",Ca=Ue(h.value,{maximumFractionDigits:0})??(typeof h.value=="number"&&Number.isFinite(h.value)?`${h.value}`:"—");Ue(n,{maximumFractionDigits:0})??(typeof n=="number"&&Number.isFinite(n)&&`${n}`);const Zt=["auto","manual","none"].includes(N)?N:"auto",Tt=Zt==="manual"?f?"manual":"none":Zt==="auto"&&h.canCompute?"auto":"none",Sa=Tt==="manual"?"Manual":Tt==="auto"?"Automático":"Sin usar";a.useMemo(()=>Z||(ie.trim()?"final":Pe.trim()?"base":null),[Pe,Z,ie]);const ea=a.useMemo(()=>{if(V==="manual"){if(W||$e)return!0;const t=Pe.trim()!==""&&!W,s=ie.trim()!==""&&!$e;return!t&&!s}return!1},[V,W,Pe,$e,ie]),Da=a.useMemo(()=>!!(z||Pe.trim()||ie.trim()),[z,Pe,ie]);a.useMemo(()=>ke||(ue.trim()?"final":Fe.trim()?"base":null),[Fe,ke,ue]);const ta=a.useMemo(()=>{if(S==="manual"){if(Be||_e)return!0;const t=Fe.trim()!==""&&!Be,s=ue.trim()!==""&&!_e;return!t&&!s}return!1},[Be,Fe,_e,ue,S]),Fa=a.useMemo(()=>!!(f||Fe.trim()||ue.trim()),[f,Fe,ue]),aa=a.useCallback(t=>{if(!t)return;const s=t.cycleId||t.id;if(s){if(r!=null&&r.id&&s===r.id){y("/");return}y(`/cycle/${s}`)}},[r==null?void 0:r.id,y]),sa=a.useCallback(async(t,s)=>{if(t){Kt(l=>l.includes(t)?l:[...l,t]);try{await de(t,s),F({title:s?"Ciclo ignorado":"Ciclo incluido",description:s?"El ciclo se excluyó del cálculo automático.":"El ciclo se volvió a incluir en el cálculo automático."})}catch{}finally{Kt(l=>l.filter(o=>o!==t))}}},[de,F]),tt=a.useCallback((t,s)=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),s())},[]),Ma=a.useCallback(()=>{var d;const t=typeof((d=b.shortestCycle)==null?void 0:d.duration)=="number"&&Number.isFinite(b.shortestCycle.duration)?b.shortestCycle.duration:null,s=typeof b.value=="number"&&Number.isFinite(b.value)?b.value:null,l=typeof A=="number"&&Number.isFinite(A),o=typeof R=="number"&&Number.isFinite(R),u=z&&l?A:t,c=z&&o?R:s;P(typeof u=="number"&&Number.isFinite(u)?String(u):""),De(typeof c=="number"&&Number.isFinite(c)?String(c):""),M(""),E(""),Oe(null),Ve(te),Ft(!1),Ee(!0)},[b,te,z,A,R]),Et=a.useCallback(()=>{Ft(!1),He(!1),Ke(!1),Ee(!1)},[]),ka=a.useCallback(t=>{const{value:s}=t.target;if(P(s),Oe("base"),M(""),E(""),!s.trim()){De("");return}const l=Number.parseInt(s,10);if(!Number.isFinite(l)){M("Introduce un número entero válido."),De("");return}const o=l-jt;if(o<0){M("El resultado debe ser ≥ 0 días"),De("");return}De(String(o))},[]),Ia=a.useCallback(t=>{const{value:s}=t.target;if(De(s),Oe("final"),E(""),M(""),!s.trim()){P("");return}const l=s.replace(",","."),o=Number.parseFloat(l);if(!Number.isFinite(o)){E("Introduce un número válido."),P("");return}if(o<0){E("El CPM debe ser ≥ 0"),P("");return}const u=o+jt,c=Math.round(u);P(String(c))},[]),na=a.useCallback(async()=>{if(W||$e)return!1;const t=Pe.trim(),s=ie.trim(),l=Z??(s?"final":t?"base":null);if(!l)return E("Introduce un valor."),fasle;let o=A,u;if(l==="base"){if(!t)return M("Introduce un número entero válido."),!1;const w=Number.parseInt(t,10);if(!Number.isFinite(w))return M("Introduce un número entero válido."),!1;const m=w-jt;if(m<0)return M("El resultado debe ser ≥ 0 días"),!1;o=w,u=m,De(String(m)),E("")}else{if(!s)return E("Introduce un valor."),!1;const w=s.replace(",","."),m=Number.parseFloat(w);if(!Number.isFinite(m)||m<0)return E("El CPM debe ser ≥ 0 días"),!1;u=m;const C=Number.parseInt(t,10);Number.isFinite(C)&&C-jt>=0?o=C:t||(o=null)}const c=R,d=z,j=A;be(u),Ae(!0),ee(typeof o=="number"&&Number.isFinite(o)?o:null);try{return await Ze({finalValue:u,baseValue:o}),Ee(!1),F({title:"CPM actualizado",description:"El CPM manual se guardó en tu perfil."}),!0}catch(w){return console.error("Failed to save manual CPM value",w),be(c),ee(j),Ae(d),E("No se pudo guardar el CPM. Inténtalo de nuevo."),fasle}},[z,W,Pe,A,Z,$e,ie,R,Ze,F]),ra=a.useCallback(async()=>{const t=R,s=z,l=A;be(null),ee(null),Ae(!1),P(""),De(""),M(""),E(""),Oe(null);try{await Ze({finalValue:null,baseValue:null}),F({title:"CPM borrado",description:"El valor manual se eliminó. Puedes guardar un nuevo valor o continuar con el cálculo automático."})}catch(o){console.error("Failed to delete manual CPM value",o),be(t),ee(l),Ae(s),E("No se pudo borrar el CPM. Inténtalo de nuevo.")}},[z,A,R,Ze,F]),Ta=a.useCallback(async()=>{Ke(!0);try{await ra(),He(!1);const t=J.canCompute?"auto":"none";Ye(t),Ve(t),await bt(t)}finally{Ke(!1)}},[J.canCompute,ra,bt]),at=a.useCallback(t=>{Ve(t)},[]),Ea=a.useCallback(async()=>{const t=V;if(t==="manual"){if(!await na())return;Ye("manual"),Ve("manual"),await bt("manual");return}const s=["auto","none"].includes(t)?t:"auto";Ye(s),Ve(s),await bt(s),Et()},[V,Et,na,bt]),Pa=a.useCallback(()=>{const t=typeof L=="number"&&Number.isFinite(L),s=typeof n=="number"&&Number.isFinite(n),l=f&&t?L:null,o=f&&s?n:null;mt(typeof l=="number"&&Number.isFinite(l)?String(l):""),Me(typeof o=="number"&&Number.isFinite(o)?String(o):""),ge(""),ye(""),qe(null),ae(N),pt(!1),We(!0)},[f,L,n,N]),Pt=a.useCallback(()=>{We(!1),pt(!1),Ie(!1),ht(!1)},[]),$a=a.useCallback(t=>{const{value:s}=t.target;if(mt(s),qe("base"),ge(""),ye(""),!s.trim()){Me("");return}const l=Number.parseInt(s,10);if(!Number.isFinite(l)){ge("Introduce un número entero válido."),Me("");return}if(l<9){ge("El T-8 debe ser ≥ 1"),Me("");return}const o=Math.max(1,l-8);Me(String(o))},[]),Oa=a.useCallback(t=>{const{value:s}=t.target;if(Me(s),qe("final"),ye(""),ge(""),!s.trim())return;const l=Number.parseInt(s,10);(!Number.isFinite(l)||l<1)&&ye("El T-8 debe ser ≥ 1")},[]),la=a.useCallback(async()=>{if(Be||_e)return!1;const t=Fe.trim(),s=ue.trim(),l=ke??(s?"final":t?"base":null);if(!l)return ye("Introduce un valor."),!1;let o=L,u;if(l==="base"){if(!t)return ge("Introduce un número entero válido."),!1;const w=Number.parseInt(t,10);if(!Number.isFinite(w))return ge("Introduce un número entero válido."),!1;if(w<9)return ge("El T-8 debe ser ≥ 1"),!1;const m=Math.max(1,w-8);o=w,u=m,Me(String(m)),ye("")}else{if(!s)return ye("Introduce un valor."),!1;const w=Number.parseInt(s,10);if(!Number.isFinite(w)||w<1)return ye("El T-8 debe ser ≥ 1"),!1;u=w;const m=Number.parseInt(t,10);Number.isFinite(m)&&m>=9?o=m:t||(o=null)}const c=n,d=f,j=L;x(u),g(!0),ce(typeof o=="number"&&Number.isFinite(o)?o:null);try{return await et({finalValue:u,baseValue:o}),We(!1),F({title:"T-8 actualizado",description:"El T-8 manual se guardó en tu perfil."}),!0}catch(w){return console.error("Failed to save manual T-8 value",w),x(c),ce(j),g(d),ye("No se pudo guardar el T-8. Inténtalo de nuevo."),!1}},[f,Be,Fe,L,ke,_e,ue,n,et,F]),oa=a.useCallback(async()=>{const t=n,s=f,l=L;x(null),ce(null),g(!1),mt(""),Me(""),ge(""),ye(""),qe(null);try{await et({finalValue:null,baseValue:null}),F({title:"T-8 borrado",description:"El valor manual se eliminó. Puedes guardar un nuevo valor o continuar con el cálculo automático."})}catch(o){console.error("Failed to delete manual T-8 value",o),x(t),ce(l),g(s),ge("No se pudo borrar el T-8. Inténtalo de nuevo.")}},[f,L,n,et,F]),Aa=a.useCallback(async()=>{ht(!0);try{await oa(),Ie(!1);const t=h.canCompute?"auto":"none";U(t),ae(t),await gt(t)}finally{ht(!1)}},[h.canCompute,oa,gt]),st=a.useCallback(t=>{ae(t)},[]),Ba=a.useCallback(async()=>{const t=S;if(t==="manual"){if(!await la())return;U("manual"),ae("manual"),await gt("manual");return}const s=["auto","none"].includes(t)?t:"auto";U(s),ae(s),await gt(s),Pt()},[Pt,la,gt,S]),Re=a.useCallback(()=>{pe(null),le(null),Xe(!1)},[]),_a=a.useCallback(()=>{Se((r==null?void 0:r.startDate)||""),K(""),Re(),re(!0)},[r==null?void 0:r.startDate,Re]),nt=a.useCallback(()=>{re(!1),K(""),Re(),Se((r==null?void 0:r.startDate)||"")},[r==null?void 0:r.startDate,Re]),Ra=a.useCallback(()=>{Re()},[Re]),La=a.useCallback(async()=>{if(!G){K("La fecha de inicio es obligatoria");return}if(r!=null&&r.id){K(""),he(!0);try{const t=Y?await Y(r.id,G):null;if(t){pe(G),le(t),Xe(!0),he(!1);return}await X(r.id,G),await T({silent:!0}),F({title:"Fecha de inicio actualizada",description:"El ciclo se ha ajustado a la nueva fecha de inicio."}),nt()}catch(t){console.error("Error updating start date from dashboard:",t),K("No se pudo actualizar la fecha de inicio"),F({title:"Error",description:"No se pudo actualizar la fecha de inicio.",variant:"destructive"})}finally{he(!1)}}},[G,r==null?void 0:r.id,Y,X,T,F,nt]),za=a.useCallback(async()=>{if(!(r!=null&&r.id)||!_){Re();return}he(!0),Xe(!1);try{await B(r.id,_),await T({silent:!0}),F({title:"Fecha de inicio actualizada",description:"El ciclo se ha ajustado a la nueva fecha de inicio."}),nt()}catch(t){console.error("Error forcing start date from dashboard:",t),K("No se pudo actualizar la fecha de inicio"),F({title:"Error",description:"No se pudo actualizar la fecha de inicio.",variant:"destructive"})}finally{he(!1),Re()}},[r==null?void 0:r.id,_,B,T,F,nt,Re]),[Va,Je]=a.useState(!1),[Ua,ia]=a.useState(!1),[ua,rt]=a.useState(!1),[yt,vt]=a.useState(null),[Ha,lt]=a.useState(null),Wa=!!(yt&&String(yt.id||"").startsWith("placeholder-")),Ja=a.useMemo(()=>{var s;const t=(s=r==null?void 0:r.data)==null?void 0:s.find(l=>(l==null?void 0:l.peak_marker)==="peak");return(t==null?void 0:t.isoDate)||null},[r==null?void 0:r.data]),ca=a.useCallback(()=>{Je(!1),vt(null),lt(null)},[]),Xa=a.useCallback(t=>{vt(t)},[]),Ya=a.useCallback((t,s=null)=>{vt(t),lt(s??null),Je(!0)},[]),Ka=a.useCallback(async(t,s=!0)=>{if(!(r!=null&&r.id)||!(t!=null&&t.isoDate))return;const l=u=>{if(u==null||u==="")return null;const c=parseFloat(String(u).replace(",","."));return Number.isFinite(c)?c:null},o=s??!(t.peak_marker==="peak"||t.peakStatus==="P");try{const u=t.timestamp?wt(Te(t.timestamp),"HH:mm"):wt(new Date,"HH:mm");let c=Array.isArray(t.measurements)&&t.measurements.length>0?t.measurements:[{temperature:t.temperature_chart??t.temperature_raw??null,temperature_corrected:t.temperature_corrected??null,time:t.time??u,time_corrected:t.time_corrected??u,selected:!0,use_corrected:t.use_corrected??!1}];c.length===0&&(c=[{temperature:null,temperature_corrected:null,time:u,time_corrected:u,selected:!0,use_corrected:!1}]);const d=c.map((m,C)=>{const I=m.time||u,p=m.time_corrected||I;return{temperature:l(m.temperature??m.temperature_raw),time:I,selected:C===0?!0:!!m.selected,temperature_corrected:l(m.temperature_corrected),time_corrected:p,use_corrected:!!m.use_corrected}});d.some(m=>m.selected)||(d[0].selected=!0);const j={isoDate:t.isoDate,measurements:d,mucusSensation:t.mucus_sensation??t.mucusSensation??"",mucusAppearance:t.mucus_appearance??t.mucusAppearance??"",fertility_symbol:t.fertility_symbol??"none",observations:t.observations??"",ignored:t.ignored??!1,peak_marker:o?"peak":null},w=t!=null&&t.id&&!String(t.id).startsWith("placeholder-")?t:null;await O(j,w)}catch(u){console.error("Error toggling peak marker from dashboard:",u)}},[O,r==null?void 0:r.id]),qa=a.useMemo(()=>{if(!(r!=null&&r.startDate))return null;try{return Ct(St(new Date),Te(r.startDate))+1}catch(t){return console.error("Error calculating current day:",t),null}},[r==null?void 0:r.startDate]),Ga=a.useMemo(()=>{const t=[],s=d=>["auto","manual","none"].includes(d)?d:"auto",l=(d,j,w)=>{const m=Number(j);if(!Number.isFinite(m)||m<=0)return;const C=Number(w),I=Number.isFinite(C)&&C>0,p=I?d==="CPM"?`ciclo base: ${C}`:`base ${d}: ${C}`:null;t.push({source:d,day:Math.max(1,m),reason:p?`Manual desde dashboard (${p})`:"Manual desde dashboard",kind:"calculator",isManual:!0,manualBase:I?C:null})},o=(d,j,w)=>{if(!w)return;const m=Number(j);Number.isFinite(m)&&t.push({source:d,day:Math.max(1,m),reason:"Automático desde dashboard",kind:"calculator"})},u=s(te);u==="manual"?l("CPM",R,A):u==="auto"&&o("CPM",b==null?void 0:b.value,b==null?void 0:b.canCompute);const c=s(N);return c==="manual"?l("T8",n,L):c==="auto"&&o("T8",h==null?void 0:h.value,h==null?void 0:h.canCompute),t},[b==null?void 0:b.canCompute,b==null?void 0:b.value,h==null?void 0:h.canCompute,h==null?void 0:h.value,te,A,R,L,n,N]),Qa=a.useMemo(()=>({calculators:{cpm:te!=="none",t8:N!=="none"}}),[te,N]),Za=a.useMemo(()=>{const t=[];return Array.isArray($)&&$.length>0&&t.push(...$),r&&t.push(r),t},[$,r]);if(Ns((r==null?void 0:r.data)??[],!1,"portrait",void 0,r==null?void 0:r.id,5,!1,Qa,Za,Ga,!1),ne&&!(r!=null&&r.id))return e.jsx("div",{className:"mx-auto flex min-h-screen max-w-md items-center justify-center px-4 py-4",children:e.jsx("div",{className:"w-full rounded-3xl border border-rose-100/70 bg-white/80 p-4 text-center shadow-sm",children:e.jsx("p",{className:"text-sm font-semibold text-slate-800",children:"Cargando..."})})});if(!(r!=null&&r.id))return e.jsxs("div",{className:"mx-auto flex min-h-screen max-w-md items-center justify-center px-4 py-4",children:[e.jsxs("div",{className:"w-full space-y-4 rounded-3xl border border-rose-100/70 bg-white/80 p-4 text-center shadow-sm",children:[e.jsx("p",{className:"text-[15px] font-semibold text-slate-800",children:"No hay ciclo activo."}),e.jsx("button",{onClick:()=>rt(!0),className:"h-11 w-full rounded-full bg-fertiliapp-fuerte px-4 text-sm font-semibold text-white shadow-sm transition hover:brightness-95",children:"Iniciar ciclo"})]}),e.jsx(ma,{isOpen:ua,onClose:()=>rt(!1),onConfirm:async t=>{await Le(t),rt(!1),lt(null),Je(!0)}})]});if(!(r!=null&&r.startDate))return e.jsx("div",{className:"mx-auto flex min-h-screen max-w-md items-center justify-center px-4 py-4",children:e.jsx("div",{className:"w-full rounded-3xl border border-rose-100/70 bg-white/80 p-4 text-center shadow-sm",children:e.jsx("p",{className:"text-sm font-semibold text-slate-800",children:"Cargando..."})})});const es=async(t,{keepFormOpen:s=!1}={})=>{ia(!0);try{await O(t,yt),s||(Je(!1),vt(null),lt(null))}finally{ia(!1)}},ts=async t=>{await Le(t),rt(!1),lt(null),Je(!0)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mx-auto flex h-full w-full flex-col space-y-4 px-4 pb-10 pt-4",children:e.jsxs(H.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"flex flex-1 flex-col gap-3",children:[e.jsx(Es,{cycleData:{...r,currentDay:qa,records:r.data},onEdit:Ya,onTogglePeak:Ka,currentPeakIsoDate:Ja,onEditStartDate:_a,handleOpenCpmDialog:Ma,handleOpenT8Dialog:Pa,cpmMetric:va,t8Metric:Na}),e.jsx(ot,{open:Q,onOpenChange:t=>{t||Et()},children:e.jsxs(it,{className:"flex max-h-[90vh] w-[90vw] max-w-sm flex-col overflow-hidden rounded-3xl border border-rose-100 bg-white/95 p-0 text-gray-800 shadow-xl",children:[e.jsxs(At,{className:"space-y-2 px-4 pt-4 text-left",children:[e.jsx(Bt,{children:"Editar CPM"}),e.jsx(xa,{children:e.jsx("div",{className:"text-xs",children:"Puedes usar el valor calculado automáticamente o fijar un valor manual."})})]}),e.jsxs("div",{className:"flex-1 space-y-3 overflow-y-auto px-4 pb-4",children:[e.jsx("div",{className:"rounded-2xl border border-rose-100 bg-rose-50/70 px-3 py-2",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("div",{className:"space-y-1",children:e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-rose-600",children:"Estado actual"})}),e.jsx("span",{className:`rounded-full px-3 py-1 text-[11px] font-semibold ${It==="manual"?"bg-rose-100 text-rose-700":It==="auto"?"bg-emerald-50 text-emerald-700":"bg-gray-100 text-gray-600"}`,children:ja})]})}),e.jsxs("div",{role:"radio",tabIndex:0,onClick:()=>at("auto"),onKeyDown:t=>tt(t,()=>at("auto")),className:`cursor-pointer rounded-2xl border px-3 py-3 shadow-sm transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-300/70 ${V==="auto"?"border-emerald-300 bg-emerald-50/60":"border-rose-100 bg-white/80 hover:border-fertiliapp-suave"} ${J.canCompute?"":"opacity-70"}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold text-rose-900",children:"Cálculo automático"}),e.jsx("span",{className:"text-[11px] font-semibold text-rose-600",children:J.canCompute&&J.value!==null?`CPM automático: ${wa} días`:"No disponible todavía"}),e.jsx("p",{className:"text-[10px] text-rose-600",children:"Basado en tus ciclos completados."})]}),e.jsx("span",{className:`mt-0.5 flex h-5 w-5 items-center justify-center rounded-full border-2 ${V==="auto"?"border-emerald-400 bg-emerald-400":"border-fertiliapp-suave bg-white"}`,children:V==="auto"&&e.jsx("span",{className:"h-2.5 w-2.5 rounded-full bg-white"})})]}),e.jsxs("div",{className:"mt-2 rounded-2xl border border-rose-100 bg-rose-50/70 px-3 py-2.5 text-[11px] text-rose-900",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs font-semibold text-rose-700",children:[e.jsx("span",{children:"Datos disponibles"}),e.jsx("button",{type:"button",onClick:()=>Ft(t=>!t),className:"rounded-full bg-white/70 px-2 py-0.5 text-[11px] font-semibold text-rose-600 transition hover:bg-white/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-300/70","aria-expanded":Dt,children:J.highlightLabel})]}),J.summary&&e.jsx("p",{className:"mt-1 text-[11px] text-rose-500",children:J.summary}),!J.detailsAvailable&&e.jsx("p",{className:"mt-1 text-[11px] text-rose-500",children:"Aún no hay ciclos finalizados con fecha de finalización."}),Dt&&J.detailsAvailable&&e.jsx("div",{className:"mt-2 space-y-2",children:J.cycles.length>0?e.jsx("ul",{className:"space-y-1",children:J.cycles.map((t,s)=>{const l=t.cycleId||t.id||`${t.displayName||t.name||t.startDate||"cycle"}-${s}`,o=typeof t.duration=="number"&&Number.isFinite(t.duration)?`${t.duration} días`:"duración desconocida",u=!!(J.shortestCycle&&J.shortestCycle===t),c=t.cycleId||t.id,d=!!(t.isIgnored||t.ignoredForAutoCalculations),j=c?Yt.includes(c):!1,w=`rounded-2xl border px-3 py-2 shadow-sm transition hover:border-rose-200 hover:bg-white ${d?"border-rose-200 bg-rose-50/80 opacity-80":"border-rose-100 bg-white/50"}`;return e.jsx("li",{children:e.jsxs("div",{className:"flex items-stretch gap-2",children:[e.jsxs("div",{className:`${w} flex-1`,children:[e.jsx("button",{type:"button",onClick:()=>aa(t),className:"block w-full rounded-2xl px-1 py-0.5 text-left transition hover:bg-white/60 hover:text-rose-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-300/70",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-xs font-semibold text-rose-700",children:t.dateRangeLabel||t.displayName||t.name||"Ciclo sin nombre"}),e.jsx(Xt,{className:"h-4 w-4 text-rose-400","aria-hidden":"true"})]})}),e.jsxs("div",{className:"mt-1 flex flex-wrap items-center justify-between gap-2 text-[11px] text-rose-500",children:[e.jsxs("span",{children:["Duración: ",o]}),u&&e.jsx("span",{className:"rounded-full bg-rose-100 px-2 py-0.5 font-semibold text-rose-600",children:"Ciclo más corto"})]}),d&&e.jsx("p",{className:"mt-1 text-[11px] text-rose-400",children:"Ignorado para el cálculo automático."})]}),e.jsx(Ce,{type:"button",variant:"outline",size:"xs",disabled:!c||j,onClick:()=>c&&sa(c,!d),className:"shrink-0 self-center h-8 w-8 p-0 bg-transparent border-transparent",title:d?"Incluir ciclo en el cálculo automático":"Ignorar ciclo para el cálculo automático","aria-label":d?"Incluir ciclo en el cálculo automático":"Ignorar ciclo para el cálculo automático","aria-pressed":d,children:j?e.jsxs(e.Fragment,{children:[e.jsx(fa,{className:"h-4 w-4 animate-spin text-rose-500","aria-hidden":"true"}),e.jsx("span",{className:"sr-only",children:"Guardando…"})]}):d?e.jsx(ba,{className:"h-4 w-4 text-rose-500","aria-hidden":"true"}):e.jsx(ga,{className:"h-4 w-4 text-green-800/70","aria-hidden":"true"})})]})},l)})}):e.jsx("p",{className:"text-[11px] text-rose-500",children:"Aún no hay ciclos finalizados con fecha de finalización."})})]})]}),e.jsxs("div",{role:"radio",tabIndex:0,"aria-checked":V==="manual",onClick:()=>at("manual"),onKeyDown:t=>tt(t,()=>at("manual")),className:`cursor-pointer rounded-2xl border px-3 py-3 shadow-sm transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-300/70 ${V==="manual"?"border-emerald-300 bg-emerald-50/60":"border-rose-100 bg-white/80 hover:border-rose-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("div",{className:"space-y-1",children:e.jsx("p",{className:"text-sm font-semibold text-rose-900",children:"Valor manual"})}),e.jsx("span",{className:`mt-0.5 flex h-5 w-5 items-center justify-center rounded-full border-2 ${V==="manual"?"border-emerald-400 bg-emerald-400":"border-rose-300 bg-white"}`,children:V==="manual"&&e.jsx("span",{className:"h-2.5 w-2.5 rounded-full bg-white"})})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(Lt,{htmlFor:"manual-cpm-base",className:"text-xs text-gray-600",children:"Ciclo más corto"}),e.jsx(Rt,{id:"manual-cpm-base",type:"number",inputMode:"numeric",step:"1",min:"0",value:Pe,onChange:ka,placeholder:"Introduce un entero","aria-describedby":Z?"manual-cpm-helper":void 0}),W&&e.jsx("p",{className:"text-xs text-red-500",children:W})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(Lt,{htmlFor:"manual-cpm-final",className:"text-xs text-gray-600",children:"CPM obtenido"}),e.jsx(Rt,{id:"manual-cpm-final",type:"number",inputMode:"decimal",step:"0.1",min:"0",value:ie,onChange:Ia,placeholder:"Introduce el valor","aria-describedby":Z?"manual-cpm-helper":void 0}),$e&&e.jsx("p",{className:"text-xs text-red-500",children:$e})]})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-end gap-2",children:[Z&&e.jsx("div",{className:"mt-2 flex justify-center",children:e.jsx("span",{id:"manual-cpm-helper",className:"rounded-full bg-rose-50 px-3 py-1 text-xs font-medium text-rose-600",children:Z==="base"?"Usando Ciclo más corto como base":"Usando CPM (final)"})}),e.jsx(Ce,{type:"button",variant:"outline",onClick:()=>He(!0),disabled:!Da,className:"h-8 shrink-0 rounded-full border border-rose-200 px-3 text-xs text-rose-600 hover:bg-rose-50 hover:text-rose-700",children:"Borrar"})]}),ea&&V==="manual"&&!z&&e.jsx("p",{className:"mt-2 text-[11px] text-rose-500",children:"Introduce un valor válido antes de seleccionar."})]}),e.jsx("div",{role:"radio",tabIndex:0,"aria-checked":V==="none",onClick:()=>at("none"),onKeyDown:t=>tt(t,()=>at("none")),className:`cursor-pointer rounded-2xl border px-3 py-2 text-left shadow-sm transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-300/70 ${V==="none"?"border-emerald-300 bg-emerald-50/60":"border-dashed border-rose-200 bg-white/70 hover:border-rose-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"space-y-1",children:e.jsx("p",{className:"text-sm font-semibold text-rose-900",children:"No usar ningún valor"})}),e.jsx("span",{className:`mt-0.5 flex h-5 w-5 items-center justify-center rounded-full border-2 ${V==="none"?"border-emerald-400 bg-emerald-400":"border-rose-300 bg-white"}`,children:V==="none"&&e.jsx("span",{className:"h-2.5 w-2.5 rounded-full bg-white"})})]})})]}),e.jsx(_t,{className:"mt-0 flex flex-col gap-3 px-4 pb-4",children:e.jsxs("div",{className:"flex w-full items-center justify-end gap-2",children:[e.jsx(Ce,{type:"button",variant:"secondary",onClick:Et,className:"h-8 rounded-full px-4 text-xs",children:"Cancelar"}),e.jsx(Ce,{type:"button",onClick:Ea,disabled:ea,className:"h-8 rounded-full px-4 text-xs",children:"Guardar"})]})})]})}),e.jsx(ot,{open:Mt,onOpenChange:He,children:e.jsxs(it,{className:"w-[90vw] max-w-xs rounded-2xl border border-rose-100",children:[e.jsx(At,{children:e.jsx(Bt,{children:"¿Estás segura de que quieres borrar el valor manual de CPM?"})}),e.jsxs(_t,{className:"flex flex-col gap-2 sm:flex-row sm:justify-end sm:gap-3",children:[e.jsx(Ce,{type:"button",variant:"secondary",onClick:()=>He(!1),className:"w-full sm:w-auto",children:"Cancelar"}),e.jsx(Ce,{type:"button",variant:"destructive",onClick:Ta,disabled:ct,className:"w-full sm:w-auto",children:ct?"Borrando…":"Borrar"})]})]})}),e.jsx(ot,{open:dt,onOpenChange:t=>{t||Pt()},children:e.jsxs(it,{className:"flex max-h-[90vh] w-[90vw] max-w-sm flex-col rounded-3xl border border-rose-100 bg-white/95 text-gray-800 shadow-xl overflow-hidden p-0",children:[e.jsxs(At,{className:"space-y-2 px-4 pt-4 text-left",children:[e.jsx(Bt,{children:"Editar T-8"}),e.jsx(xa,{children:e.jsx("div",{className:"text-xs",children:"Puedes usar el valor calculado automáticamente o fijar un valor manual."})})]}),e.jsxs("div",{className:"flex-1 space-y-3 overflow-y-auto px-4 pb-4",children:[e.jsx("div",{className:"rounded-2xl border border-rose-100 bg-rose-50/70 px-3 py-2",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("div",{className:"space-y-1",children:e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-rose-600",children:"Estado actual"})}),e.jsx("span",{className:`rounded-full px-3 py-1 text-[11px] font-semibold ${Tt==="manual"?"bg-rose-100 text-rose-700":Tt==="auto"?"bg-emerald-50 text-emerald-700":"bg-gray-100 text-gray-600"}`,children:Sa})]})}),e.jsxs("div",{role:"radio",tabIndex:0,onClick:()=>st("auto"),onKeyDown:t=>tt(t,()=>st("auto")),className:`cursor-pointer rounded-2xl border px-3 py-3 shadow-sm transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-300/70 ${S==="auto"?"border-emerald-300 bg-emerald-50/60":"border-rose-100 bg-white/80 hover:border-rose-200"} ${h.canCompute?"":"opacity-70"}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold text-rose-900",children:"Cálculo automático"}),e.jsx("span",{className:"text-[11px] font-semibold text-rose-600",children:h.canCompute&&h.value!==null?`T-8 automático: Día ${Ca}`:"No disponible todavía"}),e.jsx("p",{className:"text-[10px] text-rose-600",children:"Basado en tus ciclos completados."})]}),e.jsx("span",{className:`mt-0.5 flex h-5 w-5 items-center justify-center rounded-full border-2 ${S==="auto"?"border-emerald-400 bg-emerald-400":"border-rose-300 bg-white"}`,children:S==="auto"&&e.jsx("span",{className:"h-2.5 w-2.5 rounded-full bg-white"})})]}),e.jsxs("div",{className:"mt-2 rounded-2xl border border-rose-100 bg-rose-50/70 px-3 py-2.5 text-[11px] text-rose-900",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs font-semibold text-rose-700",children:[e.jsx("span",{children:"Datos disponibles"}),e.jsx("button",{type:"button",onClick:()=>pt(t=>!t),className:"rounded-full bg-white/70 px-2 py-0.5 text-[11px] font-semibold text-rose-600 transition hover:bg-white/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-300/70","aria-expanded":ft,children:Wt.highlightLabel})]}),Wt.summary&&e.jsx("p",{className:"mt-1 text-[11px] text-rose-500",children:Wt.summary}),h.cycleCount===0&&e.jsx("p",{className:"mt-1 text-[11px] text-rose-500",children:"Aún no hay ciclos con ovulación confirmada por temperatura."}),ft&&h.cycleCount>0&&e.jsx("div",{className:"mt-2 space-y-2",children:h.cyclesConsidered.length>0?e.jsx("ul",{className:"space-y-1",children:h.cyclesConsidered.map((t,s)=>{const l=t.cycleId||`${t.displayName}-${t.riseDay}-${s}`,o=typeof t.riseDay=="number"&&Number.isFinite(t.riseDay)?t.riseDay:"—",u=t.cycleId||t.id,c=!!(t.isIgnored||t.ignoredForAutoCalculations),d=u?Yt.includes(u):!1,j=`rounded-2xl border px-3 py-2 shadow-sm transition hover:border-rose-200 hover:bg-white ${c?"border-rose-200 bg-rose-50/80 opacity-80":"border-rose-100 bg-white/40"}`;return e.jsx("li",{children:e.jsxs("div",{className:"flex items-stretch gap-2",children:[e.jsxs("div",{className:`${j} flex-1`,children:[e.jsx("button",{type:"button",onClick:()=>aa(t),className:"block w-full rounded-2xl px-1 py-0.5 text-left transition hover:bg-white/60 hover:text-rose-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-300/70",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-xs font-semibold text-rose-700",children:t.dateRangeLabel||t.displayName||t.name||"Ciclo sin nombre"}),e.jsx(Xt,{className:"h-4 w-4 text-rose-400","aria-hidden":"true"})]})}),e.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-2 text-[11px] text-rose-500",children:[e.jsxs("span",{children:["Día de subida: ",o]}),Number.isFinite(t.t8Day)&&e.jsxs("span",{children:["T-8: Día ",t.t8Day]})]}),c&&e.jsx("p",{className:"mt-1 text-[11px] text-rose-400",children:"Ignorado para el cálculo automático."})]}),e.jsx(Ce,{type:"button",variant:"outline",size:"icon",disabled:!u||d,onClick:()=>u&&sa(u,!c),className:"shrink-0 self-center h-8 w-8 p-0 bg-transparent border-transparent",title:c?"Incluir ciclo en el cálculo automático":"Ignorar ciclo para el cálculo automático","aria-label":c?"Incluir ciclo en el cálculo automático":"Ignorar ciclo para el cálculo automático","aria-pressed":c,children:d?e.jsxs(e.Fragment,{children:[e.jsx(fa,{className:"h-4 w-4 animate-spin text-rose-500","aria-hidden":"true"}),e.jsx("span",{className:"sr-only",children:"Guardando…"})]}):c?e.jsx(ba,{className:"h-4 w-4 text-rose-500","aria-hidden":"true"}):e.jsx(ga,{className:"h-4 w-4 text-green-800/70","aria-hidden":"true"})})]})},l)})}):e.jsx("p",{className:"text-[11px] text-rose-500",children:"Aún no hay ciclos con ovulación confirmada por temperatura."})})]})]}),e.jsxs("div",{role:"radio",tabIndex:0,"aria-checked":S==="manual",onClick:()=>st("manual"),onKeyDown:t=>tt(t,()=>st("manual")),className:`cursor-pointer rounded-2xl border px-3 py-3 shadow-sm transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-300/70 ${S==="manual"?"border-emerald-300 bg-emerald-50/60":"border-rose-100 bg-white/80 hover:border-rose-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("div",{className:"space-y-1",children:e.jsx("p",{className:"text-sm font-semibold text-rose-900",children:"Valor manual"})}),e.jsx("span",{className:`mt-0.5 flex h-5 w-5 items-center justify-center rounded-full border-2 ${S==="manual"?"border-emerald-400 bg-emerald-400":"border-rose-300 bg-white"}`,children:S==="manual"&&e.jsx("span",{className:"h-2.5 w-2.5 rounded-full bg-white"})})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(Lt,{htmlFor:"manual-t8-base",className:"text-xs text-gray-600",children:"Ciclo con subida (día)"}),e.jsx(Rt,{id:"manual-t8-base",type:"number",inputMode:"numeric",step:"1",min:"9",value:Fe,onChange:$a,placeholder:"Día de subida","aria-describedby":ke?"manual-t8-helper":void 0}),Be&&e.jsx("p",{className:"text-xs text-red-500",children:Be})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(Lt,{htmlFor:"manual-t8-final",className:"text-xs text-gray-600",children:"T-8 manual (día)"}),e.jsx(Rt,{id:"manual-t8-final",type:"number",inputMode:"numeric",step:"1",min:"1",value:ue,onChange:Oa,placeholder:"Día del T-8","aria-describedby":ke?"manual-t8-helper":void 0}),_e&&e.jsx("p",{className:"text-xs text-red-500",children:_e})]})]}),e.jsx("div",{className:"mt-3 flex flex-wrap items-end gap-2",children:ke&&e.jsx("div",{className:"mt-2 flex justify-center",children:e.jsx("span",{id:"manual-t8-helper",className:"rounded-full bg-rose-50 px-3 py-1 text-xs font-medium text-rose-600",children:ke==="base"?"Usando día de subida como base":"Usando T-8 manual"})})}),e.jsx(Ce,{type:"button",variant:"outline",onClick:()=>Ie(!0),disabled:!Fa,className:"h-8 shrink-0 rounded-full border border-rose-200 px-3 text-xs text-rose-600 hover:bg-rose-50 hover:text-rose-700",children:"Borrar"}),ta&&S==="manual"&&!f&&e.jsx("p",{className:"mt-2 text-[11px] text-rose-500",children:"Introduce un valor válido antes de seleccionar."})]}),e.jsx("div",{role:"radio",tabIndex:0,"aria-checked":S==="none",onClick:()=>st("none"),onKeyDown:t=>tt(t,()=>st("none")),className:`cursor-pointer rounded-2xl border px-3 py-2 text-left shadow-sm transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-300/70 ${S==="none"?"border-emerald-300 bg-emerald-50/60":"border-dashed border-rose-200 bg-white/70 hover:border-rose-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"space-y-1",children:e.jsx("p",{className:"text-sm font-semibold text-rose-900",children:"No usar ningún valor"})}),e.jsx("span",{className:`mt-0.5 flex h-5 w-5 items-center justify-center rounded-full border-2 ${S==="none"?"border-emerald-400 bg-emerald-400":"border-rose-300 bg-white"}`,children:S==="none"&&e.jsx("span",{className:"h-2.5 w-2.5 rounded-full bg-white"})})]})})]}),e.jsx(_t,{className:"mt-0 flex flex-col gap-3 px-4 pb-4",children:e.jsxs("div",{className:"flex w-full items-center justify-end gap-2",children:[e.jsx(Ce,{type:"button",variant:"secondary",onClick:Pt,className:"h-8 rounded-full px-4 text-xs",children:"Cancelar"}),e.jsx(Ce,{type:"button",onClick:Ba,disabled:ta,className:"h-8 rounded-full px-4 text-xs",children:"Guardar"})]})})]})}),e.jsx(ot,{open:Vt,onOpenChange:Ie,children:e.jsxs(it,{className:"w-[90vw] max-w-xs rounded-2xl border border-rose-100",children:[e.jsx(At,{children:e.jsx(Bt,{children:"¿Estás segura de que quieres borrar el valor manual de T-8?"})}),e.jsxs(_t,{className:"flex flex-col gap-2 sm:flex-row sm:justify-end sm:gap-3",children:[e.jsx(Ce,{type:"button",variant:"secondary",onClick:()=>Ie(!1),className:"w-full sm:w-auto",children:"Cancelar"}),e.jsx(Ce,{type:"button",variant:"destructive",onClick:Aa,disabled:xt,className:"w-full sm:w-auto",children:xt?"Borrando…":"Borrar"})]})]})}),e.jsx(ot,{open:me,onOpenChange:t=>{t||nt()},children:e.jsx(it,{hideClose:!0,className:"bg-transparent border-none p-0 text-gray-800 w-[90vw] sm:w-auto max-w-md sm:max-w-lg md:max-w-xl max-h-[85vh] overflow-y-auto",children:e.jsx(fs,{cycle:r,startDate:G,endDate:r.endDate,onStartDateChange:t=>Se(t),onSave:La,onCancel:nt,isProcessing:ut,dateError:ze,includeEndDate:!1,showOverlapDialog:xe,overlapCycle:fe,onConfirmOverlap:za,onCancelOverlap:Ra,onClearError:()=>K(""),saveLabel:"Guardar cambios",title:"Editar fecha de inicio",description:"Selecciona una nueva fecha de inicio para el ciclo actual. Los registros se reorganizarán automáticamente.",className:"w-full"})})})]})}),e.jsx(ot,{open:Va,onOpenChange:t=>{t?Je(!0):ca()},children:e.jsx(it,{hideClose:!0,className:"bg-transparent border-none p-0 text-gray-800 w-[90vw] sm:w-auto max-w-md sm:max-w-lg md:max-w-xl max-h-[85vh] overflow-y-auto",children:e.jsx(xs,{onSubmit:es,onCancel:ca,initialData:yt,cycleStartDate:r.startDate,cycleEndDate:r.endDate,isProcessing:Ua,isEditing:!!yt&&!Wa,cycleData:r.data,onDateSelect:Xa,initialSectionKey:Ha})})}),e.jsx(Ps,{onAddRecord:()=>{vt(null),lt(null),Je(!0)},onAddCycle:()=>rt(!0)}),e.jsx(ma,{isOpen:ua,onClose:()=>rt(!1),onConfirm:ts,currentCycleStartDate:r.startDate})]})};export{Ws as default};
