import{c as Mt,m as V,j as t,r as W}from"./index-7fea14b0.js";import{g as At,i as Gt}from"./DataEntryForm-ad843356.js";import{s as ft,p as Lt,b as Tt,f as jt,d as Bt}from"./useCycleData-321f2a4b.js";import{C as It}from"./ChartTooltip-478e06f3.js";const ee=Mt("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),St=({padding:e,chartWidth:i,chartHeight:w,tempMin:x,tempMax:E,tempRange:y,getY:p,getX:d,allDataPoints:C=[],responsiveFontSize:b,isFullScreen:v,showLeftLabels:r=!1,reduceMotion:l=!1})=>{const c={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.3,ease:"easeOut"}}},f=[];if(y>0){const u=y<=2.5?.1:.5;for(let T=x;T<=E+1e-9;T+=u)f.push(parseFloat(T.toFixed(1)))}else for(let u=35;u<=37.5+1e-9;u+=.5)f.push(parseFloat(u.toFixed(1)));const h=l?"g":V.g;return t.jsxs(t.Fragment,{children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"bgGradientChart",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(254, 242, 242, 0.95)"}),t.jsx("stop",{offset:"30%",stopColor:"rgba(255, 241, 242, 0.9)"}),t.jsx("stop",{offset:"70%",stopColor:"rgba(255, 245, 255, 0.95)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(254, 242, 242, 0.8)"})]}),t.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),t.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),t.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),t.jsxs("filter",{id:"chartGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsx("filter",{id:"textShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:t.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodColor:"rgba(255, 255, 255, 0.8)"})}),t.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[t.jsx("rect",{width:"6",height:"6",fill:"#f3f4f6"}),t.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(239,68,68,0.7)"})]})]}),t.jsx("rect",{x:e.left,y:e.top,width:i-e.left-e.right,height:w-e.top-e.bottom,fill:"url(#bgGradientChart)",opacity:2,rx:12,style:{filter:"drop-shadow(0 4px 12px rgba(244, 114, 182, 0.1))"}}),f.map((u,T)=>{const D=p(u),S=u.toFixed(1).endsWith(".0")||u.toFixed(1).endsWith(".5"),O=S?u.toFixed(1):`.${u.toFixed(1).split(".")[1]}`;return t.jsxs(h,{...l?{}:{variants:c},children:[t.jsx("line",{x1:e.left,y1:D,x2:i-e.right,y2:D,stroke:S?"rgba(244, 114, 182, 0.3)":"rgba(244, 114, 182, 0.15)",strokeWidth:S?2:1,strokeDasharray:S?"0":"4,4",style:{filter:S?"drop-shadow(0 1px 3px rgba(244, 114, 182, 0.15))":"none",opacity:S?1:.7}}),r&&t.jsx("text",{x:e.left-b(1),y:D+b(.35),textAnchor:"end",fontSize:b(S?1.1:1),fontWeight:S?"700":"600",fill:S?"#E91E63":"#EC4899",style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:O}),t.jsx("text",{x:i-e.right+b(1),y:D+b(.35),textAnchor:"start",fontSize:b(S?1.1:1),fontWeight:S?"700":"600",fill:S?"#E91E63":"#EC4899",style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:O})]},`temp-tick-${T}`)}),C.map((u,T)=>{const D=d(T);return t.jsx("line",{x1:D,y1:e.top,x2:D,y2:w-e.bottom,stroke:"rgba(244, 114, 182, 0.08)",strokeWidth:2.8,style:{filter:"drop-shadow(0 0 1px rgba(244, 114, 182, 0.05))"}},`day-grid-${T}`)}),t.jsx("rect",{x:e.left,y:e.top,width:i-e.left-e.right,height:w-e.top-e.bottom,fill:"none",stroke:"rgba(244, 114, 182, 0.4)",strokeWidth:2,rx:12,style:{filter:"drop-shadow(0 4px 12px rgba(244, 114, 182, 0.15))",strokeDasharray:"0"}}),r&&t.jsx(h,{...l?{}:{variants:c},children:t.jsx("text",{x:e.left+b(1.2),y:e.top+b(1.5),textAnchor:"middle",fontSize:b(1.4),fontWeight:"800",fill:"#E91E63",style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:"°C"})})]})},vt=({data:e,allDataPoints:i,getX:w,getY:x,baselineY:E,temperatureField:y="temperature",reduceMotion:p=!1})=>{if(!e||e.length<2)return null;let d="",C=null;return i.forEach((b,v)=>{const r=e.find(l=>l.id===b.id);if(r&&r[y]!==null&&r[y]!==void 0&&!r.ignored){const l=w(v),c=x(r[y]);C!==null&&v===C+1?d+=` L ${l} ${c}`:d+=`${d?" ":""}M ${l} ${c}`,C=v}}),d.includes("L")?t.jsxs(t.Fragment,{children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),t.jsx("stop",{offset:"30%",stopColor:"#EC4899"}),t.jsx("stop",{offset:"70%",stopColor:"#E91E63"}),t.jsx("stop",{offset:"100%",stopColor:"#C2185B"})]}),t.jsxs("linearGradient",{id:"tempLineGradientChartGlow",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(244, 114, 182, 0.6)"}),t.jsx("stop",{offset:"30%",stopColor:"rgba(236, 72, 153, 0.7)"}),t.jsx("stop",{offset:"70%",stopColor:"rgba(233, 30, 99, 0.8)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(194, 24, 91, 0.6)"})]}),t.jsxs("filter",{id:"lineGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"4",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsx("filter",{id:"lineShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:t.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"3",floodColor:"rgba(244, 114, 182, 0.4)"})})]}),p?t.jsx("path",{d,fill:"none",stroke:"url(#tempLineGradientChartGlow)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:.4,style:{filter:"url(#lineGlow)"}}):t.jsx(V.path,{d,fill:"none",stroke:"url(#tempLineGradientChartGlow)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:.4,style:{filter:"url(#lineGlow)"},initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.4},transition:{duration:.8,ease:"easeInOut",delay:.2}}),p?t.jsx("path",{d,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#lineShadow)"}}):t.jsx(V.path,{d,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#lineShadow)"},initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:1},transition:{duration:1,ease:"easeInOut",delay:.4}}),p?t.jsx("path",{d,fill:"none",stroke:"rgba(255, 255, 255, 0.6)",strokeWidth:"0.3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.8}):t.jsx(V.path,{d,fill:"none",stroke:"rgba(255, 255, 255, 0.6)",strokeWidth:"0.3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.8,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.8},transition:{duration:1.2,ease:"easeInOut",delay:.6}})]}):null},bt="#1565C0",wt="#2E7D32",Ct="#6A1B9A",Wt="#EFF6FF",Rt="#EEF2FF",Ot="#ECFDF5",Nt="#F0FDFA",$t="#F5F3FF",_t="#FAF5FF",Dt="rgba(148, 163, 184, 0.35)",Pt="rgba(226, 232, 240, 0.6)",Ft="rgba(148, 163, 184, 0.5)",Yt=e=>{if(!e)return"";const[i,w]=e.split("/");return`${parseInt(i,10)}/${parseInt(w,10)}`},yt=(e="",i,w,x="–")=>{if(!e)return[x,""];if(e.length<=i)return[e,""];if(w)return[e.slice(0,i),""];const E=e.indexOf(" ",i);return E===-1?[e.slice(0,i),e.slice(i)]:[e.slice(0,E),e.slice(E+1)]},mt=(e="",i,w="–")=>e?e.split(/\s+/).slice(0,i).join(" "):w,Ut=({data:e,getX:i,getY:w,isFullScreen:x,orientation:E,responsiveFontSize:y,onPointInteraction:p,clearActivePoint:d,activePoint:C,padding:b,chartHeight:v,chartWidth:r,temperatureField:l="temperature_chart",textRowHeight:c,compact:f=!1,reduceMotion:h=!1,showInterpretation:u=!1,ovulationDetails:T=null})=>{const D={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},S={hidden:{opacity:0,scale:.3},visible:{opacity:1,scale:1,transition:{duration:.6,ease:[.34,1.56,.64,1],type:"spring",stiffness:120,damping:12}}},O=v-b.bottom,Z=O+c*1,rt=O+c*2,N=O+c*3,$=O+c*(x?5:4.5),tt=O+c*(x?7:6),X=O+c*(x?9:7.5),J=r-b.left-b.right,z=c*(x?2:1.5),it=h?"g":V.g;return t.jsxs(t.Fragment,{children:[t.jsxs("defs",{children:[t.jsx("filter",{id:"rowShadowChart",x:"-10%",y:"-10%",width:"120%",height:"120%",children:t.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"4",floodColor:"rgba(244, 114, 182, 0.2)"})}),t.jsxs("filter",{id:"pointGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsxs("linearGradient",{id:"sensationGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:Wt}),t.jsx("stop",{offset:"100%",stopColor:Rt})]}),t.jsxs("linearGradient",{id:"appearanceGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:Ot}),t.jsx("stop",{offset:"100%",stopColor:Nt})]}),t.jsxs("linearGradient",{id:"observationGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:$t}),t.jsx("stop",{offset:"100%",stopColor:_t})]}),t.jsxs("radialGradient",{id:"tempPointGradientChart",cx:"30%",cy:"30%",children:[t.jsx("stop",{offset:"0%",stopColor:"#FCE7F3"}),t.jsx("stop",{offset:"40%",stopColor:"#F472B6"}),t.jsx("stop",{offset:"80%",stopColor:"#E91E63"}),t.jsx("stop",{offset:"100%",stopColor:"#C2185B"})]}),t.jsxs("radialGradient",{id:"tempPointIgnoredGradient",cx:"30%",cy:"30%",children:[t.jsx("stop",{offset:"0%",stopColor:"#FFFFFF"}),t.jsx("stop",{offset:"80%",stopColor:"#F8FAFC"}),t.jsx("stop",{offset:"100%",stopColor:"#E2E8F0"})]}),t.jsxs("radialGradient",{id:"ovulationPointGradient",cx:"30%",cy:"30%",children:[t.jsx("stop",{offset:"0%",stopColor:"#bfdbfe"}),t.jsx("stop",{offset:"45%",stopColor:"#60a5fa"}),t.jsx("stop",{offset:"85%",stopColor:"#2563eb"}),t.jsx("stop",{offset:"100%",stopColor:"#1d4ed8"})]})]}),!f&&t.jsxs("g",{children:[t.jsx("rect",{x:b.left,y:$-z/2,width:J,height:z,fill:"url(#sensationGradientChart)",rx:4,style:{filter:"url(#rowShadowChart)"}}),t.jsx("rect",{x:b.left,y:tt-z/2,width:J,height:z,fill:"url(#appearanceGradientChart)",rx:4,style:{filter:"url(#rowShadowChart)"}}),t.jsx("rect",{x:b.left,y:X-z/2,width:J,height:z,fill:"url(#observationGradientChart)",rx:4,style:{filter:"url(#rowShadowChart)"}})]}),x&&E!=="portrait"&&t.jsx(V.g,{variants:D,children:[{label:"Fecha",row:1,color:x?"#374151":"#6B7280"},{label:"Día",row:2,color:x?"#374151":"#6B7280"},{label:"Símbolo",row:3,color:x?"#374151":"#6B7280"},{label:"Sens.",row:x?5:4.5,color:bt},{label:"Apar.",row:x?7:6,color:wt},{label:"Observ.",row:x?9:7.5,color:Ct}].map(({label:n,row:H,color:L})=>t.jsx("text",{x:b.left-y(.5),y:O+c*H,textAnchor:"end",fontSize:y(1.05),fontWeight:"700",fill:L,style:{filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:n},n))}),e.map((n,H)=>{const L=i(H),m=n[l]!=null?w(n[l]):O,F=n.temperature_raw,Y=n.temperature_corrected,Q=n.use_corrected&&F!=null&&Y!=null&&Math.abs(Y-F)>.01,K=Q?w(F):null,lt=x?"#374151":"#6B7280",s=n[l]!=null,j=s||n.mucus_sensation||n.mucus_appearance||n.fertility_symbol,o=String(n.id||"").startsWith("placeholder-"),a=u&&(T==null?void 0:T.confirmed)&&!n.ignored&&s&&H===T.confirmationIndex,A=!j||o?{}:{pointerEvents:"all",style:{cursor:"pointer"},onMouseEnter:_=>p(n,H,_),onClick:_=>p(n,H,_)},G=At(n.fertility_symbol);let R="transparent";if(G!=null&&G.color){const _=G.color.replace(/^bg-/,"");_==="red-500"?R="#ef4444":_==="white"?R="#ffffff":_==="green-500"?R="#22c55e":_==="pink-300"&&(R="#f9a8d4")}const k=y(x?1.8:2),I=n.isoDate?Gt(ft(Lt(n.isoDate)),ft(new Date)):!1,q=x?4:9,ot=2,[st,dt]=yt(x?mt(n.mucus_sensation,ot,I?"":"–"):n.mucus_sensation,q,!1,I?"":"–"),[ht,at]=yt(x?mt(n.mucus_appearance,ot,I?"":"–"):n.mucus_appearance,q,!1,I?"":"–"),[xt,ct]=yt(x?mt(n.observations,ot,""):n.observations,q,!1,"");return t.jsxs(it,{...h?{}:{variants:D},...A,children:[s&&t.jsxs(it,{...h?{}:{variants:S},children:[Q&&K!==null&&t.jsxs("g",{pointerEvents:"none",children:[t.jsx("line",{x1:L,y1:K,x2:L,y2:m,stroke:Dt,strokeWidth:1,strokeDasharray:"4 4"}),t.jsx("circle",{cx:L,cy:K,r:3.5,fill:Pt,stroke:Ft,strokeWidth:1}),t.jsx("circle",{cx:L,cy:K,r:1.2,fill:"rgba(255, 255, 255, 0.6)"})]}),t.jsx("circle",{cx:L,cy:m,r:a?2:1.5,fill:a?"rgba(59, 130, 246, 0.28)":"rgba(244, 114, 182, 0.2)",opacity:.85,style:{filter:"url(#pointGlow)"}}),t.jsx("circle",{cx:L,cy:m,r:a?4.2:3.5,fill:"none",stroke:n.ignored?"rgba(148, 163, 184, 0.4)":a?"rgba(37, 99, 235, 0.55)":"rgba(244, 114, 182, 0.3)",strokeWidth:a?2:1.5,opacity:a?.9:.6}),t.jsx("circle",{cx:L,cy:m,r:a?4.6:4,fill:n.ignored?"url(#tempPointIgnoredGradient)":a?"url(#ovulationPointGradient)":"url(#tempPointGradientChart)",stroke:n.use_corrected?"#F59E0B":n.ignored?"#94A3B8":a?"#1d4ed8":"#E91E63",strokeWidth:n.ignored?2:a?3.2:3,style:{filter:a?"drop-shadow(0 3px 8px rgba(37, 99, 235, 0.45))":"drop-shadow(0 3px 6px rgba(244, 114, 182, 0.4))",cursor:"pointer"},pointerEvents:"all",onMouseEnter:_=>p(n,H,_),onTouchStart:_=>p(n,H,_),onClick:_=>p(n,H,_)}),!n.ignored&&t.jsx("circle",{cx:L,cy:m,r:a?1.8:1.5,fill:a?"rgba(239, 246, 255, 0.95)":"rgba(255, 255, 255, 0.9)",style:{filter:a?"drop-shadow(0 1px 3px rgba(37, 99, 235, 0.45))":"drop-shadow(0 1px 2px rgba(244, 114, 182, 0.3))"}}),a&&t.jsx("circle",{cx:L,cy:m,r:6.5,fill:"none",stroke:"rgba(37, 99, 235, 0.35)",strokeWidth:1.2,strokeDasharray:"4 3"})]}),t.jsx("text",{x:L,y:Z,textAnchor:"middle",fontSize:y(1.05),fontWeight:"900",fill:lt,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:Yt(n.date)}),t.jsx("text",{x:L,y:rt,textAnchor:"middle",fontSize:y(1),fontWeight:"900",fill:lt,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:n.cycleDay}),!o&&(G.value!=="none"?t.jsxs("g",{children:[t.jsx("rect",{x:L-k/2+1,y:N-k*.75+1,width:k,height:k,fill:"rgba(0, 0, 0, 0.1)",rx:k*.3,opacity:.5}),t.jsx("rect",{x:L-k/2-4,y:N-k*.75,width:k*1.4,height:k,fill:G.pattern==="spotting-pattern"?"url(#spotting-pattern-chart)":R,stroke:G.value==="white"?"#CBD5E1":"rgba(233, 30, 99, 0.4)",strokeWidth:G.value==="white"?2:1,rx:k*.2,style:{filter:"drop-shadow(0 2px 4px rgba(244, 114, 182, 0.25))"}})]}):t.jsx("text",{x:L,y:N,textAnchor:"middle",fontSize:y(1),fill:lt,fontWeight:"500",style:{filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:"–"})),!f&&t.jsxs("text",{x:L,y:$,textAnchor:"middle",fontSize:y(.9),fontWeight:"700",fill:bt,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[t.jsx("tspan",{x:L,dy:0,children:st}),dt&&t.jsx("tspan",{x:L,dy:y(1.1),children:dt})]}),!f&&t.jsxs("text",{x:L,y:tt,textAnchor:"middle",fontSize:y(.9),fontWeight:"700",fill:wt,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[t.jsx("tspan",{x:L,dy:0,children:ht}),at&&t.jsx("tspan",{x:L,dy:y(1.1),children:at})]}),!f&&t.jsxs("text",{x:L,y:X,textAnchor:"middle",fontSize:y(.9),fontWeight:"700",fill:Ct,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[t.jsx("tspan",{x:L,dy:0,children:xt}),ct&&t.jsx("tspan",{x:L,dy:y(1.1),children:ct})]})]},`pt-${H}-${n.isoDate||n.timestamp}`)})]})},Vt="#1565C0",Xt="#2E7D32",zt="#6A1B9A",Ht=({padding:e,chartHeight:i,tempMin:w,tempMax:x,tempRange:E,getY:y,responsiveFontSize:p,textRowHeight:d,isFullScreen:C})=>{const b={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},v=[];if(E>0){const l=E<=2.5?.1:.5;for(let c=w;c<=x+1e-9;c+=l)v.push(parseFloat(c.toFixed(1)))}else for(let l=35;l<=37.5+1e-9;l+=.5)v.push(parseFloat(l.toFixed(1)));const r=i-e.bottom;return t.jsxs("svg",{width:e.left,height:i,className:"font-sans pointer-events-none",children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"legendBgGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(255, 228, 230, 1)"}),t.jsx("stop",{offset:"30%",stopColor:"rgba(255, 229, 235, 1)  "}),t.jsx("stop",{offset:"70%",stopColor:"rgba(255, 241, 242, 1)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(255, 236, 240, 0.6)"})]}),t.jsxs("linearGradient",{id:"legendAccentGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),t.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),t.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),t.jsx("filter",{id:"legendShadowChart",x:"-20%",y:"-20%",width:"140%",height:"140%",children:t.jsx("feDropShadow",{dx:"0",dy:"3",stdDeviation:"4",floodColor:"rgba(244, 114, 182, 0.2)"})}),t.jsx("filter",{id:"textShadowLegend",x:"-50%",y:"-50%",width:"200%",height:"200%",children:t.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodColor:"rgba(255, 255, 255, 0.9)"})})]}),t.jsx("rect",{x:0,y:r+d*.5,width:e.left,height:d*(C?9.5:8),fill:"url(#legendBgGradientChart)",rx:12,style:{filter:"url(#legendShadowChart)"}}),v.map((l,c)=>{const f=y(l),h=l.toFixed(1).endsWith(".0")||l.toFixed(1).endsWith(".5"),u=h?l.toFixed(1):`.${l.toFixed(1).split(".")[1]}`;return t.jsx(V.g,{variants:b,children:t.jsx("text",{x:e.left-p(1.2),y:f+p(.35),textAnchor:"end",fontSize:p(h?1.15:1),fontWeight:h?"800":"700",fill:h?"#E91E63":"#EC4899",style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:u})},`temp-tick-fixed-${c}`)}),t.jsx(V.g,{variants:b,children:[{label:"Fecha",row:1,color:"#374151",icon:null},{label:"Día",row:2,color:"#374151",icon:null},{label:"Símbolo",row:3,color:"#374151",icon:null},{label:"Sens.",row:C?5:4.5,color:Vt,icon:"◊"},{label:"Apar.",row:C?7:6,color:Xt,icon:"○"},{label:"Observ.",row:C?9:7.5,color:zt,icon:"✦"}].map(({label:l,row:c,color:f,icon:h})=>t.jsxs("g",{children:[h&&t.jsx("text",{x:e.left-p(2.8),y:r+d*c,textAnchor:"middle",fontSize:p(.8),fontWeight:"600",fill:f,opacity:.7,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:h}),t.jsx("text",{x:e.left-p(.8),y:r+d*c,textAnchor:"end",fontSize:p(1.05),fontWeight:"800",fill:f,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:l})]},l))})]})},Et=35.5,kt=37.5,Zt=(e=[])=>{const i=r=>r&&r.displayTemperature!=null&&!r.ignored,x=[];let E=null,y=null,p=null;const d=r=>{if(!r||r.length!==6)return null;const l=r.map(f=>f.temp);return l.some(f=>!Number.isFinite(f))?null:{baselineTemp:l.reduce((f,h)=>h>f?h:f,l[0]),baselineStartIndex:r[0].index}};for(let r=0;r<e.length;r++){const l=e[r];if(!i(l))continue;const c=l.displayTemperature;if(Number.isFinite(c)){if(x.length===6){const f=d(x);if(f&&(E=f.baselineTemp,y=f.baselineStartIndex,c>E)){p=r;break}}x.push({index:r,temp:c}),x.length>6&&x.shift()}}if(E==null&&x.length===6){const r=d(x);r&&(E=r.baselineTemp,y=r.baselineStartIndex)}const C={confirmed:!1,confirmationIndex:null,infertileStartIndex:null,rule:null,highSequenceIndices:[]};if(E==null||p==null)return{baselineTemp:E,baselineStartIndex:y,firstHighIndex:p,ovulationDetails:C};const b=r=>{if(!r||r.length<3)return null;const l=E+.2,c=r.slice(0,3);if(c.length<3)return null;const f=c.filter(h=>h.temp<l).length;return f===0?{confirmationIndex:c[2].index,usedIndices:c.map(h=>h.index),rule:"3-high"}:f===1?r.length>=4&&r[3].temp>E?{confirmationIndex:r[3].index,usedIndices:r.slice(0,4).map(h=>h.index),rule:"4-high"}:null:f>=2&&r.length>=5&&r[4].temp>=l?{confirmationIndex:r[4].index,usedIndices:r.slice(0,5).map(h=>h.index),rule:"5-high"}:null};let v=C;for(let r=p;r<e.length;r++){const l=e[r];if(!i(l)||l.displayTemperature<=E)continue;const c=[];for(let h=r;h<e.length&&c.length<5;h++){const u=e[h];if(!i(u)||u.displayTemperature<=E)break;c.push({index:h,temp:u.displayTemperature})}const f=b(c);if(f){v={confirmed:!0,confirmationIndex:f.confirmationIndex,infertileStartIndex:f.confirmationIndex+1,rule:f.rule,highSequenceIndices:f.usedIndices};break}}return{baselineTemp:E,baselineStartIndex:y,firstHighIndex:p,ovulationDetails:v}},Kt=(e,i,w,x,E,y=5,p=!1)=>{const d=W.useRef(null),C=W.useRef(null),[b,v]=W.useState({width:0,height:0}),[r,l]=W.useState(null),[c,f]=W.useState({x:0,y:0}),h=W.useMemo(()=>{const s=o=>{if(o==null||o==="")return null;const a=parseFloat(String(o).replace(",","."));return Number.isFinite(a)?a:null},j=o=>{if(!o)return null;const a=s(o.temperature),A=s(o.temperature_corrected);return o.use_corrected&&A!==null?A:a!==null?a:A!==null?A:null};return e.map(o=>{const a=[o==null?void 0:o.temperature_chart,o==null?void 0:o.temperature_raw,o==null?void 0:o.temperature_corrected];let A=null;for(const G of a)if(G!=null&&G!==""){A=G;break}if(A==null&&Array.isArray(o==null?void 0:o.measurements)){const R=o.measurements.find(k=>k&&k.selected&&j(k)!==null)||o.measurements.find(k=>j(k)!==null);R&&(A=j(R))}return{...o,displayTemperature:s(A)}})},[e]);W.useLayoutEffect(()=>{const s=()=>{if(!d.current)return;const o=d.current.parentElement||d.current;let a=o.clientWidth||600,A=o.clientHeight||400,G=d.current.clientWidth>0?d.current.clientWidth:a,R,k;if(i){let I=window.innerWidth,q=window.innerHeight;if(p&&q>I&&([I,q]=[q,I]),G=I,w==="portrait"&&!p){const ot=Math.max(30,I*.05);R=(I-ot)/y*e.length}else R=I/y*e.length;k=q}else R=G/y*e.length,k=A;v({width:R,height:k})};s(),window.addEventListener("resize",s);let j;if(d.current){const o=d.current.parentElement||d.current;j=new ResizeObserver(s),j.observe(o)}return()=>{window.removeEventListener("resize",s),j&&j.disconnect()}},[i,e.length,y,w,p]);const u=W.useMemo(()=>h.filter(s=>s&&s.isoDate&&!s.ignored&&s.displayTemperature!==null&&s.displayTemperature!==void 0),[h]),T=W.useMemo(()=>h.filter(s=>s&&s.isoDate),[h]),{baselineTemp:D,baselineStartIndex:S,firstHighIndex:O,ovulationDetails:Z}=W.useMemo(()=>Zt(h),[h]),{tempMin:rt,tempMax:N}=W.useMemo(()=>{const s=u.map(a=>a.displayTemperature).filter(a=>a!=null);if(s.length===0)return{tempMin:Et,tempMax:kt};let j=Math.min(...s,Et),o=Math.max(...s,kt);if(j=Math.floor(j*2)/2,o=Math.ceil(o*2)/2,o-j<2){const a=(j+o)/2;j=a-1,o=a+1}return{tempMin:j,tempMax:o}},[u]),$=N-rt,tt=b.width,X=b.height,J=9,z=(s=1)=>{if(!i)return J*s;const j=Math.min(tt,X);return Math.max(8,Math.min(J*s,j/(T.length>0?40/s:40)))},it=z(i?1.6:2.5),n=p||w==="landscape",L=it*(n?9:5),m={top:i?Math.max(n?6:12,X*(n?.015:.03)):12,right:i?Math.max(n?35:30,tt*(n?.02:.05)):50,bottom:(i?Math.max(n?0:40,X*(n?0:.11)):60)+L+25,left:i?Math.max(n?45:20,tt*(n?.02:.05)):50},F=s=>{if(s==null||$===0)return X-m.bottom;const j=X-m.top-m.bottom;return j<=0?X-m.bottom:X-m.bottom-(s-rt)/$*j},Y=s=>{const j=i&&!(p||w==="landscape")?5:10,o=i&&!(p||w==="landscape")?25:0,a=tt-m.left-m.right-j-o*(T.length-1);if(a<=0)return m.left+j+o*s;const A=T.length>1?T.length-1:1;return A===0||T.length===0?m.left+j+o*s:m.left+j+s*(a/(T.length===1?1:A))+o*s},Q=(s,j,o)=>{if(!s||String(s.id).startsWith("placeholder-")){K();return}const a=d.current.getBoundingClientRect();let A,G;if(o.type.startsWith("touch")){const I=o.changedTouches[0];A=I.clientX,G=I.clientY}else A=o.clientX,G=o.clientY;const R=Y(j),k=F(s.displayTemperature);f({svgX:R,svgY:k,clientX:A-a.left+d.current.scrollLeft,clientY:G-a.top+d.current.scrollTop}),l(s)};W.useEffect(()=>{const s=j=>{var o;if(C.current&&!C.current.contains(j.target)){const a=(o=d.current)==null?void 0:o.querySelectorAll("circle, text, rect");let A=!1;if(a){for(let G of a)if(G.contains(j.target)){A=!0;break}}A||l(null)}};return r&&(document.addEventListener("mousedown",s),document.addEventListener("touchstart",s)),()=>{document.removeEventListener("mousedown",s),document.removeEventListener("touchstart",s)}},[r]);const K=()=>{l(null)};return{chartRef:d,tooltipRef:C,dimensions:b,activePoint:r,tooltipPosition:c,processedData:h,validDataForLine:u,allDataPoints:T,tempMin:rt,tempMax:N,tempRange:$,padding:m,textRowHeight:it,setActivePoint:l,getY:F,getX:Y,handlePointInteraction:Q,clearActivePoint:K,handleToggleIgnore:s=>{x&&s&&(x(E,s),l(null))},responsiveFontSize:z,baselineTemp:D,baselineStartIndex:S,firstHighIndex:O,ovulationDetails:Z}},re=({data:e,isFullScreen:i,orientation:w,onToggleIgnore:x,onEdit:E,cycleId:y,initialScrollIndex:p=0,visibleDays:d=5,showInterpretation:C=!1,reduceMotion:b=!1,forceLandscape:v=!1})=>{const{chartRef:r,tooltipRef:l,dimensions:c,activePoint:f,tooltipPosition:h,allDataPoints:u,validDataForLine:T,tempMin:D,tempMax:S,tempRange:O,padding:Z,textRowHeight:rt,getY:N,getX:$,handlePointInteraction:tt,handleToggleIgnore:X,responsiveFontSize:J,clearActivePoint:z,setActivePoint:it,baselineTemp:n,baselineStartIndex:H,firstHighIndex:L,ovulationDetails:m}=Kt(e,i,w,x,y,d,v);if(!u||u.length===0)return t.jsxs("div",{className:"text-center p-8",children:[t.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-pink-100 to-rose-100 rounded-full mb-4",children:t.jsx("svg",{className:"w-8 h-8 text-pink-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),t.jsx("p",{className:"text-slate-400 font-medium",children:"No hay datos para mostrar en el gráfico"})]});const F=c.width,Y=c.height,Q=n!=null?N(n):null,K=!!(m!=null&&m.confirmed),lt=n!=null,s=$(0),j=u.length>0?$(u.length-1):F-Z.right,o=K?"#F59E0B":"#94A3B8",a=K?"6 4":"4 4",A=K?1:.7,G=3,R=F===0,k=Y-Z.bottom,I=W.useMemo(()=>{const B=new Map;return T.forEach(M=>{M&&M.id!=null&&B.set(M.id,M)}),B},[T]),q=W.useMemo(()=>{if(!C||!(m!=null&&m.confirmed))return[];const B=[];let M=[],et=null;for(let g=0;g<u.length;g++){const P=u[g],U=I.get(P==null?void 0:P.id);if(!(U&&g<=m.confirmationIndex)){M.length>0&&(B.push(M),M=[]),et=null;continue}const pt=$(g),ut=N(U.displayTemperature);M.length>0&&et!==null&&g!==et+1&&(B.push(M),M=[]),M.push({x:pt,y:ut,index:g}),et=g}return M.length>0&&B.push(M),B.filter(g=>g.length>=2).map(g=>{let P=`M ${g[0].x} ${k} L ${g[0].x} ${g[0].y}`;for(let U=1;U<g.length;U++){const nt=g[U];P+=` L ${nt.x} ${nt.y}`}return P+=` L ${g[g.length-1].x} ${k} Z`,P})},[C,m,u,I,$,N,k]),ot=W.useMemo(()=>{if(!C||!(m!=null&&m.confirmed))return[];if(m.infertileStartIndex==null)return[];const B=[];let M=[],et=null;for(let g=0;g<u.length;g++){const P=u[g],U=I.get(P==null?void 0:P.id);if(!(U&&g>=m.infertileStartIndex)){M.length>0&&(B.push(M),M=[]),et=null;continue}const pt=$(g),ut=N(U.displayTemperature);M.length>0&&et!==null&&g!==et+1&&(B.push(M),M=[]),M.push({x:pt,y:ut,index:g}),et=g}return M.length>0&&B.push(M),B.filter(g=>g.length>=2).map(g=>{let P=`M ${g[0].x} ${k} L ${g[0].x} ${g[0].y}`;for(let U=1;U<g.length;U++){const nt=g[U];P+=` L ${nt.x} ${nt.y}`}return P+=` L ${g[g.length-1].x} ${k} Z`,P})},[C,m,u,I,$,N,k]),[st,dt]=W.useState({w:typeof window<"u"?window.innerWidth:0,h:typeof window<"u"?window.innerHeight:0}),ht=st.w<st.h;W.useEffect(()=>{const B=()=>dt({w:window.innerWidth,h:window.innerHeight});return window.addEventListener("resize",B),window.addEventListener("orientationchange",B),()=>{window.removeEventListener("resize",B),window.removeEventListener("orientationchange",B)}},[]),W.useEffect(()=>{if(!r.current)return;const B=r.current.clientWidth/d;r.current.scrollLeft=Math.max(0,B*p)},[p,d,c.width,w]);const at=v&&ht,xt=at,ct="w-full h-full bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100",_=i?`${ct} min-h-full ${xt?"flex items-stretch justify-start overflow-y-auto overflow-x-hidden":"flex items-center justify-start overflow-x-auto overflow-y-hidden"}`:`${ct} overflow-x-auto overflow-y-hidden border border-pink-100/50`,gt=!i||w==="portrait";return t.jsxs(V.div,{className:"relative w-full h-full",initial:!1,children:[gt&&t.jsx("div",{className:"absolute left-0 top-0 h-full bg-transparent pointer-events-none z-10",style:{width:Z.left},children:t.jsx(Ht,{padding:Z,chartHeight:Y,tempMin:D,tempMax:S,tempRange:O,getY:N,responsiveFontSize:J,textRowHeight:rt,isFullScreen:i})}),t.jsxs(V.div,{ref:r,className:`relative p-0 ${i?"":"rounded-2xl"} ${_}`,style:{boxShadow:i?"inset 0 1px 3px rgba(244, 114, 182, 0.1)":"0 8px 32px rgba(244, 114, 182, 0.12), 0 2px 8px rgba(244, 114, 182, 0.08)",...at?{position:"absolute",top:0,left:0,width:`${st.h}px`,height:`${st.w}px`,transform:"rotate(90deg) translateY(-100%)",transformOrigin:"top left"}:{}},initial:!1,children:[R&&t.jsx("div",{className:"flex items-center justify-center w-full h-full text-slate-400",children:"Cargando..."}),t.jsxs(V.svg,{width:F,height:Y,className:"font-sans flex-shrink-0",viewBox:`0 0 ${F} ${Y}`,preserveAspectRatio:"xMidYMid meet",initial:!1,children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),t.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),t.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),t.jsxs("linearGradient",{id:"tempAreaGradientChart",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(244,114,182,0.25)"}),t.jsx("stop",{offset:"50%",stopColor:"rgba(236,72,153,0.15)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(233,30,99,0.05)"})]}),t.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[t.jsx("rect",{width:"6",height:"6",fill:"#f3f4f6"}),t.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(239,68,68,0.7)"})]}),t.jsxs("filter",{id:"chartShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsxs("filter",{id:"baselineGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsxs("linearGradient",{id:"fertileAreaGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(96, 165, 250, 0.35)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(59, 130, 246, 0.12)"})]}),t.jsxs("linearGradient",{id:"infertileAreaGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(196, 181, 253, 0.32)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(167, 139, 250, 0.12)"})]})]}),t.jsx("rect",{width:"100%",height:"100%",fill:"transparent"}),t.jsx(St,{padding:Z,chartWidth:F,chartHeight:Y,tempMin:D,tempMax:S,tempRange:O,getY:N,getX:$,allDataPoints:u,responsiveFontSize:J,isFullScreen:i,showLeftLabels:!gt,reduceMotion:b}),C&&(m==null?void 0:m.confirmed)&&t.jsxs(t.Fragment,{children:[q.map((B,M)=>t.jsx("path",{d:B,fill:"url(#fertileAreaGradient)",opacity:.65,pointerEvents:"none"},`fertile-area-${M}`)),ot.map((B,M)=>t.jsx("path",{d:B,fill:"url(#infertileAreaGradient)",opacity:.6,pointerEvents:"none"},`infertile-area-${M}`))]}),C&&lt&&Q!==null&&(b?t.jsx("line",{x1:s,y1:Q,x2:j,y2:Q,stroke:o,strokeWidth:G,strokeDasharray:a,opacity:A}):t.jsx(V.path,{d:`M ${s} ${Q} L ${j} ${Q}`,stroke:o,strokeWidth:G,strokeDasharray:a,opacity:A,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:A},transition:{duration:4,ease:"easeInOut",delay:.5}})),t.jsx(vt,{data:T,allDataPoints:u,getX:$,getY:N,baselineY:Y-Z.bottom,temperatureField:"displayTemperature",reduceMotion:b}),t.jsx(Ut,{data:u,getX:$,getY:N,isFullScreen:i,orientation:w,responsiveFontSize:J,onPointInteraction:tt,clearActivePoint:z,activePoint:f,padding:Z,chartHeight:Y,chartWidth:F,temperatureField:"displayTemperature",textRowHeight:rt,compact:!1,reduceMotion:b,showInterpretation:C,ovulationDetails:m})]}),f&&t.jsx(V.div,{ref:l,initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:10},transition:{duration:.2,ease:"easeOut"},children:t.jsx(It,{point:f,position:h,chartWidth:F,chartHeight:Y,onToggleIgnore:X,onEdit:E,onClose:z})})]})]})};function oe(e,i){if(!e||!i)return[];const w=typeof e=="string"?Lt(e):e;return[...Array(i)].map((x,E)=>{const y=Tt(w,E),p=jt(y,"yyyy-MM-dd"),d=jt(y,"dd/MM"),C=Bt(ft(y),ft(w))+1;return{date:d,isoDate:p,cycleDay:C,temperature:null,mucusSensation:null,mucusAppearance:null,id:`placeholder-${p}`,ignored:!1}})}export{re as F,ee as R,oe as g};
