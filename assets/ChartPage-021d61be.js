import{c as it,m as ie,j as e,r as x,s as Ae,p as De,D as lt,e as at,f as Ge,d as Xe,h as ct,M as Fe,B as Re,L as Ye}from"./index-65a39a90.js";import{g as dt,i as ht,c as ut,D as ft}from"./computePeakStatuses-9c417235.js";import{C as pt}from"./ChartTooltip-35e03b20.js";import{u as xt,D as mt,a as gt}from"./useCycleData-834d83be.js";import{A as yt}from"./arrow-left-d976c708.js";import{E as bt}from"./eye-off-a74b0232.js";import{E as wt}from"./eye-020a87c7.js";import"./input-49c2a17b.js";import"./label-61f7cfb2.js";import"./select-e07d8604.js";import"./badge-b2616664.js";const jt=it("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),kt=({padding:r,chartWidth:c,chartHeight:N,tempMin:v,tempMax:X,tempRange:C,getY:M,getX:b,allDataPoints:m=[],responsiveFontSize:u,isFullScreen:$,showLeftLabels:q=!1,reduceMotion:j=!1})=>{const k={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.3,ease:"easeOut"}}},D=[];if(C>0){const i=C<=2.5?.1:.5;for(let p=v;p<=X+1e-9;p+=i)D.push(parseFloat(p.toFixed(1)))}else for(let i=35;i<=37.5+1e-9;i+=.5)D.push(parseFloat(i.toFixed(1)));const o=j?"g":ie.g;return e.jsxs(e.Fragment,{children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"bgGradientChart",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(254, 242, 242, 0.95)"}),e.jsx("stop",{offset:"30%",stopColor:"rgba(255, 241, 242, 0.9)"}),e.jsx("stop",{offset:"70%",stopColor:"rgba(255, 245, 255, 0.95)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(254, 242, 242, 0.8)"})]}),e.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),e.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),e.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),e.jsxs("filter",{id:"chartGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsx("filter",{id:"textShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodColor:"rgba(255, 255, 255, 0.8)"})}),e.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[e.jsx("rect",{width:"6",height:"6",fill:"#ef4444"}),e.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(255,255,255,0.85)"})]})]}),e.jsx("rect",{x:r.left,y:r.top,width:c-r.left-r.right,height:N-r.top-r.bottom,fill:"url(#bgGradientChart)",opacity:2,rx:12,style:{filter:"drop-shadow(0 4px 12px rgba(244, 114, 182, 0.1))"}}),D.map((i,p)=>{const w=M(i),n=i.toFixed(1).endsWith(".0")||i.toFixed(1).endsWith(".5"),B=n?i.toFixed(1):`.${i.toFixed(1).split(".")[1]}`;return e.jsxs(o,{...j?{}:{variants:k},children:[e.jsx("line",{x1:r.left,y1:w,x2:c-r.right,y2:w,stroke:n?"rgba(244, 114, 182, 0.3)":"rgba(244, 114, 182, 0.15)",strokeWidth:n?3:2,strokeDasharray:n?"0":"4,4",style:{filter:n?"drop-shadow(0 1px 3px rgba(244, 114, 182, 0.15))":"none",opacity:n?1:.7}}),q&&e.jsx("text",{x:r.left-u(1),y:w+u(.35),textAnchor:"end",fontSize:u(n?1.1:1),fontWeight:n?"700":"600",fill:n?"#E91E63":"#EC4899",style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:B}),e.jsx("text",{x:c-r.right+u(1),y:w+u(.35),textAnchor:"start",fontSize:u(n?1.1:1),fontWeight:n?"700":"600",fill:n?"#E91E63":"#EC4899",style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:B})]},`temp-tick-${p}`)}),m.map((i,p)=>{const w=b(p);return e.jsx("line",{x1:w,y1:r.top,x2:w,y2:N-r.bottom,stroke:"rgba(244, 114, 182, 0.08)",strokeWidth:2.8,style:{filter:"drop-shadow(0 0 1px rgba(244, 114, 182, 0.05))"}},`day-grid-${p}`)}),e.jsx("rect",{x:r.left,y:r.top,width:c-r.left-r.right,height:N-r.top-r.bottom,fill:"none",stroke:"rgba(244, 114, 182, 0.4)",strokeWidth:4,rx:8,style:{filter:"drop-shadow(0 4px 12px rgba(244, 114, 182, 0.15))",strokeDasharray:"0"}}),q&&e.jsx(o,{...j?{}:{variants:k},children:e.jsx("text",{x:r.left+u(1.2),y:r.top+u(1.5),textAnchor:"middle",fontSize:u(1.4),fontWeight:"800",fill:"#E91E63",style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:"°C"})})]})},Ct=({data:r,allDataPoints:c,getX:N,getY:v,baselineY:X,temperatureField:C="temperature",reduceMotion:M=!1})=>{if(!r||r.length<2)return null;let b="",m=null;const u=[];if(c.forEach((j,k)=>{const D=r.find(o=>o.id===j.id);if(D&&D[C]!==null&&D[C]!==void 0&&!D.ignored){const o=N(k),i=v(D[C]);u.push({x:o,y:i}),m!==null&&k===m+1?b+=` L ${o} ${i}`:b+=`${b?" ":""}M ${o} ${i}`,m=k}}),u.length<2)return null;const $=b.includes("L"),q=u.length>1?u.map(({x:j,y:k},D)=>`${D===0?"M":"L"} ${j} ${k}`).join(" "):"";return e.jsxs(e.Fragment,{children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),e.jsx("stop",{offset:"30%",stopColor:"#EC4899"}),e.jsx("stop",{offset:"70%",stopColor:"#E91E63"}),e.jsx("stop",{offset:"100%",stopColor:"#C2185B"})]}),e.jsxs("linearGradient",{id:"tempLineGradientChartGlow",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(244, 114, 182, 0.6)"}),e.jsx("stop",{offset:"30%",stopColor:"rgba(236, 72, 153, 0.7)"}),e.jsx("stop",{offset:"70%",stopColor:"rgba(233, 30, 99, 0.8)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(194, 24, 91, 0.6)"})]}),e.jsxs("filter",{id:"lineGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"4",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsx("filter",{id:"lineShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"3",floodColor:"rgba(244, 114, 182, 0.4)"})})]}),$&&(M?e.jsx("path",{d:b,fill:"none",stroke:"url(#tempLineGradientChartGlow)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:.4,style:{filter:"url(#lineGlow)"}}):e.jsx(ie.path,{d:b,fill:"none",stroke:"url(#tempLineGradientChartGlow)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:.4,style:{filter:"url(#lineGlow)"},initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.4},transition:{duration:.8,ease:"easeInOut",delay:.2}})),q&&(M?e.jsx("path",{d:q,fill:"none",stroke:"#d587b1",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.65}):e.jsx(ie.path,{d:q,fill:"none",stroke:"#d587b1",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.65,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.65},transition:{duration:.8,ease:"easeInOut"}})),$&&(M?e.jsx("path",{d:b,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#lineShadow)"}}):e.jsx(ie.path,{d:b,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#lineShadow)"},initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:1},transition:{duration:1,ease:"easeInOut",delay:.4}})),$&&(M?e.jsx("path",{d:b,fill:"none",stroke:"rgba(255, 255, 255, 0.6)",strokeWidth:"0.3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.8}):e.jsx(ie.path,{d:b,fill:"none",stroke:"rgba(255, 255, 255, 0.6)",strokeWidth:"0.3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.8,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.8},transition:{duration:1.2,ease:"easeInOut",delay:.6}}))]})},Je="#1565C0",Qe="#2E7D32",Ze="#6A1B9A",It="#EFF6FF",Et="#EEF2FF",St="#ECFDF5",Mt="#F0FDFA",vt="#F5F3FF",Lt="#FAF5FF",At="rgba(148, 163, 184, 0.35)",Dt="rgba(226, 232, 240, 0.6)",Bt="rgba(148, 163, 184, 0.5)",et="✖",qe="#7f1d1d",Ve="#ec4899",tt="drop-shadow(0 2px 4px rgba(244, 114, 182, 0.35))",Pt="#be185d",Nt="#2563eb",_t=r=>{if(!r)return"";const[c,N]=r.split("/");return`${parseInt(c,10)}/${parseInt(N,10)}`},He=(r="",c,N,v="–")=>{if(!r)return[v,""];if(r.length<=c)return[r,""];if(N){const m=r.slice(0,c),u=r.slice(c,c*2);return[m,u]}const X=m=>{if(!m)return["",""];if(m.length<=c)return[m,""];const u=m.indexOf(" ",c);return u===-1?[m.slice(0,c),m.slice(c)]:[m.slice(0,u),m.slice(u+1)]},[C,M]=X(r),[b]=X(M.trimStart());return[C,b]},ze=(r="",c,N="–")=>r?r.split(/\s+/).slice(0,c).join(" "):N,Rt=({data:r,getX:c,getY:N,isFullScreen:v,orientation:X,responsiveFontSize:C,onPointInteraction:M,clearActivePoint:b,activePoint:m,padding:u,chartHeight:$,chartWidth:q,temperatureField:j="temperature_chart",textRowHeight:k,compact:D=!1,reduceMotion:o=!1,showInterpretation:i=!1,ovulationDetails:p=null,firstHighIndex:w=null,baselineIndices:n=[]})=>{const B={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},I={hidden:{opacity:0,scale:.3},visible:{opacity:1,scale:1,transition:{duration:.6,ease:[.34,1.56,.64,1],type:"spring",stiffness:120,damping:12}}},F=$-u.bottom,Q=F+k*1,g=F+k*2,K=F+k*3,P=F+k*(v?5:4.5),G=F+k*(v?7:6),te=F+k*(v?9:7.5),ce=q-u.left-u.right,re=k*(v?2:1.5),le=o?"g":ie.g,ae=Array.isArray(r)?r.length:0,pe=x.useMemo(()=>{if(!i)return new Map;const a=Array.isArray(p==null?void 0:p.highSequenceIndices)?p.highSequenceIndices:[],d=new Map;return a.forEach((y,V)=>{const R=Number(y);Number.isInteger(R)&&R>=0&&R<ae&&!d.has(R)&&d.set(R,V+1)}),d},[i,p,ae]),xe=x.useMemo(()=>{if(!i)return new Map;const a=Array.isArray(n)?n:[];if(!a.length)return new Map;const d=new Set,y=[],V=E=>{const J=Number(E);Number.isInteger(J)&&J>=0&&J<ae&&!d.has(J)&&(d.add(J),y.push(J))};if(a.forEach(E=>{V(E)}),w!=null){const E=Number(w);Number.isInteger(E)&&V(E-1)}if(!y.length)return new Map;const R=[...y].sort((E,J)=>E-J),U=new Map;let z=1;for(let E=R.length-1;E>=0&&!(z>6);E-=1)U.set(R[E],z),z+=1;return U},[i,n,ae,w]);return e.jsxs(e.Fragment,{children:[e.jsxs("defs",{children:[e.jsx("filter",{id:"rowShadowChart",x:"-10%",y:"-10%",width:"120%",height:"120%",children:e.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"4",floodColor:"rgba(244, 114, 182, 0.2)"})}),e.jsxs("filter",{id:"pointGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("linearGradient",{id:"sensationGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:It}),e.jsx("stop",{offset:"100%",stopColor:Et})]}),e.jsxs("linearGradient",{id:"appearanceGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:St}),e.jsx("stop",{offset:"100%",stopColor:Mt})]}),e.jsxs("linearGradient",{id:"observationGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:vt}),e.jsx("stop",{offset:"100%",stopColor:Lt})]}),e.jsxs("radialGradient",{id:"tempPointGradientChart",cx:"30%",cy:"30%",children:[e.jsx("stop",{offset:"0%",stopColor:"#FCE7F3"}),e.jsx("stop",{offset:"40%",stopColor:"#F472B6"}),e.jsx("stop",{offset:"80%",stopColor:"#E91E63"}),e.jsx("stop",{offset:"100%",stopColor:"#C2185B"})]}),e.jsxs("radialGradient",{id:"tempPointIgnoredGradient",cx:"30%",cy:"30%",children:[e.jsx("stop",{offset:"0%",stopColor:"#FFFFFF"}),e.jsx("stop",{offset:"80%",stopColor:"#F8FAFC"}),e.jsx("stop",{offset:"100%",stopColor:"#E2E8F0"})]}),e.jsxs("radialGradient",{id:"ovulationPointGradient",cx:"30%",cy:"30%",children:[e.jsx("stop",{offset:"0%",stopColor:"#bfdbfe"}),e.jsx("stop",{offset:"45%",stopColor:"#60a5fa"}),e.jsx("stop",{offset:"85%",stopColor:"#2563eb"}),e.jsx("stop",{offset:"100%",stopColor:"#1d4ed8"})]})]}),!D&&e.jsxs("g",{children:[e.jsx("rect",{x:u.left,y:P-re/2,width:ce,height:re,fill:"url(#sensationGradientChart)",rx:4,style:{filter:"url(#rowShadowChart)"}}),e.jsx("rect",{x:u.left,y:G-re/2,width:ce,height:re,fill:"url(#appearanceGradientChart)",rx:4,style:{filter:"url(#rowShadowChart)"}}),e.jsx("rect",{x:u.left,y:te-re/2,width:ce,height:re,fill:"url(#observationGradientChart)",rx:4,style:{filter:"url(#rowShadowChart)"}})]}),v&&X!=="portrait"&&e.jsx(ie.g,{variants:B,children:[{label:"Fecha",row:1,color:v?"#374151":"#6B7280"},{label:"Día",row:2,color:v?"#374151":"#6B7280"},{label:"Símbolo",row:3,color:v?"#374151":"#6B7280"},{label:"Sens.",row:v?5:4.5,color:Je},{label:"Apar.",row:v?7:6,color:Qe},{label:"Observ.",row:v?9:7.5,color:Ze}].map(({label:a,row:d,color:y})=>e.jsx("text",{x:u.left-C(.5),y:F+k*d,textAnchor:"end",fontSize:C(1.05),fontWeight:"700",fill:y,style:{filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:a},a))}),r.map((a,d)=>{const y=c(d),V=a[j]!=null?N(a[j]):F,R=a.temperature_raw,U=a.temperature_corrected,z=a.use_corrected&&R!=null&&U!=null&&Math.abs(U-R)>.01,E=z?N(R):null,J=v?"#374151":"#6B7280",de=a[j]!=null;de||a.mucus_sensation||a.mucus_appearance||a.fertility_symbol;const me=String(a.id||"").startsWith("placeholder-"),Me=p==null?void 0:p.peakDayIndex,s=i&&Me!=null&&!a.ignored&&de&&d===Me,f=dt(a.fertility_symbol);let l="transparent";if(f!=null&&f.color){const fe=f.color.replace(/^bg-/,"");fe==="red-500"?l="#ef4444":fe==="white"?l="#ffffff":fe==="green-500"?l="#22c55e":fe==="pink-300"?l="#f9a8d4":fe==="yellow-400"&&(l="#facc15")}const S=a.isoDate?ht(Ae(De(a.isoDate)),Ae(new Date)):!1,h=C(v?1.8:2),T=K-h*.75+h/2+2,O=a.peakStatus?String(a.peakStatus).toUpperCase():null,H=O==="P"||O==="X",W=O&&!H,se=H?et:O||"–",ge=H||["1","2","3"].includes(O),he=!me&&f.value!=="none",A=!!a.isoDate&&!S?{pointerEvents:"all",style:{cursor:"pointer"},onClick:fe=>M(a,d,fe)}:{},L=pe.has(d),ve=L?pe.get(d):null,Y=xe.has(d),oe=Y?xe.get(d):null,ue=C(v?.75:1.2),ye=Math.max(.5,ue*.18),Ce=V-ue*(v?2.6:1.8),ee=V+ue*(v?1.9:1.6),be=v?4:7,Ie=2,[Be,Le]=He(v?ze(a.mucus_sensation,Ie,S?"":"–"):a.mucus_sensation,be,!1,S?"":"–"),[$e,Te]=He(v?ze(a.mucus_appearance,Ie,S?"":"–"):a.mucus_appearance,be,!1,S?"":"–"),[Oe,We]=He(v?ze(a.observations,Ie,""):a.observations,be,!1,"");return e.jsxs(le,{...o?{}:{variants:B},...A,children:[de&&e.jsxs(le,{...o?{}:{variants:I},children:[z&&E!==null&&e.jsxs("g",{pointerEvents:"none",children:[e.jsx("line",{x1:y,y1:E,x2:y,y2:V,stroke:At,strokeWidth:1,strokeDasharray:"4 4"}),e.jsx("circle",{cx:y,cy:E,r:3.5,fill:Dt,stroke:Bt,strokeWidth:1}),e.jsx("circle",{cx:y,cy:E,r:1.2,fill:"rgba(255, 255, 255, 0.6)"})]}),e.jsx("circle",{cx:y,cy:V,r:s?2:1.5,fill:s?"rgba(59, 130, 246, 0.28)":"rgba(244, 114, 182, 0.2)",opacity:.85,style:{filter:"url(#pointGlow)"}}),e.jsx("circle",{cx:y,cy:V,r:s?4.2:3.5,fill:"none",stroke:a.ignored?"rgba(148, 163, 184, 0.4)":s?"rgba(37, 99, 235, 0.55)":"rgba(244, 114, 182, 0.3)",strokeWidth:s?2:1.5,opacity:s?.9:.6}),e.jsx("circle",{cx:y,cy:V,r:s?4.6:4,fill:a.ignored?"url(#tempPointIgnoredGradient)":s?"url(#ovulationPointGradient)":"url(#tempPointGradientChart)",stroke:a.use_corrected?"#F59E0B":a.ignored?"#94A3B8":s?"#1d4ed8":"#E91E63",strokeWidth:a.ignored?2:s?3.2:3,style:{filter:s?"drop-shadow(0 3px 8px rgba(37, 99, 235, 0.45))":"drop-shadow(0 3px 6px rgba(244, 114, 182, 0.4))",cursor:"pointer"},pointerEvents:"all",onClick:fe=>M(a,d,fe)}),!a.ignored&&e.jsx("circle",{cx:y,cy:V,r:s?1.8:1.5,fill:s?"rgba(239, 246, 255, 0.95)":"rgba(255, 255, 255, 0.9)",style:{filter:s?"drop-shadow(0 1px 3px rgba(37, 99, 235, 0.45))":"drop-shadow(0 1px 2px rgba(244, 114, 182, 0.3))"}}),s&&e.jsx("circle",{cx:y,cy:V,r:6.5,fill:"none",stroke:"rgba(37, 99, 235, 0.35)",strokeWidth:1.2,strokeDasharray:"4 3"}),i&&de&&!a.ignored&&L&&e.jsx("g",{pointerEvents:"none",children:e.jsx("text",{x:y,y:Ce,textAnchor:"middle",fontSize:ue,fontWeight:"900",fill:Pt,strokeWidth:ye,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',paintOrder:"stroke",filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:ve})}),i&&de&&!a.ignored&&Y&&e.jsx("g",{pointerEvents:"none",children:e.jsx("text",{x:y,y:ee,textAnchor:"middle",fontSize:ue,fontWeight:"800",fill:Nt,stroke:"#ffffff",strokeWidth:ye,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',paintOrder:"stroke",filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.85))"},children:oe})})]}),e.jsx("text",{x:y,y:Q,textAnchor:"middle",fontSize:C(1.05),fontWeight:"900",fill:J,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:_t(a.date)}),e.jsx("text",{x:y,y:g,textAnchor:"middle",fontSize:C(1),fontWeight:"900",fill:J,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:a.cycleDay}),he?e.jsxs("g",{children:[e.jsx("rect",{x:y-h/2+1,y:K-h*.75+1,width:h,height:h,fill:"rgba(0, 0, 0, 0.1)",rx:h*.3,opacity:.5}),e.jsx("rect",{x:y-h/2-4,y:K-h*.75,width:h*1.4,height:h,fill:f.pattern==="spotting-pattern"?"url(#spotting-pattern-chart)":l,stroke:f.value==="white"?"#CBD5E1":"rgba(233, 30, 99, 0.4)",strokeWidth:f.value==="white"?2:1,rx:h*.2,style:{filter:"drop-shadow(0 2px 4px rgba(244, 114, 182, 0.25))"}}),O&&e.jsx("g",{pointerEvents:"none",children:H?e.jsx("text",{x:y,y:T,textAnchor:"middle",fontSize:C(1.35),fontWeight:"900",fill:Ve,stroke:"#fff",strokeWidth:1.5,paintOrder:"stroke",style:{filter:tt},children:et}):e.jsx("text",{x:y,y:T,textAnchor:"middle",fontSize:C(O?1.1:1),fontWeight:"800",fill:qe,style:{filter:"drop-shadow(0 1px 1px rgba(255,255,255,0.9))"},children:O})})]}):e.jsxs("g",{children:[ge&&e.jsx("rect",{x:y-h/2-4,y:K-h*.75,width:h*1.4,height:h,fill:"transparent",stroke:H?Ve:qe,strokeWidth:1,rx:h*.2}),e.jsx("text",{x:y,y:T,textAnchor:"middle",fontSize:C(H?1.35:W?1.1:1),fill:H?Ve:W?qe:J,fontWeight:H?"900":W?"800":"500",style:{filter:H?tt:W?"drop-shadow(0 1px 1px rgba(255,255,255,0.9))":"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:se})]}),!D&&e.jsxs("text",{x:y,y:P,textAnchor:"middle",fontSize:C(.9),fontWeight:"700",fill:Je,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[e.jsx("tspan",{x:y,dy:0,children:Be}),Le&&e.jsx("tspan",{x:y,dy:C(1.1),children:Le})]}),!D&&e.jsxs("text",{x:y,y:G,textAnchor:"middle",fontSize:C(.9),fontWeight:"700",fill:Qe,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[e.jsx("tspan",{x:y,dy:0,children:$e}),Te&&e.jsx("tspan",{x:y,dy:C(1.1),children:Te})]}),!D&&e.jsxs("text",{x:y,y:te,textAnchor:"middle",fontSize:C(.9),fontWeight:"700",fill:Ze,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[e.jsx("tspan",{x:y,dy:0,children:Oe}),We&&e.jsx("tspan",{x:y,dy:C(1.1),children:We})]})]},`pt-${d}-${a.isoDate||a.timestamp}`)})]})},Tt="#1565C0",Ot="#2E7D32",Wt="#6A1B9A",Ft=({padding:r,chartHeight:c,tempMin:N,tempMax:v,tempRange:X,getY:C,responsiveFontSize:M,textRowHeight:b,isFullScreen:m})=>{const u={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},$=[];if(X>0){const j=X<=2.5?.1:.5;for(let k=N;k<=v+1e-9;k+=j)$.push(parseFloat(k.toFixed(1)))}else for(let j=35;j<=37.5+1e-9;j+=.5)$.push(parseFloat(j.toFixed(1)));const q=c-r.bottom;return e.jsxs("svg",{width:r.left,height:c,className:"font-sans pointer-events-none",children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"legendBgGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(255, 228, 230, 1)"}),e.jsx("stop",{offset:"30%",stopColor:"rgba(255, 229, 235, 1)  "}),e.jsx("stop",{offset:"70%",stopColor:"rgba(255, 241, 242, 1)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(255, 236, 240, 0.6)"})]}),e.jsxs("linearGradient",{id:"legendAccentGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),e.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),e.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),e.jsx("filter",{id:"legendShadowChart",x:"-20%",y:"-20%",width:"140%",height:"140%",children:e.jsx("feDropShadow",{dx:"0",dy:"3",stdDeviation:"4",floodColor:"rgba(244, 114, 182, 0.2)"})}),e.jsx("filter",{id:"textShadowLegend",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodColor:"rgba(255, 255, 255, 0.9)"})})]}),e.jsx("rect",{x:0,y:q+b*.5,width:r.left,height:b*(m?9.5:8),fill:"url(#legendBgGradientChart)",rx:12,style:{filter:"url(#legendShadowChart)"}}),$.map((j,k)=>{const D=C(j),o=j.toFixed(1).endsWith(".0")||j.toFixed(1).endsWith(".5"),i=o?j.toFixed(1):`.${j.toFixed(1).split(".")[1]}`;return e.jsx(ie.g,{variants:u,children:e.jsx("text",{x:r.left-M(1.2),y:D+M(.35),textAnchor:"end",fontSize:M(o?1.15:1),fontWeight:o?"800":"700",fill:o?"#E91E63":"#EC4899",style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:i})},`temp-tick-fixed-${k}`)}),e.jsx(ie.g,{variants:u,children:[{label:"Fecha",row:1,color:"#374151",icon:null},{label:"Día",row:2,color:"#374151",icon:null},{label:"Símbolo",row:3,color:"#374151",icon:null},{label:"Sens.",row:m?5:4.5,color:Tt,icon:"◊"},{label:"Apar.",row:m?7:6,color:Ot,icon:"○"},{label:"Observ.",row:m?9:7.5,color:Wt,icon:"✦"}].map(({label:j,row:k,color:D,icon:o})=>e.jsxs("g",{children:[o&&e.jsx("text",{x:r.left-M(2.8),y:q+b*k,textAnchor:"middle",fontSize:M(.8),fontWeight:"600",fill:D,opacity:.7,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:o}),e.jsx("text",{x:r.left-M(.8),y:q+b*k,textAnchor:"end",fontSize:M(1.05),fontWeight:"800",fill:D,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:j})]},j))})]})},nt=35.5,rt=37.5,Gt=(r=[])=>{var D;const c=o=>o&&o.displayTemperature!=null&&!o.ignored,X=o=>{if(!o||o.length!==6)return null;const i=o.map(n=>n.temp);if(i.some(n=>!Number.isFinite(n)))return null;const p=i.reduce((n,B)=>B>n?B:n,i[0]),w=i.reduce((n,B)=>B>=p-.05&&B<p?n+1:n,0);return w>=2?null:{baselineTemp:p,baselineStartIndex:o[0].index,baselineIndices:o.map(n=>n.index),baselineBorderlineCount:w}},C=o=>{const i=[];for(let p=o;p<r.length;p+=1){const w=r[p];if(!c(w))continue;const n=w.displayTemperature;if(Number.isFinite(n)&&(i.push({index:p,temp:n}),i.length>6&&i.shift(),i.length===6)){const B=X(i);if(!B)continue;let I=null;for(let F=p+1;F<r.length;F+=1){const Q=r[F];if(!c(Q))continue;const g=Q.displayTemperature;if(Number.isFinite(g)&&g>B.baselineTemp){I=F;break}}return{baselineTemp:B.baselineTemp,baselineStartIndex:B.baselineStartIndex,baselineIndices:B.baselineIndices,baselineBorderlineCount:B.baselineBorderlineCount,firstHighIndex:I}}}return null},M={confirmed:!1,confirmationIndex:null,infertileStartIndex:null,rule:null,highSequenceIndices:[],usedIndices:[],ovulationIndex:null};let b=null,m=null,u=null,$=[],q=M,j=0;const k=({baselineTemp:o,firstHighIndex:i})=>{if(i==null)return{confirmed:!1};const p=o+.2,w=[],n=[],B=new Set,I=P=>{P==null||B.has(P)||(B.add(P),n.push(P))};let F=null,Q=!1;const g=i>0?i-1:null,K=()=>g!=null?[g,...n]:[...n];for(let P=i;P<r.length;P++){const G=r[P];if(!c(G))break;const te=G.displayTemperature;if(!Number.isFinite(te))break;if(te>o){if(I(P),w.push({index:P,temp:te}),w.length===3&&w[2].temp>=p)return{confirmed:!0,confirmationIndex:w[2].index,usedIndices:K(),highSequenceIndices:[...n],rule:"3-high"};if(w.length===4&&w[2].temp<p&&w[3].temp>o)return{confirmed:!0,confirmationIndex:w[3].index,usedIndices:K(),highSequenceIndices:[...n],rule:"german-3+1"};if(F!==null&&w.length===3&&w[2].temp>=p)return{confirmed:!0,confirmationIndex:w[2].index,usedIndices:K(),highSequenceIndices:[...n],rule:"german-2nd-exception"};if(w.length===5&&w[3].temp>o&&w[4].temp>=p)return{confirmed:!0,confirmationIndex:w[4].index,usedIndices:K(),highSequenceIndices:[...n],rule:"5-high"};continue}if(te>=o-.05&&F===null&&w.length>0&&w.length<3){F=P,I(P),w.push({index:P,temp:o});continue}if(!Q&&w.length>0&&w.length<3){Q=!0,I(P);continue}break}return{confirmed:!1,usedIndices:K(),highSequenceIndices:[...n]}};for(;j<r.length;){const o=C(j);if(!o)break;if(b=o.baselineTemp,m=o.baselineStartIndex,$=Array.isArray(o.baselineIndices)?[...o.baselineIndices]:[],u=o.firstHighIndex,o.baselineBorderlineCount,u==null){j=m+1;continue}const i=k(o);if(i!=null&&i.requireRebaseline){j=m+1;continue}if(i!=null&&i.confirmed){const p=(D=i.highSequenceIndices)!=null&&D.length?i.highSequenceIndices[0]:null;q={confirmed:!0,confirmationIndex:i.confirmationIndex,infertileStartIndex:i.confirmationIndex,rule:i.rule,highSequenceIndices:i.highSequenceIndices??i.usedIndices,usedIndices:i.usedIndices,ovulationIndex:u??p??null};break}j=m+1}return{baselineTemp:b,baselineStartIndex:m,firstHighIndex:u,baselineIndices:$,ovulationDetails:q}},$t=(r,c,N,v,X,C=5,M=!1)=>{const b=x.useRef(null),m=x.useRef(null),[u,$]=x.useState({width:0,height:0}),[q,j]=x.useState(null),[k,D]=x.useState({x:0,y:0}),[o,i]=x.useState(null),p=x.useCallback(()=>{j(null),i(null)},[]),w=x.useMemo(()=>ut(r),[r]),n=x.useMemo(()=>{const s=l=>{if(l==null||l==="")return null;const S=parseFloat(String(l).replace(",","."));return Number.isFinite(S)?S:null},f=l=>{if(!l)return null;const S=s(l.temperature),h=s(l.temperature_corrected);return l.use_corrected&&h!==null?h:S!==null?S:h!==null?h:null};return r.map(l=>{const S=[l==null?void 0:l.temperature_chart,l==null?void 0:l.temperature_raw,l==null?void 0:l.temperature_corrected];let h=null;for(const O of S)if(O!=null&&O!==""){h=O;break}if(h==null&&Array.isArray(l==null?void 0:l.measurements)){const H=l.measurements.find(W=>W&&W.selected&&f(W)!==null)||l.measurements.find(W=>f(W)!==null);H&&(h=f(H))}const T=l==null?void 0:l.isoDate;return{...l,displayTemperature:s(h),peakStatus:T&&w[T]||null}})},[r,w]);x.useLayoutEffect(()=>{const s=()=>{if(!b.current)return;const l=b.current.parentElement||b.current;let S=l.clientWidth||600,h=l.clientHeight||400,T=b.current.clientWidth>0?b.current.clientWidth:S,O,H;if(c){let W=window.innerWidth,se=window.innerHeight;if(M&&se>W&&([W,se]=[se,W]),T=W,N==="portrait"&&!M){const ge=Math.max(30,W*.05);O=(W-ge)/C*r.length}else O=W/C*r.length;H=se}else O=T/C*r.length,H=h;$({width:O,height:H})};s(),window.addEventListener("resize",s);let f;if(b.current){const l=b.current.parentElement||b.current;f=new ResizeObserver(s),f.observe(l)}return()=>{window.removeEventListener("resize",s),f&&f.disconnect()}},[c,r.length,C,N,M]);const B=x.useMemo(()=>n.filter(s=>s&&s.isoDate&&!s.ignored&&s.displayTemperature!==null&&s.displayTemperature!==void 0),[n]),I=x.useMemo(()=>n.filter(s=>s&&s.isoDate),[n]),F=B.length>0,Q=x.useMemo(()=>{var s;if(!I.length)return null;for(let f=0;f<I.length;f+=1)if(((s=I[f])==null?void 0:s.peakStatus)==="P")return f;return null},[I]),g=x.useMemo(()=>{var S;if(!I.length)return null;let s=null;for(let h=0;h<I.length;h+=1)if(((S=I[h])==null?void 0:S.peakStatus)==="3"){s=h;break}if(s!=null){const h=s+1;return h>=I.length?s:h}if(Q==null)return null;const f=I[Q];if(!(f!=null&&f.isoDate))return null;const l=De(f.isoDate);for(let h=Q+1;h<I.length;h+=1){const T=I[h];if(!(T!=null&&T.isoDate))continue;if(lt(De(T.isoDate),l)>=4)return h}return null},[I,Q]),{baselineTemp:K,baselineStartIndex:P,firstHighIndex:G,baselineIndices:te,ovulationDetails:ce}=x.useMemo(()=>Gt(n),[n]),re=x.useMemo(()=>({...ce??{confirmed:!1,confirmationIndex:null,infertileStartIndex:null,rule:null,highSequenceIndices:[],usedIndices:[],ovulationIndex:null},peakDayIndex:Q,peakInfertilityStartIndex:g}),[ce,Q,g]),{tempMin:le,tempMax:ae}=x.useMemo(()=>{const s=B.map(S=>S.displayTemperature).filter(S=>S!=null);if(s.length===0)return{tempMin:nt,tempMax:rt};let f=Math.min(...s,nt),l=Math.max(...s,rt);if(f=Math.floor(f*2)/2,l=Math.ceil(l*2)/2,l-f<2){const S=(f+l)/2;f=S-1,l=S+1}return{tempMin:f,tempMax:l}},[B]),pe=ae-le,xe=u.width,a=u.height,d=9,y=(s=1)=>{if(!c)return d*s;const f=Math.min(xe,a);return Math.max(8,Math.min(d*s,f/(I.length>0?40/s:40)))},V=y(c?1.6:2.5),R=M||N==="landscape",z=V*(R?9:5),E={top:c?Math.max(R?6:12,a*(R?.015:.03)):12,right:c?Math.max(R?35:30,xe*(R?.02:.05)):50,bottom:(c?Math.max(R?0:40,a*(R?0:.11)):60)+z+25,left:c?Math.max(R?45:20,xe*(R?.02:.05)):50},J=s=>{if(s==null||pe===0)return a-E.bottom;const f=a-E.top-E.bottom;return f<=0?a-E.bottom:a-E.bottom-(s-le)/pe*f},de=s=>{const f=c&&!(M||N==="landscape")?5:10,l=c&&!(M||N==="landscape")?25:0,S=xe-E.left-E.right-f-l*(I.length-1);if(S<=0)return E.left+f+l*s;const h=I.length>1?I.length-1:1;return h===0||I.length===0?E.left+f+l*s:E.left+f+s*(S/(I.length===1?1:h))+l*s},me=(s,f,l)=>{if(!s){p();return}const S=b.current.getBoundingClientRect();let h,T;if(l.type.startsWith("touch")){const se=l.changedTouches[0];h=se.clientX,T=se.clientY}else h=l.clientX,T=l.clientY;const O=de(f),H=s.displayTemperature??s.temperature_chart??null,W=J(H);D({svgX:O,svgY:W,clientX:h-S.left+b.current.scrollLeft,clientY:T-S.top+b.current.scrollTop}),i(f),j(s)};return x.useEffect(()=>{const s=f=>{var l;if(m.current&&!m.current.contains(f.target)){const S=(l=b.current)==null?void 0:l.querySelectorAll("circle, text, rect");let h=!1;if(S){for(let T of S)if(T.contains(f.target)){h=!0;break}}h||p()}};return q&&(document.addEventListener("mousedown",s),document.addEventListener("touchstart",s)),()=>{document.removeEventListener("mousedown",s),document.removeEventListener("touchstart",s)}},[q,p]),{chartRef:b,tooltipRef:m,dimensions:u,activePoint:q,activeIndex:o,tooltipPosition:k,processedData:n,validDataForLine:B,allDataPoints:I,tempMin:le,tempMax:ae,tempRange:pe,padding:E,textRowHeight:V,setActivePoint:j,setActiveIndex:i,getY:J,getX:de,handlePointInteraction:me,clearActivePoint:p,handleToggleIgnore:s=>{v&&s&&(v(X,s),p())},responsiveFontSize:y,baselineTemp:K,baselineStartIndex:P,baselineIndices:te,firstHighIndex:G,ovulationDetails:re,hasTemperatureData:F}},Ut=({data:r,isFullScreen:c,orientation:N,onToggleIgnore:v,onEdit:X,onTogglePeak:C,cycleId:M,initialScrollIndex:b=0,visibleDays:m=5,showInterpretation:u=!1,reduceMotion:$=!1,forceLandscape:q=!1,currentPeakIsoDate:j=null})=>{const{chartRef:k,tooltipRef:D,dimensions:o,activePoint:i,activeIndex:p,tooltipPosition:w,allDataPoints:n,validDataForLine:B,tempMin:I,tempMax:F,tempRange:Q,padding:g,textRowHeight:K,getY:P,getX:G,handlePointInteraction:te,handleToggleIgnore:ce,responsiveFontSize:re,clearActivePoint:le,baselineTemp:ae,baselineStartIndex:pe,baselineIndices:xe,firstHighIndex:a,ovulationDetails:d,hasTemperatureData:y}=$t(r,c,N,v,M,m,q),V=x.useRef(null);if(!V.current){const _=Math.random().toString(36).slice(2,10);V.current=`fertility-chart-${M??"default"}-${_}`}const R=V.current;if(!n||n.length===0)return e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-pink-100 to-rose-100 rounded-full mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-pink-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),e.jsx("p",{className:"text-slate-400 font-medium",children:"No hay datos para mostrar en el gráfico"})]});const U=o.width,z=o.height,E=ae!=null?P(ae):null,J=!!(d!=null&&d.confirmed),de=ae!=null,me=G(0),Me=n.length>0?G(n.length-1):U-g.right,s=J?"#F59E0B":"#94A3B8",f=J?"6 4":"4 4",l=J?1:.7,S=3,h=U===0,T=p!=null?G(p):null,O=p!=null?p>0?G(p-1):T:null,H=p!=null?p<n.length-1?G(p+1):T:null,W=Math.max((U-g.left-g.right)/Math.max(n.length,1),0),se=p!=null?Math.max((H!=null&&O!=null?H-O:0)||W,W,0):0,ge=x.useMemo(()=>{const _=new Map;return B.forEach(Z=>{Z&&Z.id!=null&&_.set(Z.id,Z)}),_},[B]),he=x.useMemo(()=>d!=null&&d.confirmed&&Number.isFinite(d==null?void 0:d.infertileStartIndex)?d.infertileStartIndex:null,[d]),t=x.useMemo(()=>Number.isFinite(d==null?void 0:d.peakInfertilityStartIndex)?d.peakInfertilityStartIndex:null,[d]),A=x.useMemo(()=>he==null||t==null?null:Math.max(he,t),[he,t]),L=Math.max(z-g.top-g.bottom,0),ve=`${R}-temperature-below`,Y=`${R}-temperature-above`,oe=x.useCallback(_=>!Number.isFinite(_)||!n.length||_<=0?g.left:G(_),[n,G,g.left]),ue=x.useCallback(_=>!Number.isFinite(_)||!n.length||_>=n.length-1?U-g.right:G(_+1),[n,U,G,g.right]),ye=x.useCallback((_,Z,{inclusiveEnd:ne=!0}={})=>{if(!Number.isFinite(_)||!Number.isFinite(Z)||n.length===0)return null;const we=ke=>Math.max(0,Math.min(n.length-1,Math.floor(ke))),Ee=ke=>Math.max(0,Math.min(n.length-1,Math.floor(ke))),Ue=ke=>Math.max(0,Math.min(n.length,Math.floor(ke))),Pe=we(_),Se=ne?Ee(Z):Ue(Z),_e=Pe<=0?g.left:oe(Pe);let je;ne?je=Se>=n.length-1?U-g.right:ue(Se):Se<=0?je=g.left:Se>=n.length?je=U-g.right:je=oe(Se);const Ne=Math.max(je-_e,0);return Ne<=0?null:{x:_e,width:Ne}},[n,U,oe,ue,g.left,g.right]),Ce=x.useMemo(()=>{if(!y||L<=0)return{below:null,above:null};const _=z-g.bottom,Z=g.top,ne=n.map((je,Ne)=>{const ke=je?ge.get(je.id):null;return!ke||!Number.isFinite(ke.displayTemperature)?null:{index:Ne,x:G(Ne),y:P(ke.displayTemperature)}}).filter(Boolean);if(!ne.length)return{below:null,above:null};const we=ne[0],Ee=ne[ne.length-1],Ue=oe(we.index),Pe=U-g.right,Se=[...ne];Se[Se.length-1].x!==Pe&&Se.push({index:Ee.index,x:Pe,y:Ee.y});const _e=je=>[`M ${Ue} ${je}`,`L ${we.x} ${we.y}`,...Se.slice(1).map(({x:ke,y:ot})=>`L ${ke} ${ot}`),`L ${Pe} ${je}`,"Z"].join(" ");return{below:_e(_),above:_e(Z)}},[n,L,z,U,oe,G,P,y,g.bottom,g.right,g.top,ge]),ee=x.useMemo(()=>{if(!u||!(d!=null&&d.confirmed)||he==null||L<=0)return null;const _=A==null,Z=A??n.length-1;return Z<he?null:ye(he,Z,{inclusiveEnd:_})},[u,d,he,L,A,n.length,ye]),be=x.useMemo(()=>{if(!u||t==null||L<=0)return null;const _=A==null,Z=A??n.length-1;return Z<t?null:ye(t,Z,{inclusiveEnd:_})},[u,t,L,A,n.length,ye]),Ie=x.useMemo(()=>!u||A==null||L<=0?null:ye(A,n.length-1),[u,A,L,n.length,ye]),Be=x.useMemo(()=>{if(!u||!(d!=null&&d.confirmed))return null;const _=Array.isArray(d==null?void 0:d.highSequenceIndices)?d.highSequenceIndices:[];if(_.length<2)return null;const Z=_.map(ne=>{if(ne==null||ne<0||ne>=n.length)return null;const we=n[ne],Ee=ge.get(we==null?void 0:we.id);return!Ee||!Number.isFinite(Ee.displayTemperature)?null:{x:G(ne),y:P(Ee.displayTemperature)}}).filter(Boolean);return Z.length<2?null:Z.map(({x:ne,y:we},Ee)=>`${Ee===0?"M":"L"} ${ne} ${we}`).join(" ")},[u,d,n,ge,G,P]),[Le,$e]=x.useState({w:typeof window<"u"?window.innerWidth:0,h:typeof window<"u"?window.innerHeight:0}),Te=Le.w<Le.h;x.useEffect(()=>{const _=()=>$e({w:window.innerWidth,h:window.innerHeight});return window.addEventListener("resize",_),window.addEventListener("orientationchange",_),()=>{window.removeEventListener("resize",_),window.removeEventListener("orientationchange",_)}},[]),x.useEffect(()=>{if(!k.current)return;const _=k.current.clientWidth/m;k.current.scrollLeft=Math.max(0,_*b)},[b,m,o.width,N]);const Oe=q&&Te,We=Oe,fe="w-full h-full bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100",st=c?`${fe} min-h-full ${We?"flex items-stretch justify-start overflow-y-auto overflow-x-hidden":"flex items-center justify-start overflow-x-auto overflow-y-hidden"}`:`${fe} overflow-x-auto overflow-y-hidden border border-pink-100/50`,Ke=!c||N==="portrait";return e.jsxs(ie.div,{className:"relative w-full h-full",initial:!1,children:[Ke&&e.jsx("div",{className:"absolute left-0 top-0 h-full bg-transparent pointer-events-none z-10",style:{width:g.left},children:e.jsx(Ft,{padding:g,chartHeight:z,tempMin:I,tempMax:F,tempRange:Q,getY:P,responsiveFontSize:re,textRowHeight:K,isFullScreen:c})}),e.jsxs(ie.div,{ref:k,className:`relative p-0 ${c?"":"rounded-2xl"} ${st}`,style:{boxShadow:c?"inset 0 1px 3px rgba(244, 114, 182, 0.1)":"0 8px 32px rgba(244, 114, 182, 0.12), 0 2px 8px rgba(244, 114, 182, 0.08)",...Oe?{position:"absolute",top:0,left:0,width:`${Le.h}px`,height:`${Le.w}px`,transform:"rotate(90deg) translateY(-100%)",transformOrigin:"top left"}:{}},initial:!1,children:[h&&e.jsx("div",{className:"flex items-center justify-center w-full h-full text-slate-400",children:"Cargando..."}),e.jsxs(ie.svg,{width:U,height:z,className:"font-sans flex-shrink-0",viewBox:`0 0 ${U} ${z}`,preserveAspectRatio:"xMidYMid meet",initial:!1,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),e.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),e.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),e.jsxs("linearGradient",{id:"tempAreaGradientChart",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(244,114,182,0.25)"}),e.jsx("stop",{offset:"50%",stopColor:"rgba(236,72,153,0.15)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(233,30,99,0.05)"})]}),e.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[e.jsx("rect",{width:"6",height:"6",fill:"#ef4444"}),e.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(255,255,255,0.85)"})]}),e.jsxs("filter",{id:"chartShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("filter",{id:"baselineGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("pattern",{id:"temperatureInfertilityPattern",patternUnits:"userSpaceOnUse",width:"14",height:"14",children:[e.jsx("rect",{width:"14",height:"14",fill:"rgba(191, 219, 254, 0.45)"}),e.jsx("path",{d:"M0 0 L14 14",stroke:"rgba(59, 130, 246, 0.55)",strokeWidth:"1.4"}),e.jsx("path",{d:"M14 0 L0 14",stroke:"rgba(59, 130, 246, 0.55)",strokeWidth:"1.4"})]}),e.jsxs("pattern",{id:"peakInfertilityPattern",patternUnits:"userSpaceOnUse",width:"12",height:"12",children:[e.jsx("rect",{width:"12",height:"12",fill:"rgba(167, 243, 208, 0.42)"}),e.jsx("circle",{cx:"3",cy:"3",r:"1.7",fill:"rgba(13, 148, 136, 0.55)"}),e.jsx("circle",{cx:"9",cy:"9",r:"1.7",fill:"rgba(13, 148, 136, 0.55)"})]}),e.jsxs("pattern",{id:"absoluteInfertilityPattern",patternUnits:"userSpaceOnUse",width:"16",height:"16",children:[e.jsx("rect",{width:"16",height:"16",fill:"rgba(56, 189, 248, 0.45)"}),e.jsx("path",{d:"M0 0 L16 16",stroke:"rgba(13, 148, 136, 0.6)",strokeWidth:"1.2"}),e.jsx("path",{d:"M16 0 L0 16",stroke:"rgba(13, 148, 136, 0.6)",strokeWidth:"1.2"}),e.jsx("circle",{cx:"4",cy:"12",r:"1.6",fill:"rgba(19, 78, 74, 0.6)"}),e.jsx("circle",{cx:"12",cy:"4",r:"1.6",fill:"rgba(19, 78, 74, 0.6)"})]}),y&&Ce.below&&e.jsx("clipPath",{id:ve,clipPathUnits:"userSpaceOnUse",children:e.jsx("path",{d:Ce.below})}),y&&Ce.above&&e.jsx("clipPath",{id:Y,clipPathUnits:"userSpaceOnUse",children:e.jsx("path",{d:Ce.above})})]}),e.jsx("rect",{width:"100%",height:"100%",fill:"transparent"}),e.jsx(kt,{padding:g,chartWidth:U,chartHeight:z,tempMin:I,tempMax:F,tempRange:Q,getY:P,getX:G,allDataPoints:n,responsiveFontSize:re,isFullScreen:c,showLeftLabels:!Ke,reduceMotion:$}),u&&e.jsxs(e.Fragment,{children:[be&&(y&&Ce.below?e.jsx("rect",{x:be.x,y:g.top,width:be.width,height:L,fill:"url(#peakInfertilityPattern)",opacity:.75,pointerEvents:"none",clipPath:`url(#${ve})`}):e.jsx("rect",{x:be.x,y:g.top,width:be.width,height:L,fill:"url(#peakInfertilityPattern)",opacity:.75,pointerEvents:"none"})),ee&&(y&&Ce.above?e.jsx("rect",{x:ee.x,y:g.top,width:ee.width,height:L,fill:"url(#temperatureInfertilityPattern)",opacity:.7,pointerEvents:"none",clipPath:`url(#${Y})`}):e.jsx("rect",{x:ee.x,y:g.top,width:ee.width,height:L,fill:"url(#temperatureInfertilityPattern)",opacity:.7,pointerEvents:"none"})),Ie&&e.jsx("rect",{x:Ie.x,y:g.top,width:Ie.width,height:L,fill:"url(#absoluteInfertilityPattern)",opacity:.5,pointerEvents:"none"})]}),u&&de&&E!==null&&($?e.jsx("line",{x1:me,y1:E,x2:Me,y2:E,stroke:s,strokeWidth:S,strokeDasharray:f,opacity:l}):e.jsx(ie.path,{d:`M ${me} ${E} L ${Me} ${E}`,stroke:s,strokeWidth:S,strokeDasharray:f,opacity:l,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:l},transition:{duration:4,ease:"easeInOut",delay:.5}})),e.jsx(Ct,{data:B,allDataPoints:n,getX:G,getY:P,baselineY:z-g.bottom,temperatureField:"displayTemperature",reduceMotion:$}),Be&&e.jsx("path",{d:Be,fill:"none",stroke:"#cc0e93",strokeWidth:6,strokeLinecap:"round",strokeLinejoin:"round",opacity:.85,style:{filter:"drop-shadow(0 2px 6px rgba(206, 14, 147, 0.4))"},pointerEvents:"none"}),p!==null&&T!==null&&se>0&&e.jsx("g",{pointerEvents:"none",children:e.jsx("line",{x1:T,y1:0,x2:T,y2:z,stroke:"rgba(235, 171, 204,0.15)",strokeWidth:Math.max(3,Math.min(14,se*.4)),strokeLinecap:"round"})}),e.jsx(Rt,{data:n,getX:G,getY:P,isFullScreen:c,orientation:N,responsiveFontSize:re,onPointInteraction:te,clearActivePoint:le,activePoint:i,padding:g,chartHeight:z,chartWidth:U,temperatureField:"displayTemperature",textRowHeight:K,compact:!1,reduceMotion:$,showInterpretation:u,ovulationDetails:d,baselineStartIndex:pe,firstHighIndex:a,baselineIndices:xe})]}),i&&e.jsx(ie.div,{ref:D,initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:10},transition:{duration:.12,ease:"easeOut"},children:e.jsx(pt,{point:i,position:w,chartWidth:U,chartHeight:z,onToggleIgnore:ce,onEdit:X,onClose:le,onTogglePeak:C,currentPeakIsoDate:j})})]})]})};function Yt(r,c){if(!r||!c)return[];const N=typeof r=="string"?De(r):r;return[...Array(c)].map((v,X)=>{const C=at(N,X),M=Ge(C,"yyyy-MM-dd"),b=Ge(C,"dd/MM"),m=Xe(Ae(C),Ae(N))+1;return{date:b,isoDate:M,cycleDay:m,temperature:null,mucusSensation:null,mucusAppearance:null,id:`placeholder-${M}`,ignored:!1,peak_marker:null}})}const nn=()=>{const{cycleId:r}=ct(),{currentCycle:c,archivedCycles:N,isLoading:v,addOrUpdateDataPoint:X,toggleIgnoreRecord:C,getCycleById:M}=xt(),[b,m]=x.useState(null),[u,$]=x.useState(!1),[q,j]=x.useState(!1),k=!r||r===c.id,D=k?null:N.find(t=>t.id===r);x.useEffect(()=>{if(k){m(null),$(!1),j(!1);return}if(D){m(null),$(!1),j(!1);return}let t=!0;return $(!0),M(r).then(A=>{t&&(A?(m(A),j(!1)):(m(null),j(!0)))}).catch(()=>{t&&(m(null),j(!0))}).finally(()=>{t&&$(!1)}),()=>{t=!1}},[k,D,M,r]);const o=k?c:D||b,i=!k&&!D,p=!k&&(o==null?void 0:o.id),w=k?v&&!(c!=null&&c.id):u||v&&!D&&!b,[n,B]=x.useState(typeof window<"u"&&window.innerWidth>window.innerHeight?"landscape":"portrait"),[I,F]=x.useState(!1),[Q,g]=x.useState(!1),[K,P]=x.useState(null),[G,te]=x.useState(!1),[ce,re]=x.useState(!1),le=x.useRef(!1),ae=!!(K&&String(K.id||"").startsWith("placeholder-"));if(x.useEffect(()=>{const t=async()=>{var L,ve;const A=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement);if(F(A),!A){try{const Y=typeof window<"u"?(L=window.screen)==null?void 0:L.orientation:null;await((ve=Y==null?void 0:Y.unlock)==null?void 0:ve.call(Y))}catch{}B("portrait")}};return document.addEventListener("fullscreenchange",t),document.addEventListener("webkitfullscreenchange",t),document.addEventListener("mozfullscreenchange",t),document.addEventListener("MSFullscreenChange",t),()=>{document.removeEventListener("fullscreenchange",t),document.removeEventListener("webkitfullscreenchange",t),document.removeEventListener("mozfullscreenchange",t),document.removeEventListener("MSFullscreenChange",t)}},[]),x.useLayoutEffect(()=>{window.dispatchEvent(new Event("resize"))},[n,I]),w)return e.jsx(Fe,{children:e.jsx("div",{className:"flex h-full flex-col items-center justify-center space-y-4 px-4 py-8 text-center text-gray-500",children:e.jsx("p",{children:"Cargando…"})})});if(!(o!=null&&o.id))return r&&q?e.jsx(Fe,{children:e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 px-4 py-8 text-center text-pink-600",children:[e.jsx("p",{children:"No se encontró el ciclo solicitado."}),e.jsx(Re,{asChild:!0,className:"bg-gradient-to-r from-pink-500 to-rose-500 text-white shadow",children:e.jsx(Ye,{to:"/archived-cycles",children:"Volver a Mis Ciclos"})})]})}):e.jsx(Fe,{children:e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 px-4 py-8 text-center text-pink-600",children:[e.jsx("p",{children:"No hay ciclo activo."}),e.jsx(Re,{asChild:!0,className:"bg-gradient-to-r from-pink-500 to-rose-500 text-white shadow",children:e.jsx(Ye,{to:"/records",children:"Ir a Mis Registros"})})]})});const pe=28,xe=10,a=De(o.startDate),d=o.data||[],y=x.useMemo(()=>{const t=Array.isArray(d)?d.find(A=>(A==null?void 0:A.peak_marker)==="peak"):null;return(t==null?void 0:t.isoDate)||null},[d]),V=d.reduce((t,A)=>{const L=De(A.isoDate);return L>t?L:t},a),R=Ae(new Date),U=V>R?V:R,z=Xe(Ae(U),a),E=Math.max(pe,z+1),de=Yt(a,E).map(t=>{const A=d.find(L=>L.isoDate===t.isoDate);return A?{...A,date:t.date}:t}),me=n==="portrait"?xe:pe;let Me=0;if(n!=="landscape"){const t=Xe(new Date,Ae(a)),A=Math.min(Math.max(t,0),E-1);let L=Math.min(E,A+1);A<me-1&&(L=Math.min(E,me)),Me=Math.max(0,L-me)}const s={background:"linear-gradient(135deg, #FFFAFC 0%, #f7eaef 100%)"},f=I?s:{...s,height:n==="landscape"?"calc(min(100dvh, 100dvw) - var(--bottom-nav-safe))":"calc(100dvh - var(--bottom-nav-safe))",maxHeight:"100vh",paddingBottom:"env(safe-area-inset-bottom)"},l=t=>{P(t),g(!0)},S=async(t,A)=>{try{if(await C(t,A),i){const L=await M(t);L&&m(L)}}catch(L){console.error("Error toggling ignore state:",L)}},h=async(t,A=!0)=>{if(!(o!=null&&o.id)||!(t!=null&&t.isoDate))return;const L=Y=>{if(Y==null||Y==="")return null;const oe=parseFloat(String(Y).replace(",","."));return Number.isFinite(oe)?oe:null},ve=A??!(t.peak_marker==="peak"||t.peakStatus==="P");te(!0);try{const Y=t.timestamp?Ge(De(t.timestamp),"HH:mm"):Ge(new Date,"HH:mm");let oe=Array.isArray(t.measurements)&&t.measurements.length>0?t.measurements:[{temperature:t.temperature_chart??t.temperature_raw??null,temperature_corrected:t.temperature_corrected??null,time:Y,time_corrected:t.time_corrected??Y,selected:!0,use_corrected:t.use_corrected??!1}];oe.length===0&&(oe=[{temperature:null,temperature_corrected:null,time:Y,time_corrected:Y,selected:!0,use_corrected:!1}]);const ue=oe.map((ee,be)=>{const Ie=ee.time||Y,Be=ee.time_corrected||Ie;return{temperature:L(ee.temperature??ee.temperature_raw),time:Ie,selected:be===0?!0:!!ee.selected,temperature_corrected:L(ee.temperature_corrected),time_corrected:Be,use_corrected:!!ee.use_corrected}});ue.some(ee=>ee.selected)||(ue[0].selected=!0);const ye={isoDate:t.isoDate,measurements:ue,mucusSensation:t.mucus_sensation??t.mucusSensation??"",mucusAppearance:t.mucus_appearance??t.mucusAppearance??"",fertility_symbol:t.fertility_symbol??"none",observations:t.observations??"",ignored:t.ignored??!1,peak_marker:ve?"peak":null},Ce=t!=null&&t.id&&!String(t.id).startsWith("placeholder-")?t:null;await X(ye,Ce,o.id)}catch(Y){console.error("Error toggling peak marker:",Y)}finally{te(!1)}},T=async(t,{keepFormOpen:A=!1}={})=>{if(o!=null&&o.id){te(!0);try{if(await X(t,K,o.id),i){const L=await M(o.id);L&&m(L)}A||(g(!1),P(null))}finally{te(!1)}}},O=()=>{g(!1),P(null)},H=t=>{P(t)},W=()=>{re(t=>!t)},se=t=>{if(t.preventDefault(),le.current){le.current=!1;return}W()},ge=t=>{t.pointerType==="touch"&&(t.preventDefault(),le.current=!0,W())},he=async()=>{if(I){try{await screen.orientation.unlock()}catch(t){console.error(t)}try{document.fullscreenElement&&await document.exitFullscreen()}catch(t){console.error(t)}B("portrait"),F(!1)}else try{await document.documentElement.requestFullscreen(),await screen.orientation.lock("landscape"),B("landscape"),F(!0)}catch(t){console.error(t)}};return e.jsx(Fe,{hideBottomNav:I,children:e.jsxs("div",{className:I?"fixed inset-0 z-50 h-[100dvh] w-[100dvw] overflow-x-auto overflow-y-auto":"relative w-full overflow-x-auto overflow-y-auto",style:f,children:[p&&!I&&e.jsx(Re,{asChild:!0,variant:"ghost",className:"absolute top-4 left-4 z-10 bg-white/80 text-slate-700 hover:bg-[#E27DBF]/20",children:e.jsxs(Ye,{to:`/cycle/${o.id}`,className:"flex items-center gap-1",children:[e.jsx(yt,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Registros"})]})}),e.jsx(Re,{onClick:se,onPointerUp:ge,variant:"ghost",size:"icon",className:`absolute top-4 right-20 z-10 p-2 rounded-full transition-colors ${ce?"bg-[#E27DBF] text-white hover:bg-[#d46ab3]":"bg-white/80 text-slate-700 hover:bg-[#E27DBF]/20"}`,children:ce?e.jsx(bt,{className:"h-4 w-4"}):e.jsx(wt,{className:"h-4 w-4"})}),e.jsx(Re,{onClick:he,className:"absolute top-4 right-4 z-10 bg-white/80 hover:bg-white text-gray-700 p-2 rounded-full shadow","aria-label":I?"Salir de pantalla completa":"Rotar gráfico",children:e.jsx(jt,{className:"w-5 h-5"})}),e.jsx(Ut,{data:de,isFullScreen:I,orientation:n,onToggleIgnore:S,onEdit:l,onTogglePeak:h,cycleId:o.id,initialScrollIndex:Me,visibleDays:me,showInterpretation:ce,reduceMotion:!0,forceLandscape:n==="landscape",currentPeakIsoDate:y}),e.jsx(mt,{open:Q,onOpenChange:t=>{t||O()},children:e.jsx(gt,{hideClose:!0,className:"bg-transparent border-none p-0 text-gray-800 w-[90vw] sm:w-auto max-w-md sm:max-w-lg md:max-w-xl max-h-[85vh] overflow-y-auto",children:e.jsx(ft,{onSubmit:T,onCancel:O,initialData:K,cycleStartDate:o.startDate,cycleEndDate:o.endDate,isProcessing:G,isEditing:!!K&&!ae,cycleData:o.data,onDateSelect:H})})})]})})};export{nn as default};
