import{c as it,m as ce,j as e,r as f,s as Le,p as Ae,D as lt,e as at,f as Ge,d as Je,h as ct,M as We,B as Oe,L as He}from"./index-a6c447c5.js";import{g as dt,i as ht,f as ut,c as ft,D as pt}from"./computePeakStatuses-5c65dc01.js";import{C as xt}from"./ChartTooltip-03720f40.js";import{u as mt,D as gt,a as yt}from"./useCycleData-1ec13a38.js";import{A as bt}from"./arrow-left-05862eb2.js";import{E as wt,a as jt}from"./eye-0f3c0a93.js";import"./input-620e50d2.js";import"./label-fe40f887.js";import"./checkbox-2914330c.js";import"./badge-29ccf1d1.js";const kt=it("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),Ct=({padding:s,chartWidth:d,chartHeight:F,tempMin:A,tempMax:Q,tempRange:E,getY:L,getX:g,allDataPoints:p=[],responsiveFontSize:h,isFullScreen:U,showLeftLabels:Y=!1,reduceMotion:w=!1})=>{const S={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.3,ease:"easeOut"}}},D=[];if(E>0){const l=E<=2.5?.1:.5;for(let u=A;u<=Q+1e-9;u+=l)D.push(parseFloat(u.toFixed(1)))}else for(let l=35;l<=37.5+1e-9;l+=.5)D.push(parseFloat(l.toFixed(1)));const o=w?"g":ce.g;return e.jsxs(e.Fragment,{children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"bgGradientChart",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(254, 242, 242, 0.95)"}),e.jsx("stop",{offset:"30%",stopColor:"rgba(255, 241, 242, 0.9)"}),e.jsx("stop",{offset:"70%",stopColor:"rgba(255, 245, 255, 0.95)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(254, 242, 242, 0.8)"})]}),e.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),e.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),e.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),e.jsxs("filter",{id:"chartGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsx("filter",{id:"textShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodColor:"rgba(255, 255, 255, 0.8)"})}),e.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[e.jsx("rect",{width:"6",height:"6",fill:"#ef4444"}),e.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(255,255,255,0.85)"})]})]}),e.jsx("rect",{x:s.left,y:s.top,width:d-s.left-s.right,height:F-s.top-s.bottom,fill:"url(#bgGradientChart)",opacity:2,rx:12,style:{filter:"drop-shadow(0 4px 12px rgba(244, 114, 182, 0.1))"}}),D.map((l,u)=>{const y=L(l),n=l.toFixed(1).endsWith(".0")||l.toFixed(1).endsWith(".5"),B=n?l.toFixed(1):`.${l.toFixed(1).split(".")[1]}`;return e.jsxs(o,{...w?{}:{variants:S},children:[e.jsx("line",{x1:s.left,y1:y,x2:d-s.right,y2:y,stroke:n?"rgba(244, 114, 182, 0.3)":"rgba(244, 114, 182, 0.15)",strokeWidth:n?3:2,strokeDasharray:n?"0":"4,4",style:{filter:n?"drop-shadow(0 1px 3px rgba(244, 114, 182, 0.15))":"none",opacity:n?1:.7}}),Y&&e.jsx("text",{x:s.left-h(1),y:y+h(.35),textAnchor:"end",fontSize:h(n?1.1:1),fontWeight:n?"700":"600",fill:n?"#E91E63":"#EC4899",style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:B}),e.jsx("text",{x:d-s.right+h(1),y:y+h(.35),textAnchor:"start",fontSize:h(n?1.1:1),fontWeight:n?"700":"600",fill:n?"#E91E63":"#EC4899",style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:B})]},`temp-tick-${u}`)}),p.map((l,u)=>{const y=g(u);return e.jsx("line",{x1:y,y1:s.top,x2:y,y2:F-s.bottom,stroke:"rgba(244, 114, 182, 0.08)",strokeWidth:2.8,style:{filter:"drop-shadow(0 0 1px rgba(244, 114, 182, 0.05))"}},`day-grid-${u}`)}),e.jsx("rect",{x:s.left,y:s.top,width:d-s.left-s.right,height:F-s.top-s.bottom,fill:"none",stroke:"rgba(244, 114, 182, 0.4)",strokeWidth:4,rx:8,style:{filter:"drop-shadow(0 4px 12px rgba(244, 114, 182, 0.15))",strokeDasharray:"0"}}),Y&&e.jsx(o,{...w?{}:{variants:S},children:e.jsx("text",{x:s.left+h(1.2),y:s.top+h(1.5),textAnchor:"middle",fontSize:h(1.4),fontWeight:"800",fill:"#E91E63",style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:"°C"})})]})},St=({data:s,allDataPoints:d,getX:F,getY:A,baselineY:Q,temperatureField:E="temperature",reduceMotion:L=!1})=>{if(!s||s.length<2)return null;let g="",p=null;const h=[];if(d.forEach((w,S)=>{const D=s.find(o=>o.id===w.id);if(D&&D[E]!==null&&D[E]!==void 0&&!D.ignored){const o=F(S),l=A(D[E]);h.push({x:o,y:l}),p!==null&&S===p+1?g+=` L ${o} ${l}`:g+=`${g?" ":""}M ${o} ${l}`,p=S}}),h.length<2)return null;const U=g.includes("L"),Y=h.length>1?h.map(({x:w,y:S},D)=>`${D===0?"M":"L"} ${w} ${S}`).join(" "):"";return e.jsxs(e.Fragment,{children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),e.jsx("stop",{offset:"30%",stopColor:"#EC4899"}),e.jsx("stop",{offset:"70%",stopColor:"#E91E63"}),e.jsx("stop",{offset:"100%",stopColor:"#C2185B"})]}),e.jsxs("linearGradient",{id:"tempLineGradientChartGlow",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(244, 114, 182, 0.6)"}),e.jsx("stop",{offset:"30%",stopColor:"rgba(236, 72, 153, 0.7)"}),e.jsx("stop",{offset:"70%",stopColor:"rgba(233, 30, 99, 0.8)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(194, 24, 91, 0.6)"})]}),e.jsxs("filter",{id:"lineGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"4",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsx("filter",{id:"lineShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"3",floodColor:"rgba(244, 114, 182, 0.4)"})})]}),U&&(L?e.jsx("path",{d:g,fill:"none",stroke:"url(#tempLineGradientChartGlow)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:.4,style:{filter:"url(#lineGlow)"}}):e.jsx(ce.path,{d:g,fill:"none",stroke:"url(#tempLineGradientChartGlow)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:.4,style:{filter:"url(#lineGlow)"},initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.4},transition:{duration:.8,ease:"easeInOut",delay:.2}})),Y&&(L?e.jsx("path",{d:Y,fill:"none",stroke:"#d587b1",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.65}):e.jsx(ce.path,{d:Y,fill:"none",stroke:"#d587b1",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.65,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.65},transition:{duration:.8,ease:"easeInOut"}})),U&&(L?e.jsx("path",{d:g,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#lineShadow)"}}):e.jsx(ce.path,{d:g,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#lineShadow)"},initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:1},transition:{duration:1,ease:"easeInOut",delay:.4}})),U&&(L?e.jsx("path",{d:g,fill:"none",stroke:"rgba(255, 255, 255, 0.6)",strokeWidth:"0.3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.8}):e.jsx(ce.path,{d:g,fill:"none",stroke:"rgba(255, 255, 255, 0.6)",strokeWidth:"0.3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.8,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.8},transition:{duration:1.2,ease:"easeInOut",delay:.6}}))]})},Qe="#1565C0",Ze="#2E7D32",et="#6A1B9A",Et="#EFF6FF",It="#EEF2FF",Mt="#ECFDF5",vt="#F0FDFA",Lt="#F5F3FF",At="#FAF5FF",Dt="rgba(148, 163, 184, 0.35)",Bt="rgba(226, 232, 240, 0.6)",Pt="rgba(148, 163, 184, 0.5)",tt="✖",ze="#7f1d1d",Ve="#ec4899",nt="drop-shadow(0 2px 4px rgba(244, 114, 182, 0.35))",Ft="#be185d",Nt="#2563eb",Tt="#be185d",_t=s=>{if(!s)return"";const[d,F]=s.split("/");return`${parseInt(d,10)}/${parseInt(F,10)}`},Xe=(s="",d,F,A="–")=>{if(!s)return[A,""];if(s.length<=d)return[s,""];if(F){const p=s.slice(0,d),h=s.slice(d,d*2);return[p,h]}const Q=p=>{if(!p)return["",""];if(p.length<=d)return[p,""];const h=p.indexOf(" ",d);return h===-1?[p.slice(0,d),p.slice(d)]:[p.slice(0,h),p.slice(h+1)]},[E,L]=Q(s),[g]=Q(L.trimStart());return[E,g]},Ke=(s="",d,F="–")=>s?s.split(/\s+/).slice(0,d).join(" "):F,Rt=({data:s,getX:d,getY:F,isFullScreen:A,orientation:Q,responsiveFontSize:E,onPointInteraction:L,clearActivePoint:g,activePoint:p,padding:h,chartHeight:U,chartWidth:Y,temperatureField:w="temperature_chart",textRowHeight:S,compact:D=!1,reduceMotion:o=!1,showInterpretation:l=!1,ovulationDetails:u=null,firstHighIndex:y=null,baselineIndices:n=[]})=>{const B={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},M={hidden:{opacity:0,scale:.3},visible:{opacity:1,scale:1,transition:{duration:.6,ease:[.34,1.56,.64,1],type:"spring",stiffness:120,damping:12}}},G=U-h.bottom,ee=G+S*1,x=G+S*2,V=G+S*3,P=G+S*(A?5:4.5),$=G+S*(A?7:6),ie=G+S*(A?9:7.5),ue=Y-h.left-h.right,ae=S*(A?2:1.5),de=o?"g":ce.g,he=Array.isArray(s)?s.length:0,we=f.useMemo(()=>Le(new Date),[]),pe=f.useMemo(()=>{if(!l)return new Map;const r=Array.isArray(u==null?void 0:u.highSequenceIndices)?u.highSequenceIndices:[],_=new Map;return r.forEach((m,O)=>{const N=Number(m);Number.isInteger(N)&&N>=0&&N<he&&!_.has(N)&&_.set(N,O+1)}),_},[l,u,he]),se=f.useMemo(()=>{if(!l)return new Map;const r=Array.isArray(n)?n:[];if(!r.length)return new Map;const _=new Set,m=[],O=q=>{const te=Number(q);Number.isInteger(te)&&te>=0&&te<he&&!_.has(te)&&(_.add(te),m.push(te))};if(r.forEach(q=>{O(q)}),y!=null){const q=Number(y);Number.isInteger(q)&&O(q-1)}if(!m.length)return new Map;const N=[...m].sort((q,te)=>q-te),X=new Map;let W=1;for(let q=N.length-1;q>=0&&!(W>6);q-=1)X.set(N[q],W),W+=1;return X},[l,n,he,y]);return e.jsxs(e.Fragment,{children:[e.jsxs("defs",{children:[e.jsx("filter",{id:"rowShadowChart",x:"-10%",y:"-10%",width:"120%",height:"120%",children:e.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"4",floodColor:"rgba(244, 114, 182, 0.2)"})}),e.jsxs("filter",{id:"pointGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("linearGradient",{id:"sensationGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:Et}),e.jsx("stop",{offset:"100%",stopColor:It})]}),e.jsxs("linearGradient",{id:"appearanceGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:Mt}),e.jsx("stop",{offset:"100%",stopColor:vt})]}),e.jsxs("linearGradient",{id:"observationGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:Lt}),e.jsx("stop",{offset:"100%",stopColor:At})]}),e.jsxs("radialGradient",{id:"tempPointGradientChart",cx:"30%",cy:"30%",children:[e.jsx("stop",{offset:"0%",stopColor:"#FCE7F3"}),e.jsx("stop",{offset:"40%",stopColor:"#F472B6"}),e.jsx("stop",{offset:"80%",stopColor:"#E91E63"}),e.jsx("stop",{offset:"100%",stopColor:"#C2185B"})]}),e.jsxs("radialGradient",{id:"tempPointIgnoredGradient",cx:"30%",cy:"30%",children:[e.jsx("stop",{offset:"0%",stopColor:"#FFFFFF"}),e.jsx("stop",{offset:"80%",stopColor:"#F8FAFC"}),e.jsx("stop",{offset:"100%",stopColor:"#E2E8F0"})]}),e.jsxs("radialGradient",{id:"ovulationPointGradient",cx:"30%",cy:"30%",children:[e.jsx("stop",{offset:"0%",stopColor:"#bfdbfe"}),e.jsx("stop",{offset:"45%",stopColor:"#60a5fa"}),e.jsx("stop",{offset:"85%",stopColor:"#2563eb"}),e.jsx("stop",{offset:"100%",stopColor:"#1d4ed8"})]})]}),!D&&e.jsxs("g",{children:[e.jsx("rect",{x:h.left,y:P-ae/2,width:ue,height:ae,fill:"url(#sensationGradientChart)",rx:4,style:{filter:"url(#rowShadowChart)"}}),e.jsx("rect",{x:h.left,y:$-ae/2,width:ue,height:ae,fill:"url(#appearanceGradientChart)",rx:4,style:{filter:"url(#rowShadowChart)"}}),e.jsx("rect",{x:h.left,y:ie-ae/2,width:ue,height:ae,fill:"url(#observationGradientChart)",rx:4,style:{filter:"url(#rowShadowChart)"}})]}),A&&Q!=="portrait"&&e.jsx(ce.g,{variants:B,children:[{label:"Fecha",row:1,color:A?"#374151":"#6B7280"},{label:"Día",row:2,color:A?"#374151":"#6B7280"},{label:"Símbolo",row:3,color:A?"#374151":"#6B7280"},{label:"Sens.",row:A?5:4.5,color:Qe},{label:"Apar.",row:A?7:6,color:Ze},{label:"Observ.",row:A?9:7.5,color:et}].map(({label:r,row:_,color:m})=>e.jsx("text",{x:h.left-E(.5),y:G+S*_,textAnchor:"end",fontSize:E(1.05),fontWeight:"700",fill:m,style:{filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:r},r))}),s.map((r,_)=>{const m=d(_),O=r[w]!=null?F(r[w]):G,N=r.temperature_raw,X=r.temperature_corrected,W=r.use_corrected&&N!=null&&X!=null&&Math.abs(X-N)>.01,q=W?F(N):null,te=A?"#374151":"#6B7280",le=r[w]!=null;le||r.mucus_sensation||r.mucus_appearance||r.fertility_symbol;const Ee=String(r.id||"").startsWith("placeholder-"),a=u==null?void 0:u.peakDayIndex,c=l&&a!=null&&!r.ignored&&le&&_===a,i=dt(r.fertility_symbol);let I="transparent";if(i!=null&&i.color){const C=i.color.replace(/^bg-/,"");C==="red-500"?I="#ef4444":C==="white"?I="#ffffff":C==="green-500"?I="#22c55e":C==="pink-300"?I="#f9a8d4":C==="yellow-400"&&(I="#facc15")}const j=r.isoDate?ht(Le(Ae(r.isoDate)),Le(new Date)):!1,k=E(A?1.8:2),H=V-k*.75+k/2+2,K=r.peakStatus?String(r.peakStatus).toUpperCase():null,T=K==="P"||K==="X",oe=K&&!T,xe=T?tt:K||"–",fe=T||["1","2","3"].includes(K),t=!Ee&&i.value!=="none",v=!!r.isoDate&&!j?{pointerEvents:"all",style:{cursor:"pointer"},onClick:C=>L(r,_,C)}:{},R=(r.isoDate?ut(Ae(r.isoDate),we):!1)?Tt:te,z=pe.has(_),Ie=z?pe.get(_):null,me=se.has(_),je=me?se.get(_):null,Z=E(A?.75:1.2),ke=Math.max(.5,Z*.18),Me=O-Z*(A?2.6:1.8),De=O+Z*(A?1.9:1.6),ve=A?4:7,Fe=2,[$e,Ne]=Xe(A?Ke(r.mucus_sensation,Fe,j?"":"–"):r.mucus_sensation,ve,!1,j?"":"–"),[Ue,Te]=Xe(A?Ke(r.mucus_appearance,Fe,j?"":"–"):r.mucus_appearance,ve,!1,j?"":"–"),[qe,_e]=Xe(A?Ke(r.observations,Fe,""):r.observations,ve,!1,"");return e.jsxs(de,{...o?{}:{variants:B},...v,children:[le&&e.jsxs(de,{...o?{}:{variants:M},children:[W&&q!==null&&e.jsxs("g",{pointerEvents:"none",children:[e.jsx("line",{x1:m,y1:q,x2:m,y2:O,stroke:Dt,strokeWidth:1,strokeDasharray:"4 4"}),e.jsx("circle",{cx:m,cy:q,r:3.5,fill:Bt,stroke:Pt,strokeWidth:1}),e.jsx("circle",{cx:m,cy:q,r:1.2,fill:"rgba(255, 255, 255, 0.6)"})]}),e.jsx("circle",{cx:m,cy:O,r:c?2:1.5,fill:c?"rgba(59, 130, 246, 0.28)":"rgba(244, 114, 182, 0.2)",opacity:.85,style:{filter:"url(#pointGlow)"}}),e.jsx("circle",{cx:m,cy:O,r:c?4.2:3.5,fill:"none",stroke:r.ignored?"rgba(148, 163, 184, 0.4)":c?"rgba(37, 99, 235, 0.55)":"rgba(244, 114, 182, 0.3)",strokeWidth:c?2:1.5,opacity:c?.9:.6}),e.jsx("circle",{cx:m,cy:O,r:c?4.6:4,fill:r.ignored?"url(#tempPointIgnoredGradient)":c?"url(#ovulationPointGradient)":"url(#tempPointGradientChart)",stroke:r.use_corrected?"#941616":r.ignored?"#94A3B8":c?"#1d4ed8":"#E91E63",strokeWidth:r.ignored?2:c?3.2:3,style:{filter:c?"drop-shadow(0 3px 8px rgba(37, 99, 235, 0.45))":"drop-shadow(0 3px 6px rgba(244, 114, 182, 0.4))",cursor:"pointer"},pointerEvents:"all",onClick:C=>L(r,_,C)}),!r.ignored&&e.jsx("circle",{cx:m,cy:O,r:c?1.8:1.5,fill:c?"rgba(239, 246, 255, 0.95)":"rgba(255, 255, 255, 0.9)",style:{filter:c?"drop-shadow(0 1px 3px rgba(37, 99, 235, 0.45))":"drop-shadow(0 1px 2px rgba(244, 114, 182, 0.3))"}}),c&&e.jsx("circle",{cx:m,cy:O,r:6.5,fill:"none",stroke:"rgba(37, 99, 235, 0.35)",strokeWidth:1.2,strokeDasharray:"4 3"}),l&&le&&!r.ignored&&z&&e.jsx("g",{pointerEvents:"none",children:e.jsx("text",{x:m,y:Me,textAnchor:"middle",fontSize:Z,fontWeight:"900",fill:Ft,strokeWidth:ke,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',paintOrder:"stroke",filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:Ie})}),l&&le&&!r.ignored&&me&&e.jsx("g",{pointerEvents:"none",children:e.jsx("text",{x:m,y:De,textAnchor:"middle",fontSize:Z,fontWeight:"800",fill:Nt,stroke:"#ffffff",strokeWidth:ke,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',paintOrder:"stroke",filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.85))"},children:je})})]}),e.jsx("text",{x:m,y:ee,textAnchor:"middle",fontSize:E(1.05),fontWeight:"900",fill:R,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:_t(r.date)}),e.jsx("text",{x:m,y:x,textAnchor:"middle",fontSize:E(1),fontWeight:"900",fill:R,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:r.cycleDay}),t?e.jsxs("g",{children:[e.jsx("rect",{x:m-k/2+1,y:V-k*.75+1,width:k,height:k,fill:"rgba(0, 0, 0, 0.1)",rx:k*.3,opacity:.5}),e.jsx("rect",{x:m-k/2-4,y:V-k*.75,width:k*1.4,height:k,fill:i.pattern==="spotting-pattern"?"url(#spotting-pattern-chart)":I,stroke:i.value==="white"?"#CBD5E1":"rgba(233, 30, 99, 0.4)",strokeWidth:i.value==="white"?2:1,rx:k*.2,style:{filter:"drop-shadow(0 2px 4px rgba(244, 114, 182, 0.25))"}}),K&&e.jsx("g",{pointerEvents:"none",children:T?e.jsx("text",{x:m,y:H,textAnchor:"middle",fontSize:E(1.35),fontWeight:"900",fill:Ve,stroke:"#fff",strokeWidth:1.5,paintOrder:"stroke",style:{filter:nt},children:tt}):e.jsx("text",{x:m,y:H,textAnchor:"middle",fontSize:E(K?1.1:1),fontWeight:"800",fill:ze,style:{filter:"drop-shadow(0 1px 1px rgba(255,255,255,0.9))"},children:K})})]}):e.jsxs("g",{children:[fe&&e.jsx("rect",{x:m-k/2-4,y:V-k*.75,width:k*1.4,height:k,fill:"transparent",stroke:T?Ve:ze,strokeWidth:1,rx:k*.2}),e.jsx("text",{x:m,y:H,textAnchor:"middle",fontSize:E(T?1.35:oe?1.1:1),fill:T?Ve:oe?ze:te,fontWeight:T?"900":oe?"800":"500",style:{filter:T?nt:oe?"drop-shadow(0 1px 1px rgba(255,255,255,0.9))":"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:xe})]}),!D&&e.jsxs("text",{x:m,y:P,textAnchor:"middle",fontSize:E(.9),fontWeight:"700",fill:Qe,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[e.jsx("tspan",{x:m,dy:0,children:$e}),Ne&&e.jsx("tspan",{x:m,dy:E(1.1),children:Ne})]}),!D&&e.jsxs("text",{x:m,y:$,textAnchor:"middle",fontSize:E(.9),fontWeight:"700",fill:Ze,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[e.jsx("tspan",{x:m,dy:0,children:Ue}),Te&&e.jsx("tspan",{x:m,dy:E(1.1),children:Te})]}),!D&&e.jsxs("text",{x:m,y:ie,textAnchor:"middle",fontSize:E(.9),fontWeight:"700",fill:et,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[e.jsx("tspan",{x:m,dy:0,children:qe}),_e&&e.jsx("tspan",{x:m,dy:E(1.1),children:_e})]})]},`pt-${_}-${r.isoDate||r.timestamp}`)})]})},Ot="#1565C0",Wt="#2E7D32",Gt="#6A1B9A",$t=({padding:s,chartHeight:d,tempMin:F,tempMax:A,tempRange:Q,getY:E,responsiveFontSize:L,textRowHeight:g,isFullScreen:p})=>{const h={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},U=[];if(Q>0){const w=Q<=2.5?.1:.5;for(let S=F;S<=A+1e-9;S+=w)U.push(parseFloat(S.toFixed(1)))}else for(let w=35;w<=37.5+1e-9;w+=.5)U.push(parseFloat(w.toFixed(1)));const Y=d-s.bottom;return e.jsxs("svg",{width:s.left,height:d,className:"font-sans pointer-events-none",children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"legendBgGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(255, 228, 230, 1)"}),e.jsx("stop",{offset:"30%",stopColor:"rgba(255, 229, 235, 1)  "}),e.jsx("stop",{offset:"70%",stopColor:"rgba(255, 241, 242, 1)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(255, 236, 240, 0.6)"})]}),e.jsxs("linearGradient",{id:"legendAccentGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),e.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),e.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),e.jsx("filter",{id:"legendShadowChart",x:"-20%",y:"-20%",width:"140%",height:"140%",children:e.jsx("feDropShadow",{dx:"0",dy:"3",stdDeviation:"4",floodColor:"rgba(244, 114, 182, 0.2)"})}),e.jsx("filter",{id:"textShadowLegend",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodColor:"rgba(255, 255, 255, 0.9)"})})]}),e.jsx("rect",{x:0,y:Y+g*.5,width:s.left,height:g*(p?9.5:8),fill:"url(#legendBgGradientChart)",rx:12,style:{filter:"url(#legendShadowChart)"}}),U.map((w,S)=>{const D=E(w),o=w.toFixed(1).endsWith(".0")||w.toFixed(1).endsWith(".5"),l=o?w.toFixed(1):`.${w.toFixed(1).split(".")[1]}`;return e.jsx(ce.g,{variants:h,children:e.jsx("text",{x:s.left-L(1.2),y:D+L(.35),textAnchor:"end",fontSize:L(o?1.15:1),fontWeight:o?"800":"700",fill:o?"#E91E63":"#EC4899",style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:l})},`temp-tick-fixed-${S}`)}),e.jsx(ce.g,{variants:h,children:[{label:"Fecha",row:1,color:"#374151",icon:null},{label:"Día",row:2,color:"#374151",icon:null},{label:"Símbolo",row:3,color:"#374151",icon:null},{label:"Sens.",row:p?5:4.5,color:Ot,icon:"◊"},{label:"Apar.",row:p?7:6,color:Wt,icon:"○"},{label:"Observ.",row:p?9:7.5,color:Gt,icon:"✦"}].map(({label:w,row:S,color:D,icon:o})=>e.jsxs("g",{children:[o&&e.jsx("text",{x:s.left-L(2.8),y:Y+g*S,textAnchor:"middle",fontSize:L(.8),fontWeight:"600",fill:D,opacity:.7,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:o}),e.jsx("text",{x:s.left-L(.8),y:Y+g*S,textAnchor:"end",fontSize:L(1.05),fontWeight:"800",fill:D,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:w})]},w))})]})},rt=35.5,st=37.5,Ut=(s=[])=>{var D;const d=o=>o&&o.displayTemperature!=null&&!o.ignored,Q=o=>{if(!o||o.length!==6)return null;const l=o.map(n=>n.temp);if(l.some(n=>!Number.isFinite(n)))return null;const u=l.reduce((n,B)=>B>n?B:n,l[0]),y=l.reduce((n,B)=>B>=u-.05&&B<u?n+1:n,0);return y>=2?null:{baselineTemp:u,baselineStartIndex:o[0].index,baselineIndices:o.map(n=>n.index),baselineBorderlineCount:y}},E=o=>{const l=[];for(let u=o;u<s.length;u+=1){const y=s[u];if(!d(y))continue;const n=y.displayTemperature;if(Number.isFinite(n)&&(l.push({index:u,temp:n}),l.length>6&&l.shift(),l.length===6)){const B=Q(l);if(!B)continue;let M=null;for(let G=u+1;G<s.length;G+=1){const ee=s[G];if(!d(ee))continue;const x=ee.displayTemperature;if(Number.isFinite(x)&&x>B.baselineTemp){M=G;break}}return{baselineTemp:B.baselineTemp,baselineStartIndex:B.baselineStartIndex,baselineIndices:B.baselineIndices,baselineBorderlineCount:B.baselineBorderlineCount,firstHighIndex:M}}}return null},L={confirmed:!1,confirmationIndex:null,infertileStartIndex:null,rule:null,highSequenceIndices:[],usedIndices:[],ovulationIndex:null};let g=null,p=null,h=null,U=[],Y=L,w=0;const S=({baselineTemp:o,firstHighIndex:l})=>{if(l==null)return{confirmed:!1};const u=o+.2,y=[],n=[],B=new Set,M=P=>{P==null||B.has(P)||(B.add(P),n.push(P))};let G=null,ee=!1;const x=l>0?l-1:null,V=()=>x!=null?[x,...n]:[...n];for(let P=l;P<s.length;P++){const $=s[P];if(!d($))break;const ie=$.displayTemperature;if(!Number.isFinite(ie))break;if(ie>o){if(M(P),y.push({index:P,temp:ie}),y.length===3&&y[2].temp>=u)return{confirmed:!0,confirmationIndex:y[2].index,usedIndices:V(),highSequenceIndices:[...n],rule:"3-high"};if(y.length===4&&y[2].temp<u&&y[3].temp>o)return{confirmed:!0,confirmationIndex:y[3].index,usedIndices:V(),highSequenceIndices:[...n],rule:"german-3+1"};if(G!==null&&y.length===3&&y[2].temp>=u)return{confirmed:!0,confirmationIndex:y[2].index,usedIndices:V(),highSequenceIndices:[...n],rule:"german-2nd-exception"};if(y.length===5&&y[3].temp>o&&y[4].temp>=u)return{confirmed:!0,confirmationIndex:y[4].index,usedIndices:V(),highSequenceIndices:[...n],rule:"5-high"};continue}if(ie>=o-.05&&G===null&&y.length>0&&y.length<3){G=P,M(P),y.push({index:P,temp:o});continue}if(!ee&&y.length>0&&y.length<3){ee=!0,M(P);continue}break}return{confirmed:!1,usedIndices:V(),highSequenceIndices:[...n]}};for(;w<s.length;){const o=E(w);if(!o)break;if(g=o.baselineTemp,p=o.baselineStartIndex,U=Array.isArray(o.baselineIndices)?[...o.baselineIndices]:[],h=o.firstHighIndex,o.baselineBorderlineCount,h==null){w=p+1;continue}const l=S(o);if(l!=null&&l.requireRebaseline){w=p+1;continue}if(l!=null&&l.confirmed){const u=(D=l.highSequenceIndices)!=null&&D.length?l.highSequenceIndices[0]:null;Y={confirmed:!0,confirmationIndex:l.confirmationIndex,infertileStartIndex:l.confirmationIndex,rule:l.rule,highSequenceIndices:l.highSequenceIndices??l.usedIndices,usedIndices:l.usedIndices,ovulationIndex:h??u??null};break}w=p+1}return{baselineTemp:g,baselineStartIndex:p,firstHighIndex:h,baselineIndices:U,ovulationDetails:Y}},qt=(s,d,F,A,Q,E=5,L=!1)=>{const g=f.useRef(null),p=f.useRef(null),[h,U]=f.useState({width:0,height:0}),[Y,w]=f.useState(null),[S,D]=f.useState({x:0,y:0}),[o,l]=f.useState(null),u=f.useCallback(()=>{w(null),l(null)},[]),y=f.useMemo(()=>ft(s),[s]),n=f.useMemo(()=>{const a=i=>{if(i==null||i==="")return null;const I=parseFloat(String(i).replace(",","."));return Number.isFinite(I)?I:null},c=i=>{if(!i)return null;const I=a(i.temperature),j=a(i.temperature_corrected);return i.use_corrected&&j!==null?j:I!==null?I:j!==null?j:null};return s.map(i=>{const I=[i==null?void 0:i.temperature_chart,i==null?void 0:i.temperature_raw,i==null?void 0:i.temperature_corrected];let j=null;for(const H of I)if(H!=null&&H!==""){j=H;break}if(j==null&&Array.isArray(i==null?void 0:i.measurements)){const K=i.measurements.find(T=>T&&T.selected&&c(T)!==null)||i.measurements.find(T=>c(T)!==null);K&&(j=c(K))}const k=i==null?void 0:i.isoDate;return{...i,displayTemperature:a(j),peakStatus:k&&y[k]||null}})},[s,y]);f.useLayoutEffect(()=>{const a=()=>{if(!g.current)return;const i=g.current.parentElement||g.current;let I=i.clientWidth||600,j=i.clientHeight||400,k=g.current.clientWidth>0?g.current.clientWidth:I,H,K;if(d){let T=window.innerWidth,oe=window.innerHeight;if(L&&oe>T&&([T,oe]=[oe,T]),k=T,F==="portrait"&&!L){const xe=Math.max(30,T*.05);H=(T-xe)/E*s.length}else H=T/E*s.length;K=oe}else H=k/E*s.length,K=j;U({width:H,height:K})};a(),window.addEventListener("resize",a);let c;if(g.current){const i=g.current.parentElement||g.current;c=new ResizeObserver(a),c.observe(i)}return()=>{window.removeEventListener("resize",a),c&&c.disconnect()}},[d,s.length,E,F,L]);const B=f.useMemo(()=>n.filter(a=>a&&a.isoDate&&!a.ignored&&a.displayTemperature!==null&&a.displayTemperature!==void 0),[n]),M=f.useMemo(()=>n.filter(a=>a&&a.isoDate),[n]),G=B.length>0,ee=f.useMemo(()=>{var a;if(!M.length)return null;for(let c=0;c<M.length;c+=1)if(((a=M[c])==null?void 0:a.peakStatus)==="P")return c;return null},[M]),x=f.useMemo(()=>{var I;if(!M.length)return null;let a=null;for(let j=0;j<M.length;j+=1)if(((I=M[j])==null?void 0:I.peakStatus)==="3"){a=j;break}if(a!=null){const j=a+1;return j>=M.length?a:j}if(ee==null)return null;const c=M[ee];if(!(c!=null&&c.isoDate))return null;const i=Ae(c.isoDate);for(let j=ee+1;j<M.length;j+=1){const k=M[j];if(!(k!=null&&k.isoDate))continue;if(lt(Ae(k.isoDate),i)>=4)return j}return null},[M,ee]),{baselineTemp:V,baselineStartIndex:P,firstHighIndex:$,baselineIndices:ie,ovulationDetails:ue}=f.useMemo(()=>Ut(n),[n]),ae=f.useMemo(()=>({...ue??{confirmed:!1,confirmationIndex:null,infertileStartIndex:null,rule:null,highSequenceIndices:[],usedIndices:[],ovulationIndex:null},peakDayIndex:ee,peakInfertilityStartIndex:x}),[ue,ee,x]),{tempMin:de,tempMax:he}=f.useMemo(()=>{const a=B.map(I=>I.displayTemperature).filter(I=>I!=null);if(a.length===0)return{tempMin:rt,tempMax:st};let c=Math.min(...a,rt),i=Math.max(...a,st);if(c=Math.floor(c*2)/2,i=Math.ceil(i*2)/2,i-c<2){const I=(c+i)/2;c=I-1,i=I+1}return{tempMin:c,tempMax:i}},[B]),we=he-de,pe=h.width,se=h.height,r=9,_=(a=1)=>{if(!d)return r*a;const c=Math.min(pe,se);return Math.max(8,Math.min(r*a,c/(M.length>0?40/a:40)))},m=_(d?1.6:2.5),O=L||F==="landscape",X=m*(O?9:5),W={top:d?Math.max(O?6:12,se*(O?.015:.03)):12,right:d?Math.max(O?35:30,pe*(O?.02:.05)):50,bottom:(d?Math.max(O?0:40,se*(O?0:.11)):60)+X+25,left:d?Math.max(O?45:20,pe*(O?.02:.05)):50},q=a=>{if(a==null||we===0)return se-W.bottom;const c=se-W.top-W.bottom;return c<=0?se-W.bottom:se-W.bottom-(a-de)/we*c},te=a=>{const c=d&&!(L||F==="landscape")?5:10,i=d&&!(L||F==="landscape")?25:0,I=pe-W.left-W.right-c-i*(M.length-1);if(I<=0)return W.left+c+i*a;const j=M.length>1?M.length-1:1;return j===0||M.length===0?W.left+c+i*a:W.left+c+a*(I/(M.length===1?1:j))+i*a},le=(a,c,i)=>{if(!a){u();return}const I=g.current.getBoundingClientRect();let j,k;if(i.type.startsWith("touch")){const oe=i.changedTouches[0];j=oe.clientX,k=oe.clientY}else j=i.clientX,k=i.clientY;const H=te(c),K=a.displayTemperature??a.temperature_chart??null,T=q(K);D({svgX:H,svgY:T,clientX:j-I.left+g.current.scrollLeft,clientY:k-I.top+g.current.scrollTop}),l(c),w(a)};return f.useEffect(()=>{const a=c=>{var i;if(p.current&&!p.current.contains(c.target)){const I=(i=g.current)==null?void 0:i.querySelectorAll("circle, text, rect");let j=!1;if(I){for(let k of I)if(k.contains(c.target)){j=!0;break}}j||u()}};return Y&&(document.addEventListener("mousedown",a),document.addEventListener("touchstart",a)),()=>{document.removeEventListener("mousedown",a),document.removeEventListener("touchstart",a)}},[Y,u]),{chartRef:g,tooltipRef:p,dimensions:h,activePoint:Y,activeIndex:o,tooltipPosition:S,processedData:n,validDataForLine:B,allDataPoints:M,tempMin:de,tempMax:he,tempRange:we,padding:W,textRowHeight:m,setActivePoint:w,setActiveIndex:l,getY:q,getX:te,handlePointInteraction:le,clearActivePoint:u,handleToggleIgnore:a=>{A&&a&&(A(Q,a),u())},responsiveFontSize:_,baselineTemp:V,baselineStartIndex:P,baselineIndices:ie,firstHighIndex:$,ovulationDetails:ae,hasTemperatureData:G}},Yt=({data:s,isFullScreen:d,orientation:F,onToggleIgnore:A,onEdit:Q,onTogglePeak:E,cycleId:L,initialScrollIndex:g=0,visibleDays:p=5,showInterpretation:h=!1,reduceMotion:U=!1,forceLandscape:Y=!1,currentPeakIsoDate:w=null})=>{const{chartRef:S,tooltipRef:D,dimensions:o,activePoint:l,activeIndex:u,tooltipPosition:y,allDataPoints:n,validDataForLine:B,tempMin:M,tempMax:G,tempRange:ee,padding:x,textRowHeight:V,getY:P,getX:$,handlePointInteraction:ie,handleToggleIgnore:ue,responsiveFontSize:ae,clearActivePoint:de,baselineTemp:he,baselineStartIndex:we,baselineIndices:pe,firstHighIndex:se,ovulationDetails:r,hasTemperatureData:_}=qt(s,d,F,A,L,p,Y),m=f.useRef(null);if(!m.current){const C=Math.random().toString(36).slice(2,10);m.current=`fertility-chart-${L??"default"}-${C}`}const O=m.current;if(!n||n.length===0)return e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-pink-100 to-rose-100 rounded-full mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-pink-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),e.jsx("p",{className:"text-slate-400 font-medium",children:"No hay datos para mostrar en el gráfico"})]});const N=o.width,X=o.height,W=he!=null?P(he):null,q=!!(r!=null&&r.confirmed),te=he!=null,le=$(0),Ee=n.length>0?$(n.length-1):N-x.right,a=q?"#F59E0B":"#94A3B8",c=q?"6 4":"4 4",i=q?1:.7,I=3,j=N===0,k=u!=null?$(u):null,H=u!=null?u>0?$(u-1):k:null,K=u!=null?u<n.length-1?$(u+1):k:null,T=Math.max((N-x.left-x.right)/Math.max(n.length,1),0),oe=u!=null?Math.max((K!=null&&H!=null?K-H:0)||T,T,0):0,xe=f.useMemo(()=>{const C=new Map;return B.forEach(J=>{J&&J.id!=null&&C.set(J.id,J)}),C},[B]),fe=f.useMemo(()=>r!=null&&r.confirmed&&Number.isFinite(r==null?void 0:r.infertileStartIndex)?r.infertileStartIndex:null,[r]),t=f.useMemo(()=>Number.isFinite(r==null?void 0:r.peakInfertilityStartIndex)?r.peakInfertilityStartIndex:null,[r]),b=f.useMemo(()=>fe==null||t==null?null:Math.max(fe,t),[fe,t]),v=Math.max(X-x.top-x.bottom,0),ne=`${O}-temperature-below`,R=`${O}-temperature-above`,z=f.useCallback(C=>!Number.isFinite(C)||!n.length||C<=0?x.left:$(C),[n,$,x.left]),Ie=f.useCallback(C=>!Number.isFinite(C)||!n.length||C>=n.length-1?N-x.right:$(C+1),[n,N,$,x.right]),me=f.useCallback((C,J,{inclusiveEnd:re=!0}={})=>{if(!Number.isFinite(C)||!Number.isFinite(J)||n.length===0)return null;const ge=be=>Math.max(0,Math.min(n.length-1,Math.floor(be))),Ce=be=>Math.max(0,Math.min(n.length-1,Math.floor(be))),Ye=be=>Math.max(0,Math.min(n.length,Math.floor(be))),Be=ge(C),Se=re?Ce(J):Ye(J),Re=Be<=0?x.left:z(Be);let ye;re?ye=Se>=n.length-1?N-x.right:Ie(Se):Se<=0?ye=x.left:Se>=n.length?ye=N-x.right:ye=z(Se);const Pe=Math.max(ye-Re,0);return Pe<=0?null:{x:Re,width:Pe}},[n,N,z,Ie,x.left,x.right]),je=f.useMemo(()=>{if(!_||v<=0)return{below:null,above:null};const C=X-x.bottom,J=x.top,re=n.map((ye,Pe)=>{const be=ye?xe.get(ye.id):null;return!be||!Number.isFinite(be.displayTemperature)?null:{index:Pe,x:$(Pe),y:P(be.displayTemperature)}}).filter(Boolean);if(!re.length)return{below:null,above:null};const ge=re[0],Ce=re[re.length-1],Ye=z(ge.index),Be=N-x.right,Se=[...re];Se[Se.length-1].x!==Be&&Se.push({index:Ce.index,x:Be,y:Ce.y});const Re=ye=>[`M ${Ye} ${ye}`,`L ${ge.x} ${ge.y}`,...Se.slice(1).map(({x:be,y:ot})=>`L ${be} ${ot}`),`L ${Be} ${ye}`,"Z"].join(" ");return{below:Re(C),above:Re(J)}},[n,v,X,N,z,$,P,_,x.bottom,x.right,x.top,xe]),Z=f.useMemo(()=>{if(!h||!(r!=null&&r.confirmed)||fe==null||v<=0)return null;const C=b==null,J=b??n.length-1;return J<fe?null:me(fe,J,{inclusiveEnd:C})},[h,r,fe,v,b,n.length,me]),ke=f.useMemo(()=>{if(!h||t==null||v<=0)return null;const C=b==null,J=b??n.length-1;return J<t?null:me(t,J,{inclusiveEnd:C})},[h,t,v,b,n.length,me]),Me=f.useMemo(()=>!h||b==null||v<=0?null:me(b,n.length-1),[h,b,v,n.length,me]),De=f.useMemo(()=>{if(!h||!(r!=null&&r.confirmed))return null;const C=Array.isArray(r==null?void 0:r.highSequenceIndices)?r.highSequenceIndices:[];if(C.length<2)return null;const J=C.map(re=>{if(re==null||re<0||re>=n.length)return null;const ge=n[re],Ce=xe.get(ge==null?void 0:ge.id);return!Ce||!Number.isFinite(Ce.displayTemperature)?null:{x:$(re),y:P(Ce.displayTemperature)}}).filter(Boolean);return J.length<2?null:J.map(({x:re,y:ge},Ce)=>`${Ce===0?"M":"L"} ${re} ${ge}`).join(" ")},[h,r,n,xe,$,P]),[ve,Fe]=f.useState({w:typeof window<"u"?window.innerWidth:0,h:typeof window<"u"?window.innerHeight:0}),$e=ve.w<ve.h;f.useEffect(()=>{const C=()=>Fe({w:window.innerWidth,h:window.innerHeight});return window.addEventListener("resize",C),window.addEventListener("orientationchange",C),()=>{window.removeEventListener("resize",C),window.removeEventListener("orientationchange",C)}},[]),f.useEffect(()=>{if(!S.current)return;const C=S.current.clientWidth/p;S.current.scrollLeft=Math.max(0,C*g)},[g,p,o.width,F]);const Ne=Y&&$e,Ue=Ne,Te="w-full h-full bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100",qe=d?`${Te} min-h-full ${Ue?"flex items-stretch justify-start overflow-y-auto overflow-x-hidden":"flex items-center justify-start overflow-x-auto overflow-y-hidden"}`:`${Te} overflow-x-auto overflow-y-hidden border border-pink-100/50`,_e=!d||F==="portrait";return e.jsxs(ce.div,{className:"relative w-full h-full",initial:!1,children:[_e&&e.jsx("div",{className:"absolute left-0 top-0 h-full bg-transparent pointer-events-none z-10",style:{width:x.left},children:e.jsx($t,{padding:x,chartHeight:X,tempMin:M,tempMax:G,tempRange:ee,getY:P,responsiveFontSize:ae,textRowHeight:V,isFullScreen:d})}),e.jsxs(ce.div,{ref:S,className:`relative p-0 ${d?"":"rounded-2xl"} ${qe}`,style:{boxShadow:d?"inset 0 1px 3px rgba(244, 114, 182, 0.1)":"0 8px 32px rgba(244, 114, 182, 0.12), 0 2px 8px rgba(244, 114, 182, 0.08)",...Ne?{position:"absolute",top:0,left:0,width:`${ve.h}px`,height:`${ve.w}px`,transform:"rotate(90deg) translateY(-100%)",transformOrigin:"top left"}:{}},initial:!1,children:[j&&e.jsx("div",{className:"flex items-center justify-center w-full h-full text-slate-400",children:"Cargando..."}),e.jsxs(ce.svg,{width:N,height:X,className:"font-sans flex-shrink-0",viewBox:`0 0 ${N} ${X}`,preserveAspectRatio:"xMidYMid meet",initial:!1,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),e.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),e.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),e.jsxs("linearGradient",{id:"tempAreaGradientChart",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(244,114,182,0.25)"}),e.jsx("stop",{offset:"50%",stopColor:"rgba(236,72,153,0.15)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(233,30,99,0.05)"})]}),e.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[e.jsx("rect",{width:"6",height:"6",fill:"#ef4444"}),e.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(255,255,255,0.85)"})]}),e.jsxs("filter",{id:"chartShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("filter",{id:"baselineGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("pattern",{id:"temperatureInfertilityPattern",patternUnits:"userSpaceOnUse",width:"14",height:"14",children:[e.jsx("rect",{width:"14",height:"14",fill:"rgba(191, 219, 254, 0.45)"}),e.jsx("path",{d:"M0 0 L14 14",stroke:"rgba(59, 130, 246, 0.55)",strokeWidth:"1.4"}),e.jsx("path",{d:"M14 0 L0 14",stroke:"rgba(59, 130, 246, 0.55)",strokeWidth:"1.4"})]}),e.jsxs("pattern",{id:"peakInfertilityPattern",patternUnits:"userSpaceOnUse",width:"12",height:"12",children:[e.jsx("rect",{width:"12",height:"12",fill:"rgba(167, 243, 208, 0.42)"}),e.jsx("circle",{cx:"3",cy:"3",r:"1.7",fill:"rgba(13, 148, 136, 0.55)"}),e.jsx("circle",{cx:"9",cy:"9",r:"1.7",fill:"rgba(13, 148, 136, 0.55)"})]}),e.jsxs("pattern",{id:"absoluteInfertilityPattern",patternUnits:"userSpaceOnUse",width:"16",height:"16",children:[e.jsx("rect",{width:"16",height:"16",fill:"rgba(56, 189, 248, 0.45)"}),e.jsx("path",{d:"M0 0 L16 16",stroke:"rgba(13, 148, 136, 0.6)",strokeWidth:"1.2"}),e.jsx("path",{d:"M16 0 L0 16",stroke:"rgba(13, 148, 136, 0.6)",strokeWidth:"1.2"}),e.jsx("circle",{cx:"4",cy:"12",r:"1.6",fill:"rgba(19, 78, 74, 0.6)"}),e.jsx("circle",{cx:"12",cy:"4",r:"1.6",fill:"rgba(19, 78, 74, 0.6)"})]}),_&&je.below&&e.jsx("clipPath",{id:ne,clipPathUnits:"userSpaceOnUse",children:e.jsx("path",{d:je.below})}),_&&je.above&&e.jsx("clipPath",{id:R,clipPathUnits:"userSpaceOnUse",children:e.jsx("path",{d:je.above})})]}),e.jsx("rect",{width:"100%",height:"100%",fill:"transparent"}),e.jsx(Ct,{padding:x,chartWidth:N,chartHeight:X,tempMin:M,tempMax:G,tempRange:ee,getY:P,getX:$,allDataPoints:n,responsiveFontSize:ae,isFullScreen:d,showLeftLabels:!_e,reduceMotion:U}),h&&e.jsxs(e.Fragment,{children:[ke&&(_&&je.below?e.jsx("rect",{x:ke.x,y:x.top,width:ke.width,height:v,fill:"url(#peakInfertilityPattern)",opacity:.75,pointerEvents:"none",clipPath:`url(#${ne})`}):e.jsx("rect",{x:ke.x,y:x.top,width:ke.width,height:v,fill:"url(#peakInfertilityPattern)",opacity:.75,pointerEvents:"none"})),Z&&(_&&je.above?e.jsx("rect",{x:Z.x,y:x.top,width:Z.width,height:v,fill:"url(#temperatureInfertilityPattern)",opacity:.7,pointerEvents:"none",clipPath:`url(#${R})`}):e.jsx("rect",{x:Z.x,y:x.top,width:Z.width,height:v,fill:"url(#temperatureInfertilityPattern)",opacity:.7,pointerEvents:"none"})),Me&&e.jsx("rect",{x:Me.x,y:x.top,width:Me.width,height:v,fill:"url(#absoluteInfertilityPattern)",opacity:.5,pointerEvents:"none"})]}),h&&te&&W!==null&&(U?e.jsx("line",{x1:le,y1:W,x2:Ee,y2:W,stroke:a,strokeWidth:I,strokeDasharray:c,opacity:i}):e.jsx(ce.path,{d:`M ${le} ${W} L ${Ee} ${W}`,stroke:a,strokeWidth:I,strokeDasharray:c,opacity:i,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:i},transition:{duration:4,ease:"easeInOut",delay:.5}})),e.jsx(St,{data:B,allDataPoints:n,getX:$,getY:P,baselineY:X-x.bottom,temperatureField:"displayTemperature",reduceMotion:U}),De&&e.jsx("path",{d:De,fill:"none",stroke:"#cc0e93",strokeWidth:6,strokeLinecap:"round",strokeLinejoin:"round",opacity:.85,style:{filter:"drop-shadow(0 2px 6px rgba(206, 14, 147, 0.4))"},pointerEvents:"none"}),u!==null&&k!==null&&oe>0&&e.jsx("g",{pointerEvents:"none",children:(()=>{const C=X-x.bottom,J=Math.max(3,Math.min(14,oe*.4)),re=Math.max(J*2,V*.85);return e.jsxs(e.Fragment,{children:[e.jsx("line",{x1:k,y1:0,x2:k,y2:C,stroke:"rgba(235, 171, 204,0.15)",strokeWidth:J}),e.jsx("line",{x1:k,y1:C,x2:k,y2:X,stroke:"rgba(235, 171, 204,0.15)",strokeWidth:re})]})})()}),e.jsx(Rt,{data:n,getX:$,getY:P,isFullScreen:d,orientation:F,responsiveFontSize:ae,onPointInteraction:ie,clearActivePoint:de,activePoint:l,padding:x,chartHeight:X,chartWidth:N,temperatureField:"displayTemperature",textRowHeight:V,compact:!1,reduceMotion:U,showInterpretation:h,ovulationDetails:r,baselineStartIndex:we,firstHighIndex:se,baselineIndices:pe})]}),l&&e.jsx(ce.div,{ref:D,initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:10},transition:{duration:.12,ease:"easeOut"},children:e.jsx(xt,{point:l,position:y,chartWidth:N,chartHeight:X,onToggleIgnore:ue,onEdit:Q,onClose:de,onTogglePeak:E,currentPeakIsoDate:w})})]})]})};function Ht(s,d){if(!s||!d)return[];const F=typeof s=="string"?Ae(s):s;return[...Array(d)].map((A,Q)=>{const E=at(F,Q),L=Ge(E,"yyyy-MM-dd"),g=Ge(E,"dd/MM"),p=Je(Le(E),Le(F))+1;return{date:g,isoDate:L,cycleDay:p,temperature:null,mucusSensation:null,mucusAppearance:null,id:`placeholder-${L}`,ignored:!1,peak_marker:null}})}const rn=()=>{const{cycleId:s}=ct(),{currentCycle:d,archivedCycles:F,isLoading:A,addOrUpdateDataPoint:Q,toggleIgnoreRecord:E,getCycleById:L}=mt(),[g,p]=f.useState(null),[h,U]=f.useState(!1),[Y,w]=f.useState(!1),S=!s||s===d.id,D=S?null:F.find(t=>t.id===s);f.useEffect(()=>{if(S){p(null),U(!1),w(!1);return}if(D){p(null),U(!1),w(!1);return}let t=!0;return U(!0),L(s).then(b=>{t&&(b?(p(b),w(!1)):(p(null),w(!0)))}).catch(()=>{t&&(p(null),w(!0))}).finally(()=>{t&&U(!1)}),()=>{t=!1}},[S,D,L,s]);const o=S?d:D||g,l=!S&&!D,u=!S&&(o==null?void 0:o.id),y=S?A&&!(d!=null&&d.id):h||A&&!D&&!g,[n,B]=f.useState(typeof window<"u"&&window.innerWidth>window.innerHeight?"landscape":"portrait"),[M,G]=f.useState(!1),[ee,x]=f.useState(!1),[V,P]=f.useState(null),[$,ie]=f.useState(!1),[ue,ae]=f.useState(!1),de=f.useRef(!1),he=!!(V&&String(V.id||"").startsWith("placeholder-"));if(f.useEffect(()=>{const t=async()=>{var v,ne;const b=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement);if(G(b),!b){try{const R=typeof window<"u"?(v=window.screen)==null?void 0:v.orientation:null;await((ne=R==null?void 0:R.unlock)==null?void 0:ne.call(R))}catch{}B("portrait")}};return document.addEventListener("fullscreenchange",t),document.addEventListener("webkitfullscreenchange",t),document.addEventListener("mozfullscreenchange",t),document.addEventListener("MSFullscreenChange",t),()=>{document.removeEventListener("fullscreenchange",t),document.removeEventListener("webkitfullscreenchange",t),document.removeEventListener("mozfullscreenchange",t),document.removeEventListener("MSFullscreenChange",t)}},[]),f.useLayoutEffect(()=>{window.dispatchEvent(new Event("resize"))},[n,M]),y)return e.jsx(We,{children:e.jsx("div",{className:"flex h-full flex-col items-center justify-center space-y-4 bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100 px-4 py-8 text-center text-pink-600",children:e.jsx("p",{children:"Cargando…"})})});if(!(o!=null&&o.id))return s&&Y?e.jsx(We,{children:e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 px-4 py-8 text-center text-pink-600",children:[e.jsx("p",{children:"No se encontró el ciclo solicitado."}),e.jsx(Oe,{asChild:!0,className:"bg-gradient-to-r from-pink-500 to-rose-500 text-white shadow",children:e.jsx(He,{to:"/archived-cycles",children:"Volver a Mis Ciclos"})})]})}):e.jsx(We,{children:e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 px-4 py-8 text-center text-pink-600",children:[e.jsx("p",{children:"No hay ciclo activo."}),e.jsx(Oe,{asChild:!0,className:"bg-gradient-to-r from-pink-500 to-rose-500 text-white shadow",children:e.jsx(He,{to:"/records",children:"Ir a Mis Registros"})})]})});const we=28,pe=10,se=Ae(o.startDate),r=o.data||[],_=f.useMemo(()=>{const t=Array.isArray(r)?r.find(b=>(b==null?void 0:b.peak_marker)==="peak"):null;return(t==null?void 0:t.isoDate)||null},[r]),m=r.reduce((t,b)=>{const v=Ae(b.isoDate);return v>t?v:t},se),O=Le(new Date),N=m>O?m:O,X=Je(Le(N),se),W=Math.max(we,X+1),te=Ht(se,W).map(t=>{const b=r.find(v=>v.isoDate===t.isoDate);return b?{...b,date:t.date}:t}),le=n==="portrait"?pe:we;let Ee=0;if(n!=="landscape"){const t=Je(new Date,Le(se)),b=Math.min(Math.max(t,0),W-1);let v=Math.min(W,b+1);b<le-1&&(v=Math.min(W,le)),Ee=Math.max(0,v-le)}const a={background:"linear-gradient(135deg, #FFFAFC 0%, #f7eaef 100%)"},c=M?a:{...a,height:n==="landscape"?"calc(min(100dvh, 100dvw) - var(--bottom-nav-safe))":"calc(100dvh - var(--bottom-nav-safe))",maxHeight:"100vh",paddingBottom:"env(safe-area-inset-bottom)"},i=t=>{P(t),x(!0)},I=async(t,b)=>{try{if(await E(t,b),l){const v=await L(t);v&&p(v)}}catch(v){console.error("Error toggling ignore state:",v)}},j=async(t,b=!0)=>{if(!(o!=null&&o.id)||!(t!=null&&t.isoDate))return;const v=R=>{if(R==null||R==="")return null;const z=parseFloat(String(R).replace(",","."));return Number.isFinite(z)?z:null},ne=b??!(t.peak_marker==="peak"||t.peakStatus==="P");ie(!0);try{const R=t.timestamp?Ge(Ae(t.timestamp),"HH:mm"):Ge(new Date,"HH:mm");let z=Array.isArray(t.measurements)&&t.measurements.length>0?t.measurements:[{temperature:t.temperature_chart??t.temperature_raw??null,temperature_corrected:t.temperature_corrected??null,time:R,time_corrected:t.time_corrected??R,selected:!0,use_corrected:t.use_corrected??!1}];z.length===0&&(z=[{temperature:null,temperature_corrected:null,time:R,time_corrected:R,selected:!0,use_corrected:!1}]);const Ie=z.map((Z,ke)=>{const Me=Z.time||R,De=Z.time_corrected||Me;return{temperature:v(Z.temperature??Z.temperature_raw),time:Me,selected:ke===0?!0:!!Z.selected,temperature_corrected:v(Z.temperature_corrected),time_corrected:De,use_corrected:!!Z.use_corrected}});Ie.some(Z=>Z.selected)||(Ie[0].selected=!0);const me={isoDate:t.isoDate,measurements:Ie,mucusSensation:t.mucus_sensation??t.mucusSensation??"",mucusAppearance:t.mucus_appearance??t.mucusAppearance??"",fertility_symbol:t.fertility_symbol??"none",observations:t.observations??"",ignored:t.ignored??!1,peak_marker:ne?"peak":null},je=t!=null&&t.id&&!String(t.id).startsWith("placeholder-")?t:null;await Q(me,je,o.id)}catch(R){console.error("Error toggling peak marker:",R)}finally{ie(!1)}},k=async(t,{keepFormOpen:b=!1}={})=>{if(o!=null&&o.id){ie(!0);try{if(await Q(t,V,o.id),l){const v=await L(o.id);v&&p(v)}b||(x(!1),P(null))}finally{ie(!1)}}},H=()=>{x(!1),P(null)},K=t=>{P(t)},T=()=>{ae(t=>!t)},oe=t=>{if(t.preventDefault(),de.current){de.current=!1;return}T()},xe=t=>{t.pointerType==="touch"&&(t.preventDefault(),de.current=!0,T())},fe=async()=>{var v;const t=document.documentElement,b=typeof window<"u"?(v=window.screen)==null?void 0:v.orientation:null;if(M){if(b!=null&&b.unlock)try{await b.unlock()}catch(ne){console.error(ne)}try{const ne=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen,R=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;ne&&R&&await ne.call(document)}catch(ne){console.error(ne)}B("portrait"),G(!1)}else{let ne=!1,R=!1;try{const z=t.requestFullscreen||t.webkitRequestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen;R=!!z,z&&(await z.call(t),ne=!0)}catch(z){console.error(z)}if(b!=null&&b.lock)try{await b.lock("landscape")}catch(z){console.error(z)}B("landscape"),G(ne||!R)}};return e.jsx(We,{hideBottomNav:M,children:e.jsxs("div",{className:M?"fixed inset-0 z-50 h-[100dvh] w-[100dvw] overflow-x-auto overflow-y-auto":"relative w-full overflow-x-auto overflow-y-auto",style:c,children:[u&&!M&&e.jsx(Oe,{asChild:!0,variant:"ghost",className:"absolute top-4 left-4 z-10 bg-white/80 text-slate-700 hover:bg-[#E27DBF]/20",children:e.jsxs(He,{to:`/cycle/${o.id}`,className:"flex items-center gap-1",children:[e.jsx(bt,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline"})]})}),e.jsx(Oe,{onClick:oe,onPointerUp:xe,variant:"ghost",size:"icon",className:`absolute top-4 right-20 z-10 p-2 rounded-full transition-colors ${ue?"bg-[#E27DBF] text-white hover:bg-[#d46ab3]":"bg-white/80 text-slate-700 hover:bg-[#E27DBF]/20"}`,children:ue?e.jsx(wt,{className:"h-4 w-4"}):e.jsx(jt,{className:"h-4 w-4"})}),e.jsx(Oe,{onClick:fe,className:"absolute top-4 right-4 z-10 bg-white/80 hover:bg-white text-gray-700 p-2 rounded-full shadow","aria-label":M?"Salir de pantalla completa":"Rotar gráfico",children:e.jsx(kt,{className:"w-5 h-5"})}),e.jsx(Yt,{data:te,isFullScreen:M,orientation:n,onToggleIgnore:I,onEdit:i,onTogglePeak:j,cycleId:o.id,initialScrollIndex:Ee,visibleDays:le,showInterpretation:ue,reduceMotion:!0,forceLandscape:n==="landscape",currentPeakIsoDate:_}),e.jsx(gt,{open:ee,onOpenChange:t=>{t||H()},children:e.jsx(yt,{hideClose:!0,className:"bg-transparent border-none p-0 text-gray-800 w-[90vw] sm:w-auto max-w-md sm:max-w-lg md:max-w-xl max-h-[85vh] overflow-y-auto",children:e.jsx(pt,{onSubmit:k,onCancel:H,initialData:V,cycleStartDate:o.startDate,cycleEndDate:o.endDate,isProcessing:$,isEditing:!!V&&!he,cycleData:o.data,onDateSelect:K})})})]})})};export{rn as default};
