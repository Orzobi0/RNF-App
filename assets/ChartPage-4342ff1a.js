import{c as Tt,m as K,j as t,s as dt,p as ut,r as v,h as Bt,f as Et,d as wt,g as Gt,M as kt,B as mt,L as Nt}from"./index-752021ba.js";import{g as Rt,i as Ot,D as Wt}from"./DataEntryForm-99673c61.js";import{C as Ft}from"./ChartTooltip-5350e5f6.js";import{a as Pt}from"./useCycleData-af0f9bf4.js";import{D as _t,a as $t}from"./dialog-9607b487.js";import{E as Ut}from"./eye-off-1c06221e.js";import{E as Yt}from"./eye-67758e41.js";import"./input-235c5ced.js";import"./label-0ecf343f.js";const Vt=Tt("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),zt=({padding:e,chartWidth:a,chartHeight:E,tempMin:y,tempMax:k,tempRange:m,getY:d,getX:h,allDataPoints:g=[],responsiveFontSize:j,isFullScreen:T,showLeftLabels:I=!1,reduceMotion:o=!1})=>{const l={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.3,ease:"easeOut"}}},f=[];if(m>0){const c=m<=2.5?.1:.5;for(let w=y;w<=k+1e-9;w+=c)f.push(parseFloat(w.toFixed(1)))}else for(let c=35;c<=37.5+1e-9;c+=.5)f.push(parseFloat(c.toFixed(1)));const r=o?"g":K.g;return t.jsxs(t.Fragment,{children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"bgGradientChart",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(254, 242, 242, 0.95)"}),t.jsx("stop",{offset:"30%",stopColor:"rgba(255, 241, 242, 0.9)"}),t.jsx("stop",{offset:"70%",stopColor:"rgba(255, 245, 255, 0.95)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(254, 242, 242, 0.8)"})]}),t.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),t.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),t.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),t.jsxs("filter",{id:"chartGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsx("filter",{id:"textShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:t.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodColor:"rgba(255, 255, 255, 0.8)"})}),t.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[t.jsx("rect",{width:"6",height:"6",fill:"#ef4444"}),t.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(255,255,255,0.85)"})]})]}),t.jsx("rect",{x:e.left,y:e.top,width:a-e.left-e.right,height:E-e.top-e.bottom,fill:"url(#bgGradientChart)",opacity:2,rx:12,style:{filter:"drop-shadow(0 4px 12px rgba(244, 114, 182, 0.1))"}}),f.map((c,w)=>{const A=d(c),G=c.toFixed(1).endsWith(".0")||c.toFixed(1).endsWith(".5"),D=G?c.toFixed(1):`.${c.toFixed(1).split(".")[1]}`;return t.jsxs(r,{...o?{}:{variants:l},children:[t.jsx("line",{x1:e.left,y1:A,x2:a-e.right,y2:A,stroke:G?"rgba(244, 114, 182, 0.3)":"rgba(244, 114, 182, 0.15)",strokeWidth:G?3:2,strokeDasharray:G?"0":"4,4",style:{filter:G?"drop-shadow(0 1px 3px rgba(244, 114, 182, 0.15))":"none",opacity:G?1:.7}}),I&&t.jsx("text",{x:e.left-j(1),y:A+j(.35),textAnchor:"end",fontSize:j(G?1.1:1),fontWeight:G?"700":"600",fill:G?"#E91E63":"#EC4899",style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:D}),t.jsx("text",{x:a-e.right+j(1),y:A+j(.35),textAnchor:"start",fontSize:j(G?1.1:1),fontWeight:G?"700":"600",fill:G?"#E91E63":"#EC4899",style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:D})]},`temp-tick-${w}`)}),g.map((c,w)=>{const A=h(w);return t.jsx("line",{x1:A,y1:e.top,x2:A,y2:E-e.bottom,stroke:"rgba(244, 114, 182, 0.08)",strokeWidth:2.8,style:{filter:"drop-shadow(0 0 1px rgba(244, 114, 182, 0.05))"}},`day-grid-${w}`)}),t.jsx("rect",{x:e.left,y:e.top,width:a-e.left-e.right,height:E-e.top-e.bottom,fill:"none",stroke:"rgba(244, 114, 182, 0.4)",strokeWidth:4,rx:8,style:{filter:"drop-shadow(0 4px 12px rgba(244, 114, 182, 0.15))",strokeDasharray:"0"}}),I&&t.jsx(r,{...o?{}:{variants:l},children:t.jsx("text",{x:e.left+j(1.2),y:e.top+j(1.5),textAnchor:"middle",fontSize:j(1.4),fontWeight:"800",fill:"#E91E63",style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:"°C"})})]})},Ht=({data:e,allDataPoints:a,getX:E,getY:y,baselineY:k,temperatureField:m="temperature",reduceMotion:d=!1})=>{if(!e||e.length<2)return null;let h="",g=null;const j=[];if(a.forEach((o,l)=>{const f=e.find(r=>r.id===o.id);if(f&&f[m]!==null&&f[m]!==void 0&&!f.ignored){const r=E(l),c=y(f[m]);j.push({x:r,y:c}),g!==null&&l===g+1?h+=` L ${r} ${c}`:h+=`${h?" ":""}M ${r} ${c}`,g=l}}),j.length<2)return null;const T=h.includes("L"),I=j.length>1?j.map(({x:o,y:l},f)=>`${f===0?"M":"L"} ${o} ${l}`).join(" "):"";return t.jsxs(t.Fragment,{children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),t.jsx("stop",{offset:"30%",stopColor:"#EC4899"}),t.jsx("stop",{offset:"70%",stopColor:"#E91E63"}),t.jsx("stop",{offset:"100%",stopColor:"#C2185B"})]}),t.jsxs("linearGradient",{id:"tempLineGradientChartGlow",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(244, 114, 182, 0.6)"}),t.jsx("stop",{offset:"30%",stopColor:"rgba(236, 72, 153, 0.7)"}),t.jsx("stop",{offset:"70%",stopColor:"rgba(233, 30, 99, 0.8)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(194, 24, 91, 0.6)"})]}),t.jsxs("filter",{id:"lineGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"4",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsx("filter",{id:"lineShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:t.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"3",floodColor:"rgba(244, 114, 182, 0.4)"})})]}),T&&(d?t.jsx("path",{d:h,fill:"none",stroke:"url(#tempLineGradientChartGlow)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:.4,style:{filter:"url(#lineGlow)"}}):t.jsx(K.path,{d:h,fill:"none",stroke:"url(#tempLineGradientChartGlow)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:.4,style:{filter:"url(#lineGlow)"},initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.4},transition:{duration:.8,ease:"easeInOut",delay:.2}})),I&&(d?t.jsx("path",{d:I,fill:"none",stroke:"#d587b1",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.65}):t.jsx(K.path,{d:I,fill:"none",stroke:"#d587b1",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.65,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.65},transition:{duration:.8,ease:"easeInOut"}})),T&&(d?t.jsx("path",{d:h,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#lineShadow)"}}):t.jsx(K.path,{d:h,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#lineShadow)"},initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:1},transition:{duration:1,ease:"easeInOut",delay:.4}})),T&&(d?t.jsx("path",{d:h,fill:"none",stroke:"rgba(255, 255, 255, 0.6)",strokeWidth:"0.3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.8}):t.jsx(K.path,{d:h,fill:"none",stroke:"rgba(255, 255, 255, 0.6)",strokeWidth:"0.3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.8,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.8},transition:{duration:1.2,ease:"easeInOut",delay:.6}}))]})},vt="#1565C0",St="#2E7D32",Lt="#6A1B9A",Xt="#EFF6FF",qt="#EEF2FF",Kt="#ECFDF5",Zt="#F0FDFA",Jt="#F5F3FF",Qt="#FAF5FF",te="rgba(148, 163, 184, 0.35)",ee="rgba(226, 232, 240, 0.6)",oe="rgba(148, 163, 184, 0.5)",re=e=>{if(!e)return"";const[a,E]=e.split("/");return`${parseInt(a,10)}/${parseInt(E,10)}`},gt=(e="",a,E,y="–")=>{if(!e)return[y,""];if(e.length<=a)return[e,""];if(E)return[e.slice(0,a),""];const k=e.indexOf(" ",a);return k===-1?[e.slice(0,a),e.slice(a)]:[e.slice(0,k),e.slice(k+1)]},jt=(e="",a,E="–")=>e?e.split(/\s+/).slice(0,a).join(" "):E,se=({data:e,getX:a,getY:E,isFullScreen:y,orientation:k,responsiveFontSize:m,onPointInteraction:d,clearActivePoint:h,activePoint:g,padding:j,chartHeight:T,chartWidth:I,temperatureField:o="temperature_chart",textRowHeight:l,compact:f=!1,reduceMotion:r=!1,showInterpretation:c=!1,ovulationDetails:w=null})=>{const A={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},G={hidden:{opacity:0,scale:.3},visible:{opacity:1,scale:1,transition:{duration:.6,ease:[.34,1.56,.64,1],type:"spring",stiffness:120,damping:12}}},D=T-j.bottom,H=D+l*1,et=D+l*2,P=D+l*3,_=D+l*(y?5:4.5),X=D+l*(y?7:6),q=D+l*(y?9:7.5),Z=I-j.left-j.right,Y=l*(y?2:1.5),rt=r?"g":K.g;return t.jsxs(t.Fragment,{children:[t.jsxs("defs",{children:[t.jsx("filter",{id:"rowShadowChart",x:"-10%",y:"-10%",width:"120%",height:"120%",children:t.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"4",floodColor:"rgba(244, 114, 182, 0.2)"})}),t.jsxs("filter",{id:"pointGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsxs("linearGradient",{id:"sensationGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:Xt}),t.jsx("stop",{offset:"100%",stopColor:qt})]}),t.jsxs("linearGradient",{id:"appearanceGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:Kt}),t.jsx("stop",{offset:"100%",stopColor:Zt})]}),t.jsxs("linearGradient",{id:"observationGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:Jt}),t.jsx("stop",{offset:"100%",stopColor:Qt})]}),t.jsxs("radialGradient",{id:"tempPointGradientChart",cx:"30%",cy:"30%",children:[t.jsx("stop",{offset:"0%",stopColor:"#FCE7F3"}),t.jsx("stop",{offset:"40%",stopColor:"#F472B6"}),t.jsx("stop",{offset:"80%",stopColor:"#E91E63"}),t.jsx("stop",{offset:"100%",stopColor:"#C2185B"})]}),t.jsxs("radialGradient",{id:"tempPointIgnoredGradient",cx:"30%",cy:"30%",children:[t.jsx("stop",{offset:"0%",stopColor:"#FFFFFF"}),t.jsx("stop",{offset:"80%",stopColor:"#F8FAFC"}),t.jsx("stop",{offset:"100%",stopColor:"#E2E8F0"})]}),t.jsxs("radialGradient",{id:"ovulationPointGradient",cx:"30%",cy:"30%",children:[t.jsx("stop",{offset:"0%",stopColor:"#bfdbfe"}),t.jsx("stop",{offset:"45%",stopColor:"#60a5fa"}),t.jsx("stop",{offset:"85%",stopColor:"#2563eb"}),t.jsx("stop",{offset:"100%",stopColor:"#1d4ed8"})]})]}),!f&&t.jsxs("g",{children:[t.jsx("rect",{x:j.left,y:_-Y/2,width:Z,height:Y,fill:"url(#sensationGradientChart)",rx:4,style:{filter:"url(#rowShadowChart)"}}),t.jsx("rect",{x:j.left,y:X-Y/2,width:Z,height:Y,fill:"url(#appearanceGradientChart)",rx:4,style:{filter:"url(#rowShadowChart)"}}),t.jsx("rect",{x:j.left,y:q-Y/2,width:Z,height:Y,fill:"url(#observationGradientChart)",rx:4,style:{filter:"url(#rowShadowChart)"}})]}),y&&k!=="portrait"&&t.jsx(K.g,{variants:A,children:[{label:"Fecha",row:1,color:y?"#374151":"#6B7280"},{label:"Día",row:2,color:y?"#374151":"#6B7280"},{label:"Símbolo",row:3,color:y?"#374151":"#6B7280"},{label:"Sens.",row:y?5:4.5,color:vt},{label:"Apar.",row:y?7:6,color:St},{label:"Observ.",row:y?9:7.5,color:Lt}].map(({label:i,row:z,color:S})=>t.jsx("text",{x:j.left-m(.5),y:D+l*z,textAnchor:"end",fontSize:m(1.05),fontWeight:"700",fill:S,style:{filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:i},i))}),e.map((i,z)=>{const S=a(z),u=i[o]!=null?E(i[o]):D,$=i.temperature_raw,U=i.temperature_corrected,J=i.use_corrected&&$!=null&&U!=null&&Math.abs(U-$)>.01,Q=J?E($):null,st=y?"#374151":"#6B7280",s=i[o]!=null,C=s||i.mucus_sensation||i.mucus_appearance||i.fertility_symbol,n=String(i.id||"").startsWith("placeholder-"),b=w==null?void 0:w.ovulationIndex,x=c&&(w==null?void 0:w.confirmed)&&b!=null&&!i.ignored&&s&&z===b,N=!C||n?{}:{pointerEvents:"all",style:{cursor:"pointer"},onMouseEnter:L=>d(i,z,L),onClick:L=>d(i,z,L)},R=Rt(i.fertility_symbol);let B="transparent";if(R!=null&&R.color){const L=R.color.replace(/^bg-/,"");L==="red-500"?B="#ef4444":L==="white"?B="#ffffff":L==="green-500"?B="#22c55e":L==="pink-300"&&(B="#f9a8d4")}const M=m(y?1.8:2),V=i.isoDate?Ot(dt(ut(i.isoDate)),dt(new Date)):!1,tt=y?4:7,nt=2,[ot,ft]=gt(y?jt(i.mucus_sensation,nt,V?"":"–"):i.mucus_sensation,tt,!1,V?"":"–"),[xt,at]=gt(y?jt(i.mucus_appearance,nt,V?"":"–"):i.mucus_appearance,tt,!1,V?"":"–"),[p,O]=gt(y?jt(i.observations,nt,""):i.observations,tt,!1,"");return t.jsxs(rt,{...r?{}:{variants:A},...N,children:[s&&t.jsxs(rt,{...r?{}:{variants:G},children:[J&&Q!==null&&t.jsxs("g",{pointerEvents:"none",children:[t.jsx("line",{x1:S,y1:Q,x2:S,y2:u,stroke:te,strokeWidth:1,strokeDasharray:"4 4"}),t.jsx("circle",{cx:S,cy:Q,r:3.5,fill:ee,stroke:oe,strokeWidth:1}),t.jsx("circle",{cx:S,cy:Q,r:1.2,fill:"rgba(255, 255, 255, 0.6)"})]}),t.jsx("circle",{cx:S,cy:u,r:x?2:1.5,fill:x?"rgba(59, 130, 246, 0.28)":"rgba(244, 114, 182, 0.2)",opacity:.85,style:{filter:"url(#pointGlow)"}}),t.jsx("circle",{cx:S,cy:u,r:x?4.2:3.5,fill:"none",stroke:i.ignored?"rgba(148, 163, 184, 0.4)":x?"rgba(37, 99, 235, 0.55)":"rgba(244, 114, 182, 0.3)",strokeWidth:x?2:1.5,opacity:x?.9:.6}),t.jsx("circle",{cx:S,cy:u,r:x?4.6:4,fill:i.ignored?"url(#tempPointIgnoredGradient)":x?"url(#ovulationPointGradient)":"url(#tempPointGradientChart)",stroke:i.use_corrected?"#F59E0B":i.ignored?"#94A3B8":x?"#1d4ed8":"#E91E63",strokeWidth:i.ignored?2:x?3.2:3,style:{filter:x?"drop-shadow(0 3px 8px rgba(37, 99, 235, 0.45))":"drop-shadow(0 3px 6px rgba(244, 114, 182, 0.4))",cursor:"pointer"},pointerEvents:"all",onMouseEnter:L=>d(i,z,L),onTouchStart:L=>d(i,z,L),onClick:L=>d(i,z,L)}),!i.ignored&&t.jsx("circle",{cx:S,cy:u,r:x?1.8:1.5,fill:x?"rgba(239, 246, 255, 0.95)":"rgba(255, 255, 255, 0.9)",style:{filter:x?"drop-shadow(0 1px 3px rgba(37, 99, 235, 0.45))":"drop-shadow(0 1px 2px rgba(244, 114, 182, 0.3))"}}),x&&t.jsx("circle",{cx:S,cy:u,r:6.5,fill:"none",stroke:"rgba(37, 99, 235, 0.35)",strokeWidth:1.2,strokeDasharray:"4 3"})]}),t.jsx("text",{x:S,y:H,textAnchor:"middle",fontSize:m(1.05),fontWeight:"900",fill:st,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:re(i.date)}),t.jsx("text",{x:S,y:et,textAnchor:"middle",fontSize:m(1),fontWeight:"900",fill:st,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:i.cycleDay}),!n&&(R.value!=="none"?t.jsxs("g",{children:[t.jsx("rect",{x:S-M/2+1,y:P-M*.75+1,width:M,height:M,fill:"rgba(0, 0, 0, 0.1)",rx:M*.3,opacity:.5}),t.jsx("rect",{x:S-M/2-4,y:P-M*.75,width:M*1.4,height:M,fill:R.pattern==="spotting-pattern"?"url(#spotting-pattern-chart)":B,stroke:R.value==="white"?"#CBD5E1":"rgba(233, 30, 99, 0.4)",strokeWidth:R.value==="white"?2:1,rx:M*.2,style:{filter:"drop-shadow(0 2px 4px rgba(244, 114, 182, 0.25))"}})]}):t.jsx("text",{x:S,y:P,textAnchor:"middle",fontSize:m(1),fill:st,fontWeight:"500",style:{filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:"–"})),!f&&t.jsxs("text",{x:S,y:_,textAnchor:"middle",fontSize:m(.9),fontWeight:"700",fill:vt,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[t.jsx("tspan",{x:S,dy:0,children:ot}),ft&&t.jsx("tspan",{x:S,dy:m(1.1),children:ft})]}),!f&&t.jsxs("text",{x:S,y:X,textAnchor:"middle",fontSize:m(.9),fontWeight:"700",fill:St,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[t.jsx("tspan",{x:S,dy:0,children:xt}),at&&t.jsx("tspan",{x:S,dy:m(1.1),children:at})]}),!f&&t.jsxs("text",{x:S,y:q,textAnchor:"middle",fontSize:m(.9),fontWeight:"700",fill:Lt,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[t.jsx("tspan",{x:S,dy:0,children:p}),O&&t.jsx("tspan",{x:S,dy:m(1.1),children:O})]})]},`pt-${z}-${i.isoDate||i.timestamp}`)})]})},ne="#1565C0",ie="#2E7D32",ae="#6A1B9A",le=({padding:e,chartHeight:a,tempMin:E,tempMax:y,tempRange:k,getY:m,responsiveFontSize:d,textRowHeight:h,isFullScreen:g})=>{const j={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},T=[];if(k>0){const o=k<=2.5?.1:.5;for(let l=E;l<=y+1e-9;l+=o)T.push(parseFloat(l.toFixed(1)))}else for(let o=35;o<=37.5+1e-9;o+=.5)T.push(parseFloat(o.toFixed(1)));const I=a-e.bottom;return t.jsxs("svg",{width:e.left,height:a,className:"font-sans pointer-events-none",children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"legendBgGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(255, 228, 230, 1)"}),t.jsx("stop",{offset:"30%",stopColor:"rgba(255, 229, 235, 1)  "}),t.jsx("stop",{offset:"70%",stopColor:"rgba(255, 241, 242, 1)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(255, 236, 240, 0.6)"})]}),t.jsxs("linearGradient",{id:"legendAccentGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),t.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),t.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),t.jsx("filter",{id:"legendShadowChart",x:"-20%",y:"-20%",width:"140%",height:"140%",children:t.jsx("feDropShadow",{dx:"0",dy:"3",stdDeviation:"4",floodColor:"rgba(244, 114, 182, 0.2)"})}),t.jsx("filter",{id:"textShadowLegend",x:"-50%",y:"-50%",width:"200%",height:"200%",children:t.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodColor:"rgba(255, 255, 255, 0.9)"})})]}),t.jsx("rect",{x:0,y:I+h*.5,width:e.left,height:h*(g?9.5:8),fill:"url(#legendBgGradientChart)",rx:12,style:{filter:"url(#legendShadowChart)"}}),T.map((o,l)=>{const f=m(o),r=o.toFixed(1).endsWith(".0")||o.toFixed(1).endsWith(".5"),c=r?o.toFixed(1):`.${o.toFixed(1).split(".")[1]}`;return t.jsx(K.g,{variants:j,children:t.jsx("text",{x:e.left-d(1.2),y:f+d(.35),textAnchor:"end",fontSize:d(r?1.15:1),fontWeight:r?"800":"700",fill:r?"#E91E63":"#EC4899",style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:c})},`temp-tick-fixed-${l}`)}),t.jsx(K.g,{variants:j,children:[{label:"Fecha",row:1,color:"#374151",icon:null},{label:"Día",row:2,color:"#374151",icon:null},{label:"Símbolo",row:3,color:"#374151",icon:null},{label:"Sens.",row:g?5:4.5,color:ne,icon:"◊"},{label:"Apar.",row:g?7:6,color:ie,icon:"○"},{label:"Observ.",row:g?9:7.5,color:ae,icon:"✦"}].map(({label:o,row:l,color:f,icon:r})=>t.jsxs("g",{children:[r&&t.jsx("text",{x:e.left-d(2.8),y:I+h*l,textAnchor:"middle",fontSize:d(.8),fontWeight:"600",fill:f,opacity:.7,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:r}),t.jsx("text",{x:e.left-d(.8),y:I+h*l,textAnchor:"end",fontSize:d(1.05),fontWeight:"800",fill:f,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:o})]},o))})]})},Mt=35.5,It=37.5,ce=(e=[])=>{var I;const a=o=>o&&o.displayTemperature!=null&&!o.ignored,y=[];let k=null,m=null,d=null;const h=o=>{if(!o||o.length!==6)return null;const l=o.map(r=>r.temp);return l.some(r=>!Number.isFinite(r))?null:{baselineTemp:l.reduce((r,c)=>c>r?c:r,l[0]),baselineStartIndex:o[0].index}};for(let o=0;o<e.length;o++){const l=e[o];if(!a(l))continue;const f=l.displayTemperature;if(Number.isFinite(f)){if(y.length===6){const r=h(y);if(r&&(k=r.baselineTemp,m=r.baselineStartIndex,f>k)){d=o;break}}y.push({index:o,temp:f}),y.length>6&&y.shift()}}if(k==null&&y.length===6){const o=h(y);o&&(k=o.baselineTemp,m=o.baselineStartIndex)}const g={confirmed:!1,confirmationIndex:null,infertileStartIndex:null,rule:null,highSequenceIndices:[],ovulationIndex:null};if(k==null||d==null)return{baselineTemp:k,baselineStartIndex:m,firstHighIndex:d,ovulationDetails:g};const j=o=>{if(!o||o.length<3)return null;const l=k+.2,f=o.slice(0,3);if(f.length<3)return null;const r=f[2];if(r.temp>=l)return{confirmationIndex:r.index,usedIndices:f.map(c=>c.index),rule:"3-high"};if(o.length>=5){const c=o[3],w=o[4];if(c&&w&&c.temp>k&&w.temp>=l)return{confirmationIndex:w.index,usedIndices:o.slice(0,5).map(A=>A.index),rule:"5-high"}}return null};let T=g;for(let o=d;o<e.length;o++){const l=e[o];if(!a(l)||l.displayTemperature<=k)continue;const f=[];for(let c=o;c<e.length&&f.length<5;c++){const w=e[c];if(!a(w)||w.displayTemperature<=k)break;f.push({index:c,temp:w.displayTemperature})}const r=j(f);if(r){T={confirmed:!0,confirmationIndex:r.confirmationIndex,infertileStartIndex:r.confirmationIndex,rule:r.rule,highSequenceIndices:r.usedIndices,ovulationIndex:d??((I=r.usedIndices)!=null&&I.length?r.usedIndices[0]:null)};break}}return{baselineTemp:k,baselineStartIndex:m,firstHighIndex:d,ovulationDetails:T}},de=(e,a,E,y,k,m=5,d=!1)=>{const h=v.useRef(null),g=v.useRef(null),[j,T]=v.useState({width:0,height:0}),[I,o]=v.useState(null),[l,f]=v.useState({x:0,y:0}),r=v.useMemo(()=>{const s=n=>{if(n==null||n==="")return null;const b=parseFloat(String(n).replace(",","."));return Number.isFinite(b)?b:null},C=n=>{if(!n)return null;const b=s(n.temperature),x=s(n.temperature_corrected);return n.use_corrected&&x!==null?x:b!==null?b:x!==null?x:null};return e.map(n=>{const b=[n==null?void 0:n.temperature_chart,n==null?void 0:n.temperature_raw,n==null?void 0:n.temperature_corrected];let x=null;for(const N of b)if(N!=null&&N!==""){x=N;break}if(x==null&&Array.isArray(n==null?void 0:n.measurements)){const R=n.measurements.find(B=>B&&B.selected&&C(B)!==null)||n.measurements.find(B=>C(B)!==null);R&&(x=C(R))}return{...n,displayTemperature:s(x)}})},[e]);v.useLayoutEffect(()=>{const s=()=>{if(!h.current)return;const n=h.current.parentElement||h.current;let b=n.clientWidth||600,x=n.clientHeight||400,N=h.current.clientWidth>0?h.current.clientWidth:b,R,B;if(a){let M=window.innerWidth,V=window.innerHeight;if(d&&V>M&&([M,V]=[V,M]),N=M,E==="portrait"&&!d){const tt=Math.max(30,M*.05);R=(M-tt)/m*e.length}else R=M/m*e.length;B=V}else R=N/m*e.length,B=x;T({width:R,height:B})};s(),window.addEventListener("resize",s);let C;if(h.current){const n=h.current.parentElement||h.current;C=new ResizeObserver(s),C.observe(n)}return()=>{window.removeEventListener("resize",s),C&&C.disconnect()}},[a,e.length,m,E,d]);const c=v.useMemo(()=>r.filter(s=>s&&s.isoDate&&!s.ignored&&s.displayTemperature!==null&&s.displayTemperature!==void 0),[r]),w=v.useMemo(()=>r.filter(s=>s&&s.isoDate),[r]),{baselineTemp:A,baselineStartIndex:G,firstHighIndex:D,ovulationDetails:H}=v.useMemo(()=>ce(r),[r]),{tempMin:et,tempMax:P}=v.useMemo(()=>{const s=c.map(b=>b.displayTemperature).filter(b=>b!=null);if(s.length===0)return{tempMin:Mt,tempMax:It};let C=Math.min(...s,Mt),n=Math.max(...s,It);if(C=Math.floor(C*2)/2,n=Math.ceil(n*2)/2,n-C<2){const b=(C+n)/2;C=b-1,n=b+1}return{tempMin:C,tempMax:n}},[c]),_=P-et,X=j.width,q=j.height,Z=9,Y=(s=1)=>{if(!a)return Z*s;const C=Math.min(X,q);return Math.max(8,Math.min(Z*s,C/(w.length>0?40/s:40)))},rt=Y(a?1.6:2.5),i=d||E==="landscape",S=rt*(i?9:5),u={top:a?Math.max(i?6:12,q*(i?.015:.03)):12,right:a?Math.max(i?35:30,X*(i?.02:.05)):50,bottom:(a?Math.max(i?0:40,q*(i?0:.11)):60)+S+25,left:a?Math.max(i?45:20,X*(i?.02:.05)):50},$=s=>{if(s==null||_===0)return q-u.bottom;const C=q-u.top-u.bottom;return C<=0?q-u.bottom:q-u.bottom-(s-et)/_*C},U=s=>{const C=a&&!(d||E==="landscape")?5:10,n=a&&!(d||E==="landscape")?25:0,b=X-u.left-u.right-C-n*(w.length-1);if(b<=0)return u.left+C+n*s;const x=w.length>1?w.length-1:1;return x===0||w.length===0?u.left+C+n*s:u.left+C+s*(b/(w.length===1?1:x))+n*s},J=(s,C,n)=>{if(!s||String(s.id).startsWith("placeholder-")){Q();return}const b=h.current.getBoundingClientRect();let x,N;if(n.type.startsWith("touch")){const M=n.changedTouches[0];x=M.clientX,N=M.clientY}else x=n.clientX,N=n.clientY;const R=U(C),B=$(s.displayTemperature);f({svgX:R,svgY:B,clientX:x-b.left+h.current.scrollLeft,clientY:N-b.top+h.current.scrollTop}),o(s)};v.useEffect(()=>{const s=C=>{var n;if(g.current&&!g.current.contains(C.target)){const b=(n=h.current)==null?void 0:n.querySelectorAll("circle, text, rect");let x=!1;if(b){for(let N of b)if(N.contains(C.target)){x=!0;break}}x||o(null)}};return I&&(document.addEventListener("mousedown",s),document.addEventListener("touchstart",s)),()=>{document.removeEventListener("mousedown",s),document.removeEventListener("touchstart",s)}},[I]);const Q=()=>{o(null)};return{chartRef:h,tooltipRef:g,dimensions:j,activePoint:I,tooltipPosition:l,processedData:r,validDataForLine:c,allDataPoints:w,tempMin:et,tempMax:P,tempRange:_,padding:u,textRowHeight:rt,setActivePoint:o,getY:$,getX:U,handlePointInteraction:J,clearActivePoint:Q,handleToggleIgnore:s=>{y&&s&&(y(k,s),o(null))},responsiveFontSize:Y,baselineTemp:A,baselineStartIndex:G,firstHighIndex:D,ovulationDetails:H}},fe=({data:e,isFullScreen:a,orientation:E,onToggleIgnore:y,onEdit:k,cycleId:m,initialScrollIndex:d=0,visibleDays:h=5,showInterpretation:g=!1,reduceMotion:j=!1,forceLandscape:T=!1})=>{const{chartRef:I,tooltipRef:o,dimensions:l,activePoint:f,tooltipPosition:r,allDataPoints:c,validDataForLine:w,tempMin:A,tempMax:G,tempRange:D,padding:H,textRowHeight:et,getY:P,getX:_,handlePointInteraction:X,handleToggleIgnore:q,responsiveFontSize:Z,clearActivePoint:Y,setActivePoint:rt,baselineTemp:i,baselineStartIndex:z,firstHighIndex:S,ovulationDetails:u}=de(e,a,E,y,m,h,T);if(!c||c.length===0)return t.jsxs("div",{className:"text-center p-8",children:[t.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-pink-100 to-rose-100 rounded-full mb-4",children:t.jsx("svg",{className:"w-8 h-8 text-pink-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),t.jsx("p",{className:"text-slate-400 font-medium",children:"No hay datos para mostrar en el gráfico"})]});const $=l.width,U=l.height,J=i!=null?P(i):null,Q=!!(u!=null&&u.confirmed),st=i!=null,s=_(0),C=c.length>0?_(c.length-1):$-H.right,n=Q?"#F59E0B":"#94A3B8",b=Q?"6 4":"4 4",x=Q?1:.7,N=3,R=$===0,B=U-H.bottom,M=v.useMemo(()=>{const F=new Map;return w.forEach(W=>{W&&W.id!=null&&F.set(W.id,W)}),F},[w]),V=v.useMemo(()=>{const F=W=>{if(!W||W.length<2)return null;let ht=`M ${W[0].x} ${B} L ${W[0].x} ${W[0].y}`;for(let lt=1;lt<W.length;lt++){const ct=W[lt];ht+=` L ${ct.x} ${ct.y}`}return ht+=` L ${W[W.length-1].x} ${B} Z`,ht};return W=>{if(typeof W!="function")return[];const ht=[];let lt=[],ct=!1;const Ct=()=>{const it=F(lt);it&&ht.push(it),lt=[]};for(let it=0;it<c.length;it++){if(!W(it)){ct&&(Ct(),ct=!1);continue}ct=!0;const pt=c[it],yt=M.get(pt==null?void 0:pt.id);if(!yt||!Number.isFinite(yt.displayTemperature))continue;const At=_(it),Dt=P(yt.displayTemperature);lt.push({x:At,y:Dt})}return ct&&Ct(),ht}},[c,M,_,P,B]),tt=v.useMemo(()=>!g||!(u!=null&&u.confirmed)?[]:Number.isFinite(u.confirmationIndex)?V(F=>F<=u.confirmationIndex):[],[g,u,V]),nt=v.useMemo(()=>!g||!(u!=null&&u.confirmed)?[]:Number.isFinite(u.infertileStartIndex)?V(F=>F>=u.infertileStartIndex):[],[g,u,V]),[ot,ft]=v.useState({w:typeof window<"u"?window.innerWidth:0,h:typeof window<"u"?window.innerHeight:0}),xt=ot.w<ot.h;v.useEffect(()=>{const F=()=>ft({w:window.innerWidth,h:window.innerHeight});return window.addEventListener("resize",F),window.addEventListener("orientationchange",F),()=>{window.removeEventListener("resize",F),window.removeEventListener("orientationchange",F)}},[]),v.useEffect(()=>{if(!I.current)return;const F=I.current.clientWidth/h;I.current.scrollLeft=Math.max(0,F*d)},[d,h,l.width,E]);const at=T&&xt,p=at,O="w-full h-full bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100",L=a?`${O} min-h-full ${p?"flex items-stretch justify-start overflow-y-auto overflow-x-hidden":"flex items-center justify-start overflow-x-auto overflow-y-hidden"}`:`${O} overflow-x-auto overflow-y-hidden border border-pink-100/50`,bt=!a||E==="portrait";return t.jsxs(K.div,{className:"relative w-full h-full",initial:!1,children:[bt&&t.jsx("div",{className:"absolute left-0 top-0 h-full bg-transparent pointer-events-none z-10",style:{width:H.left},children:t.jsx(le,{padding:H,chartHeight:U,tempMin:A,tempMax:G,tempRange:D,getY:P,responsiveFontSize:Z,textRowHeight:et,isFullScreen:a})}),t.jsxs(K.div,{ref:I,className:`relative p-0 ${a?"":"rounded-2xl"} ${L}`,style:{boxShadow:a?"inset 0 1px 3px rgba(244, 114, 182, 0.1)":"0 8px 32px rgba(244, 114, 182, 0.12), 0 2px 8px rgba(244, 114, 182, 0.08)",...at?{position:"absolute",top:0,left:0,width:`${ot.h}px`,height:`${ot.w}px`,transform:"rotate(90deg) translateY(-100%)",transformOrigin:"top left"}:{}},initial:!1,children:[R&&t.jsx("div",{className:"flex items-center justify-center w-full h-full text-slate-400",children:"Cargando..."}),t.jsxs(K.svg,{width:$,height:U,className:"font-sans flex-shrink-0",viewBox:`0 0 ${$} ${U}`,preserveAspectRatio:"xMidYMid meet",initial:!1,children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),t.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),t.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),t.jsxs("linearGradient",{id:"tempAreaGradientChart",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(244,114,182,0.25)"}),t.jsx("stop",{offset:"50%",stopColor:"rgba(236,72,153,0.15)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(233,30,99,0.05)"})]}),t.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[t.jsx("rect",{width:"6",height:"6",fill:"#ef4444"}),t.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(255,255,255,0.85)"})]}),t.jsxs("filter",{id:"chartShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsxs("filter",{id:"baselineGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsxs("linearGradient",{id:"fertileAreaGradient",x1:"0%",y1:"100%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(253, 224, 255, 0.9)"}),t.jsx("stop",{offset:"65%",stopColor:"rgba(249, 168, 212, 0.6)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(236, 72, 153, 0.28)"})]}),t.jsxs("linearGradient",{id:"infertileAreaGradient",x1:"0%",y1:"100%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(109, 189, 245, 0.48)"}),t.jsx("stop",{offset:"50%",stopColor:"rgba(111, 168, 220, 0.48)"}),t.jsx("stop",{offset:"80%",stopColor:"rgba(120, 143, 207, 0.48)"})]})]}),t.jsx("rect",{width:"100%",height:"100%",fill:"transparent"}),t.jsx(zt,{padding:H,chartWidth:$,chartHeight:U,tempMin:A,tempMax:G,tempRange:D,getY:P,getX:_,allDataPoints:c,responsiveFontSize:Z,isFullScreen:a,showLeftLabels:!bt,reduceMotion:j}),g&&(u==null?void 0:u.confirmed)&&t.jsxs(t.Fragment,{children:[tt.map((F,W)=>t.jsx("path",{d:F,fill:"url(#fertileAreaGradient)",opacity:.65,pointerEvents:"none"},`fertile-area-${W}`)),nt.map((F,W)=>t.jsx("path",{d:F,fill:"url(#infertileAreaGradient)",opacity:.6,pointerEvents:"none"},`infertile-area-${W}`))]}),g&&st&&J!==null&&(j?t.jsx("line",{x1:s,y1:J,x2:C,y2:J,stroke:n,strokeWidth:N,strokeDasharray:b,opacity:x}):t.jsx(K.path,{d:`M ${s} ${J} L ${C} ${J}`,stroke:n,strokeWidth:N,strokeDasharray:b,opacity:x,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:x},transition:{duration:4,ease:"easeInOut",delay:.5}})),t.jsx(Ht,{data:w,allDataPoints:c,getX:_,getY:P,baselineY:U-H.bottom,temperatureField:"displayTemperature",reduceMotion:j}),t.jsx(se,{data:c,getX:_,getY:P,isFullScreen:a,orientation:E,responsiveFontSize:Z,onPointInteraction:X,clearActivePoint:Y,activePoint:f,padding:H,chartHeight:U,chartWidth:$,temperatureField:"displayTemperature",textRowHeight:et,compact:!1,reduceMotion:j,showInterpretation:g,ovulationDetails:u})]}),f&&t.jsx(K.div,{ref:o,initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:10},transition:{duration:.2,ease:"easeOut"},children:t.jsx(Ft,{point:f,position:r,chartWidth:$,chartHeight:U,onToggleIgnore:q,onEdit:k,onClose:Y})})]})]})};function he(e,a){if(!e||!a)return[];const E=typeof e=="string"?ut(e):e;return[...Array(a)].map((y,k)=>{const m=Bt(E,k),d=Et(m,"yyyy-MM-dd"),h=Et(m,"dd/MM"),g=wt(dt(m),dt(E))+1;return{date:h,isoDate:d,cycleDay:g,temperature:null,mucusSensation:null,mucusAppearance:null,id:`placeholder-${d}`,ignored:!1}})}const Ce=()=>{const{cycleId:e}=Gt(),{currentCycle:a,archivedCycles:E,isLoading:y,addOrUpdateDataPoint:k,toggleIgnoreRecord:m,getCycleById:d}=Pt(),[h,g]=v.useState(null),[j,T]=v.useState(!1),[I,o]=v.useState(!1),l=!e||e===a.id,f=l?null:E.find(p=>p.id===e);v.useEffect(()=>{if(l){g(null),T(!1),o(!1);return}if(f){g(null),T(!1),o(!1);return}let p=!0;return T(!0),d(e).then(O=>{p&&(O?(g(O),o(!1)):(g(null),o(!0)))}).catch(()=>{p&&(g(null),o(!0))}).finally(()=>{p&&T(!1)}),()=>{p=!1}},[l,f,d,e]);const r=l?a:f||h,c=!l&&!f,w=l?y&&!(a!=null&&a.id):j||y&&!f&&!h,[A,G]=v.useState(typeof window<"u"&&window.innerWidth>window.innerHeight?"landscape":"portrait"),[D,H]=v.useState(!1),[et,P]=v.useState(!1),[_,X]=v.useState(null),[q,Z]=v.useState(!1),[Y,rt]=v.useState(!1),i=v.useRef(!1);if(v.useLayoutEffect(()=>{window.dispatchEvent(new Event("resize"))},[A,D]),w)return t.jsx("p",{className:"text-center text-gray-500",children:"Cargando…"});if(!(r!=null&&r.id))return e&&I?t.jsx(kt,{children:t.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[100dvh] space-y-4 text-center text-pink-600",children:[t.jsx("p",{children:"No se encontró el ciclo solicitado."}),t.jsx(mt,{asChild:!0,className:"bg-gradient-to-r from-pink-500 to-rose-500 text-white shadow",children:t.jsx(Nt,{to:"/archived-cycles",children:"Volver a Mis Ciclos"})})]})}):t.jsx("p",{className:"text-center text-pink-600",children:"No hay ciclo activo."});const z=28,S=10,u=ut(r.startDate),$=r.data||[],U=$.reduce((p,O)=>{const L=ut(O.isoDate);return L>p?L:p},u),J=dt(new Date),Q=U>J?U:J,st=wt(dt(Q),u),s=Math.max(z,st+1),n=he(u,s).map(p=>{const O=$.find(L=>L.isoDate===p.isoDate);return O?{...O,date:p.date}:p}),b=A==="portrait"?S:z;let x=0;if(A!=="landscape"){const p=wt(new Date,dt(u)),O=Math.min(Math.max(p,0),s-1);let L=Math.min(s,O+1);O<b-1&&(L=Math.min(s,b)),x=Math.max(0,L-b)}const N={background:"linear-gradient(135deg, #FFFAFC 0%, #f7eaef 100%)"},R=D?N:{...N,height:A==="landscape"?"calc(min(100dvh, 100dvw) - var(--bottom-nav-safe))":"calc(100dvh - var(--bottom-nav-safe))",maxHeight:"100vh",paddingBottom:"env(safe-area-inset-bottom)"},B=p=>{X(p),P(!0)},M=async(p,O)=>{try{if(await m(p,O),c){const L=await d(p);L&&g(L)}}catch(L){console.error("Error toggling ignore state:",L)}},V=async p=>{if(r!=null&&r.id){Z(!0);try{if(await k(p,_,r.id),c){const O=await d(r.id);O&&g(O)}P(!1),X(null)}finally{Z(!1)}}},tt=()=>{P(!1),X(null)},nt=p=>{X(p)},ot=()=>{rt(p=>!p)},ft=p=>{if(p.preventDefault(),i.current){i.current=!1;return}ot()},xt=p=>{p.pointerType==="touch"&&(p.preventDefault(),i.current=!0,ot())},at=async()=>{if(D){try{await screen.orientation.unlock()}catch(p){console.error(p)}try{document.fullscreenElement&&await document.exitFullscreen()}catch(p){console.error(p)}G("portrait"),H(!1)}else try{await document.documentElement.requestFullscreen(),await screen.orientation.lock("landscape"),G("landscape"),H(!0)}catch(p){console.error(p)}};return t.jsx(kt,{hideBottomNav:D,children:t.jsxs("div",{className:D?"fixed inset-0 z-50 h-[100dvh] w-[100dvw] overflow-x-auto overflow-y-auto":"relative w-full overflow-x-auto overflow-y-auto",style:R,children:[t.jsx(mt,{onClick:ft,onPointerUp:xt,variant:"ghost",size:"icon",className:`absolute top-4 right-20 z-10 p-2 rounded-full transition-colors ${Y?"bg-[#E27DBF] text-white hover:bg-[#d46ab3]":"bg-white/80 text-slate-700 hover:bg-[#E27DBF]/20"}`,children:Y?t.jsx(Ut,{className:"h-4 w-4"}):t.jsx(Yt,{className:"h-4 w-4"})}),t.jsx(mt,{onClick:at,className:"absolute top-4 right-4 z-10 bg-white/80 hover:bg-white text-gray-700 p-2 rounded-full shadow","aria-label":D?"Salir de pantalla completa":"Rotar gráfico",children:t.jsx(Vt,{className:"w-5 h-5"})}),t.jsx(fe,{data:n,isFullScreen:D,orientation:A,onToggleIgnore:M,onEdit:B,cycleId:r.id,initialScrollIndex:x,visibleDays:b,showInterpretation:Y,reduceMotion:!0,forceLandscape:A==="landscape"}),t.jsx(_t,{open:et,onOpenChange:p=>{p||tt()},children:t.jsx($t,{hideClose:!0,className:"bg-transparent border-none p-0 text-gray-800 w-[90vw] sm:w-auto max-w-md sm:max-w-lg md:max-w-xl max-h-[85vh] overflow-y-auto",children:t.jsx(Wt,{onSubmit:V,onCancel:tt,initialData:_,cycleStartDate:r.startDate,cycleEndDate:r.endDate,isProcessing:q,isEditing:!!_,cycleData:r.data,onDateSelect:nt})})})]})})};export{Ce as default};
