import{c as Gt,m as we,j as e,r as y,l as tt,f as ct,n as Wt,g as jt,k as Lt,J as Ht,q as Ut,K as zt,u as Vt,M as wt,B as it,L as kt,X as Yt}from"./index-2f41c8cd.js";import{b as qt,g as Kt,i as Xt,d as Jt,D as Zt}from"./computePeakStatuses-8ec0bab9.js";import{u as Qt,C as es,a as ts,b as ss,c as as}from"./useFertilityChart-b6d45542.js";import{u as rs,D as ns,a as os}from"./useCycleData-9f76d19f.js";import{C as Ct,S as ls,a as is,b as cs,c as ds,d as us}from"./checkbox-2e1f35be.js";import{L as fs}from"./label-270ed458.js";import{A as hs}from"./arrow-left-da98c05b.js";import{E as ps,a as ms}from"./eye-fe5b932b.js";import"./input-c95d25ec.js";import"./badge-4c7d2230.js";const xs=Gt("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),gs=Gt("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),ys=({padding:n,chartWidth:c,chartHeight:m,tempMin:x,tempMax:E,tempRange:b,getY:R,getX:B,allDataPoints:k=[],responsiveFontSize:g,isFullScreen:pe,showLeftLabels:Y=!1,reduceMotion:se=!1,graphBottomY:G,chartAreaHeight:A,rowsZoneHeight:q})=>{const l={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.3,ease:"easeOut"}}},K=[];if(b>0){const $=b<=2.5?.1:.5;for(let S=x;S<=E+1e-9;S+=$)K.push(parseFloat(S.toFixed(1)))}else for(let $=35.8;$<=37.2+1e-9;$+=.1)K.push(parseFloat($.toFixed(1)));const ie=se?"g":we.g;return e.jsxs(e.Fragment,{children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"bgGradientChart",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#fffbfc"}),e.jsx("stop",{offset:"50%",stopColor:"#fff5f7"}),e.jsx("stop",{offset:"100%",stopColor:"#fff1f3"})]}),e.jsxs("linearGradient",{id:"dataZoneGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#fff7fb"}),e.jsx("stop",{offset:"50%",stopColor:"#ffe4f0"}),e.jsx("stop",{offset:"100%",stopColor:"#fff7fb"})]}),e.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"#f472b6"}),e.jsx("stop",{offset:"30%",stopColor:"#ec4899"}),e.jsx("stop",{offset:"70%",stopColor:"#db2777"}),e.jsx("stop",{offset:"100%",stopColor:"#be185d"})]}),e.jsxs("filter",{id:"softShadow",children:[e.jsx("feGaussianBlur",{in:"SourceAlpha",stdDeviation:"2"}),e.jsx("feOffset",{dx:"0",dy:"1",result:"offsetblur"}),e.jsx("feComponentTransfer",{children:e.jsx("feFuncA",{type:"linear",slope:"0.2"})}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("filter",{id:"pointGlow",children:[e.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsx("filter",{id:"textShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodColor:"rgba(255, 255, 255, 0.8)"})}),e.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[e.jsx("rect",{width:"6",height:"6",fill:"#ef4444"}),e.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(255,255,255,0.85)"})]})]}),e.jsx("rect",{x:n.left,y:n.top,width:c-n.left-n.right,height:A,fill:"url(#bgGradientChart)",opacity:2,rx:12,style:{filter:"drop-shadow(0 4px 12px rgba(244, 114, 182, 0.1))"}}),e.jsx("rect",{x:n.left,y:n.top,width:c-n.left-n.right,height:A,fill:"white",stroke:"url(#tempLineGradientChart)",strokeWidth:"1",strokeOpacity:"0.2",rx:"12",style:{filter:"url(#softShadow)"}}),e.jsx("rect",{x:n.left,y:G,width:c-n.left-n.right,height:q,fill:"url(#dataZoneGradient)",rx:"8",style:{filter:"drop-shadow(0 -1px 2px rgba(244, 114, 182, 0.05))"}}),K.map(($,S)=>{const ue=R($),w=$.toFixed(1).endsWith(".0")||$.toFixed(1).endsWith(".5"),H=w?$.toFixed(1):`.${$.toFixed(1).split(".")[1]}`;return e.jsxs(ie,{...se?{}:{variants:l},children:[e.jsx("line",{x1:n.left,y1:ue,x2:c-n.right,y2:ue,stroke:w?"#f9a8d4":"#fce7f3",strokeWidth:w?1.5:1,opacity:w?.5:.3,strokeDasharray:w?"0":"4,4",style:{filter:w?"drop-shadow(0 1px 3px rgba(244, 114, 182, 0.15))":"none",opacity:w?1:.7}}),Y&&e.jsx("text",{x:n.left-g(1),y:ue+g(.35),textAnchor:"end",fontSize:g(w?1.1:1),fontWeight:w?"700":"600",fill:w?"#be185d":"#db2777",opacity:w?.9:.7,style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:H}),e.jsx("text",{x:c-n.right+g(1),y:ue+g(.35),textAnchor:"start",fontSize:g(w?1.1:1),fontWeight:w?"700":"600",fill:w?"#be185d":"#db2777",opacity:w?.9:.7,style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:H})]},`temp-tick-${S}`)}),k.map(($,S)=>{const ue=B(S);return e.jsx("line",{x1:ue,y1:n.top,x2:ue,y2:G,stroke:"#fce7f3",strokeWidth:"1",opacity:"0.6",style:{filter:"drop-shadow(0 0 1px rgba(244, 114, 182, 0.05))"}},`day-grid-${S}`)}),e.jsx("rect",{x:n.left,y:n.top,width:c-n.left-n.right,height:A,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"2",strokeOpacity:"0.4",rx:"12"}),e.jsx("rect",{x:n.left+1,y:n.top+1,width:c-n.left-n.right-2,height:A-2,fill:"none",stroke:"white",strokeWidth:"0.5",rx:"11",opacity:"0.9"}),Y&&e.jsx(ie,{...se?{}:{variants:l},children:e.jsx("text",{x:n.left+g(1.2),y:n.top+g(1.5),textAnchor:"middle",fontSize:g(1.4),fontWeight:"800",fill:"#be185d",style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:"°C"})})]})},bs=({data:n,allDataPoints:c,getX:m,getY:x,baselineY:E,temperatureField:b="temperature",reduceMotion:R=!1})=>{if(!n||n.length<2)return null;let B="",k=null;const g=[];if(c.forEach((se,G)=>{const A=n.find(q=>q.id===se.id);if(A&&A[b]!==null&&A[b]!==void 0&&!A.ignored){const q=m(G),l=x(A[b]);g.push({x:q,y:l}),k!==null&&G===k+1?B+=` L ${q} ${l}`:B+=`${B?" ":""}M ${q} ${l}`,k=G}}),g.length<2)return null;const pe=B.includes("L"),Y=g.length>1?g.map(({x:se,y:G},A)=>`${A===0?"M":"L"} ${se} ${G}`).join(" "):"";return e.jsxs(e.Fragment,{children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"#f472b6"}),e.jsx("stop",{offset:"30%",stopColor:"#ec4899"}),e.jsx("stop",{offset:"70%",stopColor:"#db2777"}),e.jsx("stop",{offset:"100%",stopColor:"#be185d"})]}),e.jsx("filter",{id:"lineShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"3",floodColor:"rgba(244, 114, 182, 0.4)"})})]}),pe&&(R?e.jsx("path",{d:B,fill:"none",stroke:"url(#tempLineGradientChartGlow)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:.4,style:{filter:"url(#lineGlow)"}}):e.jsx(we.path,{d:B,fill:"none",stroke:"url(#tempLineGradientChartGlow)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:.4,style:{filter:"url(#lineGlow)"},initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.4},transition:{duration:.8,ease:"easeInOut",delay:.2}})),Y&&(R?e.jsx("path",{d:Y,fill:"none",stroke:"#d587b1",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.65}):e.jsx(we.path,{d:Y,fill:"none",stroke:"#d587b1",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.65,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.65},transition:{duration:.8,ease:"easeInOut"}})),pe&&(R?e.jsx("path",{d:B,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#lineShadow)"}}):e.jsx(we.path,{d:B,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#lineShadow)"},initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:1},transition:{duration:1,ease:"easeInOut",delay:.4}}))]})},Ot="var(--color-sensacion-fuerte)",Pt="var(--color-apariencia-fuerte)",Tt="var(--color-observaciones-fuerte)",Ft="#be123c",js="rgba(148, 163, 184, 0.35)",ws="rgba(226, 232, 240, 0.6)",Cs="rgba(148, 163, 184, 0.5)",Bt="✖",It="#7f1d1d",vt="#ec4899",Dt="drop-shadow(0 2px 4px rgba(244, 114, 182, 0.35))",ks="#be185d",Is="#2563eb",vs="#be185d",Ss="rgba(244, 114, 182, 0.35)",Ms=n=>{if(!n)return"";const[c,m]=n.split("/");return`${parseInt(c,10)}/${parseInt(m,10)}`},St=(n="",c,m,x="–")=>{if(!n)return[x,""];if(n.length<=c)return[n,""];if(m){const k=n.slice(0,c),g=n.slice(c,c*2);return[k,g]}const E=k=>{if(!k)return["",""];if(k.length<=c)return[k,""];const g=k.indexOf(" ",c);return g===-1?[k.slice(0,c),k.slice(c)]:[k.slice(0,g),k.slice(g+1)]},[b,R]=E(n),[B]=E(R.trimStart());return[b,B]},Mt=(n="",c,m="–")=>n?n.split(/\s+/).slice(0,c).join(" "):m,Ns=({data:n,getX:c,getY:m,isFullScreen:x,orientation:E,responsiveFontSize:b,onPointInteraction:R,clearActivePoint:B,activePoint:k,padding:g,chartHeight:pe,chartWidth:Y,temperatureField:se="temperature_chart",textRowHeight:G,compact:A=!1,reduceMotion:q=!1,showInterpretation:l=!1,ovulationDetails:K=null,firstHighIndex:ie=null,baselineIndices:$=[],graphBottomLift:S=0,graphBottomY:ue,rowsZoneHeight:w,showRelationsRow:H=!1})=>{const Z={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},X={hidden:{opacity:0,scale:.3},visible:{opacity:1,scale:1,transition:{duration:.6,ease:[.34,1.56,.64,1],type:"spring",stiffness:120,damping:12}}},h=ue,Be=x?9:7.5,De=x?1:.75,Ce=H?Be+(x?2:1.5):null,_e=Be+De,M=Math.max(1,Math.floor(w/_e)),ae=Math.max(G,M),ve=h+ae*1,Q=h+ae*2,ke=h+ae*3,ze=h+ae*(x?5:4.5),Ve=h+ae*(x?7:6),$e=h+ae*(x?9:7.5),Ye=H?$e+ae*(x?2:1.5):null;Y-g.left-g.right;const qe=ae*(x?2:1.5),st=Math.min(Math.max(qe*.46,14),12),dt=q?"g":we.g,p=Array.isArray(n)?n.length:0,d=y.useMemo(()=>tt(new Date),[]),re=y.useMemo(()=>{if(!l)return new Map;const i=Array.isArray(K==null?void 0:K.highSequenceIndices)?K.highSequenceIndices:[],P=new Map;return i.forEach((u,ce)=>{const L=Number(u);Number.isInteger(L)&&L>=0&&L<p&&!P.has(L)&&P.set(L,ce+1)}),P},[l,K,p]),Re=y.useMemo(()=>{if(!l)return new Map;const i=Array.isArray($)?$:[];if(!i.length)return new Map;const P=new Set,u=[],ce=F=>{const de=Number(F);Number.isInteger(de)&&de>=0&&de<p&&!P.has(de)&&(P.add(de),u.push(de))};if(i.forEach(F=>{ce(F)}),ie!=null){const F=Number(ie);Number.isInteger(F)&&ce(F-1)}if(!u.length)return new Map;const L=[...u].sort((F,de)=>F-de),te=new Map;let me=1;for(let F=L.length-1;F>=0&&!(me>6);F-=1)te.set(L[F],me),me+=1;return te},[l,$,p,ie]);return e.jsxs(e.Fragment,{children:[e.jsxs("defs",{children:[e.jsx("filter",{id:"rowShadowChart",x:"-10%",y:"-10%",width:"120%",height:"120%",children:e.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"4",floodColor:"rgba(244, 114, 182, 0.2)"})}),e.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[e.jsx("rect",{width:"6",height:"6",fill:"#fb7185"}),e.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(255,255,255,0.85)"})]}),e.jsxs("filter",{id:"pointGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("radialGradient",{id:"tempPointGradientChart",cx:"30%",cy:"30%",children:[e.jsx("stop",{offset:"0%",stopColor:"#FDF2F8"}),e.jsx("stop",{offset:"50%",stopColor:"#F9A8D4"}),e.jsx("stop",{offset:"85%",stopColor:"#EC4899"}),e.jsx("stop",{offset:"100%",stopColor:"#DB2777"})]}),e.jsxs("radialGradient",{id:"tempPointIgnoredGradient",cx:"30%",cy:"30%",children:[e.jsx("stop",{offset:"0%",stopColor:"#FFFFFF"}),e.jsx("stop",{offset:"80%",stopColor:"#F8FAFC"}),e.jsx("stop",{offset:"100%",stopColor:"#E2E8F0"})]}),e.jsxs("radialGradient",{id:"ovulationPointGradient",cx:"30%",cy:"30%",children:[e.jsx("stop",{offset:"0%",stopColor:"#dbeafe"}),e.jsx("stop",{offset:"50%",stopColor:"#93c5fd"}),e.jsx("stop",{offset:"85%",stopColor:"#3b82f6"}),e.jsx("stop",{offset:"100%",stopColor:"#2563eb"})]})]}),x&&E!=="portrait"&&e.jsx(we.g,{variants:Z,children:[{label:"Fecha",row:1,color:x?"#374151":"#6B7280"},{label:"Día",row:2,color:x?"#374151":"#6B7280"},{label:"Símbolo",row:3,color:x?"#374151":"#6B7280"},{label:"Sens.",row:x?5:4.5,color:Ot},{label:"Apar.",row:x?7:6,color:Pt},{label:"Observ.",row:x?9:7.5,color:Tt},...H&&Ce!=null?[{label:"RS",row:Ce,color:Ft}]:[]].map(({label:i,row:P,color:u})=>e.jsx("text",{x:g.left-b(.5),y:h+ae*P,textAnchor:"end",fontSize:b(1.05),fontWeight:"700",fill:u,style:{filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:i},i))}),n.map((i,P)=>{const u=c(P),ce=i[se]!=null?m(i[se]):h,L=i.temperature_raw,te=i.temperature_corrected,me=i.use_corrected&&L!=null&&te!=null&&Math.abs(te-L)>.01,F=me?m(L):null,de="#60666f",fe=i[se]!=null,xe=!!(i.had_relations??i.hadRelations);fe||i.mucus_sensation||i.mucus_appearance||i.fertility_symbol;const pt=String(i.id||"").startsWith("placeholder-"),Ke=K==null?void 0:K.peakDayIndex,ge=l&&Ke!=null&&!i.ignored&&fe&&P===Ke,Ge=qt(i.fertility_symbol),We=Kt(Ge.value),Ae=Ge.pattern==="spotting-pattern"?"url(#spotting-pattern-chart)":We.main,mt=We.border==="none"?"none":We.border||Ss,xt=We.border==="none"?0:Ge.value==="white"?1.6:1,ne=i.isoDate?Xt(tt(ct(i.isoDate)),tt(new Date)):!1,U=b(x?1.8:2),He=ke-U*.75+U/2+2,ye=i.peakStatus?String(i.peakStatus).toUpperCase():null,be=ye==="P"||ye==="X",Ue=ye&&!be,Se=be?Bt:ye||"–",Xe=be||["1","2","3"].includes(ye),at=!pt&&Ge.value!=="none",Me=!!i.isoDate&&!ne?{pointerEvents:"all",style:{cursor:"pointer"},onClick:t=>R(i,P,t)}:{},Oe=(i.isoDate?Jt(ct(i.isoDate),d):!1)?vs:de,Ne=re.has(P),Ie=Ne?re.get(P):null,Le=Re.has(P),N=Le?Re.get(P):null,Pe=b(x?.75:1.2),rt=Math.max(.5,Pe*.18),nt=ce-Pe*(x?2.6:1.8),ot=ce+Pe*(x?1.9:1.6),Je=x?4:7,Ze=2,[ut,lt]=St(x?Mt(i.mucus_sensation,Ze,ne?"":"–"):i.mucus_sensation,Je,!1,ne?"":"–"),[Qe,ft]=St(x?Mt(i.mucus_appearance,Ze,ne?"":"–"):i.mucus_appearance,Je,!1,ne?"":"–"),[yt,et]=St(x?Mt(i.observations,Ze,""):i.observations,Je,!1,"");return e.jsxs(dt,{...q?{}:{variants:Z},...Me,children:[fe&&e.jsxs(dt,{...q?{}:{variants:X},children:[me&&F!==null&&e.jsxs("g",{pointerEvents:"none",children:[e.jsx("line",{x1:u,y1:F,x2:u,y2:ce,stroke:js,strokeWidth:1,strokeDasharray:"4 4"}),e.jsx("circle",{cx:u,cy:F,r:3,fill:ws,stroke:Cs,strokeWidth:1}),e.jsx("circle",{cx:u,cy:F,r:1,fill:"rgba(255, 255, 255, 0.6)"})]}),e.jsx("circle",{cx:u,cy:ce,r:ge?3.5:2.8,fill:i.ignored?"url(#tempPointIgnoredGradient)":ge?"url(#ovulationPointGradient)":"url(#tempPointGradientChart)",stroke:i.use_corrected?"#941616":i.ignored?"#94A3B8":ge?"#1d4ed8":"#E91E63",strokeWidth:i.ignored?1.5:ge?2.2:2,style:{filter:ge?"drop-shadow(0 2px 4px rgba(37, 99, 235, 0.3))":"drop-shadow(0 2px 3px rgba(244, 114, 182, 0.25))",cursor:"pointer"},pointerEvents:"all",onClick:t=>R(i,P,t)}),!i.ignored&&e.jsx("circle",{cx:u,cy:ce,r:ge?1.2:.9,fill:ge?"rgba(239, 246, 255, 0.95)":"rgba(255, 255, 255, 0.9)",style:{filter:ge?"drop-shadow(0 1px 3px rgba(37, 99, 235, 0.45))":"drop-shadow(0 1px 2px rgba(244, 114, 182, 0.3))"}}),l&&fe&&!i.ignored&&Ne&&e.jsx("g",{pointerEvents:"none",children:e.jsx("text",{x:u,y:nt,textAnchor:"middle",fontSize:Pe,fontWeight:"900",fill:ks,strokeWidth:rt,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',paintOrder:"stroke",filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:Ie})}),l&&fe&&!i.ignored&&Le&&e.jsx("g",{pointerEvents:"none",children:e.jsx("text",{x:u,y:ot,textAnchor:"middle",fontSize:Pe,fontWeight:"800",fill:Is,stroke:"#ffffff",strokeWidth:rt,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',paintOrder:"stroke",filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.85))"},children:N})})]}),e.jsx("text",{x:u,y:ve,textAnchor:"middle",fontSize:b(1.05),fontWeight:"900",fill:Oe,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:Ms(i.date)}),e.jsx("text",{x:u,y:Q,textAnchor:"middle",fontSize:b(1),fontWeight:"900",fill:Oe,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:i.cycleDay}),at?e.jsxs("g",{children:[e.jsx("rect",{x:u-U/2+1,y:ke-U*.75+1,width:U,height:U,fill:"rgba(0, 0, 0, 0.1)",rx:U*.3,opacity:.5}),e.jsx("rect",{x:u-U/2-4,y:ke-U*.75,width:U*1.4,height:U,fill:Ae,stroke:mt,strokeWidth:xt,rx:U*.2,style:{filter:"drop-shadow(0 2px 4px rgba(244, 114, 182, 0.25))"}}),ye&&e.jsx("g",{pointerEvents:"none",children:be?e.jsx("text",{x:u,y:He,textAnchor:"middle",fontSize:b(1.35),fontWeight:"900",fill:vt,stroke:"#fff",strokeWidth:1.5,paintOrder:"stroke",style:{filter:Dt},children:Bt}):e.jsx("text",{x:u,y:He,textAnchor:"middle",fontSize:b(ye?1.1:1),fontWeight:"800",fill:It,style:{filter:"drop-shadow(0 1px 1px rgba(255,255,255,0.9))"},children:ye})})]}):e.jsxs("g",{children:[Xe&&e.jsx("rect",{x:u-U/2-4,y:ke-U*.75,width:U*1.4,height:U,fill:"transparent",stroke:be?vt:It,strokeWidth:1,rx:U*.2}),e.jsx("text",{x:u,y:He,textAnchor:"middle",fontSize:b(be?1.35:Ue?1.1:1),fill:be?vt:Ue?It:de,fontWeight:be?"900":Ue?"800":"500",style:{filter:be?Dt:Ue?"drop-shadow(0 1px 1px rgba(255,255,255,0.9))":"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:Se})]}),!A&&e.jsxs("text",{x:u,y:ze,textAnchor:"middle",fontSize:b(.9),fontWeight:"700",fill:Ot,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[e.jsx("tspan",{x:u,dy:0,children:ut}),lt&&e.jsx("tspan",{x:u,dy:b(1.1),children:lt})]}),!A&&e.jsxs("text",{x:u,y:Ve,textAnchor:"middle",fontSize:b(.9),fontWeight:"700",fill:Pt,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[e.jsx("tspan",{x:u,dy:0,children:Qe}),ft&&e.jsx("tspan",{x:u,dy:b(1.1),children:ft})]}),!A&&e.jsxs("text",{x:u,y:$e,textAnchor:"middle",fontSize:b(.9),fontWeight:"700",fill:Tt,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[e.jsx("tspan",{x:u,dy:0,children:yt}),et&&e.jsx("tspan",{x:u,dy:b(1.1),children:et})]}),H&&Ye!=null&&e.jsx("text",{x:u,y:Ye,textAnchor:"middle",fontSize:st,fontWeight:"700",fill:xe?Ft:"transparent","aria-label":xe?`Relación registrada el ${i.isoDate||`día ${P+1}`}`:void 0,children:xe?"❤":""})]},`pt-${P}-${i.isoDate||i.timestamp}`)})]})},Ls="var(--color-sensacion-fuerte)",Es="var(--color-apariencia-fuerte)",Rs="var(--color-observaciones-fuerte)",As=({padding:n,chartHeight:c,tempMin:m,tempMax:x,tempRange:E,getY:b,responsiveFontSize:R,textRowHeight:B,isFullScreen:k,graphBottomY:g,rowsZoneHeight:pe,showRelationsRow:Y=!1})=>{const se={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},G=[];if(E>0){const w=E<=2.5?.1:.5;for(let H=m;H<=x+1e-9;H+=w)G.push(parseFloat(H.toFixed(1)))}else for(let w=35.8;w<=37.2+1e-9;w+=.1)G.push(parseFloat(w.toFixed(1)));const A=g,q=k?9:7.5,l=k?1:.75,K=Y?q+(k?2:1.5):null,ie=q+l,$=Math.max(1,Math.floor(pe/ie)),S=Math.max(B,$),ue=y.useMemo(()=>{const w=[{label:"Fecha",row:1,color:"#374151",icon:null},{label:"Día",row:2,color:"#374151",icon:null},{label:"Símbolo",row:3,color:"#374151",icon:null},{label:"Sens.",row:k?5:4.5,color:Ls,icon:"◊"},{label:"Apar.",row:k?7:6,color:Es,icon:"○"},{label:"Obs.",row:k?9:7.5,color:Rs,icon:"✦"}];return Y&&K!=null&&w.push({label:"RS",row:K,color:"#f44336",icon:"♥"}),w},[k,K,Y]);return e.jsxs("svg",{width:n.left,height:c,className:"font-sans pointer-events-none",children:[e.jsx("defs",{children:e.jsx("filter",{id:"textShadowLegend",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodColor:"rgba(255, 255, 255, 0.9)"})})}),G.map((w,H)=>{const Z=b(w),X=w.toFixed(1).endsWith(".0")||w.toFixed(1).endsWith(".5"),h=X?w.toFixed(1):`.${w.toFixed(1).split(".")[1]}`;return e.jsx(we.g,{variants:se,children:e.jsx("text",{x:n.left-R(1.2),y:Z+R(.35),textAnchor:"end",fontSize:R(X?1.15:1),fontWeight:X?"800":"700",fill:X?"#be185d":"#db2777",opacity:X?1:.85,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:h})},`temp-tick-fixed-${H}`)}),e.jsx(we.g,{variants:se,children:ue.map(({label:w,row:H,color:Z,icon:X})=>e.jsxs("g",{children:[X&&e.jsx("text",{x:n.left-R(2.8),y:A+S*H,textAnchor:"middle",fontSize:R(.8),fontWeight:"600",fill:Z,opacity:.7,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:X}),e.jsx("text",{x:n.left-R(.8),y:A+S*H,textAnchor:"end",fontSize:R(1.05),fontWeight:"800",fill:Z,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:w})]},w))})]})},Os=({data:n,isFullScreen:c,orientation:m,onToggleIgnore:x,onEdit:E,onTogglePeak:b,cycleId:R,initialScrollIndex:B=0,visibleDays:k=5,showInterpretation:g=!1,reduceMotion:pe=!1,forceLandscape:Y=!1,currentPeakIsoDate:se=null,showRelationsRow:G=!1,fertilityStartConfig:A=null,fertilityCalculatorCycles:q=[],fertilityCalculatorCandidates:l=null,onShowPhaseInfo:K=null,isArchivedCycle:ie=!1,cycleEndDate:$=null})=>{const{chartRef:S,tooltipRef:ue,dimensions:w,activePoint:H,activeIndex:Z,tooltipPosition:X,allDataPoints:h,validDataForLine:Be,tempMin:De,tempMax:Ce,tempRange:_e,padding:M,textRowHeight:ae,getY:ve,getX:Q,handlePointInteraction:ke,handleToggleIgnore:ze,responsiveFontSize:Ve,clearActivePoint:$e,baselineTemp:Ye,baselineStartIndex:qe,baselineIndices:st,firstHighIndex:dt,ovulationDetails:p,fertilityStart:d,hasTemperatureData:re,hasAnyObservation:Re,graphBottomInset:i,todayIndex:P}=Qt(n,c,m,x,R,k,Y,A,q,l,G),u=y.useRef(null);if(!u.current){const s=Math.random().toString(36).slice(2,10);u.current=`fertility-chart-${R??"default"}-${s}`}const ce=u.current;if(!h||h.length===0)return e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-pink-100 to-rose-100 rounded-full mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-pink-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),e.jsx("p",{className:"text-slate-400 font-medium",children:"No hay datos para mostrar en el gráfico"})]});const L=w.width,te=w.contentHeight??w.height;w.viewportHeight??w.height;const me=w.scrollableContentHeight??te,F=te-M.bottom-(i||0),de=Math.max(te-F,0),fe=Ye!=null?ve(Ye):null,xe=!!(p!=null&&p.confirmed),pt=Ye!=null,Ke=Q(0),ge=h.length>0?Q(h.length-1):L-M.right,Ge=xe?"#F59E0B":"#94A3B8",We=xe?"6 4":"4 4",Ae=xe?1:.7,mt=3,xt=L===0,ne=Z!=null?Q(Z):null,U=Z!=null?Z>0?Q(Z-1):ne:null,He=Z!=null?Z<h.length-1?Q(Z+1):ne:null,ye=Math.max((L-M.left-M.right)/Math.max(h.length,1),0),be=Z!=null?Math.max((He!=null&&U!=null?He-U:0)||ye,ye,0):0,Ue=y.useMemo(()=>{const s=new Map;return Be.forEach(o=>{o&&o.id!=null&&s.set(o.id,o)}),s},[Be]),Se=y.useMemo(()=>Number.isInteger(d==null?void 0:d.fertileStartFinalIndex)?d.fertileStartFinalIndex:null,[d]),Xe=Math.max(te-M.top-M.bottom-(i||0),0),at=y.useCallback(s=>!Number.isFinite(s)||!h.length||s<=0?M.left:Q(s),[h,Q,M.left]),gt=y.useCallback(s=>!Number.isFinite(s)||!h.length||s>=h.length-1?L-M.right:Q(s+1),[h,L,Q,M.right]),Me=y.useCallback((s,o,{inclusiveEnd:j=!0}={})=>{if(!Number.isFinite(s)||!Number.isFinite(o)||h.length===0)return null;const v=le=>Math.max(0,Math.min(h.length-1,Math.floor(le))),T=le=>Math.max(0,Math.min(h.length-1,Math.floor(le))),O=le=>Math.max(0,Math.min(h.length,Math.floor(le))),ee=v(s),J=j?T(o):O(o),oe=ee<=0?M.left:at(ee);let z;j?z=J>=h.length-1?L-M.right:gt(J):J<=0?z=M.left:J>=h.length?z=L-M.right:z=at(J);const D=Math.max(z-oe,0);return D<=0?null:{x:oe,width:D}},[h,L,at,gt,M.left,M.right]),je=h.length>0?h.length-1:null,Oe=y.useMemo(()=>{var j;if(!ie||!$||je==null)return null;const s=typeof $=="string"?$:null;if(!s)return null;const o=h.findIndex(v=>(v==null?void 0:v.isoDate)===s);if(o>=0)return Math.min(o,je);for(let v=h.length-1;v>=0;v-=1){const T=(j=h[v])==null?void 0:j.isoDate;if(typeof T=="string"&&T<=s)return Math.min(v,je)}return null},[ie,$,h,je]),Ne=y.useMemo(()=>je==null?null:ie?Number.isInteger(Oe)?Math.min(Oe,je):je:Number.isInteger(P)?Math.min(P,je):je,[Oe,ie,P,je]),Ie=Xe>0?M.top+Xe*.5:null,Le=Ie!=null?Math.max(F-Ie,0):0,N=y.useMemo(()=>{var Te;if(!g||!Re)return null;const s=d==null?void 0:d.debug,o=Number.isInteger(s==null?void 0:s.mucusInfertileStartIndex)?s.mucusInfertileStartIndex:null,j=Number.isInteger((Te=d==null?void 0:d.fertileWindow)==null?void 0:Te.temperatureInfertileStartIndex)?d.fertileWindow.temperatureInfertileStartIndex:null,v=Number.isInteger(s==null?void 0:s.postOvulatoryStartIndex)?s.postOvulatoryStartIndex:null,T={confirmed:!!(p!=null&&p.confirmed),rule:(p==null?void 0:p.rule)??null,baselineTemp:(p==null?void 0:p.baselineTemp)??null,baselineIndices:Array.isArray(p==null?void 0:p.baselineIndices)?p.baselineIndices:[],firstHighIndex:Number.isInteger(p==null?void 0:p.firstHighIndex)?p.firstHighIndex:null,highSequenceIndices:Array.isArray(p==null?void 0:p.highSequenceIndices)?p.highSequenceIndices:[],confirmationIndex:Number.isInteger(p==null?void 0:p.confirmationIndex)?p.confirmationIndex:null,startIndex:j},O={peakDayIndex:Number.isInteger(p==null?void 0:p.peakDayIndex)?p.peakDayIndex:null,thirdDayIndex:Number.isInteger(p==null?void 0:p.thirdDayIndex)?p.thirdDayIndex:null,startIndex:j},ee=j!=null,J=o!=null;if(!ee&&!J)return null;const oe=Number.isInteger(v)?v:null;if(oe==null)return null;let z="pending",D="",le="Postovulatoria (pendiente)",he="Postovulatoria pendiente, a la espera del segundo criterio.";if(ee&&J)z="absolute",le="Infertilidad absoluta",he="Infertilidad absoluta (postovulatoria con doble criterio alcanzado)",D="Infertilidad absoluta";else if(ee){const V=T.rule||"regla desconocida",I=T.confirmationIndex!=null?`D${T.confirmationIndex+1}`:"—";D=`Postovulatoria (pendiente): falta moco. Temperatura con regla ${V} confirmada en ${I}.`,he=D,le="Postovulatoria (temperatura)"}else D=`Postovulatoria (pendiente): falta temperatura (método moco alcanzado vía ${O.thirdDayIndex!=null?"3° día":"P+4"}).`,he=D,le="Postovulatoria (moco)";return{phase:"postOvulatory",status:z,startIndex:oe,reasons:{type:"post",status:z,mucus:O,temperature:T},message:D,label:le,tooltip:he}},[g,Re,p,d]),Pe=y.useMemo(()=>{var z,D,le,he,Te;if(!g||Xe<=0||Ie==null||Le<=0||h.length===0)return[];const s=[],o=h.length-1,j=Number.isInteger(Ne)&&Ne>=0?Math.min(Ne,o):o,v=Number.isInteger(Se),T=Number.isFinite(N==null?void 0:N.startIndex);if(!v&&!T){const V=Math.min(j,o);if(V<0)return s;const I=Me(0,V);return I&&s.push({key:"relative-default",phase:"relativeInfertile",status:"default",bounds:I,startIndex:0,endIndex:V,displayLabel:"Relativamente infértil",tooltip:"Relativamente infértil (preovulatoria: sin día fértil por CPM/T-8 ni signos de moco fértil)",message:"Relativamente infértil",reasons:{type:"relative",fertileStartFinalIndex:null,aggregate:(d==null?void 0:d.aggregate)??null,bipScore:((z=d==null?void 0:d.debug)==null?void 0:z.bipScore)??null}}),s}if(!v&&T){const V=N.startIndex,I=Math.min(V-1,j);if(I>=0){const C=Me(0,I);C&&s.push({key:"no-fertile-window",phase:"nodata",status:"no-fertile-window",bounds:C,startIndex:0,endIndex:I,displayLabel:"Sin ventana fértil identificable",tooltip:"Sin ventana fértil identificable",message:"Sin ventana fértil identificable",reasons:{type:"nofertile",status:"no-fertile-window",message:"No se ha identificado un inicio fértil claro en este ciclo (ni por moco, ni por calculadora, ni por marcador explícito)."}})}if(Number.isFinite(N.startIndex)&&N.startIndex<=o){const C=N.status==="absolute"?o:Math.min(o,j),W=Me(N.startIndex,C);W&&s.push({key:"post",phase:N.phase,status:N.status,bounds:W,startIndex:N.startIndex,endIndex:C,displayLabel:N.label,tooltip:N.tooltip,message:N.message,reasons:N.reasons})}return s}if(v&&Se>0){const V=Math.min(Se-1,j);if(V>=0){const I=Me(0,V);I&&s.push({key:"relative",phase:"relativeInfertile",status:"default",bounds:I,startIndex:0,endIndex:V,displayLabel:"Relativamente infértil",tooltip:"Relativamente infértil (fase relativamente infértil preovulatoria)",message:"Relativamente infértil",reasons:{type:"relative",fertileStartFinalIndex:Se,aggregate:(d==null?void 0:d.aggregate)??null,bipScore:((D=d==null?void 0:d.debug)==null?void 0:D.bipScore)??null}})}}const O=v?Math.max(Se,0):0,ee=N==null?void 0:N.startIndex,J=Number.isFinite(ee)&&ee!=null?Math.min(ee-1,o):o,oe=Math.min(J,j);if(oe>=O){const V=Me(O,oe);if(V){const I=Number.isInteger((le=d==null?void 0:d.debug)==null?void 0:le.explicitStartDay)?d.debug.explicitStartDay:null,C=((he=d==null?void 0:d.aggregate)==null?void 0:he.usedCandidates)??[],W=C.some(Ee=>(Ee==null?void 0:Ee.kind)==="profile"),Fe=C.some(Ee=>(Ee==null?void 0:Ee.kind)==="calculator");let _=null;v&&I!=null&&I===Se?_="marker":W?_="profiles":Fe&&(_="calculator"),s.push({key:"fertile",phase:"fertile",status:"default",bounds:V,startIndex:O,endIndex:oe,displayLabel:"Fértil",tooltip:"Fértil",message:"Fértil",reasons:{type:"fertile",startIndex:O,endIndex:oe,source:_,details:(d==null?void 0:d.debug)??null,notes:((Te=d==null?void 0:d.aggregate)==null?void 0:Te.notes)??[],statusSummary:(d==null?void 0:d.currentAssessment)??null,dailyAssessments:(d==null?void 0:d.dailyAssessments)??[],window:(d==null?void 0:d.fertileWindow)??null,aggregate:(d==null?void 0:d.aggregate)??null}})}}if(N&&Number.isFinite(N.startIndex)&&N.startIndex<=o){const V=N.status==="absolute"?o:Math.min(o,j),I=Me(N.startIndex,V);I&&s.push({key:"post",phase:N.phase,status:N.status,bounds:I,startIndex:N.startIndex,endIndex:V,displayLabel:N.label,tooltip:N.tooltip,message:N.message,reasons:N.reasons})}return s},[g,Xe,Ie,Le,h.length,Se,d,N,Re,Me,Ne]),rt=`${ce}-phase-relative-gradient`,nt=`${ce}-phase-fertile-gradient`,ot=`${ce}-phase-post-pending-gradient`,Je=`${ce}-phase-post-absolute-gradient`,Ze=s=>s.phase==="relativeInfertile"?"#065F46":s.phase==="fertile"?"#9D174D":s.phase==="postOvulatory"?s.status==="pending"?"#075985":"#1E3A8A":s.phase==="nodata"?"#475569":"hsl(var(--foreground))",ut="0 1px 1px var(--phase-text-shadow, rgba(15, 23, 42, 0.2))",lt=y.useMemo(()=>{if(!g||!(p!=null&&p.confirmed))return null;const s=Array.isArray(p==null?void 0:p.highSequenceIndices)?p.highSequenceIndices:[];if(s.length<2)return null;const o=s.map(j=>{if(j==null||j<0||j>=h.length)return null;const v=h[j],T=Ue.get(v==null?void 0:v.id);return!T||!Number.isFinite(T.displayTemperature)?null:{x:Q(j),y:ve(T.displayTemperature)}}).filter(Boolean);return o.length<2?null:o.map(({x:j,y:v},T)=>`${T===0?"M":"L"} ${j} ${v}`).join(" ")},[g,p,h,Ue,Q,ve]),[Qe,ft]=y.useState({w:typeof window<"u"?window.innerWidth:0,h:typeof window<"u"?window.innerHeight:0}),yt=Qe.w<Qe.h;y.useEffect(()=>{const s=()=>ft({w:window.innerWidth,h:window.innerHeight});return window.addEventListener("resize",s),window.addEventListener("orientationchange",s),()=>{window.removeEventListener("resize",s),window.removeEventListener("orientationchange",s)}},[]),y.useEffect(()=>{if(!S.current)return;const s=S.current.clientWidth/k;S.current.scrollLeft=Math.max(0,s*B)},[B,k,w.width,m]);const et=c&&Y&&yt,t=et,r="w-full h-full bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100",a=c?`${r} min-h-full ${t?"overflow-y-auto overflow-x-hidden":"overflow-x-auto overflow-y-visible"}`:`${r} overflow-x-auto overflow-y-visible border border-pink-100/50`,f=!c||m==="portrait";return e.jsx(we.div,{className:"relative w-full h-full",initial:!1,children:e.jsxs(we.div,{ref:S,className:`relative p-0 ${c?"":"rounded-2xl"} ${a}`,style:{touchAction:"auto",boxShadow:c?"inset 0 1px 3px rgba(244, 114, 182, 0.1)":"0 8px 32px rgba(244, 114, 182, 0.12), 0 2px 8px rgba(244, 114, 182, 0.08)",...et?{position:"absolute",top:0,left:0,width:`${Qe.h}px`,height:`${Qe.w}px`,transform:"rotate(90deg) translateY(-100%)",transformOrigin:"top left"}:{}},initial:!1,children:[xt&&e.jsx("div",{className:"flex items-center justify-center w-full h-full text-slate-400",children:"Cargando..."}),e.jsx("div",{className:"inline-block",style:{width:L,height:te},children:e.jsx("div",{className:"relative h-full overflow-y-auto",style:{height:te,maxHeight:me},children:e.jsxs("div",{className:"relative",style:{width:L,height:me},children:[f&&e.jsx("div",{className:"absolute left-0 top-0 h-full bg-transparent pointer-events-none z-10",style:{width:M.left},children:e.jsx(As,{padding:M,chartHeight:me,tempMin:De,tempMax:Ce,tempRange:_e,getY:ve,responsiveFontSize:Ve,textRowHeight:ae,isFullScreen:c,graphBottomY:F,rowsZoneHeight:de,showRelationsRow:G})}),e.jsxs(we.svg,{width:L,height:me,className:"font-sans flex-shrink-0",viewBox:`0 0 ${L} ${me}`,preserveAspectRatio:"xMidYMid meet",initial:!1,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),e.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),e.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),e.jsxs("linearGradient",{id:"tempAreaGradientChart",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(244, 114, 182, 0.18)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(244, 114, 182, 0.02)"})]}),e.jsxs("linearGradient",{id:rt,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"var(--phase-rel)",stopOpacity:"0"}),e.jsx("stop",{offset:"100%",stopColor:"var(--phase-rel)",stopOpacity:"var(--phase-rel-stop, 0.28)"})]}),e.jsxs("linearGradient",{id:nt,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"var(--phase-fertile)",stopOpacity:"0"}),e.jsx("stop",{offset:"100%",stopColor:"var(--phase-fertile)",stopOpacity:"var(--phase-fertile-stop, 0.27)"})]}),e.jsxs("linearGradient",{id:ot,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"var(--phase-post)",stopOpacity:"0"}),e.jsx("stop",{offset:"100%",stopColor:"var(--phase-post)",stopOpacity:"var(--phase-post-stop, 0.45)"})]}),e.jsxs("linearGradient",{id:Je,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"var(--phase-post-abs)",stopOpacity:"0"}),e.jsx("stop",{offset:"100%",stopColor:"var(--phase-post-abs)",stopOpacity:"var(--phase-post-abs-stop, 0.7)"})]}),e.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[e.jsx("rect",{width:"6",height:"6",fill:"#ef4444"}),e.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(255,255,255,0.85)"})]}),e.jsxs("filter",{id:"chartShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("filter",{id:"baselineGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),e.jsx("rect",{width:"100%",height:"100%",fill:"transparent"}),e.jsx(ys,{padding:M,chartWidth:L,chartHeight:te,tempMin:De,tempMax:Ce,tempRange:_e,getY:ve,getX:Q,allDataPoints:h,responsiveFontSize:Ve,isFullScreen:c,showLeftLabels:!f,reduceMotion:pe,graphBottomY:F,chartAreaHeight:Math.max(te-M.top-M.bottom-(i||0),0),rowsZoneHeight:de}),g&&Pe.length>0&&Ie!=null&&Le>0&&e.jsx("g",{children:Pe.map(s=>{const o=Ie,j=Le,T=(()=>s.phase==="postOvulatory"?s.status==="pending"?`url(#${ot})`:`url(#${Je})`:s.phase==="relativeInfertile"?`url(#${rt})`:s.phase==="fertile"?`url(#${nt})`:s.phase==="nodata"?"rgba(203, 213, 225, 0.2)":`url(#${nt})`)(),O=c?14:13,ee=Math.max(Ve(1.1),O),J=s.bounds.width<120,oe=Math.max(s.bounds.width-16,0),z=Math.max(ee*.58,1),D=Math.max(1,Math.floor(oe/z)),le=s.tooltip??s.displayLabel??s.message??"";let he=s.displayLabel??s.message??"";if(J&&he.length>D){const _=Math.max(D-1,1);he=`${he.slice(0,_).trimEnd()}${he.length>_?"…":""}`}const Te=J?s.bounds.x+8:s.bounds.x+s.bounds.width/2,V=J?"start":"middle",I=o+j/2,C=Ze(s),W=_=>{typeof(_==null?void 0:_.stopPropagation)=="function"&&_.stopPropagation(),typeof K=="function"&&K({phase:s.phase,status:s.status,reasons:s.reasons,message:s.message,startIndex:s.startIndex,endIndex:s.endIndex,label:s.displayLabel??s.message??null})},Fe=_=>{(_.key==="Enter"||_.key===" ")&&(_.preventDefault(),W(_))};return e.jsxs("g",{children:[e.jsx("rect",{x:s.bounds.x,y:o,width:s.bounds.width,height:j,fill:T,pointerEvents:"none"}),e.jsxs("text",{x:Te,y:I,fill:C,fontSize:ee,fontWeight:600,dominantBaseline:"middle",textAnchor:V,role:"button","aria-label":le,tabIndex:0,onClick:W,onKeyDown:Fe,style:{cursor:"pointer",userSelect:"none",lineHeight:1.2,textShadow:ut},pointerEvents:"auto",children:[e.jsx("title",{children:le}),he]})]},s.key)})}),g&&pt&&fe!==null&&(pe?e.jsx("line",{x1:Ke,y1:fe,x2:ge,y2:fe,stroke:Ge,strokeWidth:mt,strokeDasharray:We,opacity:Ae}):e.jsx(we.path,{d:`M ${Ke} ${fe} L ${ge} ${fe}`,stroke:Ge,strokeWidth:mt,strokeDasharray:We,opacity:Ae,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:Ae},transition:{duration:4,ease:"easeInOut",delay:.5}})),e.jsx(bs,{data:Be,allDataPoints:h,getX:Q,getY:ve,baselineY:F,temperatureField:"displayTemperature",reduceMotion:pe}),lt&&e.jsx("g",{pointerEvents:"none",children:e.jsx("path",{d:lt,fill:"none",stroke:"#cc0e93",strokeWidth:4,strokeLinecap:"round",strokeLinejoin:"round",opacity:.9})}),Z!==null&&ne!==null&&be>0&&e.jsx("g",{pointerEvents:"none",children:(()=>{const s=F,o=Math.max(3,Math.min(14,be*.4)),j=Math.max(o*2,ae*.85);return e.jsxs(e.Fragment,{children:[e.jsx("line",{x1:ne,y1:0,x2:ne,y2:s,stroke:"rgba(235, 171, 204,0.15)",strokeWidth:o}),e.jsx("line",{x1:ne,y1:s,x2:ne,y2:te,stroke:"rgba(235, 171, 204,0.15)",strokeWidth:j})]})})()}),e.jsx(Ns,{data:h,getX:Q,getY:ve,isFullScreen:c,orientation:m,responsiveFontSize:Ve,onPointInteraction:ke,clearActivePoint:$e,activePoint:H,padding:M,chartHeight:te,chartWidth:L,temperatureField:"displayTemperature",textRowHeight:ae,graphBottomY:F,rowsZoneHeight:de,compact:!1,reduceMotion:pe,showInterpretation:g,ovulationDetails:p,baselineStartIndex:qe,firstHighIndex:dt,baselineIndices:st,graphBottomLift:i,showRelationsRow:G})]})]})})}),H&&e.jsx(we.div,{ref:ue,initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:10},transition:{duration:.12,ease:"easeOut"},children:e.jsx(es,{point:H,position:X,chartWidth:L,chartHeight:te,onToggleIgnore:ze,onEdit:E,onClose:$e,onTogglePeak:b,currentPeakIsoDate:se})})]})})};function Ps(n,c){if(!n||!c)return[];const m=typeof n=="string"?ct(n):n;return[...Array(c)].map((x,E)=>{const b=Wt(m,E),R=jt(b,"yyyy-MM-dd"),B=jt(b,"dd/MM"),k=Lt(tt(b),tt(m))+1;return{date:B,isoDate:R,cycleDay:k,temperature:null,mucusSensation:null,mucusAppearance:null,had_relations:!1,hadRelations:!1,id:`placeholder-${R}`,ignored:!1,peak_marker:null}})}const Ts=({isOpen:n,onClose:c,children:m,ariaLabel:x,containerClassName:E="",backdropClassName:b="bg-black/40"})=>{if(y.useEffect(()=>{if(!n)return;const k=Y=>{Y.key==="Escape"&&typeof c=="function"&&c()};document.addEventListener("keydown",k);const{body:g}=document,pe=g.style.overflow;return g.style.overflow="hidden",()=>{document.removeEventListener("keydown",k),g.style.overflow=pe}},[n,c]),!n||typeof document>"u")return null;const R=()=>{typeof c=="function"&&c()},B=k=>{k.stopPropagation()};return Ht.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center px-4 py-8",children:[e.jsx("div",{className:`absolute inset-0 ${b}`,onClick:R,"aria-hidden":"true"}),e.jsx("div",{role:"dialog","aria-modal":"true","aria-label":x??void 0,className:`relative z-[101] w-full max-w-md overflow-hidden rounded-3xl bg-white shadow-2xl shadow-rose-200/50 focus:outline-none focus-visible:ring-2 focus-visible:ring-pink-200 ${E}`,onClick:B,children:m})]}),document.body)},_t="fertility-chart-settings",bt=n=>n?String(n).toUpperCase().replace(/-/g,""):"",Fs=n=>{const c=bt(n);return c==="T8"?"T-8":c==="CPM"?"CPM":n??""},ht=()=>({methods:{alemanas:!0,oms:!0,creighton:!0},calculators:{cpm:!0,t8:!0},postpartum:!1,combineMode:"conservador"}),$t={showRelationsRow:!1,fertilityStartConfig:ht()},Bs=[{key:"alemanas",label:"Alemanas"},{key:"oms",label:"OMS"},{key:"creighton",label:"Creighton"}],Ds=[{key:"cpm",label:"CPM"},{key:"t8",label:"T-8"}],Et={conservador:"Conservador",consenso:"Consenso",permisivo:"Permisivo"},Nt=n=>{const c=ht(),m={methods:{...c.methods},calculators:{...c.calculators},postpartum:c.postpartum,combineMode:c.combineMode};if(n&&typeof n=="object"){Object.keys(m.methods).forEach(E=>{var b;typeof((b=n==null?void 0:n.methods)==null?void 0:b[E])=="boolean"&&(m.methods[E]=n.methods[E])});let x=!1;if(Object.keys(m.calculators).forEach(E=>{var b;typeof((b=n==null?void 0:n.calculators)==null?void 0:b[E])=="boolean"&&(m.calculators[E]=n.calculators[E],x=!0)}),Object.prototype.hasOwnProperty.call(Et,n.combineMode)&&(m.combineMode=n.combineMode),typeof n.postpartum=="boolean"?m.postpartum=n.postpartum:n.postpartum!=null&&(m.postpartum=!!n.postpartum),!x){const{alemanas:E,oms:b,creighton:R}=m.methods;E?(m.calculators.cpm=!0,m.calculators.t8=!0):(b||R)&&(m.calculators.cpm=!1,m.calculators.t8=!1)}}else{const{alemanas:x,oms:E,creighton:b}=m.methods;x?(m.calculators.cpm=!0,m.calculators.t8=!0):(E||b)&&(m.calculators.cpm=!1,m.calculators.t8=!1)}return m},Ks=()=>{var et;const{cycleId:n}=Ut(),c=zt(),{currentCycle:m,archivedCycles:x,isLoading:E,addOrUpdateDataPoint:b,toggleIgnoreRecord:R,getCycleById:B}=rs(),[k,g]=y.useState(null),[pe,Y]=y.useState(!1),[se,G]=y.useState(!1),A=!n||n===m.id,q=A?null:x.find(t=>t.id===n);y.useEffect(()=>{if(A){g(null),Y(!1),G(!1);return}if(q){g(null),Y(!1),G(!1);return}let t=!0;return Y(!0),B(n).then(r=>{t&&(r?(g(r),G(!1)):(g(null),G(!0)))}).catch(()=>{t&&(g(null),G(!0))}).finally(()=>{t&&Y(!1)}),()=>{t=!1}},[A,q,B,n]);const l=A?m:q||k,K=!A&&!q,ie=!A&&(l==null?void 0:l.id),$=A?E&&!(m!=null&&m.id):pe||E&&!q&&!k,{preferences:S}=Vt(),ue=S==null?void 0:S.manualCpm,w=S==null?void 0:S.manualCpmBase,H=S==null?void 0:S.manualT8,Z=S==null?void 0:S.manualT8Base,X=["auto","manual","none"].includes(S==null?void 0:S.cpmMode)?S.cpmMode:"auto",h=["auto","manual","none"].includes(S==null?void 0:S.t8Mode)?S.t8Mode:"auto",Be=y.useMemo(()=>{if(!ie||!(l!=null&&l.startDate))return"";const t=f=>{if(!f)return null;try{return jt(ct(f),"dd/MM/yyyy")}catch(s){return console.error("Error formatting cycle date",s),f}},r=t(l.startDate),a=t(l.endDate)??"Sin fecha de fin";return r?`Ciclo ${r} - ${a}`:""},[ie,l==null?void 0:l.startDate,l==null?void 0:l.endDate]),De=y.useMemo(()=>{const t=[];return Array.isArray(x)&&x.length>0&&t.push(...x),m!=null&&m.id&&t.push(m),l!=null&&l.id&&!t.some(r=>(r==null?void 0:r.id)===l.id)&&t.push(l),t},[x,m,l]),[Ce,_e]=y.useState(typeof window<"u"&&window.innerWidth>window.innerHeight?"landscape":"portrait"),[M,ae]=y.useState(!1),[ve,Q]=y.useState(!1),[ke,ze]=y.useState(null),[Ve,$e]=y.useState(null),[Ye,qe]=y.useState(!1),[st,dt]=y.useState(!1),[p,d]=y.useState(!1),[re,Re]=y.useState(null),[i,P]=y.useState(()=>{const t={showRelationsRow:$t.showRelationsRow,fertilityStartConfig:Nt($t.fertilityStartConfig)};if(typeof window>"u")return t;try{const r=window.localStorage.getItem(_t);if(r){const a=JSON.parse(r),f={...t,...a};return typeof(a==null?void 0:a.showRelationsRow)=="boolean"?f.showRelationsRow=a.showRelationsRow:(a==null?void 0:a.showRelationsRow)!=null&&(f.showRelationsRow=!!a.showRelationsRow),f.fertilityStartConfig=Nt(a==null?void 0:a.fertilityStartConfig),f}}catch(r){console.warn("No se pudieron cargar los ajustes del gráfico.",r)}return t}),u=y.useMemo(()=>Nt(i.fertilityStartConfig),[i.fertilityStartConfig]),ce=y.useMemo(()=>({...u,calculators:{...u.calculators,cpm:u.calculators.cpm&&X!=="none",t8:u.calculators.t8&&h!=="none"}}),[u,X,h]);y.useEffect(()=>{if(!(typeof window>"u"))try{const t={...i,fertilityStartConfig:u};window.localStorage.setItem(_t,JSON.stringify(t))}catch(t){console.warn("No se pudieron guardar los ajustes del gráfico.",t)}},[i,u]);const L=y.useRef(!1),te=!!(ke&&String(ke.id||"").startsWith("placeholder-"));if(y.useEffect(()=>{const t=async()=>{var a,f;const r=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement);if(ae(r),!r){try{const s=typeof window<"u"?(a=window.screen)==null?void 0:a.orientation:null;await((f=s==null?void 0:s.unlock)==null?void 0:f.call(s))}catch{}_e("portrait")}};return document.addEventListener("fullscreenchange",t),document.addEventListener("webkitfullscreenchange",t),document.addEventListener("mozfullscreenchange",t),document.addEventListener("MSFullscreenChange",t),()=>{document.removeEventListener("fullscreenchange",t),document.removeEventListener("webkitfullscreenchange",t),document.removeEventListener("mozfullscreenchange",t),document.removeEventListener("MSFullscreenChange",t)}},[]),y.useLayoutEffect(()=>{window.dispatchEvent(new Event("resize"))},[Ce,M]),$)return e.jsx(wt,{children:e.jsx("div",{className:"flex h-full flex-col items-center justify-center space-y-4 bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100 px-4 py-8 text-center text-fertiliapp-fuerte",children:e.jsx("p",{children:"Cargando…"})})});if(!(l!=null&&l.id))return n&&se?e.jsx(wt,{children:e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 px-4 py-8 text-center text-fertiliapp-fuerte",children:[e.jsx("p",{children:"No se encontró el ciclo solicitado."}),e.jsx(it,{asChild:!0,className:"bg-fertiliapp-fuerte rounded-3xl text-white shadow",children:e.jsx(kt,{to:"/archived-cycles",children:"Volver a Mis Ciclos"})})]})}):e.jsx(wt,{children:e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 px-4 py-8 text-center text-fertiliapp-fuerte",children:[e.jsx("p",{children:"No hay ciclo activo."}),e.jsx(it,{asChild:!0,className:"bg-fertiliapp-fuerte rounded-3xl text-white shadow",children:e.jsx(kt,{to:"/records",children:"Ir a Mis Registros"})})]})});const me=28,F=10,de=25,fe=ct(l.startDate),xe=l.data||[],pt=y.useMemo(()=>{const t=Array.isArray(xe)?xe.find(r=>(r==null?void 0:r.peak_marker)==="peak"):null;return(t==null?void 0:t.isoDate)||null},[xe]),Ke=xe.reduce((t,r)=>{const a=ct(r.isoDate);return a>t?a:t},fe),ge=tt(new Date),Ge=Ke>ge?Ke:ge,We=Lt(tt(Ge),fe),Ae=Math.max(me,We+1),xt=Ps(fe,Ae).map(t=>{const r=xe.find(a=>a.isoDate===t.isoDate);return r?{...r,date:t.date}:t}),ne=M?Ce==="portrait"?F:de:Ce==="portrait"?F:me;let U=0;if(Ce!=="landscape"){const t=Lt(new Date,tt(fe)),r=Math.min(Math.max(t,0),Ae-1);let a=Math.min(Ae,r+1);r<ne-1&&(a=Math.min(Ae,ne)),U=Math.max(0,a-ne)}const He={backgroundColor:"#fff7fb",backgroundImage:`
      radial-gradient(120% 120% at 0% 0%, rgba(251,113,133,0.18) 0, transparent 55%),
      radial-gradient(110% 110% at 100% 0%, rgba(244,114,182,0.16) 0, transparent 55%),
      radial-gradient(130% 130% at 0% 100%, rgba(251,113,133,0.08) 0, transparent 60%),
      radial-gradient(140% 140% at 100% 100%, rgba(255,255,255,0.9) 0, rgba(255,247,250,0.3) 40%, transparent 70%)
    `},ye="var(--bottom-nav-safe)",be=M?{...He,height:"100dvh",maxHeight:"100dvh",paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"}:{...He,height:`calc(100dvh - ${ye})`,maxHeight:`calc(100dvh - ${ye})`,paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},Ue=(t,r=null)=>{ze(t),$e(r??null),Q(!0)},Se=async(t,r)=>{try{if(await R(t,r),K){const a=await B(t);a&&g(a)}}catch(a){console.error("Error toggling ignore state:",a)}},Xe=t=>{P(r=>({...r,showRelationsRow:t===!0}))},at=(t,r)=>{P(a=>{var j;const f=a.fertilityStartConfig??ht(),s=r===!0;if(((j=f.methods)==null?void 0:j[t])===s)return a;const o={...f,methods:{...f.methods,[t]:s}};return t==="alemanas"&&s&&(o.calculators={...f.calculators,cpm:!0,t8:!0}),{...a,fertilityStartConfig:o}})},gt=(t,r)=>{P(a=>{var o;const f=a.fertilityStartConfig??ht(),s=r===!0;return((o=f.calculators)==null?void 0:o[t])===s?a:{...a,fertilityStartConfig:{...f,calculators:{...f.calculators,[t]:s}}}})},Me=t=>{Object.prototype.hasOwnProperty.call(Et,t)&&P(r=>{const a=r.fertilityStartConfig??ht();return a.combineMode===t?r:{...r,fertilityStartConfig:{...a,combineMode:t}}})},je=t=>{P(r=>{const a=r.fertilityStartConfig??ht(),f=t===!0;return a.postpartum===f?r:{...r,fertilityStartConfig:{...a,postpartum:f}}})},Oe=(et=c==null?void 0:c.state)==null?void 0:et.fertilityCalculatorCandidates,Ne=l==null?void 0:l.fertilityCalculatorCandidates,Ie=y.useMemo(()=>{const t=[Array.isArray(Oe)?Oe:null,Array.isArray(Ne)?Ne:null].find(r=>Array.isArray(r)&&r.length>0);return t?t.map(r=>{if(!r)return null;const{source:a,day:f,reason:s}=r;if(a!=="CPM"&&a!=="T8")return null;const o=Number(f);return Number.isFinite(o)?{source:a,day:o,reason:typeof s=="string"?s:""}:null}).filter(Boolean):null},[Oe,Ne]),Le=y.useMemo(()=>{const t=ts(De),r=ss(De,as),a=[];return X==="auto"&&t&&a.push(t),h==="auto"&&r&&a.push(r),a},[De,X,h]),N=y.useMemo(()=>{const t=[],r=(a,f,s,o)=>{if(a!=="manual")return;const j=Number(s);if(!Number.isFinite(j)||j<=0)return;const v=Number(o),T=Number.isFinite(v)&&v>0,O=T?Number.isInteger(v)?`${v}`:`${Number(v.toFixed(2))}`:null,ee=T?f==="CPM"?`ciclo base: ${O} días`:`base ${Fs(f)}: ${O}`:null,J=ee?`Manual desde dashboard (${ee})`:"Manual desde dashboard";t.push({source:f,day:Math.max(1,j),reason:J,kind:"calculator",isManual:!0,manualBase:T?v:null})};return r(X,"CPM",ue,w),r(h,"T8",H,Z),t},[X,ue,w,H,Z,h]),Pe=y.useMemo(()=>{const t=new Map;(Array.isArray(Ie)?Ie:[]).forEach(s=>{const o=bt(s==null?void 0:s.source);o&&t.set(o,s)});const r=new Map;N.forEach(s=>{const o=bt(s==null?void 0:s.source);o&&r.set(o,s)});const a=X==="manual"?r.get("CPM")??t.get("CPM")??null:X==="auto"?Le.find(s=>bt(s==null?void 0:s.source)==="CPM")??null:null,f=h==="manual"?r.get("T8")??t.get("T8")??null:h==="auto"?Le.find(s=>bt(s==null?void 0:s.source)==="T8")??null:null;return[a,f].filter(Boolean)},[Le,X,N,Ie,h]),rt=async(t,r=!0)=>{if(!(l!=null&&l.id)||!(t!=null&&t.isoDate))return;const a=s=>{if(s==null||s==="")return null;const o=parseFloat(String(s).replace(",","."));return Number.isFinite(o)?o:null},f=r??!(t.peak_marker==="peak"||t.peakStatus==="P");qe(!0);try{const s=t.timestamp?jt(ct(t.timestamp),"HH:mm"):jt(new Date,"HH:mm");let o=Array.isArray(t.measurements)&&t.measurements.length>0?t.measurements:[{temperature:t.temperature_chart??t.temperature_raw??null,temperature_corrected:t.temperature_corrected??null,time:s,time_corrected:t.time_corrected??s,selected:!0,use_corrected:t.use_corrected??!1}];o.length===0&&(o=[{temperature:null,temperature_corrected:null,time:s,time_corrected:s,selected:!0,use_corrected:!1}]);const j=o.map((O,ee)=>{const J=O.time||s,oe=O.time_corrected||J;return{temperature:a(O.temperature??O.temperature_raw),time:J,selected:ee===0?!0:!!O.selected,temperature_corrected:a(O.temperature_corrected),time_corrected:oe,use_corrected:!!O.use_corrected}});j.some(O=>O.selected)||(j[0].selected=!0);const v={isoDate:t.isoDate,measurements:j,mucusSensation:t.mucus_sensation??t.mucusSensation??"",mucusAppearance:t.mucus_appearance??t.mucusAppearance??"",fertility_symbol:t.fertility_symbol??"none",observations:t.observations??"",had_relations:t.had_relations??t.hadRelations??!1,ignored:t.ignored??!1,peak_marker:f?"peak":null},T=t!=null&&t.id&&!String(t.id).startsWith("placeholder-")?t:null;await b(v,T,l.id)}catch(s){console.error("Error toggling peak marker:",s)}finally{qe(!1)}},nt=async(t,{keepFormOpen:r=!1}={})=>{if(l!=null&&l.id){qe(!0);try{if(await b(t,ke,l.id),K){const a=await B(l.id);a&&g(a)}r||(Q(!1),ze(null),$e(null))}finally{qe(!1)}}},ot=()=>{Q(!1),ze(null),$e(null)},Je=t=>{ze(t)},Ze=()=>{dt(t=>!t)},ut=y.useCallback(()=>{Re(null)},[]),lt=t=>{if(t.preventDefault(),L.current){L.current=!1;return}Ze()},Qe=t=>{t.pointerType==="touch"&&(t.preventDefault(),L.current=!0,Ze())},ft=y.useCallback((t={})=>{var Te,V;if(!t)return;const r=t.phase??null,a=t.reasons??{},f=(a==null?void 0:a.aggregate)??null,s=Array.isArray(f==null?void 0:f.usedCandidates)?f.usedCandidates:[],o=(a==null?void 0:a.window)??(a==null?void 0:a.fertileWindow)??null,j=Number.isInteger(a==null?void 0:a.startIndex)?a.startIndex:Number.isInteger(a==null?void 0:a.fertileStartFinalIndex)?a.fertileStartFinalIndex:null,v=(f==null?void 0:f.selectedMode)??(u==null?void 0:u.combineMode)??null,T=(()=>{var C;return(a==null?void 0:a.source)==="marker"||((C=a==null?void 0:a.details)==null?void 0:C.explicitStartDay)!=null?"Ajustado por marcadores":{conservador:"Modo conservador",consenso:"Modo consenso",permisivo:"Modo permisivo"}[v]??null})(),O=I=>((I==null?void 0:I.source)??(I==null?void 0:I.originalSource)??"").toString().toUpperCase(),ee=()=>{const I=Number.isInteger(j)?j+1:null;return I?{candidate:s.find(W=>Number.isFinite(W==null?void 0:W.day)&&Math.round(W.day)===I)??s[0]??null,dayNumber:I}:{candidate:null,dayNumber:null}},J=(I="start")=>{const{candidate:C,dayNumber:W}=ee();if(!C||!W)return null;const Fe=O(C),_=(C==null?void 0:C.base)??(C==null?void 0:C.baseCycle)??(C==null?void 0:C.shortestCycle)??(C==null?void 0:C.referenceCycle)??(C==null?void 0:C.finalValue)??(C==null?void 0:C.baseValue)??null;if(Fe==="CPM")return I==="start"?`Iniciado por cálculo (ciclo más corto: día ${W}).`:_?`Fin por cálculo del ciclo más corto (ciclo de ${_} días).`:`Fin por cálculo del ciclo más corto (día ${W}).`;if(Fe==="T8"||Fe==="T-8"){const At=`día ${W}`;return I==="start"?`Iniciado por cálculo (día de subida en ciclos anteriores: T-8 = ${At}).`:`Fin por cálculo según el día de subida de temperatura (T-8 = ${At}).`}const Ee=((C==null?void 0:C.reason)??"").toUpperCase(),Rt=Ee.includes("S")||Ee.includes("BIP");return I==="start"?Rt?`Iniciado por presencia de sensación fértil (día ${W}).`:`Iniciado por moco fértil (día ${W}).`:Rt?`Fin por presencia de sensación fértil (día ${W}).`:`Fin por presencia de moco fértil (día ${W}).`};let oe=null,z="",D="",le=[],he=null;if(r==="relativeInfertile")z="Relativamente infértil",Number.isInteger(j)?D=J("end")??"Fin de fase relativamente infértil.":D="A la espera de cambio en la sensación o apariencia del moco.";else if(r==="fertile"){z="Fértil";const I=J("start")??"Inicio de fase fértil.",C=Number.isFinite(o==null?void 0:o.endIndex),W=Number.isInteger(o==null?void 0:o.mucusInfertileStartIndex),Fe=Number.isInteger(o==null?void 0:o.temperatureInfertileStartIndex);let _=null;C?W&&Fe?_="Fin determinado por moco y temperatura.":W?_="Fin determinado por determinación de día pico.":Fe&&(_="Fin determinado por curva de temperatura."):_="A la espera de cierre por determinación de día pico o temperatura.",D=_?`${I} ${_}`:I}else if(r==="postOvulatory"){z="Infértil postovulatoria";const I=Number.isInteger((Te=a==null?void 0:a.temperature)==null?void 0:Te.startIndex)||Number.isInteger(o==null?void 0:o.temperatureInfertileStartIndex),C=Number.isInteger((V=a==null?void 0:a.mucus)==null?void 0:V.startIndex)||Number.isInteger(o==null?void 0:o.mucusInfertileStartIndex);I&&C?D="Determinada por moco y temperatura (doble criterio).":C?D="Determinada por moco.":I&&(D="Determinada por temperatura."),D||(D="Infertilidad postovulatoria."),(a==null?void 0:a.status)==="pending"&&(he="Pendiente completar el segundo criterio.")}else if(r==="nodata")((a==null?void 0:a.status)??(t==null?void 0:t.status)??null)==="no-fertile-window"?(z="Sin ventana fértil identificable",D="No se ha identificado un inicio fértil claro en este ciclo (ni por moco, ni por calculadora, ni por marcador explícito)."):(z="Sin datos suficientes",D="Añade registros de sensación, moco o temperatura para interpretar el ciclo.");else if(t!=null&&t.message)z=t.message;else return;z&&(!oe&&typeof(t==null?void 0:t.message)=="string"&&t.message.trim().length>0&&(oe=t.message),Re({header:oe,title:z,body:D,reasons:le,note:he,modeLabel:T}))},[u,Re]),yt=async()=>{var a;const t=document.documentElement,r=typeof window<"u"?(a=window.screen)==null?void 0:a.orientation:null;if(M){if(r!=null&&r.unlock)try{await r.unlock()}catch(f){console.error(f)}try{const f=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen,s=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;f&&s&&await f.call(document)}catch(f){console.error(f)}_e("portrait"),ae(!1)}else{const f=t.requestFullscreen||t.webkitRequestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen,s=!!f,o=!!(r!=null&&r.lock);if(!s&&!o){window.alert("La pantalla completa no está disponible en este dispositivo.");return}let j=!1,v=!1;try{f&&(await f.call(t),j=!0)}catch(O){console.error(O)}if(o)try{await r.lock("landscape"),v=!0}catch(O){console.error(O)}j||v?(_e("landscape"),ae(!0)):(_e("portrait"),ae(!1))}};return e.jsx(wt,{hideBottomNav:M,children:e.jsxs("div",{className:M?"fixed inset-0 z-50 h-[100dvh] w-[100dvw] overflow-y-auto overflow-x-hidden":"relative w-full h-full overflow-y-auto overflow-x-hidden",style:be,children:[ie&&!M&&e.jsx(it,{asChild:!0,variant:"ghost",className:"absolute top-4 left-4 z-10 bg-white/80 text-slate-700 hover:bg-[#E27DBF]/20",children:e.jsxs(kt,{to:`/cycle/${l.id}`,className:"flex items-center gap-1",children:[e.jsx(hs,{className:"h-4 w-4"}),Be&&e.jsx("span",{className:"ml-1 text-xs font-semibold text-slate-700 sm:text-sm",children:Be})]})}),e.jsx(it,{onClick:()=>d(t=>!t),variant:"ghost",size:"icon",className:"absolute top-16 right-4 z-10 p-2 rounded-full bg-white/80 shadow-lg shadow-slate-300/50 text-slate-700 hover:bg-[#E27DBF]/20","aria-label":"Ajustes del gráfico",children:e.jsx(gs,{className:"h-4 w-4"})}),e.jsx(it,{onClick:lt,onPointerUp:Qe,variant:"ghost",size:"icon",className:`absolute top-4 right-20 z-10 p-2 rounded-full transition-colors ${st?"bg-gradient-to-br from-pink-500 to-rose-500 text-white shadow-lg shadow-pink-300/50 border-pink-400":"bg-white/80 text-slate-600 hover:bg-pink-50/80 shadow-md border-pink-200/50"}`,children:st?e.jsx(ps,{className:"h-4 w-4"}):e.jsx(ms,{className:"h-4 w-4"})}),e.jsx(it,{onClick:yt,className:"absolute top-4 right-4 z-10 bg-white/80 rounded-full text-slate-600 hover:bg-pink-50/80 shadow-md border border-pink-200/50 backdrop-blur-sm","aria-label":M?"Salir de pantalla completa":"Rotar gráfico",children:e.jsx(xs,{className:"w-4 h-4"})}),e.jsx(Os,{data:xt,isFullScreen:M,orientation:Ce,onToggleIgnore:Se,onEdit:Ue,onTogglePeak:rt,cycleId:l.id,initialScrollIndex:U,visibleDays:ne,showInterpretation:st,reduceMotion:!0,forceLandscape:Ce==="landscape",currentPeakIsoDate:pt,showRelationsRow:i.showRelationsRow,fertilityStartConfig:ce,fertilityCalculatorCycles:De,fertilityCalculatorCandidates:Pe,onShowPhaseInfo:ft,isArchivedCycle:!A,cycleEndDate:(l==null?void 0:l.endDate)??null}),p&&e.jsx("div",{className:"fixed inset-0 z-40 bg-black/30",onClick:()=>d(!1),"aria-hidden":"true"}),e.jsx("div",{className:`fixed top-0 right-0 z-50 h-dvh w-72 sm:w-80 transform transition-transform duration-300 ease-in-out ${p?"translate-x-0":"translate-x-full"}`,role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"flex h-full flex-col gap-6 border-l border-rose-100/60 bg-white p-6 shadow-xl",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-700",children:"Ajustes del gráfico"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Personaliza la visualización de filas adicionales en la gráfica."})]}),e.jsx(it,{variant:"ghost",size:"icon",className:"h-8 w-8 text-slate-400 hover:text-slate-600",onClick:()=>d(!1),"aria-label":"Cerrar ajustes del gráfico",children:"×"})]}),e.jsxs("div",{className:"space-y-4 overflow-y-auto pr-1",children:[e.jsxs("div",{className:"rounded-xl border border-rose-100/70 bg-rose-50/40 p-4 flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"max-w-xs",children:[e.jsx(fs,{htmlFor:"toggle-relations-row",className:"text-sm font-semibold text-slate-700",children:"Mostrar fila de Relaciones (RS)"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Añade una fila dedicada a las relaciones sexuales debajo de la gráfica."})]}),e.jsx(Ct,{id:"toggle-relations-row",checked:i.showRelationsRow,onCheckedChange:Xe,className:"mt-1"})]}),e.jsxs("div",{className:"rounded-xl border border-purple-100/70 bg-purple-50/40 p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700",children:"Perfiles sintotérmicos"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Activa los métodos que quieras considerar para detectar el inicio fértil."})]}),e.jsx("div",{className:"space-y-2",children:Bs.map(t=>{var r;return e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("span",{className:"text-sm text-slate-700",children:t.label}),e.jsx(Ct,{checked:!!((r=u.methods)!=null&&r[t.key]),onCheckedChange:a=>at(t.key,a)})]},t.key)})})]}),e.jsxs("div",{className:"rounded-xl border border-amber-100/70 bg-amber-50/40 p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700",children:"Calculadoras complementarias"}),e.jsx("p",{className:"text-xs text-slate-500",children:"CPM y T-8 se combinan con los perfiles activos, salvo que actives el modo posparto."})]}),u.postpartum&&e.jsx("p",{className:"text-xs font-medium text-rose-500",children:"El modo posparto está activo: CPM y T-8 se omiten del cálculo final."}),e.jsx("div",{className:"space-y-2",children:Ds.map(t=>{var r;return e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("span",{className:"text-sm text-slate-700",children:t.label}),e.jsx(Ct,{checked:!!((r=u.calculators)!=null&&r[t.key]),onCheckedChange:a=>gt(t.key,a)})]},t.key)})})]}),e.jsxs("div",{className:"rounded-xl border border-sky-100/70 bg-sky-50/40 p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700",children:"Modo de combinación"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Determina cómo se elige el inicio fértil a partir de los candidatos disponibles."})]}),e.jsxs(ls,{value:u.combineMode,onValueChange:Me,children:[e.jsx(is,{className:"w-full bg-white/80 border-slate-200 text-sm text-slate-700",children:e.jsx(cs,{placeholder:"Selecciona un modo"})}),e.jsx(ds,{className:"bg-white border-slate-200 text-slate-700",children:Object.entries(Et).map(([t,r])=>e.jsx(us,{value:t,className:"text-sm",children:r},t))})]}),e.jsxs("div",{className:"flex items-start justify-between gap-3 pt-1",children:[e.jsxs("div",{className:"max-w-[65%]",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-700",children:"Modo posparto"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Ignora automáticamente CPM y T-8."})]}),e.jsx(Ct,{checked:!!u.postpartum,onCheckedChange:je,className:"mt-1"})]})]})]})]})}),e.jsx(Ts,{isOpen:!!re,onClose:ut,ariaLabel:"Detalle de interpretación del ciclo",containerClassName:"p-6",children:re&&e.jsxs("div",{className:"space-y-4 text-left",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[re.header&&e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-pink-600",children:re.header}),e.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:re.title})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[re.modeLabel&&e.jsx("span",{className:"rounded-full border border-rose-100 bg-rose-50 px-3 py-1 text-[11px] font-semibold text-rose-700",children:re.modeLabel}),e.jsx("button",{type:"button",onClick:ut,className:"rounded-full p-1 text-slate-400 transition hover:bg-slate-100 hover:text-slate-600 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-pink-200","aria-label":"Cerrar detalle de interpretación",children:e.jsx(Yt,{className:"h-5 w-5"})})]})]}),re.body&&e.jsx("p",{className:"text-sm leading-relaxed text-slate-600",children:re.body}),Array.isArray(re.reasons)&&re.reasons.length>0&&e.jsx("ul",{className:"list-disc space-y-1 pl-5 text-sm text-slate-600",children:re.reasons.map((t,r)=>e.jsx("li",{children:t},`${t}-${r}`))}),re.note&&e.jsx("p",{className:"text-xs text-slate-500",children:re.note})]})}),e.jsx(ns,{open:ve,onOpenChange:t=>{t||ot()},children:e.jsx(os,{hideClose:!0,className:"bg-transparent border-none p-0 text-gray-800 w-[90vw] sm:w-auto max-w-md sm:max-w-lg md:max-w-xl max-h-[85vh] overflow-y-auto",children:e.jsx(Zt,{onSubmit:nt,onCancel:ot,initialData:ke,cycleStartDate:l.startDate,cycleEndDate:l.endDate,isProcessing:Ye,isEditing:!!ke&&!te,cycleData:l.data,onDateSelect:Je,initialSectionKey:Ve})})})]})})};export{Ks as default};
