import{r as i,j as e,B as d,m as C,A as O,L as M,p,f as F,C as B,e as T}from"./index-752021ba.js";import{u as U,a as V,e as I}from"./useCycleData-af0f9bf4.js";import{B as q,T as G}from"./badge-fc139165.js";import{D as H,a as R,b as W,c as $,d as J,e as K}from"./dialog-9607b487.js";import{I as P}from"./input-235c5ced.js";import{O as Q}from"./OverlapWarningDialog-7190f3a2.js";import{P as L}from"./plus-1f07c869.js";import{E as X}from"./eye-67758e41.js";const S=({isOpen:m,onClose:x,onConfirm:j,initialStartDate:g,initialEndDate:h,includeEndDate:o=!0,title:w="Editar Fechas del Ciclo",description:k,cycleId:u,checkOverlap:l})=>{const[a,v]=i.useState(g||""),[n,b]=i.useState(h||""),[y,r]=i.useState(""),[D,A]=i.useState(null),[s,t]=i.useState(null),[c,N]=i.useState(!1);U(m,x),i.useEffect(()=>{v(g||""),b(h||"")},[g,h]);const z=async()=>{if(o&&!n){r("La fecha de fin es obligatoria");return}if(o&&a&&n&&n<a){r("La fecha de fin no puede ser anterior al inicio");return}const f=o?{startDate:a,endDate:n}:{startDate:a};if(l&&u&&a){const E=await l(u,a);if(E){A(E),t(f),N(!0);return}}j(f)};return e.jsxs(e.Fragment,{children:[e.jsx(H,{open:m,onOpenChange:x,children:e.jsxs(R,{className:"bg-white border-pink-100 text-gray-800",children:[e.jsxs(W,{children:[e.jsx($,{children:w}),e.jsx(J,{className:"text-gray-600",children:k??(o?"Modifica la fecha de inicio y fin del ciclo.":"Modifica la fecha de inicio del ciclo.")})]}),e.jsxs("div",{className:"my-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"startDate",className:"text-gray-700 text-sm",children:"Inicio del ciclo"}),e.jsx(P,{id:"startDate",type:"date",value:a,onChange:f=>v(f.target.value),className:"bg-gray-50 border-gray-200 text-gray-800"})]}),o&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"endDate",className:"text-gray-700 text-sm",children:"Fin del ciclo"}),e.jsx(P,{id:"endDate",type:"date",value:n||"",onChange:f=>{b(f.target.value),r("")},className:"bg-gray-50 border-gray-200 text-gray-800"}),y&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:y})]})]}),e.jsxs(K,{className:"sm:justify-end",children:[e.jsx(d,{variant:"outline",onClick:x,className:"border-gray-300 text-gray-700 hover:bg-gray-100",children:"Cancelar"}),e.jsx(d,{variant:"primary",onClick:z,className:"bg-pink-600 hover:bg-pink-700 text-white",children:"Guardar"})]})]})}),e.jsx(Q,{isOpen:c,conflictCycle:D,onCancel:()=>N(!1),onConfirm:()=>{N(!1),s&&j({...s,force:!0})}})]})},ie=()=>{const{currentCycle:m,archivedCycles:x,isLoading:j,addArchivedCycle:g,updateCycleDates:h,deleteCycle:o,checkCycleOverlap:w,forceUpdateCycleStart:k}=V(),[u,l]=i.useState(!1),[a,v]=i.useState(null),n=async({startDate:s,endDate:t})=>{try{await g(s,t),l(!1)}catch{}},b=async({startDate:s,endDate:t,force:c})=>{if(a)try{c?(await k(a.id,s),t!==void 0&&await h(a.id,void 0,t)):await h(a.id,s,t),v(null)}catch{}},y=s=>{window.confirm("¿Eliminar este ciclo?")&&o(s)},r=m.id?[{...m,isCurrent:!0,needsCompletion:!m.endDate},...x]:x,D=r&&r.length>0;if(j&&!D)return e.jsxs("div",{className:"min-h-[100dvh] bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100 flex items-center justify-center",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0",style:{background:"radial-gradient(65% 55% at 50% 32%, rgba(244,114,182,0.18) 0%, rgba(244,114,182,0.12) 35%, rgba(244,114,182,0.06) 60%, rgba(244,114,182,0) 100%)"}}),e.jsx("div",{className:"text-center text-slate-600 p-8",children:"Cargando ciclos archivados..."})]});if(!r||r.length===0)return e.jsxs("div",{className:"min-h-[100dvh] bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100 relative",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0",style:{background:"radial-gradient(65% 55% at 50% 32%, rgba(244,114,182,0.18) 0%, rgba(244,114,182,0.12) 35%, rgba(244,114,182,0.06) 60%, rgba(244,114,182,0) 100%)"}}),e.jsx("div",{className:"flex items-center justify-center min-h-[100dvh] px-4",children:e.jsx(C.div,{className:"text-center text-slate-600 flex flex-col items-center max-w-md",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs("div",{className:"bg-white/70 backdrop-blur-md rounded-3xl p-8 border border-pink-200/50 shadow-lg",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-pink-100 to-rose-100 rounded-full flex items-center justify-center",children:e.jsx(O,{className:"w-10 h-10 text-pink-500"})}),e.jsx("h2",{className:"text-2xl font-semibold text-slate-700 mb-4",children:"No hay ciclos archivados"}),e.jsx("p",{className:"text-slate-600 mb-8",children:"Cuando inicies un nuevo ciclo, el anterior aparecerá aquí."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsx(d,{asChild:!0,className:"bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white shadow-lg",children:e.jsx(M,{to:"/",children:"Volver al Ciclo Actual"})}),e.jsxs(d,{onClick:()=>l(!0),className:"bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white shadow-lg",children:[e.jsx(L,{className:"mr-2 h-4 w-4"})," Crear Ciclo"]})]})]})})}),e.jsx(S,{isOpen:u,onClose:()=>l(!1),onConfirm:n,title:"Añadir Ciclo Anterior",description:"Ingresa las fechas de un ciclo previo para añadir registros."})]});const A=[...r].sort((s,t)=>p(t.startDate)-p(s.startDate));return e.jsxs("div",{className:"min-h-[100dvh] bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100 relative",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0",style:{background:"radial-gradient(65% 55% at 50% 32%, rgba(244,114,182,0.18) 0%, rgba(244,114,182,0.12) 35%, rgba(244,114,182,0.06) 60%, rgba(244,114,182,0) 100%)"}}),e.jsxs("div",{className:"w-full max-w-4xl mx-auto px-4 py-6 relative z-10",children:[e.jsxs(C.div,{className:"flex flex-col sm:flex-row justify-between items-center mb-8",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsxs("h1",{className:"text-3xl sm:text-4xl font-bold text-slate-700 mb-4 sm:mb-0 flex items-center",children:[e.jsx(O,{className:"mr-3 h-8 w-8 text-pink-500"}),"Mis Ciclos"]}),e.jsxs(d,{onClick:()=>l(!0),className:"bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white shadow-lg",style:{filter:"drop-shadow(0 6px 12px rgba(236, 72, 153, 0.3))"},children:[e.jsx(L,{className:"mr-2 h-4 w-4"})," Añadir Ciclo"]})]}),e.jsx(C.div,{className:"space-y-4",variants:{hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.1}}},initial:"hidden",animate:"show",children:A.map(s=>{const t=s.endDate?F(p(s.endDate),"dd/MM/yyyy",{locale:I}):"En curso",c=s.data?s.data.length:0;return e.jsx(C.div,{className:"bg-white/80 backdrop-blur-md border border-pink-200/50 shadow-lg hover:shadow-xl transition-all duration-300 hover:bg-white/90 rounded-xl",variants:{hidden:{opacity:0,y:20},show:{opacity:1,y:0}},children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center",children:[e.jsxs("div",{className:"flex items-start space-x-4 flex-1",children:[e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-pink-100 to-rose-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(B,{className:"w-6 h-6 text-pink-600"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center flex-wrap gap-2 mb-2",children:e.jsxs("h2",{className:"text-lg font-semibold text-slate-700",children:[F(p(s.startDate),"dd/MM/yyyy",{locale:I})," - ",t]})}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-slate-600",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(T,{className:"w-4 h-4 text-slate-500"}),e.jsxs("span",{children:[c," registro",c!==1?"s":""]})]}),s.endDate&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(B,{className:"w-4 h-4 text-slate-500"}),e.jsxs("span",{children:[Math.ceil((p(s.endDate)-p(s.startDate))/(1e3*60*60*24))+1," días"]})]}),s.isCurrent&&e.jsx(q,{className:"bg-gradient-to-r from-pink-500 to-rose-500 text-white text-xs",children:"Ciclo actual"})]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4 sm:mt-0 w-full sm:w-auto",children:[e.jsx(d,{asChild:!0,variant:"outline",size:"sm",className:"flex-1 sm:flex-none border-pink-300 text-pink-600 hover:bg-pink-50 hover:border-pink-400",children:e.jsxs(M,{to:s.isCurrent?"/":`/cycle/${s.id}`,children:[e.jsx(X,{className:"mr-2 h-4 w-4"})," Ver"]})}),e.jsxs(d,{variant:"default",size:"sm",className:"flex-1 sm:flex-none bg-rose-500 text-white hover:bg-rose-600",onClick:()=>y(s.id),children:[e.jsx(G,{className:"mr-2 h-4 w-4"})," Eliminar"]})]})]})})},s.id)})})]}),e.jsx(S,{isOpen:u,onClose:()=>l(!1),onConfirm:n,title:"Añadir Ciclo Anterior",description:"Ingresa las fechas de un ciclo previo para añadir registros."}),e.jsx(S,{isOpen:!!a,onClose:()=>v(null),onConfirm:b,initialStartDate:a==null?void 0:a.startDate,initialEndDate:a==null?void 0:a.endDate,cycleId:a==null?void 0:a.id,checkOverlap:w,title:"Editar Fechas del Ciclo",description:"Actualiza las fechas del ciclo."})]})};export{ie as default};
