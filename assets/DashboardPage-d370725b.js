import{c as T,r as i,j as e,B as E,m as l}from"./index-ba6a3a71.js";import{D as A}from"./DataEntryForm-ff5b3dce.js";import{f as w,u as B,a as W,d as X,p as Y,s as $}from"./useCycleData-58376b29.js";import{D as I,a as O,b as z,c as G,d as U,e as _}from"./dialog-d17201db.js";import{I as q}from"./input-44b95b9b.js";import{C as V}from"./ChartTooltip-6fef2c69.js";import{P as J}from"./plus-2ba7c1cf.js";import"./label-75f62444.js";import"./eye-add74470.js";import"./eye-off-cbbbeb2a.js";const K=T("CalendarPlus",[["path",{d:"M21 13V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8",key:"3spt84"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["line",{x1:"19",x2:"19",y1:"16",y2:"22",key:"1ttwzi"}],["line",{x1:"16",x2:"22",y1:"19",y2:"19",key:"1g9955"}]]),Q=T("FilePlus",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"12",x2:"12",y1:"18",y2:"12",key:"1tsf04"}],["line",{x1:"9",x2:"15",y1:"15",y2:"15",key:"110plj"}]]),F=({isOpen:s,onClose:p,onConfirm:h,currentCycleStartDate:n})=>{const[o,c]=i.useState(w(new Date,"yyyy-MM-dd"));B(s,p);const u=!n,d=()=>{h(o)},y=u?"":w(new Date(n),"dd/MM/yyyy"),f=(()=>{if(u)return"";const a=new Date(o);return a.setDate(a.getDate()-1),w(a,"dd/MM/yyyy")})();return e.jsx(I,{open:s,onOpenChange:p,children:e.jsxs(O,{className:"bg-white border-pink-100 text-gray-800",children:[e.jsxs(z,{children:[e.jsx(G,{children:"Iniciar nuevo ciclo"}),e.jsx(U,{className:"text-gray-600",children:u?"Este será tu primer ciclo. Selecciona la fecha de inicio.":`¿Estás seguro de que quieres iniciar un nuevo ciclo? Los datos del ciclo actual (${y} - ${f}) serán archivados.`})]}),e.jsxs("div",{className:"my-4 space-y-2",children:[e.jsx("label",{htmlFor:"startDate",className:"text-gray-700 text-sm",children:"Fecha de inicio del nuevo ciclo"}),e.jsx(q,{id:"startDate",type:"date",value:o,onChange:a=>c(a.target.value),max:w(new Date,"yyyy-MM-dd"),min:u?void 0:w(new Date(n),"yyyy-MM-dd"),className:"bg-gray-50 border-gray-200 text-gray-800"})]}),e.jsxs(_,{className:"sm:justify-end",children:[e.jsx(E,{variant:"outline",onClick:p,className:"border-gray-300 text-gray-700 hover:bg-gray-100",children:"Cancelar"}),e.jsx(E,{variant:"primary",onClick:d,className:"bg-pink-600 hover:bg-pink-700 text-white",children:u?"Iniciar ciclo":"Confirmar nuevo ciclo"})]})]})})},Z=({cycleData:s,onEdit:p})=>{var v,k;const h=s.records||[],[n,o]=i.useState(null),[c,u]=i.useState({clientX:0,clientY:0}),d=i.useRef(null),y=140,a=y+15,x=a*2,j=t=>{switch(t){case"red":return{main:"#ef4444",light:"#fee2e2",glow:"rgba(239, 68, 68, 0.3)",border:"none"};case"white":return{main:"#f8fafc",light:"#ffe4e6",glow:"rgba(248, 250, 252, 0.3)"};case"green":return{main:"#22c55e",light:"#22c55e",glow:"rgba(34, 197, 94, 0.3)",border:"none"};case"spot":return{main:"#f9a8d4",light:"#f9a8d4",glow:"rgba(236, 72, 153, 0.3)",border:"#f87171",pattern:"url(#spotting-pattern-dashboard)"};default:return{main:"#d1d5db",light:"#f8fafc",glow:"rgba(209, 213, 219, 0.3)"}}},N=(()=>{const t=Math.max(s.currentDay,28);return Array.from({length:t},(r,b)=>{const g=b+1,m=h.find(H=>H.cycleDay===g),M=b/t*2*Math.PI-Math.PI/2,L=a+y*Math.cos(M),R=a+y*Math.sin(M);let D=g<=s.currentDay&&m?j(m.fertility_symbol):{main:"#b5b6ba",light:"#c8cacf",glow:"rgba(229, 231, 235, 0.3)"};const P=g===s.currentDay;return P&&(m?D={...j(m.fertility_symbol),border:"rgba(251, 113, 133, 0.8)"}:D={main:"transparent",light:"transparent",glow:"rgba(251, 113, 133, 0.4)",border:"rgba(251, 113, 133, 0.8)"}),{x:L,y:R,day:g,colors:D,isActive:g<=s.currentDay,isToday:P,hasRecord:!!m,record:m}})})(),C=(t,r)=>{if(r.stopPropagation(),!t.record){o(null);return}const b=d.current.getBoundingClientRect();let g,m;r.touches&&r.touches[0]?(g=r.touches[0].clientX,m=r.touches[0].clientY):(g=r.clientX,m=r.clientY),u({clientX:g-b.left,clientY:m-b.top}),o(t.record)};return i.useEffect(()=>{if(!n)return;const t=r=>{d.current&&!d.current.contains(r.target)&&o(null)};return document.addEventListener("mousedown",t),document.addEventListener("touchstart",t),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("touchstart",t)}},[n]),e.jsxs("div",{className:"relative min-h-[100dvh] flex flex-col",children:[e.jsxs(l.div,{className:"px-4 pt-5 pb-4 text-center flex-shrink-0",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.4},children:[e.jsx("h1",{className:"text-xl font-bold text-gray-800 mb-1",children:new Date().toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long"})}),e.jsx("p",{className:"text-sm font-medium text-pink-700 bg-white/20 backdrop-blur-sm rounded-full px-3 py-1.5 inline-block",children:"Ciclo actual"})]}),e.jsxs(l.div,{className:"px-4 flex-grow flex flex-col justify-start mt-4",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.4,delay:.1},children:[e.jsx("div",{className:"text-center mb-4 flex-shrink-0",children:e.jsxs(l.div,{ref:d,className:"relative inline-flex items-center justify-center mb-4",style:{width:x,height:x},initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200,damping:15,delay:.3},children:[e.jsxs("svg",{className:"w-full h-full",viewBox:`0 0 ${x} ${x}`,onClick:()=>o(null),children:[e.jsxs("defs",{children:[e.jsxs("pattern",{id:"spotting-pattern-dashboard",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[e.jsx("rect",{width:"6",height:"6",fill:"#f3f4f6"}),e.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(239,68,68,0.7)"})]}),e.jsxs("radialGradient",{id:"ringGlow",cx:"50%",cy:"50%",r:"50%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(255,255,255,0.0)"}),e.jsx("stop",{offset:"60%",stopColor:"rgba(244,114,182,0.12)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(190,24,93,0.10)"})]})]}),e.jsx("circle",{cx:a,cy:a,r:y-30,fill:"url(#ringGlow)",stroke:"rgba(255,255,255,0.35)",strokeWidth:"0.5"}),N.map((t,r)=>e.jsxs("g",{children:[!(t.isToday&&!t.hasRecord)&&t.isActive&&e.jsx("circle",{cx:t.x+.3,cy:t.y+.3,r:t.isToday?11:10,fill:"rgba(0, 0, 0, 0.2)",opacity:.5}),t.isToday&&e.jsx("circle",{cx:t.x,cy:t.y,r:8.5,fill:"none",stroke:"rgba(244,63,94,0.8)",strokeWidth:3,className:"animate-pulse",style:{pointerEvents:"none"}}),e.jsx(l.circle,{cx:t.x,cy:t.y,r:t.isToday?11:10,fill:t.colors.pattern||(t.isActive&&t.hasRecord?t.colors.main:"none"),stroke:t.colors.border==="none"?"none":t.colors.border||"rgba(158,158,158,0.4)",strokeWidth:t.colors.border==="none"?0:t.isToday?1.8:t.colors.border?.6:.8,onClick:b=>C(t,b),initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.6,delay:.8+r*.02,type:"spring",stiffness:400,damping:25},style:{filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.2))"}})]},r))]}),n&&e.jsx("div",{onClick:t=>t.stopPropagation(),children:e.jsx(V,{point:n,position:c,chartWidth:((v=d.current)==null?void 0:v.clientWidth)||0,chartHeight:((k=d.current)==null?void 0:k.clientHeight)||0,onEdit:p,onClose:()=>o(null)})}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none",children:[e.jsxs(l.div,{className:"text-center  backdrop-blur-md rounded-full p-4",initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{delay:1,type:"spring",stiffness:200},style:{filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.1))"},children:[e.jsx("span",{className:"text-5xl font-bold text-pink-700 block",children:s.currentDay}),e.jsx("span",{className:"text-800 text-pink-700 font-medium mt-0.5 block",children:"día del ciclo"})]}),e.jsx(l.div,{className:"mt-2 px-2.5 py-1  backdrop-blur-sm rounded-full border border-pink-200",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:1.3},style:{filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.1))"},children:e.jsx("span",{className:"text-md font-medium text-pink-900",children:s.currentDay<=7?"Menstrual":s.currentDay<=14?"Folicular":s.currentDay<=21?"Ovulatoria":"Lútea"})})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mx-2 mb-20 mt-2 flex-shrink-0",children:[e.jsxs(l.div,{className:"relative bg-gradient-to-br from-pink-50/90 to-rose-50/90 backdrop-blur-md rounded-3xl p-4 border border-pink-200/30",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.4,delay:.5},style:{filter:"drop-shadow(0 8px 25px rgba(236,72,153,0.08))",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.7)"},children:[e.jsx("h3",{className:"font-bold mb-6 text-gray-800 flex items-center gap-2 justify-center text-xs tracking-wide uppercase",children:"Símbolos"}),e.jsx("div",{className:"grid grid-cols-2 gap-2.5",children:[{label:"Menstrual",color:"#ef4444"},{label:"Fértil",color:"#f8fafc",stroke:"#e2e8f0"},{label:"Infértil",color:"#22c55e"},{label:"Spotting",color:"#f3f4f6",stroke:"#f87171",pattern:!0}].map(t=>e.jsxs("div",{className:"flex flex-col items-center gap-1.5",children:[e.jsx("div",{className:`w-4 h-4 rounded-full border ${t.pattern?"pattern-bg":""}`,style:{backgroundColor:t.color,borderColor:t.stroke||"transparent"}}),e.jsx("span",{className:"text-xs font-medium text-gray-700 text-center leading-none",children:t.label})]},t.label))}),e.jsxs("div",{className:"flex items-center justify-center gap-2 pt-3 mt-3 border-t border-gradient-to-r from-transparent via-gray-200 to-transparent",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-4 h-4 rounded-full border border-rose-400/80 bg-transparent"}),e.jsx("div",{className:"absolute inset-0 rounded-full border-[3px] border-rose-500/80 animate-pulse"})]}),e.jsx("span",{className:"text-xs font-semibold text-gray-700",children:"Hoy"}),e.jsx("div",{className:"absolute top-3 right-4 w-2 h-2 bg-gradient-to-br from-pink-300/40 to-rose-400/40 rounded-full"})]})]}),e.jsxs(l.div,{className:"relative bg-gradient-to-br from-pink-50/70 to-rose-50/50 backdrop-blur-md rounded-3xl p-4 border border-pink-200/40",initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.4,delay:.6},style:{filter:"drop-shadow(0 8px 25px rgba(236,72,153,0.1))",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.8)"},children:[e.jsx("h3",{className:"font-bold mb-3 text-gray-800 flex items-center gap-2 justify-center text-xs tracking-wide uppercase",children:"Cálculo"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1.5",children:[e.jsx("div",{className:"w-1 h-1 bg-pink-400 rounded-full"}),e.jsx("div",{className:"font-bold text-pink-800 text-xs",children:"CPM"}),e.jsx("div",{className:"w-1 h-1 bg-pink-400 rounded-full"})]}),e.jsx("div",{className:"bg-white/60 backdrop-blur-sm px-3 py-1.5 rounded-full border border-gray-200/50 shadow-sm",children:e.jsx("span",{className:"text-xs text-gray-600 font-medium",children:"Sin datos"})})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1.5",children:[e.jsx("div",{className:"w-1 h-1 bg-pink-400 rounded-full"}),e.jsx("div",{className:"font-bold text-pink-800 text-xs",children:"T-8"}),e.jsx("div",{className:"w-1 h-1 bg-pink-400 rounded-full"})]}),e.jsx("div",{className:"bg-white/60 backdrop-blur-sm px-3 py-1.5 rounded-full border border-gray-200/50 shadow-sm",children:e.jsx("span",{className:"text-xs text-gray-600 font-medium",children:"Sin datos"})})]})]}),e.jsx("div",{className:"absolute top-3 right-4 w-2 h-2 bg-gradient-to-br from-pink-500/40 to-rose-400/40 rounded-full"})]})]})]})]})},ee=({onAddRecord:s,onAddCycle:p})=>{const[h,n]=i.useState(!1);return e.jsxs("div",{className:"fixed bottom-[calc(var(--bottom-nav-height)+1rem)] right-6 flex flex-col items-end space-y-3 z-50",children:[h&&e.jsxs(e.Fragment,{children:[e.jsx(l.button,{onClick:s,className:"w-12 h-12 rounded-full bg-gradient-to-br from-pink-500 to-rose-500 text-white shadow-lg flex items-center justify-center",whileTap:{scale:.95},whileHover:{scale:1.05},initial:{opacity:0,y:20,scale:.8},animate:{opacity:1,y:0,scale:1},style:{filter:"drop-shadow(0 6px 12px rgba(236, 72, 153, 0.3))"},children:e.jsx(Q,{className:"h-5 w-5"})}),e.jsx(l.button,{onClick:p,className:"w-12 h-12 rounded-full bg-gradient-to-br from-purple-500 to-indigo-500 text-white shadow-lg flex items-center justify-center",whileTap:{scale:.95},whileHover:{scale:1.05},initial:{opacity:0,y:20,scale:.8},animate:{opacity:1,y:0,scale:1},style:{filter:"drop-shadow(0 6px 12px rgba(147, 51, 234, 0.3))"},children:e.jsx(K,{className:"h-5 w-5"})})]}),e.jsx(l.button,{onClick:()=>n(!h),className:"w-14 h-14 bg-gradient-to-br from-pink-500 to-rose-500 text-white rounded-full shadow-lg flex items-center justify-center",whileTap:{scale:.95},whileHover:{scale:1.05},initial:{scale:0},animate:{scale:1},style:{filter:"drop-shadow(0 6px 16px rgba(236, 72, 153, 0.4))"},children:e.jsx(J,{className:"h-6 w-6"})})]})},xe=()=>{const{currentCycle:s,addOrUpdateDataPoint:p,startNewCycle:h,isLoading:n}=W(),[o,c]=i.useState(!1),[u,d]=i.useState(!1),[y,f]=i.useState(!1),[a,x]=i.useState(null),j=i.useCallback(()=>{c(!1),x(null)},[]),S=i.useCallback(t=>{x(t)},[]),N=i.useCallback(t=>{x(t),c(!0)},[]);if(n)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-rose-50 via-pink-50 to-rose-100 flex items-center justify-center",children:e.jsx("p",{className:"text-center text-gray-600 text-lg",children:"Cargando..."})});if(!(s!=null&&s.id))return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-rose-50 via-pink-50 to-rose-100 flex items-center justify-center",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("p",{className:"text-gray-600 text-lg",children:"No hay ciclo activo."}),e.jsx("button",{onClick:()=>f(!0),className:"px-6 py-3 rounded-lg bg-pink-600 hover:bg-pink-700 text-white shadow",children:"Iniciar ciclo"})]}),e.jsx(F,{isOpen:y,onClose:()=>f(!1),onConfirm:async t=>{await h(t),f(!1),c(!0)}})]});const C=X($(new Date),Y(s.startDate))+1,v=async t=>{d(!0);try{await p(t,a),c(!1),x(null)}finally{d(!1)}},k=async t=>{await h(t),f(!1),c(!0)};return e.jsxs("div",{className:"min-h-[100dvh] bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100 relative overflow-x-hidden",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0",style:{background:"radial-gradient(65% 55% at 50% 32%, rgba(244,114,182,0.18) 0%, rgba(244,114,182,0.12) 35%, rgba(244,114,182,0.06) 60%, rgba(244,114,182,0) 100%)"}}),e.jsx("div",{className:"max-w-md mx-auto h-[100dvh]",children:e.jsx(l.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full",children:e.jsx(Z,{cycleData:{...s,currentDay:C,records:s.data},onEdit:N})})}),e.jsx(I,{open:o,onOpenChange:t=>{t?c(!0):j()},children:e.jsx(O,{hideClose:!0,className:"bg-transparent border-none p-0 text-gray-800 w-[90vw] sm:w-auto max-w-md sm:max-w-lg md:max-w-xl max-h-[85vh] overflow-y-auto",children:e.jsx(A,{onSubmit:v,onCancel:j,initialData:a,cycleStartDate:s.startDate,cycleEndDate:s.endDate,isProcessing:u,isEditing:!!a,cycleData:s.data,onDateSelect:S})})}),e.jsx(ee,{onAddRecord:()=>{x(null),c(!0)},onAddCycle:()=>f(!0)}),e.jsx(F,{isOpen:y,onClose:()=>f(!1),onConfirm:k,currentCycleStartDate:s.startDate})]})};export{xe as default};
