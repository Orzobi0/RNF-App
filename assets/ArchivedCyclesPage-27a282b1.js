import{r as t,j as e,B as N,b as W,a as J,m as A,A as q,L as K,p as d,f as T,C as U,g as Q}from"./index-a6c447c5.js";import{D as X,a as Y,b as Z,c as _,d as ee,e as ae,u as se}from"./useCycleData-1ec13a38.js";import{u as te,P as $,e as z,B as re}from"./badge-29ccf1d1.js";import{I as G}from"./input-620e50d2.js";import{O as ie}from"./OverlapWarningDialog-60ecf11f.js";import{D as le}from"./DeletionDialog-e098040e.js";const I=({isOpen:x,onClose:u,onConfirm:w,initialStartDate:p,initialEndDate:f,includeEndDate:m=!0,title:O="Editar Fechas del Ciclo",description:P,cycleId:D,checkOverlap:k})=>{const[l,o]=t.useState(p||""),[s,v]=t.useState(f||""),[n,h]=t.useState(""),[L,E]=t.useState(null),[r,g]=t.useState(null),[M,y]=t.useState(!1);te(x,u),t.useEffect(()=>{o(p||""),v(f||"")},[p,f]);const F=async()=>{if(m&&!s){h("La fecha de fin es obligatoria");return}if(m&&l&&s&&s<l){h("La fecha de fin no puede ser anterior al inicio");return}const c=m?{startDate:l,endDate:s}:{startDate:l};if(k&&D&&l){const j=await k(D,l);if(j){E(j),g(c),y(!0);return}}w(c)};return e.jsxs(e.Fragment,{children:[e.jsx(X,{open:x,onOpenChange:u,children:e.jsxs(Y,{className:"bg-white border-pink-100 text-gray-800",children:[e.jsxs(Z,{children:[e.jsx(_,{children:O}),e.jsx(ee,{className:"text-gray-600",children:P??(m?"Modifica la fecha de inicio y fin del ciclo.":"Modifica la fecha de inicio del ciclo.")})]}),e.jsxs("div",{className:"my-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"startDate",className:"text-gray-700 text-sm",children:"Inicio del ciclo"}),e.jsx(G,{id:"startDate",type:"date",value:l,onChange:c=>o(c.target.value),className:"bg-gray-50 border-gray-200 text-gray-800"})]}),m&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"endDate",className:"text-gray-700 text-sm",children:"Fin del ciclo"}),e.jsx(G,{id:"endDate",type:"date",value:s||"",onChange:c=>{v(c.target.value),h("")},className:"bg-gray-50 border-gray-200 text-gray-800"}),n&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:n})]})]}),e.jsxs(ae,{className:"sm:justify-end",children:[e.jsx(N,{variant:"outline",onClick:u,className:"border-gray-300 text-gray-700 hover:bg-gray-100",children:"Cancelar"}),e.jsx(N,{variant:"primary",onClick:F,className:"bg-pink-600 hover:bg-pink-700 text-white",children:"Guardar"})]})]})}),e.jsx(ie,{isOpen:M,conflictCycle:L,onCancel:()=>y(!1),onConfirm:()=>{y(!1),r&&w({...r,force:!0})}})]})},xe=()=>{const{currentCycle:x,archivedCycles:u,isLoading:w,addArchivedCycle:p,updateCycleDates:f,deleteCycle:m,checkCycleOverlap:O,forceUpdateCycleStart:P}=se(),{toast:D}=W(),k=J(),[l,o]=t.useState(!1),[s,v]=t.useState(null),[n,h]=t.useState(null),[L,E]=t.useState(!1),r=t.useRef(null),g=t.useRef(!1),M=async({startDate:a,endDate:i})=>{try{await p(a,i),o(!1)}catch{}},y=async({startDate:a,endDate:i,force:C})=>{if(s)try{C?(await P(s.id,a),i!==void 0&&await f(s.id,void 0,i)):await f(s.id,a,i),v(null)}catch{}},F=a=>{h(a)},c=async()=>{if(n){E(!0);try{await m(n.id),D({title:"Ciclo eliminado",description:"El ciclo ha sido eliminado."}),h(null)}catch(a){console.error("Error deleting archived cycle:",a)}finally{E(!1)}}},j=a=>{k(a.isCurrent?"/":`/cycle/${a.id}`)},B=a=>{g.current=!1,r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{g.current=!0,F(a)},1500)},S=(a,i=!0)=>{r.current&&(clearTimeout(r.current),r.current=null),!g.current&&i&&j(a)};t.useEffect(()=>()=>{r.current&&clearTimeout(r.current)},[]);const b=x.id?[{...x,isCurrent:!0,needsCompletion:!x.endDate},...u]:u,H=b&&b.length>0;if(w&&!H)return e.jsxs("div",{className:"min-h-[100dvh] bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100 flex items-center justify-center",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0",style:{background:"radial-gradient(65% 55% at 50% 32%, rgba(244,114,182,0.18) 0%, rgba(244,114,182,0.12) 35%, rgba(244,114,182,0.06) 60%, rgba(244,114,182,0) 100%)"}}),e.jsx("div",{className:"text-center text-slate-600 p-8",children:"Cargando ciclos archivados..."})]});if(!b||b.length===0)return e.jsxs("div",{className:"min-h-[100dvh] bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100 relative",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0",style:{background:"radial-gradient(65% 55% at 50% 32%, rgba(244,114,182,0.18) 0%, rgba(244,114,182,0.12) 35%, rgba(244,114,182,0.06) 60%, rgba(244,114,182,0) 100%)"}}),e.jsx("div",{className:"flex items-center justify-center min-h-[100dvh] px-4",children:e.jsx(A.div,{className:"text-center text-slate-600 flex flex-col items-center max-w-md",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs("div",{className:"bg-white/70 backdrop-blur-md rounded-3xl p-8 border border-pink-200/50 shadow-lg",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-pink-100 to-rose-100 rounded-full flex items-center justify-center",children:e.jsx(q,{className:"w-10 h-10 text-pink-500"})}),e.jsx("h2",{className:"text-2xl font-semibold text-slate-700 mb-4",children:"No hay ciclos archivados"}),e.jsx("p",{className:"text-slate-600 mb-8",children:"Cuando inicies un nuevo ciclo, el anterior aparecerá aquí."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsx(N,{asChild:!0,className:"bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white shadow-lg",children:e.jsx(K,{to:"/",children:"Volver al Ciclo Actual"})}),e.jsxs(N,{onClick:()=>o(!0),className:"bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white shadow-lg",children:[e.jsx($,{className:"mr-2 h-4 w-4"})," Crear Ciclo"]})]})]})})}),e.jsx(I,{isOpen:l,onClose:()=>o(!1),onConfirm:M,title:"Añadir Ciclo Anterior",description:"Ingresa las fechas de un ciclo previo para añadir registros."})]});const V=[...b].sort((a,i)=>d(i.startDate)-d(a.startDate));return e.jsxs("div",{className:"min-h-[100dvh] bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100 relative",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0",style:{background:"radial-gradient(65% 55% at 50% 32%, rgba(244,114,182,0.18) 0%, rgba(244,114,182,0.12) 35%, rgba(244,114,182,0.06) 60%, rgba(244,114,182,0) 100%)"}}),e.jsxs("div",{className:"w-full max-w-4xl mx-auto px-4 py-6 relative z-10",children:[e.jsxs(A.div,{className:"flex flex-col sm:flex-row justify-between items-center mb-8",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsxs("h1",{className:"text-3xl sm:text-4xl font-bold text-slate-700 mb-4 sm:mb-0 flex items-center",children:[e.jsx(q,{className:"mr-3 h-8 w-8 text-pink-500"}),"Mis Ciclos"]}),e.jsxs(N,{onClick:()=>o(!0),className:"bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white shadow-lg",style:{filter:"drop-shadow(0 6px 12px rgba(236, 72, 153, 0.3))"},children:[e.jsx($,{className:"mr-2 h-4 w-4"})," Añadir Ciclo"]})]}),e.jsx(A.div,{className:"space-y-3",variants:{hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.1}}},initial:"hidden",animate:"show",children:V.map(a=>{const i=a.endDate?T(d(a.endDate),"dd/MM/yyyy",{locale:z}):"En curso",C=a.data?a.data.length:0;return e.jsx(A.button,{type:"button",className:"w-full bg-white/80 backdrop-blur-md border border-pink-200/50 shadow-lg hover:shadow-xl transition-all duration-300 hover:bg-white/90 rounded-xl active:scale-[0.98] cursor-pointer select-none",variants:{hidden:{opacity:0,y:20},show:{opacity:1,y:0}},onMouseDown:()=>B(a),onMouseUp:()=>S(a),onMouseLeave:()=>S(a,!1),onTouchStart:()=>B(a),onTouchEnd:()=>S(a),onTouchMove:()=>S(a,!1),onClick:R=>{R.preventDefault(),g.current||j(a)},children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-pink-100 to-rose-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(U,{className:"w-6 h-6 text-pink-600"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center flex-wrap gap-2 mb-1.5",children:e.jsxs("h2",{className:"text-lg font-semibold text-slate-700",children:[T(d(a.startDate),"dd/MM/yyyy",{locale:z})," - ",i]})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-slate-600",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Q,{className:"w-4 h-4 text-slate-500"}),e.jsxs("span",{children:[C," registro",C!==1?"s":""]})]}),a.endDate&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(U,{className:"w-4 h-4 text-slate-500"}),e.jsxs("span",{children:[Math.ceil((d(a.endDate)-d(a.startDate))/(1e3*60*60*24))+1," días"]})]}),a.isCurrent&&e.jsx(re,{className:"bg-gradient-to-r from-pink-500 to-rose-500 text-white text-xs",children:"Ciclo actual"})]})]})]})})},a.id)})})]}),e.jsx(I,{isOpen:l,onClose:()=>o(!1),onConfirm:M,title:"Añadir Ciclo Anterior",description:"Ingresa las fechas de un ciclo previo para añadir registros."}),e.jsx(I,{isOpen:!!s,onClose:()=>v(null),onConfirm:y,initialStartDate:s==null?void 0:s.startDate,initialEndDate:s==null?void 0:s.endDate,cycleId:s==null?void 0:s.id,checkOverlap:O,title:"Editar Fechas del Ciclo",description:"Actualiza las fechas del ciclo."}),e.jsx(le,{isOpen:!!n,onClose:()=>h(null),onConfirm:c,title:"Eliminar ciclo",confirmLabel:"Eliminar ciclo",description:n?`¿Estás seguro de que quieres eliminar el ciclo ${T(d(n.startDate),"dd/MM/yyyy")} - ${n.endDate?T(d(n.endDate),"dd/MM/yyyy"):"En curso"}? Esta acción no se puede deshacer.`:"",isProcessing:L})]})};export{xe as default};
