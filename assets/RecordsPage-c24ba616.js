import{c as cs,r as a,E as Rt,F as He,G as Mt,H as Is,I as Hs,J as _e,K as _s,N as Ws,O as Vs,Q as Gs,S as Us,T as Ks,V as qs,W as Ys,X as Xs,b as Js,p as B,Y as me,f as I,s as Pe,z as Zs,Z as Qs,D as Xt,e as er,j as o,B as Jt,m as z,R as Zt}from"./index-9c052d95.js";import{P as tr,C as sr,T as rr}from"./CycleDatesEditor-13f0a133.js";import{c as or,m as Qt,f as $e,i as lt,h as nr,j as ct,D as ar,F as es,T as ds,k as ir,e as us,d as fs,P as ps}from"./computePeakStatuses-53226450.js";import{D as lr}from"./DeletionDialog-4d81e29b.js";import{u as cr,D as dr,a as ur}from"./useCycleData-5c7fca7c.js";import{P as fr,e as Fe,B as pr}from"./badge-4d2a43e0.js";import{e as ts}from"./checkbox-33f1ec29.js";import"./OverlapWarningDialog-691979ea.js";import"./input-38433acf.js";import"./label-79a0a783.js";import"./eye-2851a226.js";const ss=cs("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),mr=cs("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);function ms(){const e=a.useRef(!1);return Rt(()=>(e.current=!0,()=>{e.current=!1}),[]),e}function hr(){const e=ms(),[r,l]=a.useState(0),n=a.useCallback(()=>{e.current&&l(r+1)},[r]);return[a.useCallback(()=>He.postRender(n),[n]),r]}class gr extends a.Component{getSnapshotBeforeUpdate(r){const l=this.props.childRef.current;if(l&&r.isPresent&&!this.props.isPresent){const n=this.props.sizeRef.current;n.height=l.offsetHeight||0,n.width=l.offsetWidth||0,n.top=l.offsetTop,n.left=l.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function xr({children:e,isPresent:r}){const l=a.useId(),n=a.useRef(null),c=a.useRef({width:0,height:0,top:0,left:0});return a.useInsertionEffect(()=>{const{width:f,height:u,top:h,left:g}=c.current;if(r||!n.current||!f||!u)return;n.current.dataset.motionPopId=l;const x=document.createElement("style");return document.head.appendChild(x),x.sheet&&x.sheet.insertRule(`
          [data-motion-pop-id="${l}"] {
            position: absolute !important;
            width: ${f}px !important;
            height: ${u}px !important;
            top: ${h}px !important;
            left: ${g}px !important;
          }
        `),()=>{document.head.removeChild(x)}},[r]),a.createElement(gr,{isPresent:r,childRef:n,sizeRef:c},a.cloneElement(e,{ref:n}))}const jt=({children:e,initial:r,isPresent:l,onExitComplete:n,custom:c,presenceAffectsLayout:f,mode:u})=>{const h=Mt(br),g=a.useId(),x=a.useMemo(()=>({id:g,initial:r,isPresent:l,custom:c,onExitComplete:p=>{h.set(p,!0);for(const b of h.values())if(!b)return;n&&n()},register:p=>(h.set(p,!1),()=>h.delete(p))}),f?void 0:[l]);return a.useMemo(()=>{h.forEach((p,b)=>h.set(b,!1))},[l]),a.useEffect(()=>{!l&&!h.size&&n&&n()},[l]),u==="popLayout"&&(e=a.createElement(xr,{isPresent:l},e)),a.createElement(Is.Provider,{value:x},e)};function br(){return new Map}function vr(e){return a.useEffect(()=>()=>e(),[])}const he=e=>e.key||"";function yr(e,r){e.forEach(l=>{const n=he(l);r.set(n,l)})}function wr(e){const r=[];return a.Children.forEach(e,l=>{a.isValidElement(l)&&r.push(l)}),r}const kt=({children:e,custom:r,initial:l=!0,onExitComplete:n,exitBeforeEnter:c,presenceAffectsLayout:f=!0,mode:u="sync"})=>{const h=a.useContext(Hs).forceRender||hr()[0],g=ms(),x=wr(e);let p=x;const b=a.useRef(new Map).current,j=a.useRef(p),R=a.useRef(new Map).current,H=a.useRef(!0);if(Rt(()=>{H.current=!1,yr(x,R),j.current=p}),vr(()=>{H.current=!0,R.clear(),b.clear()}),H.current)return a.createElement(a.Fragment,null,p.map(E=>a.createElement(jt,{key:he(E),isPresent:!0,initial:l?void 0:!1,presenceAffectsLayout:f,mode:u},E)));p=[...p];const q=j.current.map(he),A=x.map(he),Ee=q.length;for(let E=0;E<Ee;E++){const N=q[E];A.indexOf(N)===-1&&!b.has(N)&&b.set(N,void 0)}return u==="wait"&&b.size&&(p=[]),b.forEach((E,N)=>{if(A.indexOf(N)!==-1)return;const L=R.get(N);if(!L)return;const ge=q.indexOf(N);let Y=E;if(!Y){const Ne=()=>{b.delete(N);const xe=Array.from(R.keys()).filter(_=>!A.includes(_));if(xe.forEach(_=>R.delete(_)),j.current=x.filter(_=>{const ae=he(_);return ae===N||xe.includes(ae)}),!b.size){if(g.current===!1)return;h(),n&&n()}};Y=a.createElement(jt,{key:he(L),isPresent:!1,onExitComplete:Ne,custom:r,presenceAffectsLayout:f,mode:u},L),b.set(N,Y)}p.splice(ge,0,Y)}),p=p.map(E=>{const N=E.key;return b.has(N)?E:a.createElement(jt,{key:he(E),isPresent:!0,presenceAffectsLayout:f,mode:u},E)}),a.createElement(a.Fragment,null,b.size?p:p.map(E=>a.cloneElement(E)))};function Cr(e){const r=Mt(()=>_e(e)),{isStatic:l}=a.useContext(_s);if(l){const[,n]=a.useState(e);a.useEffect(()=>r.on("change",n),[])}return r}function Dr(e,r,l){a.useInsertionEffect(()=>e.on(r,l),[e,r,l])}function jr(e,r,l){var n;if(typeof e=="string"){let c=document;r&&(Ws(!!r.current),c=r.current),l?((n=l[e])!==null&&n!==void 0||(l[e]=c.querySelectorAll(e)),e=l[e]):e=c.querySelectorAll(e)}else e instanceof Element&&(e=[e]);return Array.from(e||[])}const dt=new WeakMap;let ne;function Sr(e,r){if(r){const{inlineSize:l,blockSize:n}=r[0];return{width:l,height:n}}else return e instanceof SVGElement&&"getBBox"in e?e.getBBox():{width:e.offsetWidth,height:e.offsetHeight}}function kr({target:e,contentRect:r,borderBoxSize:l}){var n;(n=dt.get(e))===null||n===void 0||n.forEach(c=>{c({target:e,contentSize:r,get size(){return Sr(e,l)}})})}function Er(e){e.forEach(kr)}function Nr(){typeof ResizeObserver>"u"||(ne=new ResizeObserver(Er))}function Br(e,r){ne||Nr();const l=jr(e);return l.forEach(n=>{let c=dt.get(n);c||(c=new Set,dt.set(n,c)),c.add(r),ne==null||ne.observe(n)}),()=>{l.forEach(n=>{const c=dt.get(n);c==null||c.delete(r),c!=null&&c.size||ne==null||ne.unobserve(n)})}}const ut=new Set;let Ve;function Rr(){Ve=()=>{const e={width:window.innerWidth,height:window.innerHeight},r={target:window,size:e,contentSize:e};ut.forEach(l=>l(r))},window.addEventListener("resize",Ve)}function Mr(e){return ut.add(e),Ve||Rr(),()=>{ut.delete(e),!ut.size&&Ve&&(Ve=void 0)}}function Tr(e,r){return typeof e=="function"?Mr(e):Br(e,r)}const zr=50,rs=()=>({current:0,offset:[],progress:0,scrollLength:0,targetOffset:0,targetLength:0,containerLength:0,velocity:0}),Ar=()=>({time:0,x:rs(),y:rs()}),Lr={x:{length:"Width",position:"Left"},y:{length:"Height",position:"Top"}};function os(e,r,l,n){const c=l[r],{length:f,position:u}=Lr[r],h=c.current,g=l.time;c.current=e["scroll"+u],c.scrollLength=e["scroll"+f]-e["client"+f],c.offset.length=0,c.offset[0]=0,c.offset[1]=c.scrollLength,c.progress=Vs(0,c.scrollLength,c.current);const x=n-g;c.velocity=x>zr?0:Gs(c.current-h,x)}function Or(e,r,l){os(e,"x",r,l),os(e,"y",r,l),r.time=l}function Pr(e,r){const l={x:0,y:0};let n=e;for(;n&&n!==r;)if(n instanceof HTMLElement)l.x+=n.offsetLeft,l.y+=n.offsetTop,n=n.offsetParent;else if(n.tagName==="svg"){const c=n.getBoundingClientRect();n=n.parentElement;const f=n.getBoundingClientRect();l.x+=c.left-f.left,l.y+=c.top-f.top}else if(n instanceof SVGGraphicsElement){const{x:c,y:f}=n.getBBox();l.x+=c,l.y+=f;let u=null,h=n.parentNode;for(;!u;)h.tagName==="svg"&&(u=h),h=n.parentNode;n=u}else break;return l}const $r={Enter:[[0,1],[1,1]],Exit:[[0,0],[1,0]],Any:[[1,0],[0,1]],All:[[0,0],[1,1]]},Et={start:0,center:.5,end:1};function ns(e,r,l=0){let n=0;if(Et[e]!==void 0&&(e=Et[e]),typeof e=="string"){const c=parseFloat(e);e.endsWith("px")?n=c:e.endsWith("%")?e=c/100:e.endsWith("vw")?n=c/100*document.documentElement.clientWidth:e.endsWith("vh")?n=c/100*document.documentElement.clientHeight:e=c}return typeof e=="number"&&(n=r*e),l+n}const Fr=[0,0];function Ir(e,r,l,n){let c=Array.isArray(e)?e:Fr,f=0,u=0;return typeof e=="number"?c=[e,e]:typeof e=="string"&&(e=e.trim(),e.includes(" ")?c=e.split(" "):c=[e,Et[e]?e:"0"]),f=ns(c[0],l,n),u=ns(c[1],r),f-u}const Hr={x:0,y:0};function _r(e){return"getBBox"in e&&e.tagName!=="svg"?e.getBBox():{width:e.clientWidth,height:e.clientHeight}}function Wr(e,r,l){let{offset:n=$r.All}=l;const{target:c=e,axis:f="y"}=l,u=f==="y"?"height":"width",h=c!==e?Pr(c,e):Hr,g=c===e?{width:e.scrollWidth,height:e.scrollHeight}:_r(c),x={width:e.clientWidth,height:e.clientHeight};r[f].offset.length=0;let p=!r[f].interpolate;const b=n.length;for(let j=0;j<b;j++){const R=Ir(n[j],x[u],g[u],h[f]);!p&&R!==r[f].interpolatorOffsets[j]&&(p=!0),r[f].offset[j]=R}p&&(r[f].interpolate=Us(r[f].offset,Ks(n)),r[f].interpolatorOffsets=[...r[f].offset]),r[f].progress=r[f].interpolate(r[f].current)}function Vr(e,r=e,l){if(l.x.targetOffset=0,l.y.targetOffset=0,r!==e){let n=r;for(;n&&n!==e;)l.x.targetOffset+=n.offsetLeft,l.y.targetOffset+=n.offsetTop,n=n.offsetParent}l.x.targetLength=r===e?r.scrollWidth:r.clientWidth,l.y.targetLength=r===e?r.scrollHeight:r.clientHeight,l.x.containerLength=e.clientWidth,l.y.containerLength=e.clientHeight}function Gr(e,r,l,n={}){return{measure:()=>Vr(e,n.target,l),update:c=>{Or(e,l,c),(n.offset||n.target)&&Wr(e,l,n)},notify:()=>r(l)}}const Ie=new WeakMap,as=new WeakMap,St=new WeakMap,is=e=>e===document.documentElement?window:e;function Ur(e,{container:r=document.documentElement,...l}={}){let n=St.get(r);n||(n=new Set,St.set(r,n));const c=Ar(),f=Gr(r,e,c,l);if(n.add(f),!Ie.has(r)){const h=()=>{for(const j of n)j.measure()},g=()=>{for(const j of n)j.update(Ys.timestamp)},x=()=>{for(const j of n)j.notify()},p=()=>{He.read(h,!1,!0),He.read(g,!1,!0),He.update(x,!1,!0)};Ie.set(r,p);const b=is(r);window.addEventListener("resize",p,{passive:!0}),r!==document.documentElement&&as.set(r,Tr(r,p)),b.addEventListener("scroll",p,{passive:!0})}const u=Ie.get(r);return He.read(u,!1,!0),()=>{var h;qs(u);const g=St.get(r);if(!g||(g.delete(f),g.size))return;const x=Ie.get(r);Ie.delete(r),x&&(is(r).removeEventListener("scroll",x),(h=as.get(r))===null||h===void 0||h(),window.removeEventListener("resize",x))}}function ls(e,r){Xs(!!(!r||r.current))}const Kr=()=>({scrollX:_e(0),scrollY:_e(0),scrollXProgress:_e(0),scrollYProgress:_e(0)});function qr({container:e,target:r,layoutEffect:l=!0,...n}={}){const c=Mt(Kr);return(l?Rt:a.useEffect)(()=>(ls("target",r),ls("container",e),Ur(({x:u,y:h})=>{c.scrollX.set(u.current),c.scrollXProgress.set(u.progress),c.scrollY.set(h.current),c.scrollYProgress.set(h.progress)},{...n,container:(e==null?void 0:e.current)||void 0,target:(r==null?void 0:r.current)||void 0})),[e,r,JSON.stringify(n.offset)]),c}const Yr=e=>es.find(r=>r.value===e)||es[0],Nt=10,Bt={default:{iconBg:"bg-slate-50",iconBorder:"border-slate-200",iconColor:"text-slate-500",labelColor:"text-slate-600",valueColor:"text-slate-600",chipBorder:"border-slate-200",chipBg:"bg-white/80",hoverBg:"hover:bg-slate-50",focusRing:"focus-visible:ring-2 focus-visible:ring-slate-200"},temperature:{iconBg:"bg-orange-50",iconBorder:"border-orange-100",iconColor:"text-orange-500",labelColor:"text-orange-600",valueColor:"text-orange-600",chipBorder:"border-orange-100",hoverBg:"hover:bg-orange-50",focusRing:"focus-visible:ring-2 focus-visible:ring-orange-100"},time:{iconBg:"bg-slate-50",iconBorder:"border-slate-200",iconColor:"text-slate-500",labelColor:"text-slate-500",valueColor:"text-slate-600",chipBorder:"border-slate-200",hoverBg:"hover:bg-slate-50",focusRing:"focus-visible:ring-2 focus-visible:ring-slate-200"},mucusSensation:{iconBg:"bg-sky-50",iconBorder:"border-sky-100",iconColor:"text-sky-500",labelColor:"text-sky-600",valueColor:"text-sky-600",chipBorder:"border-sky-100",hoverBg:"hover:bg-sky-50",focusRing:"focus-visible:ring-2 focus-visible:ring-sky-100"},mucusAppearance:{iconBg:"bg-emerald-50",iconBorder:"border-emerald-100",iconColor:"text-emerald-500",labelColor:"text-emerald-600",valueColor:"text-emerald-600",chipBorder:"border-emerald-100",hoverBg:"hover:bg-emerald-50",focusRing:"focus-visible:ring-2 focus-visible:ring-emerald-100"},observations:{iconBg:"bg-violet-50",iconBorder:"border-violet-100",iconColor:"text-violet-500",labelColor:"text-violet-600",valueColor:"text-violet-600",chipBorder:"border-violet-100",hoverBg:"hover:bg-violet-50",focusRing:"focus-visible:ring-2 focus-visible:ring-violet-100"}},Xr=(e={})=>{const r={...Bt.default,dotColor:"bg-slate-300",patternClass:e!=null&&e.pattern?"pattern-bg":""};switch(e==null?void 0:e.value){case"red":return{...r,iconBg:"bg-rose-50",iconBorder:"border-rose-100",iconColor:"text-rose-500",labelColor:"text-rose-600",valueColor:"text-rose-600",chipBorder:"border-rose-100",hoverBg:"hover:bg-rose-50",focusRing:"focus-visible:ring-2 focus-visible:ring-rose-100",dotColor:"bg-rose-400"};case"white":return{...r,iconBg:"bg-white",iconBorder:"border-slate-200",iconColor:"text-slate-500",labelColor:"text-slate-600",valueColor:"text-slate-600",chipBorder:"border-slate-200",hoverBg:"hover:bg-slate-50",focusRing:"focus-visible:ring-2 focus-visible:ring-slate-200",dotColor:"bg-white"};case"green":return{...r,iconBg:"bg-emerald-50",iconBorder:"border-emerald-100",iconColor:"text-emerald-500",labelColor:"text-emerald-600",valueColor:"text-emerald-600",chipBorder:"border-emerald-100",hoverBg:"hover:bg-emerald-50",focusRing:"focus-visible:ring-2 focus-visible:ring-emerald-100",dotColor:"bg-emerald-400"};case"yellow":return{...r,iconBg:"bg-yellow-50",iconBorder:"border-yellow-100",iconColor:"text-yellow-500",labelColor:"text-yellow-600",valueColor:"text-yellow-600",chipBorder:"border-yellow-100",hoverBg:"hover:bg-yellow-50",focusRing:"focus-visible:ring-2 focus-visible:ring-yellow-100",dotColor:"bg-yellow-300"};case"spot":return{...r,iconBg:"bg-rose-50",iconBorder:"border-rose-100",iconColor:"text-rose-500",labelColor:"text-rose-600",valueColor:"text-rose-600",chipBorder:"border-rose-100",hoverBg:"hover:bg-rose-50",focusRing:"focus-visible:ring-2 focus-visible:ring-rose-100",dotColor:"bg-rose-400",patternClass:e!=null&&e.pattern?"pattern-bg":""};default:return r}},We=e=>({...Bt.default,...Bt[e]||{}}),hs=(e,{dependencies:r=[],externalRef:l,scrollContainerRef:n}={})=>{const c=a.useRef(null),f=Cr(1),u=f,{scrollY:h}=qr(),g=a.useCallback(()=>{var H;const p=c.current,b=(H=e==null?void 0:e.current)==null?void 0:H.getBoundingClientRect();if(!p||!b){f.set(1);return}const j=b.bottom+Nt;if(p.getBoundingClientRect().bottom<=j){f.set(0);return}f.set(1)},[e,f]);Dr(h,"change",g),a.useEffect(()=>{const p=n==null?void 0:n.current;if(!p)return;const b=()=>g();return p.addEventListener("scroll",b,{passive:!0}),g(),()=>{p.removeEventListener("scroll",b)}},[n,g,...r]);const x=a.useCallback(p=>{c.current=p,typeof l=="function"?l(p):l&&typeof l=="object"&&(l.current=p),p&&requestAnimationFrame(()=>g())},[l,g]);return a.useEffect(()=>{g();const p=()=>g();return window.addEventListener("resize",p),()=>{window.removeEventListener("resize",p)}},[g,...r]),a.useEffect(()=>{const p=c.current;if(!p||typeof ResizeObserver>"u")return;const b=new ResizeObserver(()=>g());return b.observe(p),()=>{b.disconnect()}},[g,...r]),{setRefs:x,opacity:u}},Jr=({isoDate:e,dayRef:r,onToggle:l,isSelected:n,displayDate:c,cycleDay:f,details:u,symbolLabel:h,isExpanded:g,onEdit:x,onDelete:p,isProcessing:b,calendarContainerRef:j,isCalendarOpen:R,scrollMarginTop:H,scrollContainerRef:q,onInlineEdit:A})=>{var _,ae,Ge,Ue;const{setRefs:Ee,opacity:E}=hs(j,{dependencies:[g,R],externalRef:r,scrollContainerRef:q}),N=Xr(u.symbolInfo),L=We,ge=(_=u==null?void 0:u.symbolInfo)==null?void 0:_.value,Y=ge&&ge!=="none",Ne=[{key:"temperatureTime",grouped:!0,items:[{key:"temperature",inlineKey:"temperature",palette:L("temperature"),icon:ds,title:u.hasTemperature?`${u.displayTemp}°C`:"—",hasValue:u.hasTemperature,badge:u.showCorrectedIndicator?o.jsxs("span",{className:"flex h-2.5 w-2.5 items-center justify-center text-amber-500",title:"Temperatura corregida",children:[o.jsx("span",{"aria-hidden":"true",className:"text-base leading-none",children:"•"}),o.jsx("span",{className:"sr-only",children:"Temperatura corregida"})]}):null},{key:"time",inlineKey:"time",palette:L("time"),icon:ir,title:u.timeValue||"—",hasValue:!!u.timeValue}]},{key:"sensationAppearance",grouped:!0,items:[{key:"mucusSensation",inlineKey:"mucusSensation",palette:L("mucusSensation"),icon:us,title:u.mucusSensation||"—",hasValue:!!u.mucusSensation},{key:"mucusAppearance",inlineKey:"mucusAppearance",palette:L("mucusAppearance"),icon:fs,title:u.mucusAppearance||"—",hasValue:!!u.mucusAppearance}]},{key:"observationsAndSymbol",grouped:!0,items:[{key:"observations",inlineKey:"observations",palette:L("observations"),icon:ps,title:(ae=u.observationsText)!=null&&ae.trim()?u.observationsText:"—",hasValue:!!((Ge=u.observationsText)!=null&&Ge.trim()),isMultiline:!0,minWidthClass:"min-w-[9rem]"},{key:"fertilitySymbol",inlineKey:"fertilitySymbol",palette:N,title:h||"Sin símbolo",hasValue:!!Y,minWidthClass:"min-w-[7.5rem]"},{key:"editAction",isAction:!0,icon:mr,ariaLabel:"Editar registro",onClick:S=>{S.stopPropagation(),x(u.record)},disabled:b},{key:"deleteAction",isAction:!0,icon:rr,ariaLabel:"Eliminar registro",onClick:S=>{S.stopPropagation(),p(u.record.id)},disabled:b}]}],xe=(S,t)=>{if(S.grouped)return o.jsx(Zt.Fragment,{children:o.jsx("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1.5",children:S.items.map(v=>{if(v.isAction){const Q=v.icon;return o.jsx("button",{type:"button",className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-md text-rose-500 transition-colors hover:bg-rose-50 hover:text-rose-600 focus:outline-none focus-visible:ring-1 focus-visible:ring-rose-300 disabled:cursor-not-allowed disabled:opacity-60",onClick:W=>{var ie;W.preventDefault(),W.stopPropagation(),(ie=v.onClick)==null||ie.call(v,W)},"aria-label":v.ariaLabel,disabled:v.disabled,children:o.jsx(Q,{className:"h-4 w-4"})},v.key)}const X=v.palette||L(v.key),F=v.icon,pt=v.hasValue??!!v.title,J=v.title||"-",Re=v.minWidthClass||"min-w-[8rem]",V=v.renderIcon?v.renderIcon():F?o.jsx(F,{className:`h-4 w-4 shrink-0 ${X.iconColor}`}):null,Z=V?"gap-2":"gap-1.5";return o.jsxs("button",{type:"button",className:`flex ${Re} flex-1 items-center ${Z} rounded-md px-1.5 py-1 text-left text-sm transition-colors ${X.hoverBg} focus:outline-none focus-visible:ring-1 focus-visible:ring-rose-300`,onClick:Q=>{Q.stopPropagation(),Q.preventDefault(),typeof A=="function"&&A(v.inlineKey||v.key)},children:[V,o.jsx("div",{className:"min-w-0 flex-1",children:o.jsxs("div",{className:"flex items-start gap-1.5",children:[o.jsx("span",{className:`text-sm font-semibold leading-tight ${pt?X.valueColor:"text-slate-400"} ${v.isMultiline?"whitespace-pre-line break-words":"truncate"}`,children:J}),v.badge&&o.jsx("span",{className:"shrink-0",children:v.badge})]})})]},v.key)})})},S.key);const Be=S.palette||L(S.key),Ke=S.icon,ft=S.value?Be.valueColor:"text-slate-400",be=S.value??"—",ve=Ke?o.jsx(Ke,{className:`mt-0.5 h-4 w-4 shrink-0 ${Be.iconColor}`}):null,qe=ve?"gap-2":"gap-1.5";return o.jsxs(Zt.Fragment,{children:[t>0&&o.jsx("div",{className:"my-1.5 border-t border-slate-100"}),o.jsxs("button",{type:"button",className:`flex w-full items-start gap-3 rounded-md px-1.5 py-1.5 text-left text-sm transition-colors ${Be.hoverBg} focus:outline-none focus-visible:ring-1 focus-visible:ring-rose-300`,onClick:v=>{v.stopPropagation(),v.preventDefault(),typeof A=="function"&&A(S.key)},children:[o.jsxs("div",{className:`flex min-w-0 flex-1 items-start ${qe} ${S.isMultiline?"pt-0.5":""}`,children:[ve,o.jsx("div",{className:"min-w-0 flex-1",children:o.jsx("span",{className:`block text-sm leading-snug ${ft} ${S.isMultiline?"whitespace-pre-line":"truncate"}`,children:be})})]}),S.badge&&o.jsx("span",{className:"shrink-0 self-center",children:S.badge})]})]},S.key)};return o.jsxs(z.div,{layout:!0,ref:Ee,onClick:()=>l(e),className:`group relative mx-0.5 flex w-full cursor-pointer flex-col rounded-2xl border border-rose-100 bg-white/75 px-4 py-3 shadow-sm backdrop-blur-md transition-all duration-300 hover:shadow-lg sm:mx-1 sm:px-5 ${n?"bg-white/90 ring-2 ring-rose-400 shadow-rose-200/70":""}`,whileHover:{translateY:-2},style:{opacity:E,scrollMarginTop:H},children:[o.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[o.jsxs("div",{className:"flex items-center gap-1 text-sm font-semibold text-slate-700",children:[o.jsx(ct,{className:"h-4 w-4 text-rose-400"}),c]}),o.jsxs("span",{className:"text-sm font-semibold text-rose-600 ",children:["D",f]}),o.jsx(eo,{hasTemperature:u.hasTemperature,hasMucusSensation:u.hasMucusSensation,hasMucusAppearance:u.hasMucusAppearance,hasObservations:u.hasObservations,peakStatus:u.peakStatus,isPeakDay:u.isPeakDay}),o.jsx("div",{className:"ml-auto flex items-center",children:o.jsx("div",{className:`flex h-6 w-6 items-center justify-center rounded-full border border-slate-400 ${N.dotColor} ${N.patternClass} shadow-inner`,title:h})})]}),o.jsx(kt,{initial:!1,children:g&&o.jsx(z.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.25,ease:"easeInOut"},className:"mt-1.5 overflow-hidden",children:o.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white/80 p-2 shadow-sm",children:[o.jsxs("div",{className:"flex flex-wrap items-center gap-1 text-[0.65rem] font-semibold uppercase tracking-wide text-slate-500",children:[o.jsx(gs,{peakStatus:u.peakStatus,isPeakDay:u.isPeakDay,size:"small"}),(u.isPeakDay||u.peakStatus==="P")&&o.jsx("span",{className:"text-rose-600",children:"Día pico"}),((Ue=u.record)==null?void 0:Ue.ignored)&&o.jsxs(pr,{className:"flex items-center gap-1 rounded-full border border-slate-200 bg-slate-50 text-[0.65rem] font-semibold uppercase tracking-wide text-slate-400",title:"Registro ignorado",children:[o.jsx("span",{"aria-hidden":"true",className:"h-2 w-2 rounded-full bg-slate-300"}),o.jsx("span",{className:"sr-only",children:"Registro ignorado"})]})]}),o.jsx("div",{className:"mt-1.5 space-y-1",children:Ne.map((S,t)=>xe(S,t))})]})})})]})},Zr=({id:e,days:r,toggleEmptyGroup:l,isExpandedGroup:n,hasSelectedInGroup:c,calendarContainerRef:f,isCalendarOpen:u,children:h,scrollMarginTop:g,scrollContainerRef:x})=>{const{setRefs:p,opacity:b}=hs(f,{dependencies:[n,u,r.length],scrollContainerRef:x});return o.jsx(z.button,{type:"button",ref:p,onClick:()=>l(e),className:`flex w-full items-center justify-between rounded-2xl border border-dashed border-rose-300 bg-white/40 px-4 py-3 text-sm font-medium text-slate-500 backdrop-blur-sm transition-all duration-200 hover:border-rose-500 hover:bg-white/70 ${c?"ring-2 ring-rose-300 text-rose-500 shadow-rose-200/70":""}`,whileHover:{scale:1.01},whileTap:{scale:.99},"aria-expanded":n,style:{opacity:b,scrollMarginTop:g},children:h})},Qr=e=>{if(e==null||e==="")return null;const r=Number(String(e).replace(",","."));return Number.isNaN(r)?null:r.toFixed(2)},gs=({peakStatus:e,isPeakDay:r,size:l="default",className:n=""})=>{let c=null,f="",u="border border-slate-200 bg-slate-100 text-slate-500";if(r||e==="P"?(c="✖",f="Día pico",u="border border-rose-200 bg-rose-100 text-rose-600"):e==="1"?(c="+1",f="Post día pico +1",u="border border-rose-200 bg-rose-50 text-rose-500"):e==="2"?(c="+2",f="Post día pico +2",u="border border-rose-200 bg-rose-50 text-rose-500"):e==="3"&&(c="+3",f="Post día pico +3",u="border border-rose-200 bg-rose-50 text-rose-500"),!c)return null;const h=l==="small"?"h-5 w-5 text-[0.6rem]":"h-6 w-6 text-xs";return o.jsx("span",{role:"img","aria-label":f,title:f,className:`flex items-center justify-center rounded-full font-semibold shadow-sm shadow-rose-200/40 transition-transform duration-200 ${h} ${u} ${n}`,children:c})},eo=({hasTemperature:e,hasMucusSensation:r,hasMucusAppearance:l,hasObservations:n,peakStatus:c,isPeakDay:f})=>{const u="flex items-center justify-center w-5 h-5 rounded-full text-[0.6rem] shadow-sm transition-transform duration-200",h=We("temperature"),g=We("mucusSensation"),x=We("mucusAppearance"),p=We("observations");return o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx(gs,{peakStatus:c,isPeakDay:f,size:"small"}),e&&o.jsx("span",{className:`${u} border ${h.iconBorder} ${h.iconBg}`,children:o.jsx(ds,{className:`h-2.5 w-2.5 ${h.iconColor}`})}),r&&o.jsx("span",{className:`${u} border ${g.iconBorder} ${g.iconBg}`,children:o.jsx(us,{className:`h-2.5 w-2.5 ${g.iconColor}`})}),l&&o.jsx("span",{className:`${u} border ${x.iconBorder} ${x.iconBg}`,children:o.jsx(fs,{className:`h-2.5 w-2.5 ${x.iconColor}`})}),n&&o.jsx("span",{className:`${u} border ${p.iconBorder} ${p.iconBg}`,children:o.jsx(ps,{className:`h-2.5 w-2.5 ${p.iconColor}`})})]})},to=({cycle:e,headerTitle:r="Mis Registros",headerIcon:l=ss,headerActions:n,topAccessory:c,includeEndDate:f=!1,initialCalendarOpen:u=!0,addOrUpdateDataPoint:h,deleteRecord:g,isLoading:x,updateCycleDates:p,checkCycleOverlap:b,forceShiftNextCycleStart:j,forceUpdateCycleStart:R,refreshData:H,afterRecordsContent:q=null,onRequestDeleteCycle:A=null,dateEditorDeleteTitle:Ee="Eliminar ciclo",dateEditorDeleteDescription:E="Esta acción no se puede deshacer. Se eliminarán todos los registros asociados.",dateEditorDeleteLabel:N="Eliminar ciclo",isDeletingCycle:L=!1}={})=>{const{currentCycle:ge,addOrUpdateDataPoint:Y,deleteRecord:Ne,isLoading:xe,updateCycleDates:_,checkCycleOverlap:ae,forceUpdateCycleStart:Ge,forceShiftNextCycleStart:Ue,refreshData:S}=cr(),t=e??ge,Be=x??xe,Ke=h||(async(s,i)=>{if(t!=null&&t.id)return Y(s,i,t.id)}),ft=g||(async s=>{if(t!=null&&t.id)return Ne(s,t.id)}),be=p||(async(s,i,d)=>_(s??(t==null?void 0:t.id),i,d)),ve=b??ae,qe=R||(async(s,i)=>Ge(s??(t==null?void 0:t.id),i)),v=j||(async(s,i,d)=>Ue(s??(t==null?void 0:t.id),i,d)),X=H??S,{toast:F}=Js(),[pt,J]=a.useState(!1),[Re,V]=a.useState(null),[Z,Q]=a.useState(null),[W,ie]=a.useState(!1),[xs,Tt]=a.useState(!1),[le,Ye]=a.useState(()=>(t==null?void 0:t.startDate)||""),[ce,Xe]=a.useState(()=>(t==null?void 0:t.endDate)||""),[bs,ee]=a.useState(""),[te,zt]=a.useState(null),[mt,At]=a.useState(null),[ht,Lt]=a.useState(!1),[vs,Ot]=a.useState(null),[ys,gt]=a.useState(!1),[xt,Me]=a.useState(!1),[w,se]=a.useState(null),[ye,re]=a.useState(null),[ws,de]=a.useState(null),[Cs,Te]=a.useState(null),[oe,Je]=a.useState(u),[Pt,bt]=a.useState([]),we=a.useRef(null),ze=a.useRef(null),Ae=a.useRef({}),ue=a.useRef(!1),$t=a.useRef(0),[Ze,Ft]=a.useState(0),vt=a.useCallback(s=>i=>{s&&(i?Ae.current[s]=i:delete Ae.current[s])},[]),Qe=a.useCallback(()=>{const s=we.current;if(!s){$t.current=0,Ft(0);return}const d=s.getBoundingClientRect().height;$t.current=d,Ft(m=>Math.abs(m-d)>.5?d:m)},[]);a.useLayoutEffect(()=>{let s=window.requestAnimationFrame(Qe);const i=()=>{s&&window.cancelAnimationFrame(s),s=window.requestAnimationFrame(Qe)};window.addEventListener("resize",i);let d;return typeof ResizeObserver<"u"&&(d=new ResizeObserver(()=>{s&&window.cancelAnimationFrame(s),s=window.requestAnimationFrame(Qe)}),we.current&&d.observe(we.current)),()=>{window.removeEventListener("resize",i),d&&d.disconnect(),s&&window.cancelAnimationFrame(s)}},[Qe]);const Ce=a.useCallback((s,{behavior:i="smooth",forceAlignTop:d=!1}={})=>{const m=ze.current;if(!s||!m)return;const y=m.getBoundingClientRect(),k=s.getBoundingClientRect(),C=k.top-y.top+m.scrollTop,P=C+k.height,O=m.scrollTop,pe=O+m.clientHeight,U=Math.max(C-12,0);if(d||C<O){m.scrollTo({top:U,behavior:i});return}if(P>pe){const T=Math.max(P-m.clientHeight+12,0),$=k.height<=m.clientHeight;m.scrollTo({top:$?U:T,behavior:i})}},[]),et=a.useMemo(()=>Math.max(Math.round(Ze+Nt),Nt),[Ze]),tt=a.useMemo(()=>et,[et]);a.useEffect(()=>{Ye((t==null?void 0:t.startDate)||""),Xe((t==null?void 0:t.endDate)||"")},[t==null?void 0:t.startDate,t==null?void 0:t.endDate]);const De=a.useMemo(()=>{var s;return(s=t==null?void 0:t.data)!=null&&s.length?[...t.data].filter(i=>i==null?void 0:i.isoDate).sort((i,d)=>{const m=B(i.isoDate);return B(d.isoDate)-m}).map(i=>i.isoDate):[]},[t==null?void 0:t.data]);a.useEffect(()=>{if(!w||!ue.current)return;const s=Ae.current[w];if(!s)return;const i=window.requestAnimationFrame(()=>{Ce(s,{behavior:"smooth",forceAlignTop:!0}),ue.current=!1});return()=>{window.cancelAnimationFrame(i)}},[w,Pt,oe,Ce]),a.useEffect(()=>{if(!ye)return;const s=Ae.current[ye];if(!s)return;const i=window.requestAnimationFrame(()=>{Ce(s,{behavior:"smooth",forceAlignTop:!0})});return()=>{window.cancelAnimationFrame(i)}},[ye,Ce,oe,Ze]),a.useEffect(()=>{const s=ye||w;if(!s)return;const i=Ae.current[s];i&&Ce(i,{behavior:"auto"})},[Ze,oe,ye,w,Ce]),a.useEffect(()=>{const s=ze.current;s&&s.scrollTo({top:0,behavior:"auto"})},[]);const je=a.useMemo(()=>{var s;return(s=t==null?void 0:t.data)!=null&&s.length?t.data.map(i=>{if(!(i!=null&&i.isoDate))return null;const d=B(i.isoDate);return me(d)?d:null}).filter(Boolean):[]},[t==null?void 0:t.data]),It=a.useMemo(()=>new Set(De),[De]),Ht=a.useMemo(()=>or((t==null?void 0:t.data)??[]),[t==null?void 0:t.data]),Se=a.useMemo(()=>{var i;const s=new Map;return(i=t==null?void 0:t.data)!=null&&i.length&&t.data.forEach(d=>{var it;if(!(d!=null&&d.isoDate))return;const m=((it=d.measurements)==null?void 0:it.find(Oe=>Oe==null?void 0:Oe.selected))||(d.temperature_chart||d.temperature_raw?{temperature:d.temperature_chart??d.temperature_raw,temperature_corrected:d.temperature_corrected??null,time:d.timestamp?I(B(d.timestamp),"HH:mm"):null,use_corrected:d.use_corrected??!1}:null),y=(m==null?void 0:m.use_corrected)??d.use_corrected??!1,k=(m==null?void 0:m.temperature_corrected)??d.temperature_corrected??null,C=(m==null?void 0:m.temperature)??d.temperature_chart??d.temperature_raw??null,O=Qr(y&&k!==null&&k!==void 0&&k!==""?k:C??k),pe=O!==null,U=y&&k!==null&&k!==void 0&&k!=="";let T=null;m!=null&&m.time?T=m.time:d.timestamp&&me(B(d.timestamp))&&(T=I(B(d.timestamp),"HH:mm"));const $=d.mucusSensation??d.mucus_sensation??"",ot=d.mucusAppearance??d.mucus_appearance??"",nt=!!$,at=!!ot,yt=nt||at,ke=d.observations||"",wt=!!ke,K=Ht[d.isoDate]||null,Ct=d.peak_marker==="peak"||K==="P",Dt=Yr(d.fertility_symbol);s.set(d.isoDate,{record:d,symbolInfo:Dt,hasTemperature:pe,displayTemp:O,showCorrectedIndicator:U,timeValue:T,hasMucus:yt,hasMucusSensation:nt,hasMucusAppearance:at,mucusSensation:$,mucusAppearance:ot,hasObservations:wt,observationsText:ke,peakStatus:K,isPeakDay:Ct})}),s},[t==null?void 0:t.data,Ht]),D=a.useMemo(()=>{if(!(t!=null&&t.startDate))return null;const s=B(t.startDate);if(!me(s))return null;let i;if(t!=null&&t.endDate)i=B(t.endDate);else{const d=Pe(new Date),m=[s,d];je.length&&m.push(Qt(je)),i=Qt(m)}return me(i)?{from:s,to:i}:{from:s,to:s}},[t==null?void 0:t.startDate,t==null?void 0:t.endDate,je]),Ds=a.useMemo(()=>{const s={};return D&&(s.outsideCycle=i=>$e(i,D.from)||lt(i,D.to),s.insideCycleNoRecord=i=>{if($e(i,D.from)||lt(i,D.to))return!1;const d=I(i,"yyyy-MM-dd");return!It.has(d)}),je.length&&(s.hasRecord=je),s},[D,je,It]),js=a.useMemo(()=>({months:"flex flex-col items-center sm:flex-row sm:items-center sm:justify-center space-y-3 sm:space-x-4 sm:space-y-0",month:"space-y-3",table:"w-full border-collapse space-y-0.5",row:"flex w-full mt-1.5",head_cell:"text-muted-foreground rounded-md w-8 font-medium text-[0.75rem]",cell:"h-8 w-8 text-center text-sm p-0 relative [&:has([aria-selected])]:bg-transparent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:Zs(Qs({variant:"ghost",size:"icon"}),"!h-8 !w-8 !p-0 font-medium text-slate-700 aria-selected:opacity-100"),day_selected:"border border-rose-400 text-white hover:bg-rose-300 hover:text-white focus:bg-rose-300 focus:text-white",day_today:"bg-rose-200 text-rose-700 font-semibold"}),[]),M=a.useMemo(()=>{if(!(t!=null&&t.startDate))return[];const s=B(t.startDate);if(!me(s))return[];const i=Pe(s),d=Pe(new Date);let m=D!=null&&D.to?Pe(D.to):d;lt(m,d)&&(m=d),$e(m,i)&&(m=i);const y=Xt(m,i)+1;if(y<=0)return[];const k=[];for(let C=y-1;C>=0;C-=1){const P=er(i,C),O=I(P,"yyyy-MM-dd"),pe=Xt(P,i)+1,U=Se.get(O)||null;k.push({isoDate:O,date:P,cycleDay:pe,details:U})}return k},[t==null?void 0:t.startDate,D,Se]),_t=a.useMemo(()=>new Set(M.map(s=>s.isoDate)),[M]),Le=a.useMemo(()=>{const s=D!=null&&D.to?I(Pe(D.to),"yyyy-MM-dd"):null;return f?s??De[0]??null:De.length?De[0]:s},[f,D,De]);a.useEffect(()=>{if(!(w&&_t.has(w))){if(!Le){w!==null&&(se(null),re(null));return}w!==Le&&(se(Le),Se.has(Le)||re(null))}},[w,_t,Le,Se]);const Ss=a.useMemo(()=>{if(!M.length)return{items:[],isoToGroup:{}};const s=[],i={};for(let d=0;d<M.length;){const m=M[d];if(m.details){s.push({type:"record",day:m}),d+=1;continue}let y=d;for(;y<M.length&&!M[y].details;)y+=1;if(y-d>3){const C=M.slice(d,y),P=`${C[0].isoDate}_${C[C.length-1].isoDate}`;C.forEach(({isoDate:O})=>{i[O]=P}),s.push({type:"empty-group",id:P,days:C})}else for(let C=d;C<y;C+=1)s.push({type:"empty-day",day:M[C]});d=y}return{items:s,isoToGroup:i}},[M]),{items:ks,isoToGroup:st}=Ss,Es=a.useCallback(s=>{s&&bt(i=>i.includes(s)?i.filter(d=>d!==s):[...i,s])},[]);a.useEffect(()=>{if(!w)return;const s=st[w];s&&bt(i=>i.includes(s)?i:[...i,s])},[w,st]);const Wt=a.useCallback(s=>{if(!s)return;const i=I(s,"yyyy-MM-dd");if(D&&($e(s,D.from)||lt(s,D.to)))return;const d=st[i];d&&bt(m=>m.includes(d)?m:[...m,d]),ue.current=!0,se(i),Se.has(i)||re(null)},[D,st,Se]),G=a.useCallback(()=>{zt(null),At(null),Lt(!1),Ot(null),gt(!1)},[]),Vt=a.useCallback(()=>{Ye((t==null?void 0:t.startDate)||""),Xe((t==null?void 0:t.endDate)||""),ee(""),G(),Tt(!0)},[t==null?void 0:t.startDate,t==null?void 0:t.endDate,G]),fe=a.useCallback(()=>{Tt(!1),ee(""),G(),Ye((t==null?void 0:t.startDate)||""),Xe((t==null?void 0:t.endDate)||"")},[t==null?void 0:t.startDate,t==null?void 0:t.endDate,G]),Ns=a.useCallback(()=>{A&&(fe(),A())},[fe,A]),Bs=a.useCallback(()=>{G()},[G]),Rs=a.useCallback(async()=>{if(!le){ee("La fecha de inicio es obligatoria");return}if(f&&ce&&ce<le){ee("La fecha de fin no puede ser anterior al inicio");return}if(t!=null&&t.id){ee(""),Me(!0);try{const s=ve?await ve(t.id,le,f&&ce||void 0):null;if(s){zt(le),At((f&&ce||void 0)??null),Lt(!!f),Ot(s),gt(!0),Me(!1);return}await be(t.id,le,f&&ce||void 0),await X({silent:!0}),F({title:"Fechas actualizadas",description:"El ciclo se ha ajustado a las nuevas fechas."}),fe()}catch(s){console.error("Error updating start date from records page:",s),ee("No se pudieron actualizar las fechas"),F({title:"Error",description:"No se pudieron actualizar las fechas.",variant:"destructive"})}finally{Me(!1)}}},[le,ce,f,t==null?void 0:t.id,ve,be,X,F,fe]),Ms=a.useCallback(async()=>{if(!(t!=null&&t.id)||!te){G();return}Me(!0),gt(!1);try{const s=t.startDate,i=t.endDate??void 0,d=te!==s,m=d&&te&&s&&$e(B(te),B(s)),y=ht?mt??void 0:void 0,k=ht&&mt!==null&&y!==i;if(m&&await qe(t.id,te),k&&y&&v){const C=d?te:s;await v(t.id,y,C)}await be(t.id,d?te:void 0,y),await X({silent:!0}),F({title:"Fechas actualizadas",description:"El ciclo se ha ajustado a las nuevas fechas."}),fe()}catch(s){console.error("Error adjusting cycle dates from records page:",s),ee("No se pudieron actualizar las fechas"),F({title:"Error",description:"No se pudieron actualizar las fechas.",variant:"destructive"})}finally{Me(!1),G()}},[t==null?void 0:t.id,t==null?void 0:t.startDate,t==null?void 0:t.endDate,te,ht,mt,qe,v,be,X,F,fe,G]),Gt=a.useCallback(()=>{J(!1),V(null),de(null),Te(null)},[]),rt=a.useCallback((s,i=null)=>{s&&(V(s),de(s.isoDate??null),Te(i),s.isoDate&&(ue.current=!1,se(s.isoDate),re(s.isoDate)),J(!0))},[]),Ts=a.useCallback(s=>rt(s),[rt]),zs=a.useCallback((s,i)=>rt(s,i),[rt]),As=s=>{var d;const i=(d=t==null?void 0:t.data)==null?void 0:d.find(m=>m.id===s);Q(i||null)},Ls=a.useCallback(s=>{V(s)},[]),Os=a.useCallback((s,i)=>{s&&(ue.current=!1,se(s),i&&re(d=>d===s?null:s))},[]),Ut=a.useCallback(s=>{s&&(ue.current=!1,se(s),re(null),V(null),de(s),Te(null),J(!0))},[]),Kt=a.useCallback(()=>{const s=M.length?M[0].isoDate:(t==null?void 0:t.startDate)||null,i=w||s||null;V(null),de(i),Te(null),ue.current=!1,i&&(se(i),re(null)),J(!0)},[M,t==null?void 0:t.startDate,w]),Ps=async(s,{keepFormOpen:i=!1}={})=>{ie(!0);try{await Ke(s,Re),i||(J(!1),V(null),de(null),Te(null))}catch{F({title:"Error",description:"No se pudo guardar el registro",variant:"destructive"})}finally{ie(!1),i&&de((s==null?void 0:s.isoDate)??null)}},$s=async()=>{if(Z){ie(!0);try{const s=Z.isoDate;await ft(Z.id),Q(null),de(null),s&&(re(i=>i===s?null:i),w===s&&se(s))}catch{F({title:"Error",description:"No se pudo eliminar el registro",variant:"destructive"})}finally{ie(!1)}}},qt={openDateEditor:Vt,openAddRecord:Kt,isProcessing:W,isUpdatingDates:xt,cycle:t},Fs=typeof n=="function"?n(qt):o.jsxs(o.Fragment,{children:[o.jsxs(Jt,{type:"button",variant:"outline",size:"icon",onClick:Vt,className:"border-pink-200 rounded-full text-pink-600 hover:bg-pink-500",disabled:W||xt,"aria-label":f?"Editar fechas del ciclo":"Editar fecha de inicio",children:[o.jsx(tr,{className:"h-4 w-4"}),o.jsx("span",{className:"sr-only",children:f?"Editar fechas del ciclo":"Editar fecha de inicio"})]}),o.jsxs(Jt,{type:"button",size:"icon",onClick:Kt,className:"rounded-full bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white shadow-lg",disabled:W,style:{filter:"drop-shadow(0 6px 12px rgba(236, 72, 153, 0.3))"},"aria-label":"Añadir registro",children:[o.jsx(fr,{className:"h-4 w-4"}),o.jsx("span",{className:"sr-only",children:"Añadir registro"})]})]}),Yt=typeof c=="function"?c({...qt,toggleCalendar:()=>Je(s=>!s),openCalendar:()=>Je(!0),closeCalendar:()=>Je(!1)}):c??null;return Be&&!(t!=null&&t.id)?o.jsxs("div",{className:"relative flex h-full flex-col items-center justify-center bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100",children:[o.jsx("div",{className:"pointer-events-none absolute inset-0",style:{background:"radial-gradient(65% 55% at 50% 32%, rgba(244,114,182,0.18) 0%, rgba(244,114,182,0.12) 35%, rgba(244,114,182,0.06) 60%, rgba(244,114,182,0) 100%)"}}),o.jsx("p",{className:"text-center text-slate-600 text-lg",children:"Cargando..."})]}):t!=null&&t.id?o.jsxs("div",{className:"relative flex h-full flex-col bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100",children:[Yt&&o.jsx("div",{className:"space-y-4",children:Yt}),o.jsx("div",{className:"pointer-events-none absolute inset-0",style:{background:"radial-gradient(65% 55% at 50% 32%, rgba(244,114,182,0.18) 0%, rgba(244,114,182,0.12) 35%, rgba(244,114,182,0.06) 60%, rgba(244,114,182,0) 100%)"}}),o.jsxs("div",{className:"mx-auto grid w-full max-w-6xl grid-cols-1 gap-6 px-4 relative z-10",children:[o.jsx("div",{ref:we,className:"sticky top-1 z-50 w-full max-w-lg mx-auto",children:o.jsx("div",{className:"relative overflow-hidden rounded-2xl ring-1 ring-rose-100/70",children:o.jsxs("div",{className:"space-y-1.5 p-2 sm:p-2.5 relative z-10",children:[o.jsx(z.div,{className:"flex flex-col gap-4",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:o.jsxs("div",{className:"flex flex-wrap items-center gap-1 justify-between sm:justify-start",children:[o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx(l,{className:"h-7 w-7 text-pink-500"}),o.jsxs("button",{type:"button",onClick:()=>Je(s=>!s),className:"group flex items-center gap-1 rounded-full px-1 py-1 text-left transition-all hover:border-rose-800 hover:bg-white/20 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-400 focus-visible:ring-offset-2 focus-visible:ring-offset-rose-50","aria-expanded":oe,"aria-controls":"records-calendar",children:[o.jsx("span",{className:"text-2xl sm:text-2xl font-bold text-slate-700",children:r}),o.jsx("span",{className:"flex items-center gap-1",children:o.jsx(z.span,{animate:{rotate:oe?180:0},className:"flex h-7 w-7 items-center justify-center rounded-full bg-rose-50 text-rose-400",children:o.jsx(ts,{className:"h-4 w-4"})})})]})]}),o.jsx("div",{className:"flex items-center gap-1",children:Fs})]})}),xs&&o.jsx(z.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.4},children:o.jsx(sr,{cycle:t,startDate:le,endDate:f?ce:t==null?void 0:t.endDate,onStartDateChange:s=>Ye(s),onEndDateChange:f?s=>Xe(s):void 0,onSave:Rs,onCancel:fe,isProcessing:xt,dateError:bs,includeEndDate:f,showOverlapDialog:ys,overlapCycle:vs,onConfirmOverlap:Ms,onCancelOverlap:Bs,onClearError:()=>ee(""),saveLabel:f?"Guardar fechas":"Guardar cambios",title:f?"Editar fechas del ciclo":"Editar fecha de inicio",description:f?"Actualiza las fechas del ciclo. Los registros se reorganizarán automáticamente.":"Actualiza la fecha de inicio del ciclo actual. Los registros se reorganizarán automáticamente.",onDeleteCycle:A?Ns:void 0,deleteTitle:Ee,deleteDescription:E,deleteLabel:N,isDeletingCycle:L})}),o.jsx(kt,{initial:!1,children:oe&&o.jsx(z.div,{id:"records-calendar",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"flex justify-center",children:o.jsx(nr,{mode:"single",locale:Fe,defaultMonth:w&&me(B(w))?B(w):D==null?void 0:D.to,selected:w&&me(B(w))?B(w):void 0,onSelect:Wt,onDayClick:Wt,modifiers:Ds,className:"w-full max-w-xs sm:max-w-sm rounded-3xl bg-white/40 !p-2 sm:!p-2.5 mx-auto backdrop-blur-sm [&_button]:text-slate-900 [&_button:hover]:bg-rose-100 [&_button[aria-selected=true]]:bg-rose-400",classNames:js,modifiersClassNames:{hasRecord:"relative font-semibold after:absolute after:bottom-0.5 after:left-1/2 after:-translate-x-1/2 after:w-1.5 after:h-1.5 after:rounded-full after:bg-rose-400 after:content-['']",outsideCycle:"text-slate-300 opacity-50 hover:text-slate-300 hover:bg-transparent",insideCycleNoRecord:"text-slate-900 hover:text-slate-900 hover:bg-rose-50"}})},"records-calendar")})]})})}),o.jsxs("div",{ref:ze,className:"sticky overflow-y-auto overscroll-contain w-full max-w-4xl mx-auto",style:{top:et,maxHeight:`calc(100dvh - ${et}px - var(--bottom-nav-safe, 0px))`,WebkitOverflowScrolling:"touch"},children:[o.jsx(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},className:"relative space-y-2 px-1.5 pt-2 pb-[calc(var(--bottom-nav-safe,0px))] sm:px-2 lg:px-4",children:M.length===0?o.jsx(z.div,{className:"py-12 text-center",initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:o.jsxs("div",{className:"mx-auto max-w-md rounded-3xl border border-rose-100 bg-white/80 p-8 shadow-lg backdrop-blur-sm",children:[o.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-rose-100 text-rose-500 shadow-inner",children:o.jsx(ss,{className:"h-8 w-8"})}),o.jsx("h3",{className:"text-lg font-semibold text-slate-700",children:"Aún no hay días para mostrar"}),o.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Actualiza la fecha de inicio del ciclo o añade tu primer registro para comenzar a ver el historial."})]})}):ks.map(s=>{var U;if(s.type==="empty-group"){const{id:T,days:$}=s;if(!$.length)return null;const ot=$[0],nt=$[$.length-1],at=I(nt.date,"dd/MM",{locale:Fe}),yt=I(ot.date,"dd/MM",{locale:Fe}),ke=Pt.includes(T),wt=w?$.some(K=>K.isoDate===w):!1;return o.jsxs(z.div,{layout:!0,className:"space-y-2",children:[o.jsxs(Zr,{id:T,days:$,toggleEmptyGroup:Es,isExpandedGroup:ke,hasSelectedInGroup:wt,calendarContainerRef:we,isCalendarOpen:oe,scrollMarginTop:tt,scrollContainerRef:ze,children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(ct,{className:"h-4 w-4 text-rose-300"}),o.jsx("span",{children:`${at} --- ${yt} sin registro`})]}),o.jsx(z.span,{animate:{rotate:ke?180:0},className:"rounded-2xl bg-rose-50 p-1 text-rose-400 shadow-inner",children:o.jsx(ts,{className:"h-4 w-4"})})]}),o.jsx(kt,{initial:!1,children:ke&&o.jsx(z.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2,ease:"easeInOut"},className:"space-y-2 pl-4 sm:pl-6",children:$.map(({isoDate:K,date:Ct,cycleDay:Dt})=>{const it=w===K,Oe=I(Ct,"dd/MM/yyyy",{locale:Fe});return o.jsxs(z.button,{type:"button",ref:vt(K),onClick:()=>Ut(K),className:`flex w-full items-center justify-between rounded-2xl border border-dashed border-rose-300 bg-white/40 px-4 py-3 text-sm font-medium text-slate-500 backdrop-blur-sm transition-all duration-200 hover:border-rose-500 hover:bg-white/70 ${it?"ring-2 ring-rose-300 text-rose-500 shadow-rose-200/70":""}`,whileHover:{scale:1.01},whileTap:{scale:.99},style:{scrollMarginTop:tt},children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(ct,{className:"h-4 w-4 text-rose-300"}),o.jsx("span",{children:`${Oe} D${Dt} - Sin registro`})]}),o.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-rose-400",children:"Añadir"})]},K)})},`${T}-items`)})]},T)}const{isoDate:i,date:d,cycleDay:m,details:y}=s.day,k=!!y,C=w===i,P=k&&ye===i,O=I(d,"dd/MM/yyyy",{locale:Fe}),pe=((U=y==null?void 0:y.symbolInfo)==null?void 0:U.label)||"";return k?o.jsx(Jr,{isoDate:i,dayRef:vt(i),onToggle:T=>Os(T,!0),isSelected:C,displayDate:O,cycleDay:m,details:y,symbolLabel:pe,isExpanded:P,onEdit:Ts,onDelete:As,isProcessing:W,calendarContainerRef:we,isCalendarOpen:oe,scrollMarginTop:tt,scrollContainerRef:ze,onInlineEdit:T=>zs(y.record,T)},i):o.jsxs(z.button,{type:"button",ref:vt(i),onClick:()=>Ut(i),className:`flex w-full items-center justify-between rounded-2xl border border-dashed border-rose-300 bg-white/40 px-4 py-3 text-sm font-medium text-slate-500 backdrop-blur-sm transition-all duration-200 hover:border-rose-500 hover:bg-white/70 ${C?"ring-2 ring-rose-300 text-rose-500 shadow-rose-200/70":""}`,whileHover:{scale:1.01},whileTap:{scale:.99},style:{scrollMarginTop:tt},children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(ct,{className:"h-4 w-4 text-rose-300"}),o.jsx("span",{children:`${O} D${m} - Sin registro`})]}),o.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-rose-400",children:"Añadir"})]},i)})}),q&&o.jsx("div",{className:"pt-4 space-y-4",children:q})]})]}),o.jsx(dr,{open:pt,onOpenChange:s=>{s?J(!0):Gt()},children:o.jsx(ur,{hideClose:!0,className:"bg-white border-pink-100 text-gray-800 w-[90vw] sm:w-auto max-w-md sm:max-w-lg md:max-w-xl max-h-[85vh] overflow-y-auto p-4 sm:p-6 rounded-2xl",children:o.jsx(ar,{onSubmit:Ps,onCancel:Gt,initialData:Re,cycleStartDate:t==null?void 0:t.startDate,cycleEndDate:t==null?void 0:t.endDate,isProcessing:W,isEditing:!!Re,cycleData:t==null?void 0:t.data,onDateSelect:Ls,defaultIsoDate:ws,focusedField:Cs})})}),o.jsx(lr,{isOpen:!!Z,onClose:()=>Q(null),onConfirm:$s,title:"Eliminar registro",confirmLabel:"Eliminar registro",description:Z?`¿Estás seguro de que quieres eliminar el registro del ${I(B(Z.isoDate),"dd/MM/yyyy")}? Esta acción no se puede deshacer.`:"",isProcessing:W})]}):o.jsxs("div",{className:"relative flex h-full flex-col items-center justify-center bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100",children:[o.jsx("div",{className:"pointer-events-none absolute inset-0",style:{background:"radial-gradient(65% 55% at 50% 32%, rgba(244,114,182,0.18) 0%, rgba(244,114,182,0.12) 35%, rgba(244,114,182,0.06) 60%, rgba(244,114,182,0) 100%)"}}),o.jsx("p",{className:"text-center text-slate-600 text-lg",children:"No hay ciclo activo."})]})},mo=()=>o.jsx(to,{});export{to as RecordsExperience,mo as default};
