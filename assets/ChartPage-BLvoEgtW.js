import{c as ln,m as Ge,j as e,R as wn,r as i,l as ct,f as lt,K as cn,n as Cn,g as Dt,k as $t,M as jn,q as In,N as Sn,u as vn,O as Tt,B as It,L as zt,X as kn}from"./index-Ck3e0O9m.js";import{a as Mn,g as Nn,i as Rn,C as Ht,S as Ln,d as Dn,e as An,f as En,h as On}from"./computePeakStatuses-D9iHsp4z.js";import{i as Pn,D as Tn}from"./DataEntryForm-CRvk9Tt4.js";import{u as $n,C as Bn,a as Fn,b as _n,c as Wn}from"./useFertilityChart-tonPsZ77.js";import{u as Gn,D as zn,a as Hn}from"./useCycleData-C3echxsr.js";import{L as Un}from"./label-DxCIISDy.js";import{A as Yn}from"./arrow-left-TyOdhabY.js";import{E as Vn,a as qn}from"./eye-DWFbEAhh.js";import"./input-hh7yE9fK.js";import"./badge-CIoXRNss.js";const Xn=ln("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),Kn=ln("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Zn=({padding:a,chartWidth:o,chartHeight:p,tempMin:f,tempMax:T,tempRange:m,getY:U,getX:G,allDataPoints:w=[],visibleRange:b=null,responsiveFontSize:$,isFullScreen:ee,showLeftLabels:q=!1,reduceMotion:z=!1,isScrolling:S=!1,graphBottomY:Z,chartAreaHeight:d,rowsZoneHeight:B})=>{const L={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.3,ease:"easeOut"}}},te=[];if(m>0){const A=m<=2.5?.1:.5;for(let ye=f;ye<=T+1e-9;ye+=A)te.push(parseFloat(ye.toFixed(1)))}else for(let A=35.8;A<=37.2+1e-9;A+=.1)te.push(parseFloat(A.toFixed(1)));const y=w.length,M=y>60||S,ce=z||M?"g":Ge.g,ne=Number.isInteger(b?.startIndex)?b.startIndex:0,le=Number.isInteger(b?.endIndex)?b.endIndex:Math.max(y-1,0),u=y?Math.max(0,Math.min(y-1,ne)):0,de=y?Math.max(u,Math.min(y-1,le)):-1;return e.jsxs(e.Fragment,{children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"bgGradientChart",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#fffbfc"}),e.jsx("stop",{offset:"50%",stopColor:"#fff5f7"}),e.jsx("stop",{offset:"100%",stopColor:"#fff1f3"})]}),e.jsxs("linearGradient",{id:"dataZoneGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#fff7fb"}),e.jsx("stop",{offset:"50%",stopColor:"#ffe4f0"}),e.jsx("stop",{offset:"100%",stopColor:"#fff7fb"})]}),e.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"#f472b6"}),e.jsx("stop",{offset:"30%",stopColor:"#ec4899"}),e.jsx("stop",{offset:"70%",stopColor:"#db2777"}),e.jsx("stop",{offset:"100%",stopColor:"#be185d"})]}),e.jsxs("filter",{id:"softShadow",children:[e.jsx("feGaussianBlur",{in:"SourceAlpha",stdDeviation:"2"}),e.jsx("feOffset",{dx:"0",dy:"1",result:"offsetblur"}),e.jsx("feComponentTransfer",{children:e.jsx("feFuncA",{type:"linear",slope:"0.2"})}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("filter",{id:"pointGlow",children:[e.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsx("filter",{id:"textShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodColor:"rgba(255, 255, 255, 0.8)"})}),e.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[e.jsx("rect",{width:"6",height:"6",fill:"#ef4444"}),e.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(255,255,255,0.85)"})]})]}),e.jsx("rect",{x:a.left,y:a.top,width:o-a.left-a.right,height:d,fill:"url(#bgGradientChart)",opacity:2,rx:12,style:{filter:"drop-shadow(0 4px 12px rgba(244, 114, 182, 0.1))"}}),e.jsx("rect",{x:a.left,y:a.top,width:o-a.left-a.right,height:d,fill:"white",stroke:"url(#tempLineGradientChart)",strokeWidth:"1",strokeOpacity:"0.2",rx:"12",style:{filter:"url(#softShadow)"}}),e.jsx("rect",{x:a.left,y:Z,width:o-a.left-a.right,height:B,fill:"url(#dataZoneGradient)",rx:"8",style:{filter:"drop-shadow(0 -1px 2px rgba(244, 114, 182, 0.05))"}}),te.map((A,ye)=>{const Ce=U(A),h=A.toFixed(1).endsWith(".0")||A.toFixed(1).endsWith(".5"),ue=h?A.toFixed(1):`.${A.toFixed(1).split(".")[1]}`;return e.jsxs(ce,{...z||M?{}:{variants:L},children:[e.jsx("line",{x1:a.left,y1:Ce,x2:o-a.right,y2:Ce,stroke:h?"#f9a8d4":"#fce7f3",strokeWidth:h?1.5:1,opacity:h?.5:.3,strokeDasharray:h?"0":"4,4",style:{filter:h&&!M?"drop-shadow(0 1px 3px rgba(244, 114, 182, 0.15))":"none",opacity:h?1:.7}}),q&&e.jsx("text",{x:a.left-$(1),y:Ce+$(.35),textAnchor:"end",fontSize:$(h?1.1:1),fontWeight:h?"700":"600",fill:h?"#be185d":"#db2777",opacity:h?.9:.7,style:{filter:M?"none":"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:ue}),e.jsx("text",{x:o-a.right+$(1),y:Ce+$(.35),textAnchor:"start",fontSize:$(h?1.1:1),fontWeight:h?"700":"600",fill:h?"#be185d":"#db2777",opacity:h?.9:.7,style:{filter:M?"none":"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:ue})]},`temp-tick-${ye}`)}),y>0&&Array.from({length:de-u+1},(A,ye)=>{const Ce=u+ye,h=G(Ce);return e.jsx("line",{x1:h,y1:a.top,x2:h,y2:Z,stroke:"#fce7f3",strokeWidth:"1",opacity:"0.6",style:{filter:M?"none":"drop-shadow(0 0 1px rgba(244, 114, 182, 0.05))"}},`day-grid-${Ce}`)}),e.jsx("rect",{x:a.left,y:a.top,width:o-a.left-a.right,height:d,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"2",strokeOpacity:"0.4",rx:"12"}),e.jsx("rect",{x:a.left+1,y:a.top+1,width:o-a.left-a.right-2,height:d-2,fill:"none",stroke:"white",strokeWidth:"0.5",rx:"11",opacity:"0.9"}),q&&e.jsx(ce,{...z||M?{}:{variants:L},children:e.jsx("text",{x:a.left+$(1.2),y:a.top+$(1.5),textAnchor:"middle",fontSize:$(1.4),fontWeight:"800",fill:"#be185d",style:{filter:M?"none":"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:"°C"})})]})},Jn=({data:a,allDataPoints:o,getX:p,getY:f,baselineY:T,temperatureField:m="temperature",reduceMotion:U=!1})=>{if(!a||a.length<2)return null;let G="",w=null;const b=[];if(o.forEach((q,z)=>{const S=a.find(Z=>Z.id===q.id);if(S&&S[m]!==null&&S[m]!==void 0&&!S.ignored){const Z=p(z),d=f(S[m]);b.push({x:Z,y:d}),w!==null&&z===w+1?G+=` L ${Z} ${d}`:G+=`${G?" ":""}M ${Z} ${d}`,w=z}}),b.length<2)return null;const $=G.includes("L"),ee=b.length>1?b.map(({x:q,y:z},S)=>`${S===0?"M":"L"} ${q} ${z}`).join(" "):"";return e.jsxs(e.Fragment,{children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"#f472b6"}),e.jsx("stop",{offset:"30%",stopColor:"#ec4899"}),e.jsx("stop",{offset:"70%",stopColor:"#db2777"}),e.jsx("stop",{offset:"100%",stopColor:"#be185d"})]}),e.jsx("filter",{id:"lineShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"3",floodColor:"rgba(244, 114, 182, 0.4)"})})]}),$&&(U?e.jsx("path",{d:G,fill:"none",stroke:"url(#tempLineGradientChartGlow)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:.4,style:{filter:"url(#lineGlow)"}}):e.jsx(Ge.path,{d:G,fill:"none",stroke:"url(#tempLineGradientChartGlow)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:.4,style:{filter:"url(#lineGlow)"},initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.4},transition:{duration:.8,ease:"easeInOut",delay:.2}})),ee&&(U?e.jsx("path",{d:ee,fill:"none",stroke:"#d587b1",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.65}):e.jsx(Ge.path,{d:ee,fill:"none",stroke:"#d587b1",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.65,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.65},transition:{duration:.8,ease:"easeInOut"}})),$&&(U?e.jsx("path",{d:G,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#lineShadow)"}}):e.jsx(Ge.path,{d:G,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#lineShadow)"},initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:1},transition:{duration:1,ease:"easeInOut",delay:.4}}))]})},en="var(--color-sensacion-fuerte)",tn="var(--color-apariencia-fuerte)",nn="var(--color-observaciones-fuerte)",Ut="#be123c",Qn="rgba(148, 163, 184, 0.35)",es="rgba(226, 232, 240, 0.6)",ts="rgba(148, 163, 184, 0.5)",sn="✖",Yt="#7f1d1d",Vt="#ec4899",ns="drop-shadow(0 2px 4px rgba(244, 114, 182, 0.35))",ss="#be185d",as="#2563eb",rs="#be185d",os="rgba(244, 114, 182, 0.35)",is=a=>{if(!a)return"";const[o,p]=a.split("/");return`${parseInt(o,10)}/${parseInt(p,10)}`},Xt='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',ls=()=>{if(typeof document>"u")return(p,f)=>{const T=/(\d+(?:\.\d+)?)px/.exec(f||""),m=T?Number(T[1]):12;return p.length*m*.6};const o=document.createElement("canvas").getContext("2d");return o?(p,f)=>(o.font=f,o.measureText(p).width):(p,f)=>{const T=/(\d+(?:\.\d+)?)px/.exec(f||""),m=T?Number(T[1]):12;return p.length*m*.6}},cs=(a,o,p)=>`${o} ${a}px ${p}`,an=(a="",{maxWidth:o,maxLines:p=2,fontSize:f,fontWeight:T=700,fontFamily:m=Xt,fallback:U="–",measureTextWidth:G})=>{if(!a)return[U,...Array.from({length:Math.max(0,p-1)},()=>"")];const w=cs(f,T,m),b=d=>G(d,w),$=String(a).trim(),ee=/\s/.test($),q=ee?$.split(/\s+/):Array.from($),z=ee?" ":"",S=[],Z=d=>{const B=Array.from(d);let L="";for(;B.length;){const te=L+B[0];if(b(te)<=o||!L){if(L=te,B.shift(),b(L)>o&&L.length>1){B.unshift(...Array.from(L.slice(1))),L=L[0];break}}else break}return[L,B.join("")]};for(;q.length&&S.length<p;){let d="";for(;q.length;){const B=q[0],L=d?`${d}${z}${B}`:B;if(b(L)<=o){d=L,q.shift();continue}if(!d)if(ee){const[te,y]=Z(B);d=te,y?q[0]=y:q.shift()}else{const[te,y]=Z(B);d=te,y?q[0]=y:q.shift()}break}S.push(d),!d&&q.length&&S.push(q.shift())}if(q.length&&S.length){const d=S.length-1;let B=S[d]||"";for(;B&&b(`${B}…`)>o;)B=B.slice(0,-1);S[d]=B?`${B}…`:"…"}for(;S.length<p;)S.push("");return S};function qt(a="",o,p="–"){return a?a.split(/\s+/).slice(0,o).join(" "):p}const ds=({data:a,getX:o,getY:p,isFullScreen:f,orientation:T,responsiveFontSize:m,onPointInteraction:U,clearActivePoint:G,activePoint:w,visibleRange:b=null,padding:$,chartHeight:ee,chartWidth:q,temperatureField:z="temperature_chart",textRowHeight:S,compact:Z=!1,reduceMotion:d=!1,isScrolling:B=!1,showInterpretation:L=!1,ovulationDetails:te=null,firstHighIndex:y=null,baselineIndices:we=[],graphBottomLift:M=0,graphBottomY:ce,rowsZoneHeight:ne,showRelationsRow:le=!1})=>{const u={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},de={hidden:{opacity:0,scale:.3},visible:{opacity:1,scale:1,transition:{duration:.6,ease:[.34,1.56,.64,1],type:"spring",stiffness:120,damping:12}}},A=ce,ye=f?9:7.5,Ce=f?1:.75,h=le?ye+(f?2:1.5):null,ue=ye+Ce,Be=Math.max(1,Math.floor(ne/ue)),Y=Math.max(S,Be),St=A+Y*1,At=A+Y*2,Ne=A+Y*3,Ve=A+Y*(f?5:4.5),qe=A+Y*(f?7:6),vt=A+Y*(f?9:7.5),dt=le?vt+Y*(f?2:1.5):null,me=Array.isArray(a)?a.length:0,v=me>60||B,et=d||v?"g":Ge.g,Xe=q-$.left-$.right,tt=Y*(f?2:1.5),xe=Math.min(Math.max(tt*.46,14),12),Ke=Number.isInteger(b?.startIndex)?b.startIndex:0,Ae=Number.isInteger(b?.endIndex)?b.endIndex:Math.max(me-1,0),Ee=me?Math.max(0,Math.min(me-1,Ke)):0,oe=me?Math.max(Ee,Math.min(me-1,Ae)):-1,kt=i.useMemo(()=>ct(new Date),[]),Re=i.useMemo(()=>ls(),[]),ze=i.useRef(new Map),Le=me>0?Xe/me:Xe,be=2,fe=Math.min(12,Math.max(4,Le*.12)),ie=Math.max(0,Le-fe*2),Ie=m(.95),Oe=m(.9),Pe=m(.9),Se=m(.9),nt=m(.8),ut=m(.8),ft=m(.8),ht=i.useMemo(()=>{if(!L)return new Map;const j=Array.isArray(te?.highSequenceIndices)?te.highSequenceIndices:[],c=new Map;return j.forEach((x,he)=>{const X=Number(x);Number.isInteger(X)&&X>=0&&X<me&&!c.has(X)&&c.set(X,he+1)}),c},[L,te,me]),st=i.useMemo(()=>{if(!L)return new Map;const j=Array.isArray(we)?we:[];if(!j.length)return new Map;const c=new Set,x=[],he=ae=>{const pe=Number(ae);Number.isInteger(pe)&&pe>=0&&pe<me&&!c.has(pe)&&(c.add(pe),x.push(pe))};if(j.forEach(ae=>{he(ae)}),y!=null){const ae=Number(y);Number.isInteger(ae)&&he(ae-1)}if(!x.length)return new Map;const X=[...x].sort((ae,pe)=>ae-pe),se=new Map;let ke=1;for(let ae=X.length-1;ae>=0&&!(ke>6);ae-=1)se.set(X[ae],ke),ke+=1;return se},[L,we,me,y]),Mt=v?"none":"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))",Fe=v?"none":"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))",He=v?"none":"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))",wt=v?"none":ns,ve=v?"none":"drop-shadow(0 2px 4px rgba(244, 114, 182, 0.25))",Et=v?"none":"drop-shadow(0 1px 3px rgba(37, 99, 235, 0.45))",Ze=v?"none":"drop-shadow(0 2px 4px rgba(37, 99, 235, 0.3))",at=i.useCallback((j,c,x,he)=>{const X=an(j,{maxWidth:ie,maxLines:3,fontSize:x,fontWeight:700,fontFamily:Xt,fallback:c,measureTextWidth:Re});return X[2]?{lines:an(j,{maxWidth:ie,maxLines:3,fontSize:he,fontWeight:700,fontFamily:Xt,fallback:c,measureTextWidth:Re}),fontSize:he}:{lines:X,fontSize:x}},[ie,Re]);i.useEffect(()=>{ze.current.clear()},[me,ie,Oe,Pe,Se]);const Ue=i.useCallback((j,c,x,he,X)=>{const se=ze.current.get(j);if(se)return se;const ke=at(c,x,he,X);return ze.current.set(j,ke),ke},[at]),Ct=i.useMemo(()=>!me||oe<Ee?[]:Array.from({length:oe-Ee+1},(j,c)=>Ee+c),[oe,Ee,me]);return e.jsxs(e.Fragment,{children:[e.jsxs("defs",{children:[e.jsx("filter",{id:"rowShadowChart",x:"-10%",y:"-10%",width:"120%",height:"120%",children:e.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"4",floodColor:"rgba(244, 114, 182, 0.2)"})}),e.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[e.jsx("rect",{width:"6",height:"6",fill:"#fb7185"}),e.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(255,255,255,0.85)"})]}),e.jsxs("filter",{id:"pointGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("radialGradient",{id:"tempPointGradientChart",cx:"30%",cy:"30%",children:[e.jsx("stop",{offset:"0%",stopColor:"#FDF2F8"}),e.jsx("stop",{offset:"50%",stopColor:"#F9A8D4"}),e.jsx("stop",{offset:"85%",stopColor:"#EC4899"}),e.jsx("stop",{offset:"100%",stopColor:"#DB2777"})]}),e.jsxs("radialGradient",{id:"tempPointIgnoredGradient",cx:"30%",cy:"30%",children:[e.jsx("stop",{offset:"0%",stopColor:"#FFFFFF"}),e.jsx("stop",{offset:"80%",stopColor:"#F8FAFC"}),e.jsx("stop",{offset:"100%",stopColor:"#E2E8F0"})]}),e.jsxs("radialGradient",{id:"ovulationPointGradient",cx:"30%",cy:"30%",children:[e.jsx("stop",{offset:"0%",stopColor:"#dbeafe"}),e.jsx("stop",{offset:"50%",stopColor:"#93c5fd"}),e.jsx("stop",{offset:"85%",stopColor:"#3b82f6"}),e.jsx("stop",{offset:"100%",stopColor:"#2563eb"})]})]}),f&&T!=="portrait"&&e.jsx(et,{...d||v?{}:{variants:u},children:[{label:"Fecha",row:1,color:f?"#374151":"#6B7280"},{label:"Día",row:2,color:f?"#374151":"#6B7280"},{label:"Símbolo",row:3,color:f?"#374151":"#6B7280"},{label:"Sens.",row:f?5:4.5,color:en},{label:"Apar.",row:f?7:6,color:tn},{label:"Observ.",row:f?9:7.5,color:nn},...le&&h!=null?[{label:"RS",row:h,color:Ut}]:[]].map(({label:j,row:c,color:x})=>e.jsx("text",{x:$.left-m(.5),y:A+Y*c,textAnchor:"end",fontSize:m(1.05),fontWeight:"700",fill:x,style:{filter:Mt,fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:j},j))}),Ct.map(j=>{const c=a[j];if(!c)return null;const x=o(j),he=c[z]!=null?p(c[z]):A,X=c.temperature_raw,se=c.temperature_corrected,ke=c.use_corrected&&X!=null&&se!=null&&Math.abs(se-X)>.01,ae=ke?p(X):null,pe="#60666f",_e=c[z]!=null,F=c.use_corrected&&se!=null&&c[z]===se,De=c.ignored||c.use_corrected&&!F,rt=!!(c.had_relations??c.hadRelations);_e||c.mucus_sensation||c.mucus_appearance||c.fertility_symbol;const ot=String(c.id||"").startsWith("placeholder-"),pt=te?.peakDayIndex,Te=L&&pt!=null&&!De&&_e&&j===pt,mt=Mn(c.fertility_symbol),Je=Nn(mt.value),Nt=mt.pattern==="spotting-pattern"?"url(#spotting-pattern-chart)":Je.main,xt=Je.border==="none"?"none":Je.border||os,Rt=Je.border==="none"?0:mt.value==="white"?1.6:1,Qe=c.isoDate?Rn(ct(lt(c.isoDate)),ct(new Date)):!1,J=m(f?1.8:2),gt=Ne-J*.75+J/2+2,$e=c.peakStatus?String(c.peakStatus).toUpperCase():null,ge=$e==="P"||$e==="X",it=$e&&!ge,Ot=ge?sn:$e||"–",n=ge||["1","2","3"].includes($e),t=!ot&&mt.value!=="none",r=!!c.isoDate&&!Qe?{pointerEvents:"all",style:{cursor:"pointer"},onClick:jt=>U(c,j,jt)}:{},g=(c.isoDate?Pn(lt(c.isoDate),kt):!1)?rs:pe,H=ht.has(j),E=H?ht.get(j):null,N=st.has(j),_=N?st.get(j):null,D=m(f?.75:1.2),C=Math.max(.5,D*.18),k=he-D*(f?2.6:1.8),Q=he+D*(f?1.9:1.6),I=f?qt(c.mucus_sensation,be,Qe?"":"–"):c.mucus_sensation,O=f?qt(c.mucus_appearance,be,Qe?"":"–"):c.mucus_appearance,P=f?qt(c.observations,be,""):c.observations,R=`${c.isoDate||c.id||j}`,re=Ue(`${R}-sens-${ie}-${Oe}-${nt}-${I??""}`,I,Qe?"":"–",Oe,nt),K=Ue(`${R}-apar-${ie}-${Pe}-${ut}-${O??""}`,O,Qe?"":"–",Pe,ut),W=Ue(`${R}-obs-${ie}-${Se}-${ft}-${P??""}`,P,"",Se,ft),[Me,je,yt]=re.lines,[We,Ye,Lt]=K.lines,[Jt,Bt,Ft]=W.lines,dn=re.fontSize,un=K.fontSize,fn=W.fontSize,_t=(jt,Gt,bn)=>Math.max(1,[jt,Gt,bn].filter(Qt=>Qt&&String(Qt).trim()!=="").length),hn=_t(Me,je,yt),pn=_t(We,Ye,Lt),mn=_t(Jt,Bt,Ft),Wt=(jt,Gt)=>jt-(Gt-1)*Ie/2,xn=Wt(Ve,hn),gn=Wt(qe,pn),yn=Wt(vt,mn);return e.jsxs(et,{...d||v?{}:{variants:u},...r,children:[_e&&e.jsxs(et,{...d||v?{}:{variants:de},children:[ke&&ae!==null&&e.jsxs("g",{pointerEvents:"none",children:[e.jsx("line",{x1:x,y1:ae,x2:x,y2:he,stroke:Qn,strokeWidth:1,strokeDasharray:"4 4"}),e.jsx("circle",{cx:x,cy:ae,r:3,fill:es,stroke:ts,strokeWidth:1}),e.jsx("circle",{cx:x,cy:ae,r:1,fill:"rgba(255, 255, 255, 0.6)"})]}),e.jsx("circle",{cx:x,cy:he,r:Te?3.5:2.8,fill:De?"url(#tempPointIgnoredGradient)":Te?"url(#ovulationPointGradient)":"url(#tempPointGradientChart)",stroke:c.use_corrected&&F?"#941616":De?"#94A3B8":Te?"#1d4ed8":"#E91E63",sstrokeWidth:De?1.5:Te?2.2:2,style:{filter:Te?Ze:ve,cursor:"pointer"},pointerEvents:"all",onClick:jt=>U(c,j,jt)}),!De&&e.jsx("circle",{cx:x,cy:he,r:Te?1.2:.9,fill:Te?"rgba(239, 246, 255, 0.95)":"rgba(255, 255, 255, 0.9)",style:{filter:Te?Et:Fe}}),L&&_e&&!De&&H&&e.jsx("g",{pointerEvents:"none",children:e.jsx("text",{x,y:k,textAnchor:"middle",fontSize:D,fontWeight:"900",fill:ss,strokeWidth:C,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',paintOrder:"stroke",filter:Fe},children:E})}),L&&_e&&!De&&N&&e.jsx("g",{pointerEvents:"none",children:e.jsx("text",{x,y:Q,textAnchor:"middle",fontSize:D,fontWeight:"800",fill:as,stroke:"#ffffff",strokeWidth:C,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',paintOrder:"stroke",filter:Fe},children:_})})]}),e.jsx("text",{x,y:St,textAnchor:"middle",fontSize:m(1.05),fontWeight:"900",fill:g,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:Fe},children:is(c.date)}),e.jsx("text",{x,y:At,textAnchor:"middle",fontSize:m(1),fontWeight:"900",fill:g,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:Fe},children:c.cycleDay}),t?e.jsxs("g",{children:[e.jsx("rect",{x:x-J/2+1,y:Ne-J*.75+1,width:J,height:J,fill:"rgba(0, 0, 0, 0.1)",rx:J*.3,opacity:.5}),e.jsx("rect",{x:x-J/2-4,y:Ne-J*.75,width:J*1.4,height:J,fill:Nt,stroke:xt,strokeWidth:Rt,rx:J*.2,style:{filter:ve}}),$e&&e.jsx("g",{pointerEvents:"none",children:ge?e.jsx("text",{x,y:gt,textAnchor:"middle",fontSize:m(1.35),fontWeight:"900",fill:Vt,stroke:"#fff",strokeWidth:1.5,paintOrder:"stroke",style:{filter:wt},children:sn}):e.jsx("text",{x,y:gt,textAnchor:"middle",fontSize:m($e?1.1:1),fontWeight:"800",fill:Yt,style:{filter:He},children:$e})})]}):e.jsxs("g",{children:[n&&e.jsx("rect",{x:x-J/2-4,y:Ne-J*.75,width:J*1.4,height:J,fill:"transparent",stroke:ge?Vt:Yt,strokeWidth:1,rx:J*.2}),e.jsx("text",{x,y:gt,textAnchor:"middle",fontSize:m(ge?1.35:it?1.1:1),fill:ge?Vt:it?Yt:pe,fontWeight:ge?"900":it?"800":"500",style:{filter:ge?wt:it?He:Fe},children:Ot})]}),!Z&&e.jsxs("text",{x,y:xn,textAnchor:"middle",fontSize:dn,fontWeight:"700",fill:en,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:He},children:[e.jsx("tspan",{x,dy:0,children:Me}),je&&e.jsx("tspan",{x,dy:Ie,children:je}),yt&&e.jsx("tspan",{x,dy:Ie,children:yt})]}),!Z&&e.jsxs("text",{x,y:gn,textAnchor:"middle",fontSize:un,fontWeight:"700",fill:tn,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:He},children:[e.jsx("tspan",{x,dy:0,children:We}),Ye&&e.jsx("tspan",{x,dy:Ie,children:Ye}),Lt&&e.jsx("tspan",{x,dy:Ie,children:Lt})]}),!Z&&e.jsxs("text",{x,y:yn,textAnchor:"middle",fontSize:fn,fontWeight:"700",fill:nn,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:He},children:[e.jsx("tspan",{x,dy:0,children:Jt}),Bt&&e.jsx("tspan",{x,dy:Ie,children:Bt}),Ft&&e.jsx("tspan",{x,dy:Ie,children:Ft})]}),le&&dt!=null&&rt&&e.jsx("g",{transform:`translate(${x-xe/2}, ${dt-xe/2})`,role:"img","aria-label":`Relación registrada el ${c.isoDate||`día ${j+1}`}`,children:e.jsx(cn,{width:xe,height:xe,color:Ut,fill:Ut})})]},`pt-${j}-${c.isoDate||c.timestamp}`)})]})},us=(a,o)=>{if(a.data!==o.data||a.getX!==o.getX||a.getY!==o.getY||a.isFullScreen!==o.isFullScreen||a.orientation!==o.orientation||a.responsiveFontSize!==o.responsiveFontSize||a.onPointInteraction!==o.onPointInteraction||a.clearActivePoint!==o.clearActivePoint||a.chartHeight!==o.chartHeight||a.chartWidth!==o.chartWidth||a.temperatureField!==o.temperatureField||a.textRowHeight!==o.textRowHeight||a.compact!==o.compact||a.reduceMotion!==o.reduceMotion||a.isScrolling!==o.isScrolling||a.showInterpretation!==o.showInterpretation||a.ovulationDetails!==o.ovulationDetails||a.firstHighIndex!==o.firstHighIndex||a.baselineIndices!==o.baselineIndices||a.graphBottomLift!==o.graphBottomLift||a.graphBottomY!==o.graphBottomY||a.rowsZoneHeight!==o.rowsZoneHeight||a.showRelationsRow!==o.showRelationsRow)return!1;const p=a.visibleRange,f=o.visibleRange;if(p?.startIndex!==f?.startIndex||p?.endIndex!==f?.endIndex)return!1;const T=a.padding,m=o.padding;return!(T!==m&&(!T||!m||T.left!==m.left||T.right!==m.right||T.top!==m.top||T.bottom!==m.bottom))},fs=wn.memo(ds,us),hs="var(--color-sensacion-fuerte)",ps="var(--color-apariencia-fuerte)",ms="var(--color-observaciones-fuerte)",xs=({padding:a,chartHeight:o,tempMin:p,tempMax:f,tempRange:T,getY:m,responsiveFontSize:U,textRowHeight:G,isFullScreen:w,graphBottomY:b,rowsZoneHeight:$,showRelationsRow:ee=!1})=>{const q={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},z=[];if(T>0){const M=T<=2.5?.1:.5;for(let ce=p;ce<=f+1e-9;ce+=M)z.push(parseFloat(ce.toFixed(1)))}else for(let M=35.8;M<=37.2+1e-9;M+=.1)z.push(parseFloat(M.toFixed(1)));const S=b,Z=w?9:7.5,d=w?1:.75,B=ee?Z+(w?2:1.5):null,L=Z+d,te=Math.max(1,Math.floor($/L)),y=Math.max(G,te),we=i.useMemo(()=>{const M=[{label:"Fecha",row:1,color:"#374151",icon:null},{label:"Día",row:2,color:"#374151",icon:null},{label:"Símbolo",row:3,color:"#374151",icon:null},{label:"Sens.",row:w?5:4.5,color:hs,icon:{type:"text",value:"◊"}},{label:"Apar.",row:w?7:6,color:ps,icon:{type:"text",value:"○"}},{label:"Obs.",row:w?9:7.5,color:ms,icon:{type:"text",value:"✦"}}];return ee&&B!=null&&M.push({label:"RS",row:B,color:"#f44336",icon:{type:"heart"}}),M},[w,B,ee]);return e.jsxs("svg",{width:a.left,height:o,className:"font-sans pointer-events-none",children:[e.jsx("defs",{children:e.jsx("filter",{id:"textShadowLegend",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodColor:"rgba(255, 255, 255, 0.9)"})})}),z.map((M,ce)=>{const ne=m(M),le=M.toFixed(1).endsWith(".0")||M.toFixed(1).endsWith(".5"),u=le?M.toFixed(1):`.${M.toFixed(1).split(".")[1]}`;return e.jsx(Ge.g,{variants:q,children:e.jsx("text",{x:a.left-U(1.2),y:ne+U(.35),textAnchor:"end",fontSize:U(le?1.15:1),fontWeight:le?"800":"700",fill:le?"#be185d":"#db2777",opacity:le?1:.85,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:u})},`temp-tick-fixed-${ce}`)}),e.jsx(Ge.g,{variants:q,children:we.map(({label:M,row:ce,color:ne,icon:le})=>{const u=a.left-U(2.8),de=S+y*ce,A=U(.95);return e.jsxs("g",{children:[le?.type==="text"&&e.jsx("text",{x:u,y:de,textAnchor:"middle",fontSize:U(.8),fontWeight:"600",fill:ne,opacity:.7,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:le.value}),le?.type==="heart"&&e.jsx("g",{transform:`translate(${u-A/2}, ${de-A/2})`,opacity:.7,children:e.jsx(cn,{width:A,height:A,color:ne,fill:ne,"aria-hidden":"true"})}),e.jsx("text",{x:a.left-U(.8),y:S+y*ce,textAnchor:"end",fontSize:U(1.05),fontWeight:"800",fill:ne,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:M})]},M)})})]})},gs=({data:a,isFullScreen:o,orientation:p,onToggleIgnore:f,onEdit:T,onTogglePeak:m,cycleId:U,initialScrollIndex:G=0,visibleDays:w=5,showInterpretation:b=!1,reduceMotion:$=!1,forceLandscape:ee=!1,currentPeakIsoDate:q=null,showRelationsRow:z=!1,fertilityStartConfig:S=null,fertilityCalculatorCycles:Z=[],fertilityCalculatorCandidates:d=null,onShowPhaseInfo:B=null,isArchivedCycle:L=!1,cycleEndDate:te=null})=>{const{chartRef:y,tooltipRef:we,dimensions:M,activePoint:ce,activeIndex:ne,tooltipPosition:le,allDataPoints:u,validDataForLine:de,tempMin:A,tempMax:ye,tempRange:Ce,padding:h,textRowHeight:ue,getY:Be,getX:Y,handlePointInteraction:St,handleToggleIgnore:At,responsiveFontSize:Ne,clearActivePoint:Ve,baselineTemp:qe,baselineStartIndex:vt,baselineIndices:dt,firstHighIndex:me,ovulationDetails:V,fertilityStart:v,hasAnyObservation:et,graphBottomInset:Xe,todayIndex:tt}=$n(a,o,p,f,U,w,ee,S,Z,d,z),xe=i.useRef(null);if(!xe.current){const t=Math.random().toString(36).slice(2,10);xe.current=`fertility-chart-${U??"default"}-${t}`}const Ke=xe.current,Ae=i.useCallback((t,s)=>{const r=t>=20?1:2,l=Math.ceil(t*r),g=Math.min(l,24);return Math.max(g,12)},[]),Ee=i.useMemo(()=>{const t=u.length;if(!t)return{startIndex:0,endIndex:-1};const s=Ae(w,t),r=Math.max(0,Math.floor(G)-s),l=Math.min(t-1,Math.floor(G)+w+s);return{startIndex:r,endIndex:l}},[u.length,Ae,G,w]),[oe,kt]=i.useState(Ee),Re=i.useRef(null),[ze,Le]=i.useState(!1),be=i.useRef(null);if(!u||u.length===0)return e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-pink-100 to-rose-100 rounded-full mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-pink-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),e.jsx("p",{className:"text-slate-400 font-medium",children:"No hay datos para mostrar en el gráfico"})]});const fe=M.width,ie=M.contentHeight??M.height,Ie=M.scrollableContentHeight??ie,Oe=ie-h.bottom-(Xe||0),Pe=Math.max(ie-Oe,0),Se=qe!=null?Be(qe):null,nt=!!V?.confirmed,ut=qe!=null&&nt,ft=Y(0),ht=u.length>0?Y(u.length-1):fe-h.right,st=nt?"#F59E0B":"#94A3B8",Mt=nt?"6 4":"4 4",Fe=nt?1:.7,He=3,wt=fe===0,ve=ne!=null?Y(ne):null,Et=ne!=null?ne>0?Y(ne-1):ve:null,Ze=ne!=null?ne<u.length-1?Y(ne+1):ve:null,at=Math.max((fe-h.left-h.right)/Math.max(u.length,1),0),Ue=ne!=null?Math.max((Ze!=null&&Et!=null?Ze-Et:0)||at,at,0):0,Ct=i.useMemo(()=>{const t=new Map;return de.forEach(s=>{s&&s.id!=null&&t.set(s.id,s)}),t},[de]),j=i.useMemo(()=>Number.isInteger(v?.fertileStartFinalIndex)?v.fertileStartFinalIndex:null,[v]),c=Math.max(ie-h.top-h.bottom-(Xe||0),0),x=i.useCallback(t=>!Number.isFinite(t)||!u.length||t<=0?h.left:Y(t),[u,Y,h.left]),he=i.useCallback(t=>!Number.isFinite(t)||!u.length||t>=u.length-1?fe-h.right:Y(t+1),[u,fe,Y,h.right]),X=i.useCallback((t,s,{inclusiveEnd:r=!0}={})=>{if(!Number.isFinite(t)||!Number.isFinite(s)||u.length===0)return null;const l=k=>Math.max(0,Math.min(u.length-1,Math.floor(k))),g=k=>Math.max(0,Math.min(u.length-1,Math.floor(k))),H=k=>Math.max(0,Math.min(u.length,Math.floor(k))),E=l(t),N=r?g(s):H(s),_=E<=0?h.left:x(E);let D;r?D=N>=u.length-1?fe-h.right:he(N):N<=0?D=h.left:N>=u.length?D=fe-h.right:D=x(N);const C=Math.max(D-_,0);return C<=0?null:{x:_,width:C}},[u,fe,x,he,h.left,h.right]),se=u.length>0?u.length-1:null,ke=i.useMemo(()=>{if(!L||!te||se==null)return null;const t=typeof te=="string"?te:null;if(!t)return null;const s=u.findIndex(r=>r?.isoDate===t);if(s>=0)return Math.min(s,se);for(let r=u.length-1;r>=0;r-=1){const l=u[r]?.isoDate;if(typeof l=="string"&&l<=t)return Math.min(r,se)}return null},[L,te,u,se]),ae=i.useMemo(()=>se==null?null:L?Number.isInteger(ke)?Math.min(ke,se):se:Number.isInteger(tt)?Math.min(tt,se):se,[ke,L,tt,se]),pe=c>0?h.top+c*.5:null,_e=pe!=null?Math.max(Oe-pe,0):0,F=i.useMemo(()=>{if(!b||!et)return null;const t=v?.debug,s=Number.isInteger(t?.mucusInfertileStartIndex)?t.mucusInfertileStartIndex:null,r=Number.isInteger(v?.fertileWindow?.temperatureInfertileStartIndex)?v.fertileWindow.temperatureInfertileStartIndex:null,l=[s,r].filter(We=>Number.isInteger(We)).sort((We,Ye)=>We-Ye)[0],g=Number.isInteger(l)?l:Number.isInteger(t?.postOvulatoryStartIndex)?t.postOvulatoryStartIndex:null,H=Number.isInteger(s)&&Number.isInteger(r)?Math.max(s,r):null,E=Number.isInteger(H)?H:Number.isInteger(t?.absoluteStartIndex)?t.absoluteStartIndex:null,N={confirmed:!!V?.confirmed,rule:V?.rule??null,baselineTemp:V?.baselineTemp??null,baselineIndices:Array.isArray(V?.baselineIndices)?V.baselineIndices:[],firstHighIndex:Number.isInteger(V?.firstHighIndex)?V.firstHighIndex:null,highSequenceIndices:Array.isArray(V?.highSequenceIndices)?V.highSequenceIndices:[],confirmationIndex:Number.isInteger(V?.confirmationIndex)?V.confirmationIndex:null,startIndex:r},_={peakDayIndex:Number.isInteger(V?.peakDayIndex)?V.peakDayIndex:null,thirdDayIndex:Number.isInteger(V?.thirdDayIndex)?V.thirdDayIndex:null,startIndex:s},D=r!=null,C=s!=null;if(!D&&!C)return null;const k=Number.isInteger(g)?g:null;if(k==null)return null;let Q="pending",I="",O="Infertilidad postovulatoria",P="Fase postovulatoria: se ha cumplido un criterio de cierre; falta el segundo para confirmar la infertilidad absoluta.";const R="Infertilidad absoluta",re="Fase postovulatoria alcanzada (se ha confirmado día pico y subida de temperatura).",K="Confirmación completa: doble criterio (día pico + temperatura).";let W=O,Me=P,je=I,yt="pending";return D&&C?(Q="absolute",O=R,P=K,I=re,Number.isInteger(r)&&(!Number.isInteger(s)||r<=s)?(N.rule,je=`Temperatura confirmada el ${N.confirmationIndex!=null?`D${N.confirmationIndex+1}`:"—"}. A la espera de determinación del día pico.`,Me=je,W="Infertilidad estimada por temperatura"):(je=`Alcanzado ${_.thirdDayIndex!=null?"3° día postpico":"4º día postpico"} tras alcanzar día pico el ${_.peakDayIndex+1} del ciclo`,Me=je,W="Infertilidad estimada por moco")):D?(N.rule,I=`Temperatura confirmada el ${N.confirmationIndex!=null?`D${N.confirmationIndex+1}`:"—"}. A la espera de determinación del día pico.`,P=I,O="Infertilidad estimada por temperatura",je=I,Me=P,W=O):(I=`Alcanzado ${_.thirdDayIndex!=null?"3° día postpico":"4º día postpico"} tras seleccionar día pico el ${_.peakDayIndex+1} del ciclo`,P=I,O="Infertilidad estimada por moco",je=I,Me=P,W=O),{phase:"postOvulatory",status:Q,startIndex:k,absoluteStartIndex:E,estimated:{status:yt,label:W,tooltip:Me,message:je},absolute:{label:R,tooltip:K,message:re},reasons:{type:"post",status:Q,mucus:_,temperature:N},message:I,label:O,tooltip:P}},[b,et,V,v]),De=i.useMemo(()=>{if(!b||c<=0||pe==null||_e<=0||u.length===0)return[];const t=[],s=u.length-1,r=Number.isInteger(ae)&&ae>=0?Math.min(ae,s):s,l=(C,k)=>{if(!F)return;const Q=F.startIndex,I=Number.isInteger(F.absoluteStartIndex)?F.absoluteStartIndex:null,O=F.estimated??F,P=F.absolute??F,R=I??Q,re=F.status==="absolute"?s:Math.min(s,k);if(I!=null&&I>Q){const K=Math.min(I-1,k),W=X(Q,K);W&&C.push({key:"post-pending",phase:"postOvulatory",status:O.status??"pending",bounds:W,startIndex:Q,endIndex:K,displayLabel:O.label,tooltip:O.tooltip,message:O.message,reasons:F.reasons})}if(R<=re){const K=X(R,re);K&&C.push({key:"post-absolute",phase:"postOvulatory",status:I!=null?"absolute":F.status,bounds:K,startIndex:R,endIndex:re,displayLabel:I!=null?P.label:F.label,tooltip:I!=null?P.tooltip:F.tooltip,message:I!=null?P.message:F.message,reasons:F.reasons})}},g=Number.isInteger(j),H=Number.isFinite(F?.startIndex);if(!g&&!H){const C=Math.min(r,s);if(C<0)return t;const k=X(0,C);return k&&t.push({key:"relative-default",phase:"relativeInfertile",status:"default",bounds:k,startIndex:0,endIndex:C,displayLabel:"Relativamente infértil",tooltip:"Relativamente infértil (preovulatoria: sin día fértil por CPM/T-8 ni signos de moco fértil)",message:"Relativamente infértil",reasons:{type:"relative",fertileStartFinalIndex:null,aggregate:v?.aggregate??null,bipScore:v?.debug?.bipScore??null}}),t}if(!g&&H){const C=F.startIndex,k=Math.min(C-1,r);if(k>=0){const Q=X(0,k);Q&&t.push({key:"no-fertile-window",phase:"nodata",status:"no-fertile-window",bounds:Q,startIndex:0,endIndex:k,displayLabel:"Sin ventana fértil identificable",tooltip:"Sin ventana fértil identificable",message:"Sin ventana fértil identificable",reasons:{type:"nofertile",status:"no-fertile-window",message:"No se ha identificado un inicio fértil claro en este ciclo (ni por moco, ni por calculadora, ni por marcador explícito)."}})}return Number.isFinite(F.startIndex)&&F.startIndex<=s&&l(t,r),t}if(g&&j>0){const C=Math.min(j-1,r);if(C>=0){const k=X(0,C);k&&t.push({key:"relative",phase:"relativeInfertile",status:"default",bounds:k,startIndex:0,endIndex:C,displayLabel:"Relativamente infértil",tooltip:"Relativamente infértil (fase relativamente infértil preovulatoria)",message:"Relativamente infértil",reasons:{type:"relative",fertileStartFinalIndex:j,aggregate:v?.aggregate??null,bipScore:v?.debug?.bipScore??null}})}}const E=g?Math.max(j,0):0,N=F?.startIndex,_=Number.isFinite(N)&&N!=null?Math.min(N-1,s):s,D=Math.min(_,r);if(D>=E){const C=X(E,D);if(C){const k=Number.isInteger(v?.debug?.explicitStartDay)?v.debug.explicitStartDay:null,Q=v?.aggregate?.usedCandidates??[],I=Q.some(R=>R?.kind==="profile"),O=Q.some(R=>R?.kind==="calculator");let P=null;g&&k!=null&&k===j?P="marker":I?P="profiles":O&&(P="calculator"),t.push({key:"fertile",phase:"fertile",status:"default",bounds:C,startIndex:E,endIndex:D,displayLabel:"Fértil",tooltip:"Fértil",message:"Fértil",reasons:{type:"fertile",startIndex:E,endIndex:D,source:P,details:v?.debug??null,notes:v?.aggregate?.notes??[],statusSummary:v?.currentAssessment??null,dailyAssessments:v?.dailyAssessments??[],window:v?.fertileWindow??null,aggregate:v?.aggregate??null}})}}return F&&Number.isFinite(F.startIndex)&&F.startIndex<=s&&l(t,r),t},[b,c,pe,_e,u.length,j,v,F,et,X,ae]),rt=`${Ke}-phase-relative-gradient`,ot=`${Ke}-phase-fertile-gradient`,pt=`${Ke}-phase-post-pending-gradient`,Te=`${Ke}-phase-post-absolute-gradient`,mt=t=>t.phase==="relativeInfertile"?"#065F46":t.phase==="fertile"?"#9D174D":t.phase==="postOvulatory"?t.status==="pending"?"#075985":"#1E3A8A":t.phase==="nodata"?"#475569":"hsl(var(--foreground))",Je="0 1px 1px var(--phase-text-shadow, rgba(15, 23, 42, 0.2))",Nt=i.useMemo(()=>{if(!b||!V?.confirmed)return null;const t=Array.isArray(V?.highSequenceIndices)?V.highSequenceIndices:[];if(t.length<2)return null;const s=t.map(r=>{if(r==null||r<0||r>=u.length)return null;const l=u[r],g=Ct.get(l?.id);return!g||!Number.isFinite(g.displayTemperature)?null:{x:Y(r),y:Be(g.displayTemperature)}}).filter(Boolean);return s.length<2?null:s.map(({x:r,y:l},g)=>`${g===0?"M":"L"} ${r} ${l}`).join(" ")},[b,V,u,Ct,Y,Be]),[xt,Rt]=i.useState({w:typeof window<"u"?window.innerWidth:0,h:typeof window<"u"?window.innerHeight:0}),Qe=xt.w<xt.h;i.useEffect(()=>{const t=()=>Rt({w:window.innerWidth,h:window.innerHeight});return window.addEventListener("resize",t),window.addEventListener("orientationchange",t),()=>{window.removeEventListener("resize",t),window.removeEventListener("orientationchange",t)}},[]);const J=i.useCallback((t=0)=>{const s=y.current;if(!s)return;const r=u.length;if(!r){kt({startIndex:0,endIndex:-1});return}const l=s.clientWidth||1,H=l/Math.max(w,1)||1,E=Ae(w,r),N=Math.floor(t/H),_=Math.floor((t+l)/H);let D=N-E,C=_+E;D=Math.max(0,D),C=Math.min(r-1,C),kt(k=>k.startIndex===D&&k.endIndex===C?k:{startIndex:D,endIndex:C})},[u.length,Ae,w]);i.useEffect(()=>{if(!y.current)return;const t=y.current.clientWidth/w;y.current.scrollLeft=Math.max(0,t*G),J(y.current.scrollLeft)},[G,w,M.width,p,J]),i.useEffect(()=>{const t=y.current;if(!t)return;const s=()=>{Le(!0),be.current&&window.clearTimeout(be.current),be.current=window.setTimeout(()=>Le(!1),140),!Re.current&&(Re.current=window.requestAnimationFrame(()=>{Re.current=null,J(t.scrollLeft)}))};return t.addEventListener("scroll",s,{passive:!0}),J(t.scrollLeft),()=>{t.removeEventListener("scroll",s),be.current&&window.clearTimeout(be.current),Re.current&&(window.cancelAnimationFrame(Re.current),Re.current=null)}},[J]);const gt=o&&ee&&Qe,$e=ee?"landscape":p,ge=gt,it="w-full h-full bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100",Ot=o?`${it} h-full ${ge?"overflow-y-auto overflow-x-auto":"overflow-x-auto overflow-y-auto"}`:`${it} overflow-x-auto overflow-y-visible border border-pink-100/50`,n=!o||$e==="portrait";return e.jsx(Ge.div,{className:"relative w-full h-full",initial:!1,children:e.jsxs(Ge.div,{ref:y,className:`relative p-0 ${o?"":"rounded-2xl"} ${Ot}`,style:{touchAction:"auto",boxShadow:o?"inset 0 1px 3px rgba(244, 114, 182, 0.1)":"0 8px 32px rgba(244, 114, 182, 0.12), 0 2px 8px rgba(244, 114, 182, 0.08)",...gt?{position:"absolute",top:"50%",left:"50%",width:`${xt.h}px`,height:`${xt.w}px`,transform:"translate(-50%, -50%) rotate(90deg)",transformOrigin:"center center"}:{}},initial:!1,children:[wt&&e.jsx("div",{className:"flex items-center justify-center w-full h-full text-slate-400",children:"Cargando..."}),e.jsx("div",{className:"inline-block",style:{width:fe,height:ie},children:e.jsx("div",{className:"relative h-full overflow-y-auto",style:{height:ie,maxHeight:Ie},children:e.jsxs("div",{className:"relative",style:{width:fe,height:Ie},children:[n&&e.jsx("div",{className:"absolute left-0 top-0 h-full bg-transparent pointer-events-none z-10",style:{width:h.left},children:e.jsx(xs,{padding:h,chartHeight:Ie,tempMin:A,tempMax:ye,tempRange:Ce,getY:Be,responsiveFontSize:Ne,textRowHeight:ue,isFullScreen:o,graphBottomY:Oe,rowsZoneHeight:Pe,showRelationsRow:z})}),e.jsxs(Ge.svg,{width:fe,height:Ie,className:"font-sans flex-shrink-0",viewBox:`0 0 ${fe} ${Ie}`,preserveAspectRatio:"xMidYMid meet",initial:!1,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),e.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),e.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),e.jsxs("linearGradient",{id:"tempAreaGradientChart",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(244, 114, 182, 0.18)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(244, 114, 182, 0.02)"})]}),e.jsxs("linearGradient",{id:rt,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"var(--phase-rel)",stopOpacity:"0"}),e.jsx("stop",{offset:"100%",stopColor:"var(--phase-rel)",stopOpacity:"var(--phase-rel-stop, 0.28)"})]}),e.jsxs("linearGradient",{id:ot,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"var(--phase-fertile)",stopOpacity:"0"}),e.jsx("stop",{offset:"100%",stopColor:"var(--phase-fertile)",stopOpacity:"var(--phase-fertile-stop, 0.27)"})]}),e.jsxs("linearGradient",{id:pt,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"var(--phase-post)",stopOpacity:"0"}),e.jsx("stop",{offset:"100%",stopColor:"var(--phase-post)",stopOpacity:"var(--phase-post-stop, 0.45)"})]}),e.jsxs("linearGradient",{id:Te,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"var(--phase-post-abs)",stopOpacity:"0"}),e.jsx("stop",{offset:"100%",stopColor:"var(--phase-post-abs)",stopOpacity:"var(--phase-post-abs-stop, 0.7)"})]}),e.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[e.jsx("rect",{width:"6",height:"6",fill:"#ef4444"}),e.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(255,255,255,0.85)"})]}),e.jsxs("filter",{id:"chartShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("filter",{id:"baselineGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),e.jsx("rect",{width:"100%",height:"100%",fill:"transparent"}),e.jsx(Zn,{padding:h,chartWidth:fe,chartHeight:ie,tempMin:A,tempMax:ye,tempRange:Ce,getY:Be,getX:Y,allDataPoints:u,visibleRange:oe,responsiveFontSize:Ne,isFullScreen:o,showLeftLabels:!n,reduceMotion:$,isScrolling:ze,graphBottomY:Oe,chartAreaHeight:Math.max(ie-h.top-h.bottom-(Xe||0),0),rowsZoneHeight:Pe}),b&&De.length>0&&pe!=null&&_e>0&&e.jsx("g",{children:De.map(t=>{const s=pe,r=_e,g=t.phase==="postOvulatory"?t.status==="pending"?`url(#${pt})`:`url(#${Te})`:t.phase==="relativeInfertile"?`url(#${rt})`:t.phase==="fertile"?`url(#${ot})`:t.phase==="nodata"?"rgba(203, 213, 225, 0.2)":`url(#${ot})`,H=o?14:13,E=Math.max(Ne(1.1),H),N=t.bounds.width<120,_=Math.max(t.bounds.width-16,0),D=Math.max(E*.58,1),C=Math.max(1,Math.floor(_/D)),k=t.tooltip??t.displayLabel??t.message??"";let Q=t.displayLabel??t.message??"";if(N&&Q.length>C){const W=Math.max(C-1,1);Q=`${Q.slice(0,W).trimEnd()}${Q.length>W?"…":""}`}const I=N?t.bounds.x+8:t.bounds.x+t.bounds.width/2,O=N?"start":"middle",P=s+r/2,R=mt(t),re=W=>{typeof W?.stopPropagation=="function"&&W.stopPropagation(),typeof B=="function"&&B({phase:t.phase,status:t.status,reasons:t.reasons,message:t.message,startIndex:t.startIndex,endIndex:t.endIndex,label:t.displayLabel??t.message??null})},K=W=>{(W.key==="Enter"||W.key===" ")&&(W.preventDefault(),re(W))};return e.jsxs("g",{children:[e.jsx("rect",{x:t.bounds.x,y:s,width:t.bounds.width,height:r,fill:g,pointerEvents:"none"}),e.jsxs("text",{x:I,y:P,fill:R,fontSize:E,fontWeight:600,dominantBaseline:"middle",textAnchor:O,role:"button","aria-label":k,tabIndex:0,onClick:re,onKeyDown:K,style:{cursor:"pointer",userSelect:"none",lineHeight:1.2,textShadow:Je},pointerEvents:"auto",children:[e.jsx("title",{children:k}),Q]})]},t.key)})}),b&&ut&&Se!==null&&($?e.jsx("line",{x1:ft,y1:Se,x2:ht,y2:Se,stroke:st,strokeWidth:He,strokeDasharray:Mt,opacity:Fe}):e.jsx(Ge.path,{d:`M ${ft} ${Se} L ${ht} ${Se}`,stroke:st,strokeWidth:He,strokeDasharray:Mt,opacity:Fe,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:Fe},transition:{duration:4,ease:"easeInOut",delay:.5}})),e.jsx(Jn,{data:de,allDataPoints:u,getX:Y,getY:Be,baselineY:Oe,temperatureField:"displayTemperature",reduceMotion:$}),Nt&&e.jsx("g",{pointerEvents:"none",children:e.jsx("path",{d:Nt,fill:"none",stroke:"#cc0e93",strokeWidth:4,strokeLinecap:"round",strokeLinejoin:"round",opacity:.9})}),ne!==null&&ve!==null&&Ue>0&&e.jsx("g",{pointerEvents:"none",children:(()=>{const t=Oe,s=Math.max(3,Math.min(14,Ue*.4)),r=Math.max(s*2,ue*.85);return e.jsxs(e.Fragment,{children:[e.jsx("line",{x1:ve,y1:0,x2:ve,y2:t,stroke:"rgba(235, 171, 204,0.15)",strokeWidth:s}),e.jsx("line",{x1:ve,y1:t,x2:ve,y2:ie,stroke:"rgba(235, 171, 204,0.15)",strokeWidth:r})]})})()}),e.jsx(fs,{data:u,getX:Y,getY:Be,isFullScreen:o,orientation:$e,responsiveFontSize:Ne,onPointInteraction:St,clearActivePoint:Ve,activePoint:ce,visibleRange:oe,padding:h,chartHeight:ie,chartWidth:fe,temperatureField:"displayTemperature",textRowHeight:ue,graphBottomY:Oe,rowsZoneHeight:Pe,compact:!1,reduceMotion:$,isScrolling:ze,showInterpretation:b,ovulationDetails:V,baselineStartIndex:vt,firstHighIndex:me,baselineIndices:dt,graphBottomLift:Xe,showRelationsRow:z})]})]})})}),ce&&e.jsx(Ge.div,{ref:we,initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:10},transition:{duration:.12,ease:"easeOut"},children:e.jsx(Bn,{point:ce,position:le,chartWidth:fe,chartHeight:ie,onToggleIgnore:At,onEdit:T,onClose:Ve,onTogglePeak:m,currentPeakIsoDate:q})})]})})};function ys(a,o){if(!a||!o)return[];const p=typeof a=="string"?lt(a):a;return[...Array(o)].map((f,T)=>{const m=Cn(p,T),U=Dt(m,"yyyy-MM-dd"),G=Dt(m,"dd/MM"),w=$t(ct(m),ct(p))+1;return{date:G,isoDate:U,cycleDay:w,temperature:null,mucusSensation:null,mucusAppearance:null,had_relations:!1,hadRelations:!1,id:`placeholder-${U}`,ignored:!1,peak_marker:null}})}const bs=({isOpen:a,onClose:o,children:p,ariaLabel:f,containerClassName:T="",backdropClassName:m="bg-black/40"})=>{if(i.useEffect(()=>{if(!a)return;const w=ee=>{ee.key==="Escape"&&typeof o=="function"&&o()};document.addEventListener("keydown",w);const{body:b}=document,$=b.style.overflow;return b.style.overflow="hidden",()=>{document.removeEventListener("keydown",w),b.style.overflow=$}},[a,o]),!a||typeof document>"u")return null;const U=()=>{typeof o=="function"&&o()},G=w=>{w.stopPropagation()};return jn.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center px-4 py-8",children:[e.jsx("div",{className:`absolute inset-0 ${m}`,onClick:U,"aria-hidden":"true"}),e.jsx("div",{role:"dialog","aria-modal":"true","aria-label":f??void 0,className:`relative z-[101] w-full max-w-md overflow-hidden rounded-3xl bg-white shadow-2xl shadow-rose-200/50 focus:outline-none focus-visible:ring-2 focus-visible:ring-pink-200 ${T}`,onClick:G,children:p})]}),document.body)},rn="fertility-chart-settings",Pt=a=>a?String(a).toUpperCase().replace(/-/g,""):"",ws=a=>{const o=Pt(a);return o==="T8"?"T-8":o==="CPM"?"CPM":a??""},Zt=()=>({calculators:{cpm:!0,t8:!0},postpartum:!1,combineMode:"estandar"}),on={showRelationsRow:!0,fertilityStartConfig:Zt()},Cs=[{key:"cpm",label:"CPM"},{key:"t8",label:"T-8"}],Kt={estandar:"Estándar",conservador:"Conservador"},bt=a=>{const o=Zt(),p={calculators:{...o.calculators},postpartum:o.postpartum,combineMode:o.combineMode};return a&&typeof a=="object"&&(Object.keys(p.calculators).forEach(f=>{typeof a?.calculators?.[f]=="boolean"&&(p.calculators[f]=a.calculators[f])}),Object.prototype.hasOwnProperty.call(Kt,a.combineMode)&&(p.combineMode=a.combineMode),typeof a.postpartum=="boolean"?p.postpartum=a.postpartum:a.postpartum!=null&&(p.postpartum=!!a.postpartum)),p},As=()=>{const{cycleId:a}=In(),o=Sn(),{currentCycle:p,archivedCycles:f,isLoading:T,addOrUpdateDataPoint:m,toggleIgnoreRecord:U,getCycleById:G}=Gn(),[w,b]=i.useState(null),[$,ee]=i.useState(!1),[q,z]=i.useState(!1),S=!a||a===p.id,Z=S?null:f.find(n=>n.id===a);i.useEffect(()=>{if(S){b(null),ee(!1),z(!1);return}if(Z){b(null),ee(!1),z(!1);return}let n=!0;return ee(!0),G(a).then(t=>{n&&(t?(b(t),z(!1)):(b(null),z(!0)))}).catch(()=>{n&&(b(null),z(!0))}).finally(()=>{n&&ee(!1)}),()=>{n=!1}},[S,Z,G,a]);const d=S?p:Z||w,B=!S&&!Z,L=!S&&d?.id,te=S?T&&!p?.id:$||T&&!Z&&!w,{preferences:y,savePreferences:we}=vn(),M=y?.manualCpm,ce=y?.manualCpmBase,ne=y?.manualT8,le=y?.manualT8Base,u=["auto","manual","none"].includes(y?.cpmMode)?y.cpmMode:"auto",de=["auto","manual","none"].includes(y?.t8Mode)?y.t8Mode:"auto",A=i.useMemo(()=>{if(!L||!d?.startDate)return"";const n=r=>{if(!r)return null;try{return Dt(lt(r),"dd/MM/yyyy")}catch(l){return console.error("Error formatting cycle date",l),r}},t=n(d.startDate),s=n(d.endDate)??"Sin fecha de fin";return t?`Ciclo ${t} - ${s}`:""},[L,d?.startDate,d?.endDate]),ye=i.useMemo(()=>{const n=[];return Array.isArray(f)&&f.length>0&&n.push(...f),p?.id&&n.push(p),d?.id&&!n.some(t=>t?.id===d.id)&&n.push(d),n},[f,p,d]),[Ce,h]=i.useState(typeof window<"u"&&window.innerWidth>window.innerHeight?"landscape":"portrait"),[ue,Be]=i.useState(!1),[Y,St]=i.useState(!1),[At,Ne]=i.useState(!1),[Ve,qe]=i.useState(null),[vt,dt]=i.useState(null),[me,V]=i.useState(!1),[v,et]=i.useState(!1),[Xe,tt]=i.useState(!1),[xe,Ke]=i.useState(null),[Ae,Ee]=i.useState(()=>{const n={showRelationsRow:on.showRelationsRow,fertilityStartConfig:bt(on.fertilityStartConfig)};if(typeof window>"u")return n;try{const t=window.localStorage.getItem(rn);if(t){const s=JSON.parse(t),r={...n,...s};return typeof s?.showRelationsRow=="boolean"?r.showRelationsRow=s.showRelationsRow:s?.showRelationsRow!=null&&(r.showRelationsRow=!!s.showRelationsRow),r.fertilityStartConfig=bt(s?.fertilityStartConfig),r}}catch(t){console.warn("No se pudieron cargar los ajustes del gráfico.",t)}return n});i.useEffect(()=>{y&&Ee(n=>{const t=bt(n.fertilityStartConfig),s=bt(y.fertilityStartConfig);let r=!1;return typeof y.showRelationsRow=="boolean"&&n.showRelationsRow!==y.showRelationsRow&&(r=!0),t.combineMode!==s.combineMode&&(r=!0),t.postpartum!==s.postpartum&&(r=!0),Object.keys(t.calculators??{}).some(l=>t.calculators?.[l]!==s.calculators?.[l])&&(r=!0),r?{...n,showRelationsRow:typeof y.showRelationsRow=="boolean"?y.showRelationsRow:n.showRelationsRow,fertilityStartConfig:s}:n})},[y]);const oe=i.useMemo(()=>bt(Ae.fertilityStartConfig),[Ae.fertilityStartConfig]),kt=i.useMemo(()=>({...oe,calculators:{...oe.calculators,cpm:oe.calculators.cpm&&u!=="none",t8:oe.calculators.t8&&de!=="none"}}),[oe,u,de]);i.useEffect(()=>{if(!(typeof window>"u"))try{const n={...Ae,fertilityStartConfig:oe};window.localStorage.setItem(rn,JSON.stringify(n))}catch(n){console.warn("No se pudieron guardar los ajustes del gráfico.",n)}},[Ae,oe]);const Re=i.useRef(!1),ze=i.useRef(0),Le=i.useRef(null),be=i.useRef(null),fe=!!(Ve&&String(Ve.id||"").startsWith("placeholder-"));if(i.useEffect(()=>{if(typeof document>"u")return;const n=document.body,t=document.documentElement;if(ue){Le.current===null&&(Le.current=n.style.overflow),be.current===null&&(be.current=t.style.overflow),n.style.overflow="hidden",t.style.overflow="hidden";return}return Le.current!==null&&(n.style.overflow=Le.current,Le.current=null),be.current!==null&&(t.style.overflow=be.current,be.current=null),()=>{Le.current!==null&&(n.style.overflow=Le.current,Le.current=null),be.current!==null&&(t.style.overflow=be.current,be.current=null)}},[ue]),i.useLayoutEffect(()=>{window.dispatchEvent(new Event("resize"))},[Ce,ue]),i.useEffect(()=>{if(typeof window>"u")return;const n=()=>{if(Y)return;const t=window.innerWidth>window.innerHeight?"landscape":"portrait";h(s=>s===t?s:t),window.dispatchEvent(new Event("resize"))};return window.addEventListener("resize",n),window.addEventListener("orientationchange",n),n(),()=>{window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n)}},[Y]),te)return e.jsx(Tt,{children:e.jsx("div",{className:"flex h-full flex-col items-center justify-center space-y-4 bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100 px-4 py-8 text-center text-fertiliapp-fuerte",children:e.jsx("p",{children:"Cargando…"})})});if(!d?.id)return a&&q?e.jsx(Tt,{children:e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 px-4 py-8 text-center text-fertiliapp-fuerte",children:[e.jsx("p",{children:"No se encontró el ciclo solicitado."}),e.jsx(It,{asChild:!0,className:"bg-fertiliapp-fuerte rounded-3xl text-white shadow",children:e.jsx(zt,{to:"/archived-cycles",children:"Volver a Mis Ciclos"})})]})}):e.jsx(Tt,{children:e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 px-4 py-8 text-center text-fertiliapp-fuerte",children:[e.jsx("p",{children:"No hay ciclo activo."}),e.jsx(It,{asChild:!0,className:"bg-fertiliapp-fuerte rounded-3xl text-white shadow",children:e.jsx(zt,{to:"/records",children:"Ir a Mis Registros"})})]})});const ie=28,Ie=10,Oe=25,Pe=lt(d.startDate),Se=d.data||[],nt=i.useMemo(()=>(Array.isArray(Se)?Se.find(t=>t?.peak_marker==="peak"):null)?.isoDate||null,[Se]),ut=Se.reduce((n,t)=>{const s=lt(t.isoDate);return s>n?s:n},Pe),ft=ct(new Date),ht=!S,st=ht&&d?.endDate?ct(lt(d.endDate)):null,Mt=ht?st??ut:ut>ft?ut:ft,Fe=$t(ct(Mt),Pe),He=Math.max(ie,Fe+1),wt=st?$t(st,Pe)+1:null,ve=wt?Math.min(He,wt):He,Ze=ys(Pe,ve).map(n=>{const t=Se.find(s=>s.isoDate===n.isoDate);return t?{...t,date:n.date}:n}),at=Y?"landscape":Ce,Ue=ue?at==="portrait"?Ie:Oe:at==="portrait"?Ie:ie;let Ct=0;if(at!=="landscape"){const n=$t(new Date,ct(Pe)),t=Math.min(Math.max(n,0),ve-1);let s=Math.min(ve,t+1);t<Ue-1&&(s=Math.min(ve,Ue)),Ct=Math.max(0,s-Ue)}const j={backgroundColor:"#fff7fb",backgroundImage:`
      radial-gradient(120% 120% at 0% 0%, rgba(251,113,133,0.18) 0, transparent 55%),
      radial-gradient(110% 110% at 100% 0%, rgba(244,114,182,0.16) 0, transparent 55%),
      radial-gradient(130% 130% at 0% 100%, rgba(251,113,133,0.08) 0, transparent 60%),
      radial-gradient(140% 140% at 100% 100%, rgba(255,255,255,0.9) 0, rgba(255,247,250,0.3) 40%, transparent 70%)
    `},c="calc(var(--app-vh, 1vh) * 100)",x="var(--bottom-nav-safe)",he=ue?{...j,height:c,maxHeight:c,paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"}:{...j,height:`calc(${c} - ${x})`,maxHeight:`calc(${c} - ${x})`,paddingTop:"env(safe-area-inset-top)"},X=(n,t=null)=>{qe(n),dt(t??null),Ne(!0)},se=async(n,t)=>{try{if(await U(n,t),B){const s=await G(n);s&&b(s)}}catch(s){console.error("Error toggling ignore state:",s)}},ke=n=>{const t=n===!0;Ee(s=>({...s,showRelationsRow:t})),typeof we=="function"&&we({showRelationsRow:t}).catch(s=>{console.error("Failed to persist relations row preference",s)})},ae=(n,t)=>{let s=null;Ee(r=>{const l=bt(r.fertilityStartConfig),g=t===!0;return l.calculators?.[n]===g?r:(s={...l,calculators:{...l.calculators,[n]:g}},{...r,fertilityStartConfig:s})}),s&&typeof we=="function"&&we({fertilityStartConfig:s}).catch(r=>{console.error("Failed to persist calculator preference",r)})},pe=n=>{if(!Object.prototype.hasOwnProperty.call(Kt,n))return;let t=null;Ee(s=>{const r=bt(s.fertilityStartConfig);return r.combineMode===n?s:(t={...r,combineMode:n},{...s,fertilityStartConfig:t})}),t&&typeof we=="function"&&we({fertilityStartConfig:t}).catch(s=>{console.error("Failed to persist combine mode preference",s)})},_e=n=>{let t=null;Ee(s=>{const r=bt(s.fertilityStartConfig),l=n===!0;if(r.postpartum===l)return s;const H={...r.calculators??Zt().calculators,cpm:!l,t8:!l};return t={...r,postpartum:l,calculators:H},{...s,fertilityStartConfig:t}}),t&&typeof we=="function"&&we({fertilityStartConfig:t}).catch(s=>{console.error("Failed to persist postpartum preference",s)})},F=o?.state?.fertilityCalculatorCandidates,De=d?.fertilityCalculatorCandidates,rt=i.useMemo(()=>{const n=[Array.isArray(F)?F:null,Array.isArray(De)?De:null].find(t=>Array.isArray(t)&&t.length>0);return n?n.map(t=>{if(!t)return null;const{source:s,day:r,reason:l}=t;if(s!=="CPM"&&s!=="T8")return null;const g=Number(r);return Number.isFinite(g)?{source:s,day:g,reason:typeof l=="string"?l:""}:null}).filter(Boolean):null},[F,De]),ot=i.useMemo(()=>{const n=Fn(ye),t=_n(ye,Wn),s=[];return u==="auto"&&n&&s.push(n),de==="auto"&&t&&s.push(t),s},[ye,u,de]),pt=i.useMemo(()=>{const n=[],t=(s,r,l,g)=>{if(s!=="manual")return;const H=Number(l);if(!Number.isFinite(H)||H<=0)return;const E=Number(g),N=Number.isFinite(E)&&E>0,_=N?Number.isInteger(E)?`${E}`:`${Number(E.toFixed(2))}`:null,D=N?r==="CPM"?`ciclo base: ${_} días`:`base ${ws(r)}: ${_}`:null,C=D?`Manual desde dashboard (${D})`:"Manual desde dashboard";n.push({source:r,day:Math.max(1,H),reason:C,kind:"calculator",isManual:!0,manualBase:N?E:null})};return t(u,"CPM",M,ce),t(de,"T8",ne,le),n},[u,M,ce,ne,le,de]),Te=i.useMemo(()=>{const n=new Map;(Array.isArray(rt)?rt:[]).forEach(l=>{const g=Pt(l?.source);g&&n.set(g,l)});const t=new Map;pt.forEach(l=>{const g=Pt(l?.source);g&&t.set(g,l)});const s=u==="manual"?t.get("CPM")??n.get("CPM")??null:u==="auto"?ot.find(l=>Pt(l?.source)==="CPM")??null:null,r=de==="manual"?t.get("T8")??n.get("T8")??null:de==="auto"?ot.find(l=>Pt(l?.source)==="T8")??null:null;return[s,r].filter(Boolean)},[ot,u,pt,rt,de]),mt=async(n,t=!0)=>{if(!d?.id||!n?.isoDate)return;const s=l=>{if(l==null||l==="")return null;const g=parseFloat(String(l).replace(",","."));return Number.isFinite(g)?g:null},r=t??!(n.peak_marker==="peak"||n.peakStatus==="P");V(!0);try{const l=n.timestamp?Dt(lt(n.timestamp),"HH:mm"):Dt(new Date,"HH:mm");let g=Array.isArray(n.measurements)&&n.measurements.length>0?n.measurements:[{temperature:n.temperature_chart??n.temperature_raw??null,temperature_corrected:n.temperature_corrected??null,time:l,time_corrected:n.time_corrected??l,selected:!0,use_corrected:n.use_corrected??!1}];g.length===0&&(g=[{temperature:null,temperature_corrected:null,time:l,time_corrected:l,selected:!0,use_corrected:!1}]);const H=g.map((_,D)=>{const C=_.time||l,k=_.time_corrected||C;return{temperature:s(_.temperature??_.temperature_raw),time:C,selected:D===0?!0:!!_.selected,temperature_corrected:s(_.temperature_corrected),time_corrected:k,use_corrected:!!_.use_corrected}});H.some(_=>_.selected)||(H[0].selected=!0);const E={isoDate:n.isoDate,measurements:H,mucusSensation:n.mucus_sensation??n.mucusSensation??"",mucusAppearance:n.mucus_appearance??n.mucusAppearance??"",fertility_symbol:n.fertility_symbol??"none",observations:n.observations??"",had_relations:n.had_relations??n.hadRelations??!1,ignored:n.ignored??!1,peak_marker:r?"peak":null},N=n?.id&&!String(n.id).startsWith("placeholder-")?n:null;await m(E,N,d.id)}catch(l){console.error("Error toggling peak marker:",l)}finally{V(!1)}},Je=i.useCallback(()=>{Ne(!1),qe(null),dt(null)},[]),Nt=async(n,{keepFormOpen:t=!1}={})=>{if(d?.id){V(!0),t&&(ze.current=Date.now()+500);try{if(await m(n,Ve,d.id),B){const s=await G(d.id);s&&b(s)}t||(Ne(!1),qe(null),dt(null))}finally{V(!1)}}},xt=n=>{qe(n)},Rt=()=>{et(n=>!n)},Qe=i.useCallback(()=>{Ke(null)},[]),J=n=>{if(n.preventDefault(),Re.current){Re.current=!1;return}Rt()},gt=n=>{n.pointerType==="touch"&&(n.preventDefault(),Re.current=!0,Rt())},$e=i.useCallback(n=>{if(n){Ne(!0);return}Date.now()<ze.current||Je()},[Je]),ge=i.useCallback(n=>{if(!Number.isInteger(n)||n<0||n>=Ze.length)return"—";const t=Ze[n],s=t?.isoDate??t?.date;if(!s)return"—";try{const r=typeof s=="string"?lt(s):s;return Dt(r,"dd/MM")}catch(r){return console.error("Error formatting date from index",r),"—"}},[Ze]),it=i.useCallback((n={})=>{if(!n)return;const t=n.phase??null,s=n.reasons??{},r=s?.aggregate??null,l=Array.isArray(r?.usedCandidates)?r.usedCandidates:[],g=Array.isArray(r?.ignoredCalculatorCandidates)?r.ignoredCalculatorCandidates:[],H=s?.window??s?.fertileWindow??null,E=Number.isInteger(s?.startIndex)?s.startIndex:Number.isInteger(s?.fertileStartFinalIndex)?s.fertileStartFinalIndex:null,N=r?.selectedMode??oe?.combineMode??null,_=s?.source==="marker"||s?.details?.explicitStartDay!=null?"Ajustado por marcadores":{conservador:"Conservador",estandar:"Estándar"}[N]??null,D=!!oe?.postpartum,C=R=>(R?.source??R?.originalSource??"").toString().toUpperCase(),k=()=>{const R=Number.isInteger(E)?E+1:null;return R?{candidate:l.find(K=>Number.isFinite(K?.day)&&Math.round(K.day)===R)??l[0]??null,dayNumber:R}:{candidate:null,dayNumber:null}},Q=()=>{const{candidate:R}=k(),re=C(R);if(re==="CPM")return"alcanzar valor CPM";if(re==="T8"||re==="T-8")return"alcanzar valor T-8";if(s?.source==="marker"||s?.details?.explicitStartDay!=null)return"marcador";const K=(R?.reason??"").toUpperCase(),W=K.includes("S")||K.includes("BIP");return!K&&!re?null:W?"cambio en la sensación":"presencia de moco"};let I="",O="",P=null;if(t==="relativeInfertile"){I="Relativamente infértil";const R=Number.isInteger(E),re=N==="estandar"&&Array.isArray(g)&&g.length>0,K=Q(),W=ge(E);R?(O=`Fin de fase por ${K??"—"}.`,P=W!=="—"?`Inicio fértil: ${W}.`:null):N==="conservador"?O="A la espera de cálculo (CPM/T-8) o signos de moco/sensación.":re?O="Referencia alcanzada (CPM/T-8). A la espera de signos de moco/sensación.":O="A la espera de signos de moco/sensación."}else if(t==="fertile"){I="Fase fértil";const R=Q()??"—",K=ge(E)??"—",W=Number.isFinite(H?.endIndex),Me=Number.isInteger(H?.mucusInfertileStartIndex),je=Number.isInteger(H?.temperatureInfertileStartIndex);O=`Iniciada el ${K} por ${R}.`,W?Me&&je?P="Finalizada por doble criterio.":Me?P="Finalizada por día pico.":je&&(P="Finalizada por temperatura."):P="A la espera de cierre por día pico y/o confirmación de temperatura."}else if(t==="postOvulatory"){const R=(n?.displayLabel??n?.label??"").toLowerCase(),re=n?.status??s?.status??null,K=ge(Number.isInteger(s?.temperature?.confirmationIndex)?s.temperature.confirmationIndex:Number.isInteger(s?.temperature?.startIndex)?s.temperature.startIndex:H?.temperatureInfertileStartIndex),W=ge(s?.mucus?.peakDayIndex),Me=ge(Number.isInteger(s?.mucus?.infertileStartIndex)?s.mucus.infertileStartIndex:n?.startIndex),je=ge(n?.startIndex);if(re==="absolute"||n?.displayLabel==="Infertilidad absoluta")I="Infertilidad postovulatoria confirmada",O=`Comienza el ${je}.`,P=`Confirmada por temperatura (${K}) y 3.º/4.º día postpico (${Me}).`;else if(R.includes("moco")){I="Infertilidad post-pico";const yt=Number.isInteger(s?.mucus?.infertileStartIndex)?s.mucus.infertileStartIndex:Number.isInteger(n?.startIndex)?n.startIndex:null,We=Number.isInteger(s?.mucus?.peakDayIndex)?s.mucus.peakDayIndex:null;let Ye="día postpico";if(Number.isInteger(yt)&&Number.isInteger(We)){const Lt=yt-We;Lt===3?Ye="3.º día postpico":Lt===4&&(Ye="4.º día postpico")}O=`Alcanzada el ${je} por ${Ye}. Día pico: ${W}.`,P="A la espera de confirmación por temperatura."}else R.includes("temperatura")?(I="Infertilidad postovulatoria por temperatura",O=`Temperatura confirmada el ${K}.`,P="A la espera de determinación del día pico."):(I="Fase postovulatoria",O="Interpretación postovulatoria disponible.",P=re==="pending"?"Pendiente completar el segundo criterio.":null)}else if(t==="nodata")(s?.status??n?.status??null)==="no-fertile-window"?(I="Sin ventana fértil identificable",O="No se ha identificado un inicio fértil claro en este ciclo (ni por moco, ni por calculadora, ni por marcador explícito)."):(I="Sin datos suficientes",O="Añade registros de sensación, moco o temperatura para interpretar el ciclo.");else if(n?.message)I=n.message;else return;I&&Ke({title:I,message:O,description:P,modeLabel:_,postpartumActive:D})},[oe,ge,Ze.length,Ke]),Ot=()=>{if(!ue){Be(!0),St(!0);return}St(!1);const n=typeof window<"u"&&window.innerWidth>window.innerHeight?"landscape":"portrait";h(n),Be(!1)};return e.jsx(Tt,{hideBottomNav:ue,children:e.jsxs("div",{className:ue?"fixed inset-0 z-50 h-app w-[100vw] overflow-y-auto overflow-x-hidden":"relative w-full h-full overflow-y-auto overflow-x-hidden",style:he,children:[L&&!ue&&e.jsx(It,{asChild:!0,variant:"ghost",className:"absolute top-4 left-4 z-10 bg-white/20 text-slate-700 hover:brightness-95",children:e.jsxs(zt,{to:`/cycle/${d.id}`,className:"flex items-center gap-1",children:[e.jsx(Yn,{className:"h-4 w-4"}),A&&e.jsx("span",{className:"ml-1 text-xs font-semibold text-slate-700 sm:text-sm",children:A})]})}),e.jsx(It,{onClick:()=>tt(n=>!n),variant:"ghost",size:"icon",className:"absolute top-16 right-4 z-10 p-2 rounded-full bg-white/20 shadow-lg shadow-secundario text-secundario border hover:brightness-95","aria-label":"Ajustes",children:e.jsx(Kn,{className:"h-4 w-4"})}),e.jsx(It,{onClick:J,onPointerUp:gt,variant:"ghost",size:"icon",className:`absolute top-4 right-20 z-10 p-2 rounded-full transition-colors ${v?"bg-fertiliapp-fuerte text-white shadow-lg shadow-fertiliapp-fuerte/50 border-fertiliapp-fuerte/70":"bg-white/20 text-fertiliapp-fuerte border border-fertiliapp-fuerte hover:brightness-95 shadow-md"}`,children:v?e.jsx(Vn,{className:"h-4 w-4"}):e.jsx(qn,{className:"h-4 w-4"})}),e.jsx(It,{onClick:Ot,className:"absolute top-4 right-4 z-10 bg-white/20 rounded-full text-slate-600 hover:bg-pink-50/80 shadow-md border border-slate-400/50 backdrop-blur-sm","aria-label":ue?"Salir de pantalla completa":"Rotar gráfico",children:e.jsx(Xn,{className:"w-4 h-4"})}),e.jsx(gs,{data:Ze,isFullScreen:ue,orientation:Ce,onToggleIgnore:se,onEdit:X,onTogglePeak:mt,cycleId:d.id,initialScrollIndex:Ct,visibleDays:Ue,showInterpretation:v,reduceMotion:!0,forceLandscape:Y||Ce==="landscape",currentPeakIsoDate:nt,showRelationsRow:Ae.showRelationsRow,fertilityStartConfig:kt,fertilityCalculatorCycles:ye,fertilityCalculatorCandidates:Te,onShowPhaseInfo:it,isArchivedCycle:!S,cycleEndDate:d?.endDate??null}),Xe&&e.jsx("div",{className:"fixed inset-0 z-40 bg-black/30",onClick:()=>tt(!1),"aria-hidden":"true"}),e.jsx("div",{className:`fixed top-0 right-0 z-50 h-app w-72 sm:w-80 transform transition-transform duration-300 ease-in-out ${Xe?"translate-x-0":"translate-x-full"}`,role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"flex h-full flex-col gap-6 border-xl rounded-xl border-rose-100/60 bg-white p-6 shadow-xl",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-titulo",children:"Ajustes del gráfico"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Personaliza la visualización del gráfico"})]}),e.jsx(It,{variant:"ghost",size:"icon",className:"h-8 w-8 text-slate-400 hover:text-slate-600",onClick:()=>tt(!1),"aria-label":"Cerrar ajustes del gráfico",children:"×"})]}),e.jsxs("div",{className:"space-y-4 overflow-y-auto pr-1",children:[e.jsxs("div",{className:"rounded-2xl border border-pink-100/70 bg-pink-50/40 p-4 flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"max-w-xs",children:[e.jsx(Un,{htmlFor:"toggle-relations-row",className:"text-sm font-semibold text-slate-700",children:"Mostrar fila RS"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Añade una fila dedicada a las relaciones sexuales debajo de la gráfica."})]}),e.jsx(Ht,{id:"toggle-relations-row",checked:Ae.showRelationsRow,onCheckedChange:ke,className:"mt-1"})]}),e.jsxs("div",{className:"rounded-2xl border border-sky-100/70 bg-sky-50/40 p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700",children:"Modo de combinación"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Determina cómo se elige el inicio y fin de la fase fértil a partir de los candidatos disponibles."})]}),e.jsxs(Ln,{value:oe.combineMode,onValueChange:pe,children:[e.jsx(Dn,{className:"w-full bg-white/80 border-slate-200 text-sm rounded-3xl text-slate-700",children:e.jsx(An,{placeholder:"Selecciona un modo"})}),e.jsx(En,{className:"bg-white border-slate-200 text-slate-700 rounded-3xl",children:Object.entries(Kt).map(([n,t])=>e.jsx(On,{value:n,className:"text-sm rounded-3xl",children:t},n))})]})]}),e.jsx("div",{className:"rounded-2xl border border-red-100/70 bg-red-50/40 p-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-3 pt-1",children:[e.jsx("div",{className:"max-w-[65%]",children:e.jsx("p",{className:"text-sm font-semibold text-slate-700",children:"Modo postparto"})}),e.jsx(Ht,{checked:!!oe.postpartum,onCheckedChange:_e,className:"mt-1"})]})}),e.jsxs("div",{className:"rounded-2xl border border-amber-100/70 bg-amber-50/40 p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700",children:"Calculadoras complementarias"}),e.jsx("p",{className:"text-xs text-slate-500",children:"CPM y T-8 se combinan con los perfiles activos, salvo que actives el modo posparto."})]}),oe.postpartum&&e.jsx("p",{className:"text-xs font-medium text-rose-500",children:"El modo posparto está activo: CPM y T-8 se omiten del cálculo final."}),e.jsx("div",{className:"space-y-2",children:Cs.map(n=>e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("span",{className:"text-sm text-slate-700",children:n.label}),e.jsx(Ht,{checked:!!oe.calculators?.[n.key],disabled:!!oe.postpartum,onCheckedChange:t=>ae(n.key,t)})]},n.key))})]})]})]})}),e.jsx(bs,{isOpen:!!xe,onClose:Qe,ariaLabel:"Detalle de interpretación del ciclo",containerClassName:"p-6",children:xe&&e.jsxs("div",{className:"space-y-3 text-left",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-fertiliapp-fuerte",children:xe.title}),xe.modeLabel&&e.jsx("span",{className:"rounded-full border border-secundario bg-secundario-suave px-3 py-1 text-[11px] font-semibold text-secundario-fuerte",children:xe.modeLabel}),xe.postpartumActive&&e.jsx("span",{className:"rounded-full border border-rose-200 bg-rose-50 px-3 py-1 text-[11px] font-semibold text-rose-600",children:"Modo postparto"})]}),e.jsx("button",{type:"button",onClick:Qe,className:"rounded-full p-1 text-slate-400 transition hover:bg-slate-100 hover:text-slate-600 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-pink-200","aria-label":"Cerrar detalle de interpretación",children:e.jsx(kn,{className:"h-5 w-5"})})]}),xe.message&&e.jsx("p",{className:"text-sm leading-relaxed text-slate-700",children:xe.message}),xe.description&&e.jsx("p",{className:"text-sm leading-relaxed text-slate-500",children:xe.description})]})}),e.jsx(zn,{open:At,onOpenChange:$e,children:e.jsx(Hn,{hideClose:!0,className:"bg-transparent border-none p-0 text-gray-800 w-[90vw] sm:w-auto max-w-md sm:max-w-lg md:max-w-xl max-h-[85vh] overflow-y-auto",onInteractOutside:n=>{Date.now()<ze.current&&n.preventDefault()},onPointerDownOutside:n=>{Date.now()<ze.current&&n.preventDefault()},children:e.jsx(Tn,{onSubmit:Nt,onCancel:Je,initialData:Ve,cycleStartDate:d.startDate,cycleEndDate:d.endDate,isProcessing:me,isEditing:!!Ve&&!fe,cycleData:d.data,onDateSelect:xt,initialSectionKey:vt})})})]})})};export{As as default};
