import{c as He,m as ee,j as e,s as je,p as Ee,r as k,e as Xe,f as ve,d as Pe,h as Ke,M as Re,B as De,L as qe}from"./index-24043ae7.js";import{g as Je,i as Ze,c as Qe,D as et}from"./computePeakStatuses-a8c393d1.js";import{C as tt}from"./ChartTooltip-086fab25.js";import{u as nt,D as rt,a as st}from"./useCycleData-4efbc629.js";import{E as ot}from"./eye-off-b85355d3.js";import{E as it}from"./eye-61791957.js";import"./input-2a7ce825.js";import"./label-e033e1bb.js";import"./select-4e9e95be.js";import"./badge-e36f7fd8.js";const at=He("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),lt=({padding:n,chartWidth:a,chartHeight:v,tempMin:y,tempMax:L,tempRange:j,getY:g,getX:x,allDataPoints:S=[],responsiveFontSize:m,isFullScreen:P,showLeftLabels:R=!1,reduceMotion:r=!1})=>{const c={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.3,ease:"easeOut"}}},h=[];if(j>0){const u=j<=2.5?.1:.5;for(let w=y;w<=L+1e-9;w+=u)h.push(parseFloat(w.toFixed(1)))}else for(let u=35;u<=37.5+1e-9;u+=.5)h.push(parseFloat(u.toFixed(1)));const o=r?"g":ee.g;return e.jsxs(e.Fragment,{children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"bgGradientChart",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(254, 242, 242, 0.95)"}),e.jsx("stop",{offset:"30%",stopColor:"rgba(255, 241, 242, 0.9)"}),e.jsx("stop",{offset:"70%",stopColor:"rgba(255, 245, 255, 0.95)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(254, 242, 242, 0.8)"})]}),e.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),e.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),e.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),e.jsxs("filter",{id:"chartGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsx("filter",{id:"textShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodColor:"rgba(255, 255, 255, 0.8)"})}),e.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[e.jsx("rect",{width:"6",height:"6",fill:"#ef4444"}),e.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(255,255,255,0.85)"})]})]}),e.jsx("rect",{x:n.left,y:n.top,width:a-n.left-n.right,height:v-n.top-n.bottom,fill:"url(#bgGradientChart)",opacity:2,rx:12,style:{filter:"drop-shadow(0 4px 12px rgba(244, 114, 182, 0.1))"}}),h.map((u,w)=>{const N=g(u),p=u.toFixed(1).endsWith(".0")||u.toFixed(1).endsWith(".5"),_=p?u.toFixed(1):`.${u.toFixed(1).split(".")[1]}`;return e.jsxs(o,{...r?{}:{variants:c},children:[e.jsx("line",{x1:n.left,y1:N,x2:a-n.right,y2:N,stroke:p?"rgba(244, 114, 182, 0.3)":"rgba(244, 114, 182, 0.15)",strokeWidth:p?3:2,strokeDasharray:p?"0":"4,4",style:{filter:p?"drop-shadow(0 1px 3px rgba(244, 114, 182, 0.15))":"none",opacity:p?1:.7}}),R&&e.jsx("text",{x:n.left-m(1),y:N+m(.35),textAnchor:"end",fontSize:m(p?1.1:1),fontWeight:p?"700":"600",fill:p?"#E91E63":"#EC4899",style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:_}),e.jsx("text",{x:a-n.right+m(1),y:N+m(.35),textAnchor:"start",fontSize:m(p?1.1:1),fontWeight:p?"700":"600",fill:p?"#E91E63":"#EC4899",style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:_})]},`temp-tick-${w}`)}),S.map((u,w)=>{const N=x(w);return e.jsx("line",{x1:N,y1:n.top,x2:N,y2:v-n.bottom,stroke:"rgba(244, 114, 182, 0.08)",strokeWidth:2.8,style:{filter:"drop-shadow(0 0 1px rgba(244, 114, 182, 0.05))"}},`day-grid-${w}`)}),e.jsx("rect",{x:n.left,y:n.top,width:a-n.left-n.right,height:v-n.top-n.bottom,fill:"none",stroke:"rgba(244, 114, 182, 0.4)",strokeWidth:4,rx:8,style:{filter:"drop-shadow(0 4px 12px rgba(244, 114, 182, 0.15))",strokeDasharray:"0"}}),R&&e.jsx(o,{...r?{}:{variants:c},children:e.jsx("text",{x:n.left+m(1.2),y:n.top+m(1.5),textAnchor:"middle",fontSize:m(1.4),fontWeight:"800",fill:"#E91E63",style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:"°C"})})]})},ct=({data:n,allDataPoints:a,getX:v,getY:y,baselineY:L,temperatureField:j="temperature",reduceMotion:g=!1})=>{if(!n||n.length<2)return null;let x="",S=null;const m=[];if(a.forEach((r,c)=>{const h=n.find(o=>o.id===r.id);if(h&&h[j]!==null&&h[j]!==void 0&&!h.ignored){const o=v(c),u=y(h[j]);m.push({x:o,y:u}),S!==null&&c===S+1?x+=` L ${o} ${u}`:x+=`${x?" ":""}M ${o} ${u}`,S=c}}),m.length<2)return null;const P=x.includes("L"),R=m.length>1?m.map(({x:r,y:c},h)=>`${h===0?"M":"L"} ${r} ${c}`).join(" "):"";return e.jsxs(e.Fragment,{children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),e.jsx("stop",{offset:"30%",stopColor:"#EC4899"}),e.jsx("stop",{offset:"70%",stopColor:"#E91E63"}),e.jsx("stop",{offset:"100%",stopColor:"#C2185B"})]}),e.jsxs("linearGradient",{id:"tempLineGradientChartGlow",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(244, 114, 182, 0.6)"}),e.jsx("stop",{offset:"30%",stopColor:"rgba(236, 72, 153, 0.7)"}),e.jsx("stop",{offset:"70%",stopColor:"rgba(233, 30, 99, 0.8)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(194, 24, 91, 0.6)"})]}),e.jsxs("filter",{id:"lineGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"4",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsx("filter",{id:"lineShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"3",floodColor:"rgba(244, 114, 182, 0.4)"})})]}),P&&(g?e.jsx("path",{d:x,fill:"none",stroke:"url(#tempLineGradientChartGlow)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:.4,style:{filter:"url(#lineGlow)"}}):e.jsx(ee.path,{d:x,fill:"none",stroke:"url(#tempLineGradientChartGlow)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:.4,style:{filter:"url(#lineGlow)"},initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.4},transition:{duration:.8,ease:"easeInOut",delay:.2}})),R&&(g?e.jsx("path",{d:R,fill:"none",stroke:"#d587b1",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.65}):e.jsx(ee.path,{d:R,fill:"none",stroke:"#d587b1",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.65,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.65},transition:{duration:.8,ease:"easeInOut"}})),P&&(g?e.jsx("path",{d:x,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#lineShadow)"}}):e.jsx(ee.path,{d:x,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#lineShadow)"},initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:1},transition:{duration:1,ease:"easeInOut",delay:.4}})),P&&(g?e.jsx("path",{d:x,fill:"none",stroke:"rgba(255, 255, 255, 0.6)",strokeWidth:"0.3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.8}):e.jsx(ee.path,{d:x,fill:"none",stroke:"rgba(255, 255, 255, 0.6)",strokeWidth:"0.3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.8,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.8},transition:{duration:1.2,ease:"easeInOut",delay:.6}}))]})},Ne="#1565C0",We="#2E7D32",Fe="#6A1B9A",dt="#EFF6FF",ft="#EEF2FF",ht="#ECFDF5",ut="#F0FDFA",pt="#F5F3FF",xt="#FAF5FF",mt="rgba(148, 163, 184, 0.35)",yt="rgba(226, 232, 240, 0.6)",gt="rgba(148, 163, 184, 0.5)",Oe="✖",_e="#7f1d1d",Te="#ed5ca4",$e="drop-shadow(0 2px 4px rgba(244, 114, 182, 0.35))",wt=n=>{if(!n)return"";const[a,v]=n.split("/");return`${parseInt(a,10)}/${parseInt(v,10)}`},Be=(n="",a,v,y="–")=>{if(!n)return[y,""];if(n.length<=a)return[n,""];if(v)return[n.slice(0,a),""];const L=n.indexOf(" ",a);return L===-1?[n.slice(0,a),n.slice(a)]:[n.slice(0,L),n.slice(L+1)]},Ge=(n="",a,v="–")=>n?n.split(/\s+/).slice(0,a).join(" "):v,jt=({data:n,getX:a,getY:v,isFullScreen:y,orientation:L,responsiveFontSize:j,onPointInteraction:g,clearActivePoint:x,activePoint:S,padding:m,chartHeight:P,chartWidth:R,temperatureField:r="temperature_chart",textRowHeight:c,compact:h=!1,reduceMotion:o=!1,showInterpretation:u=!1,ovulationDetails:w=null})=>{const N={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},p={hidden:{opacity:0,scale:.3},visible:{opacity:1,scale:1,transition:{duration:.6,ease:[.34,1.56,.64,1],type:"spring",stiffness:120,damping:12}}},_=P-m.bottom,z=_+c*1,ue=_+c*2,te=_+c*3,O=_+c*(y?5:4.5),ne=_+c*(y?7:6),H=_+c*(y?9:7.5),$=R-m.left-m.right,X=c*(y?2:1.5),ae=o?"g":ee.g;return e.jsxs(e.Fragment,{children:[e.jsxs("defs",{children:[e.jsx("filter",{id:"rowShadowChart",x:"-10%",y:"-10%",width:"120%",height:"120%",children:e.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"4",floodColor:"rgba(244, 114, 182, 0.2)"})}),e.jsxs("filter",{id:"pointGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("linearGradient",{id:"sensationGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:dt}),e.jsx("stop",{offset:"100%",stopColor:ft})]}),e.jsxs("linearGradient",{id:"appearanceGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:ht}),e.jsx("stop",{offset:"100%",stopColor:ut})]}),e.jsxs("linearGradient",{id:"observationGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:pt}),e.jsx("stop",{offset:"100%",stopColor:xt})]}),e.jsxs("radialGradient",{id:"tempPointGradientChart",cx:"30%",cy:"30%",children:[e.jsx("stop",{offset:"0%",stopColor:"#FCE7F3"}),e.jsx("stop",{offset:"40%",stopColor:"#F472B6"}),e.jsx("stop",{offset:"80%",stopColor:"#E91E63"}),e.jsx("stop",{offset:"100%",stopColor:"#C2185B"})]}),e.jsxs("radialGradient",{id:"tempPointIgnoredGradient",cx:"30%",cy:"30%",children:[e.jsx("stop",{offset:"0%",stopColor:"#FFFFFF"}),e.jsx("stop",{offset:"80%",stopColor:"#F8FAFC"}),e.jsx("stop",{offset:"100%",stopColor:"#E2E8F0"})]}),e.jsxs("radialGradient",{id:"ovulationPointGradient",cx:"30%",cy:"30%",children:[e.jsx("stop",{offset:"0%",stopColor:"#bfdbfe"}),e.jsx("stop",{offset:"45%",stopColor:"#60a5fa"}),e.jsx("stop",{offset:"85%",stopColor:"#2563eb"}),e.jsx("stop",{offset:"100%",stopColor:"#1d4ed8"})]})]}),!h&&e.jsxs("g",{children:[e.jsx("rect",{x:m.left,y:O-X/2,width:$,height:X,fill:"url(#sensationGradientChart)",rx:4,style:{filter:"url(#rowShadowChart)"}}),e.jsx("rect",{x:m.left,y:ne-X/2,width:$,height:X,fill:"url(#appearanceGradientChart)",rx:4,style:{filter:"url(#rowShadowChart)"}}),e.jsx("rect",{x:m.left,y:H-X/2,width:$,height:X,fill:"url(#observationGradientChart)",rx:4,style:{filter:"url(#rowShadowChart)"}})]}),y&&L!=="portrait"&&e.jsx(ee.g,{variants:N,children:[{label:"Fecha",row:1,color:y?"#374151":"#6B7280"},{label:"Día",row:2,color:y?"#374151":"#6B7280"},{label:"Símbolo",row:3,color:y?"#374151":"#6B7280"},{label:"Sens.",row:y?5:4.5,color:Ne},{label:"Apar.",row:y?7:6,color:We},{label:"Observ.",row:y?9:7.5,color:Fe}].map(({label:l,row:K,color:C})=>e.jsx("text",{x:m.left-j(.5),y:_+c*K,textAnchor:"end",fontSize:j(1.05),fontWeight:"700",fill:C,style:{filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:l},l))}),n.map((l,K)=>{const C=a(K),re=l[r]!=null?v(l[r]):_,U=l.temperature_raw,E=l.temperature_corrected,q=l.use_corrected&&U!=null&&E!=null&&Math.abs(E-U)>.01,M=q?v(U):null,J=y?"#374151":"#6B7280",se=l[r]!=null;se||l.mucus_sensation||l.mucus_appearance||l.fertility_symbol;const me=String(l.id||"").startsWith("placeholder-"),le=w==null?void 0:w.ovulationIndex,i=u&&(w==null?void 0:w.confirmed)&&le!=null&&!l.ignored&&se&&K===le,d=Je(l.fertility_symbol);let s="transparent";if(d!=null&&d.color){const Z=d.color.replace(/^bg-/,"");Z==="red-500"?s="#ef4444":Z==="white"?s="#ffffff":Z==="green-500"?s="#22c55e":Z==="pink-300"?s="#f9a8d4":Z==="yellow-400"&&(s="#facc15")}const b=l.isoDate?Ze(je(Ee(l.isoDate)),je(new Date)):!1,f=j(y?1.8:2),Y=te-f*.75+f/2+2,T=l.peakStatus?String(l.peakStatus).toUpperCase():null,B=T==="P"||T==="X",G=T&&!B,Q=B?Oe:T||"–",de=B||["1","2","3"].includes(T),ye=!me&&d.value!=="none",fe=!!l.isoDate&&!b?{pointerEvents:"all",style:{cursor:"pointer"},onClick:Z=>g(l,K,Z)}:{},ge=y?4:7,we=2,[t,A]=Be(y?Ge(l.mucus_sensation,we,b?"":"–"):l.mucus_sensation,ge,!1,b?"":"–"),[D,he]=Be(y?Ge(l.mucus_appearance,we,b?"":"–"):l.mucus_appearance,ge,!1,b?"":"–"),[F,oe]=Be(y?Ge(l.observations,we,""):l.observations,ge,!1,"");return e.jsxs(ae,{...o?{}:{variants:N},...fe,children:[se&&e.jsxs(ae,{...o?{}:{variants:p},children:[q&&M!==null&&e.jsxs("g",{pointerEvents:"none",children:[e.jsx("line",{x1:C,y1:M,x2:C,y2:re,stroke:mt,strokeWidth:1,strokeDasharray:"4 4"}),e.jsx("circle",{cx:C,cy:M,r:3.5,fill:yt,stroke:gt,strokeWidth:1}),e.jsx("circle",{cx:C,cy:M,r:1.2,fill:"rgba(255, 255, 255, 0.6)"})]}),e.jsx("circle",{cx:C,cy:re,r:i?2:1.5,fill:i?"rgba(59, 130, 246, 0.28)":"rgba(244, 114, 182, 0.2)",opacity:.85,style:{filter:"url(#pointGlow)"}}),e.jsx("circle",{cx:C,cy:re,r:i?4.2:3.5,fill:"none",stroke:l.ignored?"rgba(148, 163, 184, 0.4)":i?"rgba(37, 99, 235, 0.55)":"rgba(244, 114, 182, 0.3)",strokeWidth:i?2:1.5,opacity:i?.9:.6}),e.jsx("circle",{cx:C,cy:re,r:i?4.6:4,fill:l.ignored?"url(#tempPointIgnoredGradient)":i?"url(#ovulationPointGradient)":"url(#tempPointGradientChart)",stroke:l.use_corrected?"#F59E0B":l.ignored?"#94A3B8":i?"#1d4ed8":"#E91E63",strokeWidth:l.ignored?2:i?3.2:3,style:{filter:i?"drop-shadow(0 3px 8px rgba(37, 99, 235, 0.45))":"drop-shadow(0 3px 6px rgba(244, 114, 182, 0.4))",cursor:"pointer"},pointerEvents:"all",onClick:Z=>g(l,K,Z)}),!l.ignored&&e.jsx("circle",{cx:C,cy:re,r:i?1.8:1.5,fill:i?"rgba(239, 246, 255, 0.95)":"rgba(255, 255, 255, 0.9)",style:{filter:i?"drop-shadow(0 1px 3px rgba(37, 99, 235, 0.45))":"drop-shadow(0 1px 2px rgba(244, 114, 182, 0.3))"}}),i&&e.jsx("circle",{cx:C,cy:re,r:6.5,fill:"none",stroke:"rgba(37, 99, 235, 0.35)",strokeWidth:1.2,strokeDasharray:"4 3"})]}),e.jsx("text",{x:C,y:z,textAnchor:"middle",fontSize:j(1.05),fontWeight:"900",fill:J,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:wt(l.date)}),e.jsx("text",{x:C,y:ue,textAnchor:"middle",fontSize:j(1),fontWeight:"900",fill:J,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:l.cycleDay}),ye?e.jsxs("g",{children:[e.jsx("rect",{x:C-f/2+1,y:te-f*.75+1,width:f,height:f,fill:"rgba(0, 0, 0, 0.1)",rx:f*.3,opacity:.5}),e.jsx("rect",{x:C-f/2-4,y:te-f*.75,width:f*1.4,height:f,fill:d.pattern==="spotting-pattern"?"url(#spotting-pattern-chart)":s,stroke:d.value==="white"?"#CBD5E1":"rgba(233, 30, 99, 0.4)",strokeWidth:d.value==="white"?2:1,rx:f*.2,style:{filter:"drop-shadow(0 2px 4px rgba(244, 114, 182, 0.25))"}}),T&&e.jsx("g",{pointerEvents:"none",children:B?e.jsx("text",{x:C,y:Y,textAnchor:"middle",fontSize:j(1.35),fontWeight:"900",fill:Te,style:{filter:$e},children:Oe}):e.jsx("text",{x:C,y:Y,textAnchor:"middle",fontSize:j(T?1.1:1),fontWeight:"800",fill:_e,style:{filter:"drop-shadow(0 1px 1px rgba(255,255,255,0.9))"},children:T})})]}):e.jsxs("g",{children:[de&&e.jsx("rect",{x:C-f/2-4,y:te-f*.75,width:f*1.4,height:f,fill:"transparent",stroke:B?Te:_e,strokeWidth:1,rx:f*.2}),e.jsx("text",{x:C,y:Y,textAnchor:"middle",fontSize:j(B?1.35:G?1.1:1),fill:B?Te:G?_e:J,fontWeight:B?"900":G?"800":"500",style:{filter:B?$e:G?"drop-shadow(0 1px 1px rgba(255,255,255,0.9))":"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:Q})]}),!h&&e.jsxs("text",{x:C,y:O,textAnchor:"middle",fontSize:j(.9),fontWeight:"700",fill:Ne,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[e.jsx("tspan",{x:C,dy:0,children:t}),A&&e.jsx("tspan",{x:C,dy:j(1.1),children:A})]}),!h&&e.jsxs("text",{x:C,y:ne,textAnchor:"middle",fontSize:j(.9),fontWeight:"700",fill:We,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[e.jsx("tspan",{x:C,dy:0,children:D}),he&&e.jsx("tspan",{x:C,dy:j(1.1),children:he})]}),!h&&e.jsxs("text",{x:C,y:H,textAnchor:"middle",fontSize:j(.9),fontWeight:"700",fill:Fe,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[e.jsx("tspan",{x:C,dy:0,children:F}),oe&&e.jsx("tspan",{x:C,dy:j(1.1),children:oe})]})]},`pt-${K}-${l.isoDate||l.timestamp}`)})]})},bt="#1565C0",Ct="#2E7D32",kt="#6A1B9A",Et=({padding:n,chartHeight:a,tempMin:v,tempMax:y,tempRange:L,getY:j,responsiveFontSize:g,textRowHeight:x,isFullScreen:S})=>{const m={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},P=[];if(L>0){const r=L<=2.5?.1:.5;for(let c=v;c<=y+1e-9;c+=r)P.push(parseFloat(c.toFixed(1)))}else for(let r=35;r<=37.5+1e-9;r+=.5)P.push(parseFloat(r.toFixed(1)));const R=a-n.bottom;return e.jsxs("svg",{width:n.left,height:a,className:"font-sans pointer-events-none",children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"legendBgGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(255, 228, 230, 1)"}),e.jsx("stop",{offset:"30%",stopColor:"rgba(255, 229, 235, 1)  "}),e.jsx("stop",{offset:"70%",stopColor:"rgba(255, 241, 242, 1)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(255, 236, 240, 0.6)"})]}),e.jsxs("linearGradient",{id:"legendAccentGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),e.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),e.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),e.jsx("filter",{id:"legendShadowChart",x:"-20%",y:"-20%",width:"140%",height:"140%",children:e.jsx("feDropShadow",{dx:"0",dy:"3",stdDeviation:"4",floodColor:"rgba(244, 114, 182, 0.2)"})}),e.jsx("filter",{id:"textShadowLegend",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodColor:"rgba(255, 255, 255, 0.9)"})})]}),e.jsx("rect",{x:0,y:R+x*.5,width:n.left,height:x*(S?9.5:8),fill:"url(#legendBgGradientChart)",rx:12,style:{filter:"url(#legendShadowChart)"}}),P.map((r,c)=>{const h=j(r),o=r.toFixed(1).endsWith(".0")||r.toFixed(1).endsWith(".5"),u=o?r.toFixed(1):`.${r.toFixed(1).split(".")[1]}`;return e.jsx(ee.g,{variants:m,children:e.jsx("text",{x:n.left-g(1.2),y:h+g(.35),textAnchor:"end",fontSize:g(o?1.15:1),fontWeight:o?"800":"700",fill:o?"#E91E63":"#EC4899",style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:u})},`temp-tick-fixed-${c}`)}),e.jsx(ee.g,{variants:m,children:[{label:"Fecha",row:1,color:"#374151",icon:null},{label:"Día",row:2,color:"#374151",icon:null},{label:"Símbolo",row:3,color:"#374151",icon:null},{label:"Sens.",row:S?5:4.5,color:bt,icon:"◊"},{label:"Apar.",row:S?7:6,color:Ct,icon:"○"},{label:"Observ.",row:S?9:7.5,color:kt,icon:"✦"}].map(({label:r,row:c,color:h,icon:o})=>e.jsxs("g",{children:[o&&e.jsx("text",{x:n.left-g(2.8),y:R+x*c,textAnchor:"middle",fontSize:g(.8),fontWeight:"600",fill:h,opacity:.7,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:o}),e.jsx("text",{x:n.left-g(.8),y:R+x*c,textAnchor:"end",fontSize:g(1.05),fontWeight:"800",fill:h,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:r})]},r))})]})},Ue=35.5,Ye=37.5,St=(n=[])=>{var R;const a=r=>r&&r.displayTemperature!=null&&!r.ignored,y=[];let L=null,j=null,g=null;const x=r=>{if(!r||r.length!==6)return null;const c=r.map(o=>o.temp);return c.some(o=>!Number.isFinite(o))?null:{baselineTemp:c.reduce((o,u)=>u>o?u:o,c[0]),baselineStartIndex:r[0].index}};for(let r=0;r<n.length;r++){const c=n[r];if(!a(c))continue;const h=c.displayTemperature;if(Number.isFinite(h)){if(y.length===6){const o=x(y);if(o&&(L=o.baselineTemp,j=o.baselineStartIndex,h>L)){g=r;break}}y.push({index:r,temp:h}),y.length>6&&y.shift()}}if(L==null&&y.length===6){const r=x(y);r&&(L=r.baselineTemp,j=r.baselineStartIndex)}const S={confirmed:!1,confirmationIndex:null,infertileStartIndex:null,rule:null,highSequenceIndices:[],ovulationIndex:null};if(L==null||g==null)return{baselineTemp:L,baselineStartIndex:j,firstHighIndex:g,ovulationDetails:S};const m=r=>{if(!r||r.length<3)return null;const c=L+.2,h=r.slice(0,3);if(h.length<3)return null;const o=h[2];if(o.temp>=c)return{confirmationIndex:o.index,usedIndices:h.map(u=>u.index),rule:"3-high"};if(r.length>=5){const u=r[3],w=r[4];if(u&&w&&u.temp>L&&w.temp>=c)return{confirmationIndex:w.index,usedIndices:r.slice(0,5).map(N=>N.index),rule:"5-high"}}return null};let P=S;for(let r=g;r<n.length;r++){const c=n[r];if(!a(c)||c.displayTemperature<=L)continue;const h=[];for(let u=r;u<n.length&&h.length<5;u++){const w=n[u];if(!a(w)||w.displayTemperature<=L)break;h.push({index:u,temp:w.displayTemperature})}const o=m(h);if(o){P={confirmed:!0,confirmationIndex:o.confirmationIndex,infertileStartIndex:o.confirmationIndex,rule:o.rule,highSequenceIndices:o.usedIndices,ovulationIndex:g??((R=o.usedIndices)!=null&&R.length?o.usedIndices[0]:null)};break}}return{baselineTemp:L,baselineStartIndex:j,firstHighIndex:g,ovulationDetails:P}},vt=(n,a,v,y,L,j=5,g=!1)=>{const x=k.useRef(null),S=k.useRef(null),[m,P]=k.useState({width:0,height:0}),[R,r]=k.useState(null),[c,h]=k.useState({x:0,y:0}),[o,u]=k.useState(null),w=k.useCallback(()=>{r(null),u(null)},[]),N=k.useMemo(()=>Qe(n),[n]),p=k.useMemo(()=>{const i=s=>{if(s==null||s==="")return null;const b=parseFloat(String(s).replace(",","."));return Number.isFinite(b)?b:null},d=s=>{if(!s)return null;const b=i(s.temperature),f=i(s.temperature_corrected);return s.use_corrected&&f!==null?f:b!==null?b:f!==null?f:null};return n.map(s=>{const b=[s==null?void 0:s.temperature_chart,s==null?void 0:s.temperature_raw,s==null?void 0:s.temperature_corrected];let f=null;for(const T of b)if(T!=null&&T!==""){f=T;break}if(f==null&&Array.isArray(s==null?void 0:s.measurements)){const B=s.measurements.find(G=>G&&G.selected&&d(G)!==null)||s.measurements.find(G=>d(G)!==null);B&&(f=d(B))}const Y=s==null?void 0:s.isoDate;return{...s,displayTemperature:i(f),peakStatus:Y&&N[Y]||null}})},[n,N]);k.useLayoutEffect(()=>{const i=()=>{if(!x.current)return;const s=x.current.parentElement||x.current;let b=s.clientWidth||600,f=s.clientHeight||400,Y=x.current.clientWidth>0?x.current.clientWidth:b,T,B;if(a){let G=window.innerWidth,Q=window.innerHeight;if(g&&Q>G&&([G,Q]=[Q,G]),Y=G,v==="portrait"&&!g){const de=Math.max(30,G*.05);T=(G-de)/j*n.length}else T=G/j*n.length;B=Q}else T=Y/j*n.length,B=f;P({width:T,height:B})};i(),window.addEventListener("resize",i);let d;if(x.current){const s=x.current.parentElement||x.current;d=new ResizeObserver(i),d.observe(s)}return()=>{window.removeEventListener("resize",i),d&&d.disconnect()}},[a,n.length,j,v,g]);const _=k.useMemo(()=>p.filter(i=>i&&i.isoDate&&!i.ignored&&i.displayTemperature!==null&&i.displayTemperature!==void 0),[p]),z=k.useMemo(()=>p.filter(i=>i&&i.isoDate),[p]),{baselineTemp:ue,baselineStartIndex:te,firstHighIndex:O,ovulationDetails:ne}=k.useMemo(()=>St(p),[p]),{tempMin:H,tempMax:$}=k.useMemo(()=>{const i=_.map(b=>b.displayTemperature).filter(b=>b!=null);if(i.length===0)return{tempMin:Ue,tempMax:Ye};let d=Math.min(...i,Ue),s=Math.max(...i,Ye);if(d=Math.floor(d*2)/2,s=Math.ceil(s*2)/2,s-d<2){const b=(d+s)/2;d=b-1,s=b+1}return{tempMin:d,tempMax:s}},[_]),X=$-H,ae=m.width,l=m.height,K=9,C=(i=1)=>{if(!a)return K*i;const d=Math.min(ae,l);return Math.max(8,Math.min(K*i,d/(z.length>0?40/i:40)))},re=C(a?1.6:2.5),U=g||v==="landscape",q=re*(U?9:5),M={top:a?Math.max(U?6:12,l*(U?.015:.03)):12,right:a?Math.max(U?35:30,ae*(U?.02:.05)):50,bottom:(a?Math.max(U?0:40,l*(U?0:.11)):60)+q+25,left:a?Math.max(U?45:20,ae*(U?.02:.05)):50},J=i=>{if(i==null||X===0)return l-M.bottom;const d=l-M.top-M.bottom;return d<=0?l-M.bottom:l-M.bottom-(i-H)/X*d},se=i=>{const d=a&&!(g||v==="landscape")?5:10,s=a&&!(g||v==="landscape")?25:0,b=ae-M.left-M.right-d-s*(z.length-1);if(b<=0)return M.left+d+s*i;const f=z.length>1?z.length-1:1;return f===0||z.length===0?M.left+d+s*i:M.left+d+i*(b/(z.length===1?1:f))+s*i},me=(i,d,s)=>{if(!i){w();return}const b=x.current.getBoundingClientRect();let f,Y;if(s.type.startsWith("touch")){const Q=s.changedTouches[0];f=Q.clientX,Y=Q.clientY}else f=s.clientX,Y=s.clientY;const T=se(d),B=i.displayTemperature??i.temperature_chart??null,G=J(B);h({svgX:T,svgY:G,clientX:f-b.left+x.current.scrollLeft,clientY:Y-b.top+x.current.scrollTop}),u(d),r(i)};return k.useEffect(()=>{const i=d=>{var s;if(S.current&&!S.current.contains(d.target)){const b=(s=x.current)==null?void 0:s.querySelectorAll("circle, text, rect");let f=!1;if(b){for(let Y of b)if(Y.contains(d.target)){f=!0;break}}f||w()}};return R&&(document.addEventListener("mousedown",i),document.addEventListener("touchstart",i)),()=>{document.removeEventListener("mousedown",i),document.removeEventListener("touchstart",i)}},[R,w]),{chartRef:x,tooltipRef:S,dimensions:m,activePoint:R,activeIndex:o,tooltipPosition:c,processedData:p,validDataForLine:_,allDataPoints:z,tempMin:H,tempMax:$,tempRange:X,padding:M,textRowHeight:re,setActivePoint:r,setActiveIndex:u,getY:J,getX:se,handlePointInteraction:me,clearActivePoint:w,handleToggleIgnore:i=>{y&&i&&(y(L,i),w())},responsiveFontSize:C,baselineTemp:ue,baselineStartIndex:te,firstHighIndex:O,ovulationDetails:ne}},Lt=({data:n,isFullScreen:a,orientation:v,onToggleIgnore:y,onEdit:L,onTogglePeak:j,cycleId:g,initialScrollIndex:x=0,visibleDays:S=5,showInterpretation:m=!1,reduceMotion:P=!1,forceLandscape:R=!1,currentPeakIsoDate:r=null})=>{const{chartRef:c,tooltipRef:h,dimensions:o,activePoint:u,activeIndex:w,tooltipPosition:N,allDataPoints:p,validDataForLine:_,tempMin:z,tempMax:ue,tempRange:te,padding:O,textRowHeight:ne,getY:H,getX:$,handlePointInteraction:X,handleToggleIgnore:ae,responsiveFontSize:l,clearActivePoint:K,baselineTemp:C,baselineStartIndex:re,firstHighIndex:U,ovulationDetails:E}=vt(n,a,v,y,g,S,R);if(!p||p.length===0)return e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-pink-100 to-rose-100 rounded-full mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-pink-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),e.jsx("p",{className:"text-slate-400 font-medium",children:"No hay datos para mostrar en el gráfico"})]});const q=o.width,M=o.height,J=C!=null?H(C):null,se=!!(E!=null&&E.confirmed),me=C!=null,le=$(0),i=p.length>0?$(p.length-1):q-O.right,d=se?"#F59E0B":"#94A3B8",s=se?"6 4":"4 4",b=se?1:.7,f=3,Y=q===0,T=M-O.bottom,B=w!=null?$(w):null,G=w!=null?w>0?$(w-1):B:null,Q=w!=null?w<p.length-1?$(w+1):B:null,de=Math.max((q-O.left-O.right)/Math.max(p.length,1),0),ye=w!=null?Math.max((Q!=null&&G!=null?Q-G:0)||de,de,0):0,pe=k.useMemo(()=>{const I=new Map;return _.forEach(V=>{V&&V.id!=null&&I.set(V.id,V)}),I},[_]),fe=k.useMemo(()=>{const I=O.top,V=(W,be="down")=>{if(!W||W.length<2)return null;const Ce=be==="up"?I:T;let xe=`M ${W[0].x} ${Ce} L ${W[0].x} ${W[0].y}`;for(let ke=1;ke<W.length;ke++){const ce=W[ke];xe+=` L ${ce.x} ${ce.y}`}return xe+=` L ${W[W.length-1].x} ${Ce} Z`,xe};return(W,{direction:be="down"}={})=>{if(typeof W!="function")return[];const Me=[];let Ce=[],xe=!1;const ke=()=>{const ce=V(Ce,be);ce&&Me.push(ce),Ce=[]};for(let ce=0;ce<p.length;ce++){if(!W(ce)){xe&&(ke(),xe=!1);continue}xe=!0;const Ie=p[ce],Ae=pe.get(Ie==null?void 0:Ie.id);if(!Ae||!Number.isFinite(Ae.displayTemperature))continue;const Ve=$(ce),ze=H(Ae.displayTemperature);Ce.push({x:Ve,y:ze})}return xe&&ke(),Me}},[p,pe,$,H,T,O.top]),ge=k.useMemo(()=>!m||!(E!=null&&E.confirmed)?[]:Number.isFinite(E.confirmationIndex)?fe(I=>I<=E.confirmationIndex,{direction:"up"}):[],[m,E,fe]),we=k.useMemo(()=>!m||!(E!=null&&E.confirmed)?[]:Number.isFinite(E.infertileStartIndex)?fe(I=>I>=E.infertileStartIndex,{direction:"up"}):[],[m,E,fe]),t=k.useMemo(()=>{var V;if(!(E!=null&&E.confirmed))return null;let I=null;for(let W=0;W<p.length;W++)if(((V=p[W])==null?void 0:V.peakStatus)==="3"){I=W;break}if(I==null)return null;for(let W=I+1;W<p.length;W++){const be=p[W];if(be&&pe.has(be.id))return W}return null},[p,E,pe]),A=k.useMemo(()=>!m||!(E!=null&&E.confirmed)?[]:Number.isFinite(t)?fe(I=>I>=t,{direction:"down"}):[],[m,E,fe,t]),[D,he]=k.useState({w:typeof window<"u"?window.innerWidth:0,h:typeof window<"u"?window.innerHeight:0}),F=D.w<D.h;k.useEffect(()=>{const I=()=>he({w:window.innerWidth,h:window.innerHeight});return window.addEventListener("resize",I),window.addEventListener("orientationchange",I),()=>{window.removeEventListener("resize",I),window.removeEventListener("orientationchange",I)}},[]),k.useEffect(()=>{if(!c.current)return;const I=c.current.clientWidth/S;c.current.scrollLeft=Math.max(0,I*x)},[x,S,o.width,v]);const oe=R&&F,Z=oe,Se="w-full h-full bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100",Le=a?`${Se} min-h-full ${Z?"flex items-stretch justify-start overflow-y-auto overflow-x-hidden":"flex items-center justify-start overflow-x-auto overflow-y-hidden"}`:`${Se} overflow-x-auto overflow-y-hidden border border-pink-100/50`,ie=!a||v==="portrait";return e.jsxs(ee.div,{className:"relative w-full h-full",initial:!1,children:[ie&&e.jsx("div",{className:"absolute left-0 top-0 h-full bg-transparent pointer-events-none z-10",style:{width:O.left},children:e.jsx(Et,{padding:O,chartHeight:M,tempMin:z,tempMax:ue,tempRange:te,getY:H,responsiveFontSize:l,textRowHeight:ne,isFullScreen:a})}),e.jsxs(ee.div,{ref:c,className:`relative p-0 ${a?"":"rounded-2xl"} ${Le}`,style:{boxShadow:a?"inset 0 1px 3px rgba(244, 114, 182, 0.1)":"0 8px 32px rgba(244, 114, 182, 0.12), 0 2px 8px rgba(244, 114, 182, 0.08)",...oe?{position:"absolute",top:0,left:0,width:`${D.h}px`,height:`${D.w}px`,transform:"rotate(90deg) translateY(-100%)",transformOrigin:"top left"}:{}},initial:!1,children:[Y&&e.jsx("div",{className:"flex items-center justify-center w-full h-full text-slate-400",children:"Cargando..."}),e.jsxs(ee.svg,{width:q,height:M,className:"font-sans flex-shrink-0",viewBox:`0 0 ${q} ${M}`,preserveAspectRatio:"xMidYMid meet",initial:!1,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),e.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),e.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),e.jsxs("linearGradient",{id:"tempAreaGradientChart",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(244,114,182,0.25)"}),e.jsx("stop",{offset:"50%",stopColor:"rgba(236,72,153,0.15)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(233,30,99,0.05)"})]}),e.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[e.jsx("rect",{width:"6",height:"6",fill:"#ef4444"}),e.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(255,255,255,0.85)"})]}),e.jsxs("filter",{id:"chartShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("filter",{id:"baselineGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("linearGradient",{id:"fertileAreaGradient",x1:"0%",y1:"100%",x2:"0%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(255, 182, 193, 0.7)"}),e.jsx("stop",{offset:"50%",stopColor:"rgba(255, 195, 195, 0.5)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(255, 208, 200, 0.3)"})]}),e.jsxs("linearGradient",{id:"infertileAreaGradient",x1:"0%",y1:"100%",x2:"0%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(132, 170, 230, 0.7)"}),e.jsx("stop",{offset:"50%",stopColor:"rgba(155, 180, 245, 0.5)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(170, 200, 255, 0.3)"})]}),e.jsxs("linearGradient",{id:"infertileLowerAreaGradient",x1:"0%",y1:"100%",x2:"0%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(226, 180, 216, 0.7)"}),e.jsx("stop",{offset:"50%",stopColor:"rgba(228, 190, 220, 0.5)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(228, 198, 225, 0.3)"})]})]}),e.jsx("rect",{width:"100%",height:"100%",fill:"transparent"}),e.jsx(lt,{padding:O,chartWidth:q,chartHeight:M,tempMin:z,tempMax:ue,tempRange:te,getY:H,getX:$,allDataPoints:p,responsiveFontSize:l,isFullScreen:a,showLeftLabels:!ie,reduceMotion:P}),m&&(E==null?void 0:E.confirmed)&&e.jsxs(e.Fragment,{children:[A.map((I,V)=>e.jsx("path",{d:I,fill:"url(#infertileLowerAreaGradient)",opacity:.65,pointerEvents:"none"},`infertile-lower-area-${V}`)),ge.map((I,V)=>e.jsx("path",{d:I,fill:"url(#fertileAreaGradient)",opacity:.65,pointerEvents:"none"},`fertile-area-${V}`)),we.map((I,V)=>e.jsx("path",{d:I,fill:"url(#infertileAreaGradient)",opacity:.45,pointerEvents:"none"},`infertile-area-${V}`))]}),m&&me&&J!==null&&(P?e.jsx("line",{x1:le,y1:J,x2:i,y2:J,stroke:d,strokeWidth:f,strokeDasharray:s,opacity:b}):e.jsx(ee.path,{d:`M ${le} ${J} L ${i} ${J}`,stroke:d,strokeWidth:f,strokeDasharray:s,opacity:b,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:b},transition:{duration:4,ease:"easeInOut",delay:.5}})),e.jsx(ct,{data:_,allDataPoints:p,getX:$,getY:H,baselineY:M-O.bottom,temperatureField:"displayTemperature",reduceMotion:P}),e.jsx(jt,{data:p,getX:$,getY:H,isFullScreen:a,orientation:v,responsiveFontSize:l,onPointInteraction:X,clearActivePoint:K,activePoint:u,padding:O,chartHeight:M,chartWidth:q,temperatureField:"displayTemperature",textRowHeight:ne,compact:!1,reduceMotion:P,showInterpretation:m,ovulationDetails:E}),w!==null&&B!==null&&ye>0&&e.jsx("g",{pointerEvents:"none",children:e.jsx("line",{x1:B,y1:0,x2:B,y2:M,stroke:"rgba(206,95,153,0.15)",strokeWidth:Math.max(2,Math.min(10,ye*.28)),strokeLinecap:"round"})})]}),u&&e.jsx(ee.div,{ref:h,initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:10},transition:{duration:.12,ease:"easeOut"},children:e.jsx(tt,{point:u,position:N,chartWidth:q,chartHeight:M,onToggleIgnore:ae,onEdit:L,onClose:K,onTogglePeak:j,currentPeakIsoDate:r})})]})]})};function Mt(n,a){if(!n||!a)return[];const v=typeof n=="string"?Ee(n):n;return[...Array(a)].map((y,L)=>{const j=Xe(v,L),g=ve(j,"yyyy-MM-dd"),x=ve(j,"dd/MM"),S=Pe(je(j),je(v))+1;return{date:x,isoDate:g,cycleDay:S,temperature:null,mucusSensation:null,mucusAppearance:null,id:`placeholder-${g}`,ignored:!1,peak_marker:null}})}const Wt=()=>{const{cycleId:n}=Ke(),{currentCycle:a,archivedCycles:v,isLoading:y,addOrUpdateDataPoint:L,toggleIgnoreRecord:j,getCycleById:g}=nt(),[x,S]=k.useState(null),[m,P]=k.useState(!1),[R,r]=k.useState(!1),c=!n||n===a.id,h=c?null:v.find(t=>t.id===n);k.useEffect(()=>{if(c){S(null),P(!1),r(!1);return}if(h){S(null),P(!1),r(!1);return}let t=!0;return P(!0),g(n).then(A=>{t&&(A?(S(A),r(!1)):(S(null),r(!0)))}).catch(()=>{t&&(S(null),r(!0))}).finally(()=>{t&&P(!1)}),()=>{t=!1}},[c,h,g,n]);const o=c?a:h||x,u=!c&&!h,w=c?y&&!(a!=null&&a.id):m||y&&!h&&!x,[N,p]=k.useState(typeof window<"u"&&window.innerWidth>window.innerHeight?"landscape":"portrait"),[_,z]=k.useState(!1),[ue,te]=k.useState(!1),[O,ne]=k.useState(null),[H,$]=k.useState(!1),[X,ae]=k.useState(!1),l=k.useRef(!1),K=!!(O&&String(O.id||"").startsWith("placeholder-"));if(k.useEffect(()=>{const t=async()=>{var D,he;const A=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement);if(z(A),!A){try{const F=typeof window<"u"?(D=window.screen)==null?void 0:D.orientation:null;await((he=F==null?void 0:F.unlock)==null?void 0:he.call(F))}catch{}p("portrait")}};return document.addEventListener("fullscreenchange",t),document.addEventListener("webkitfullscreenchange",t),document.addEventListener("mozfullscreenchange",t),document.addEventListener("MSFullscreenChange",t),()=>{document.removeEventListener("fullscreenchange",t),document.removeEventListener("webkitfullscreenchange",t),document.removeEventListener("mozfullscreenchange",t),document.removeEventListener("MSFullscreenChange",t)}},[]),k.useLayoutEffect(()=>{window.dispatchEvent(new Event("resize"))},[N,_]),w)return e.jsx("p",{className:"text-center text-gray-500",children:"Cargando…"});if(!(o!=null&&o.id))return n&&R?e.jsx(Re,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[100dvh] space-y-4 text-center text-pink-600",children:[e.jsx("p",{children:"No se encontró el ciclo solicitado."}),e.jsx(De,{asChild:!0,className:"bg-gradient-to-r from-pink-500 to-rose-500 text-white shadow",children:e.jsx(qe,{to:"/archived-cycles",children:"Volver a Mis Ciclos"})})]})}):e.jsx("p",{className:"text-center text-pink-600",children:"No hay ciclo activo."});const C=28,re=10,U=Ee(o.startDate),E=o.data||[],q=k.useMemo(()=>{const t=Array.isArray(E)?E.find(A=>(A==null?void 0:A.peak_marker)==="peak"):null;return(t==null?void 0:t.isoDate)||null},[E]),M=E.reduce((t,A)=>{const D=Ee(A.isoDate);return D>t?D:t},U),J=je(new Date),se=M>J?M:J,me=Pe(je(se),U),le=Math.max(C,me+1),d=Mt(U,le).map(t=>{const A=E.find(D=>D.isoDate===t.isoDate);return A?{...A,date:t.date}:t}),s=N==="portrait"?re:C;let b=0;if(N!=="landscape"){const t=Pe(new Date,je(U)),A=Math.min(Math.max(t,0),le-1);let D=Math.min(le,A+1);A<s-1&&(D=Math.min(le,s)),b=Math.max(0,D-s)}const f={background:"linear-gradient(135deg, #FFFAFC 0%, #f7eaef 100%)"},Y=_?f:{...f,height:N==="landscape"?"calc(min(100dvh, 100dvw) - var(--bottom-nav-safe))":"calc(100dvh - var(--bottom-nav-safe))",maxHeight:"100vh",paddingBottom:"env(safe-area-inset-bottom)"},T=t=>{ne(t),te(!0)},B=async(t,A)=>{try{if(await j(t,A),u){const D=await g(t);D&&S(D)}}catch(D){console.error("Error toggling ignore state:",D)}},G=async(t,A=!0)=>{if(!(o!=null&&o.id)||!(t!=null&&t.isoDate))return;const D=F=>{if(F==null||F==="")return null;const oe=parseFloat(String(F).replace(",","."));return Number.isFinite(oe)?oe:null},he=A??!(t.peak_marker==="peak"||t.peakStatus==="P");$(!0);try{const F=t.timestamp?ve(Ee(t.timestamp),"HH:mm"):ve(new Date,"HH:mm");let oe=Array.isArray(t.measurements)&&t.measurements.length>0?t.measurements:[{temperature:t.temperature_chart??t.temperature_raw??null,temperature_corrected:t.temperature_corrected??null,time:F,time_corrected:t.time_corrected??F,selected:!0,use_corrected:t.use_corrected??!1}];oe.length===0&&(oe=[{temperature:null,temperature_corrected:null,time:F,time_corrected:F,selected:!0,use_corrected:!1}]);const Z=oe.map((ie,I)=>{const V=ie.time||F,W=ie.time_corrected||V;return{temperature:D(ie.temperature??ie.temperature_raw),time:V,selected:I===0?!0:!!ie.selected,temperature_corrected:D(ie.temperature_corrected),time_corrected:W,use_corrected:!!ie.use_corrected}});Z.some(ie=>ie.selected)||(Z[0].selected=!0);const Se={isoDate:t.isoDate,measurements:Z,mucusSensation:t.mucus_sensation??t.mucusSensation??"",mucusAppearance:t.mucus_appearance??t.mucusAppearance??"",fertility_symbol:t.fertility_symbol??"none",observations:t.observations??"",ignored:t.ignored??!1,peak_marker:he?"peak":null},Le=t!=null&&t.id&&!String(t.id).startsWith("placeholder-")?t:null;await L(Se,Le,o.id)}catch(F){console.error("Error toggling peak marker:",F)}finally{$(!1)}},Q=async(t,{keepFormOpen:A=!1}={})=>{if(o!=null&&o.id){$(!0);try{if(await L(t,O,o.id),u){const D=await g(o.id);D&&S(D)}A||(te(!1),ne(null))}finally{$(!1)}}},de=()=>{te(!1),ne(null)},ye=t=>{ne(t)},pe=()=>{ae(t=>!t)},fe=t=>{if(t.preventDefault(),l.current){l.current=!1;return}pe()},ge=t=>{t.pointerType==="touch"&&(t.preventDefault(),l.current=!0,pe())},we=async()=>{if(_){try{await screen.orientation.unlock()}catch(t){console.error(t)}try{document.fullscreenElement&&await document.exitFullscreen()}catch(t){console.error(t)}p("portrait"),z(!1)}else try{await document.documentElement.requestFullscreen(),await screen.orientation.lock("landscape"),p("landscape"),z(!0)}catch(t){console.error(t)}};return e.jsx(Re,{hideBottomNav:_,children:e.jsxs("div",{className:_?"fixed inset-0 z-50 h-[100dvh] w-[100dvw] overflow-x-auto overflow-y-auto":"relative w-full overflow-x-auto overflow-y-auto",style:Y,children:[e.jsx(De,{onClick:fe,onPointerUp:ge,variant:"ghost",size:"icon",className:`absolute top-4 right-20 z-10 p-2 rounded-full transition-colors ${X?"bg-[#E27DBF] text-white hover:bg-[#d46ab3]":"bg-white/80 text-slate-700 hover:bg-[#E27DBF]/20"}`,children:X?e.jsx(ot,{className:"h-4 w-4"}):e.jsx(it,{className:"h-4 w-4"})}),e.jsx(De,{onClick:we,className:"absolute top-4 right-4 z-10 bg-white/80 hover:bg-white text-gray-700 p-2 rounded-full shadow","aria-label":_?"Salir de pantalla completa":"Rotar gráfico",children:e.jsx(at,{className:"w-5 h-5"})}),e.jsx(Lt,{data:d,isFullScreen:_,orientation:N,onToggleIgnore:B,onEdit:T,onTogglePeak:G,cycleId:o.id,initialScrollIndex:b,visibleDays:s,showInterpretation:X,reduceMotion:!0,forceLandscape:N==="landscape",currentPeakIsoDate:q}),e.jsx(rt,{open:ue,onOpenChange:t=>{t||de()},children:e.jsx(st,{hideClose:!0,className:"bg-transparent border-none p-0 text-gray-800 w-[90vw] sm:w-auto max-w-md sm:max-w-lg md:max-w-xl max-h-[85vh] overflow-y-auto",children:e.jsx(et,{onSubmit:Q,onCancel:de,initialData:O,cycleStartDate:o.startDate,cycleEndDate:o.endDate,isProcessing:H,isEditing:!!O&&!K,cycleData:o.data,onDateSelect:ye})})})]})})};export{Wt as default};
