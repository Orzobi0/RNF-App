import{r as o,j as t,M as G,B as b}from"./index-7fea14b0.js";import{g as J,R as K,F as Q}from"./generatePlaceholders-d43e9126.js";import{a as X,p as F,s as g,d as R}from"./useCycleData-321f2a4b.js";import{D as Z}from"./DataEntryForm-ad843356.js";import{D as ee,a as te}from"./dialog-5eeab027.js";import{E as ae}from"./eye-off-ec261603.js";import{E as ne}from"./eye-f4dacf7c.js";import"./ChartTooltip-478e06f3.js";import"./input-eebcb0c4.js";import"./label-b7675640.js";const pe=()=>{const{currentCycle:a,isLoading:j,addOrUpdateDataPoint:N,toggleIgnoreRecord:P}=X(),[l,w]=o.useState(typeof window<"u"&&window.innerWidth>window.innerHeight?"landscape":"portrait"),[r,x]=o.useState(!1),[M,h]=o.useState(!1),[f,c]=o.useState(null),[k,y]=o.useState(!1),[m,L]=o.useState(!1),p=o.useRef(!1);if(o.useLayoutEffect(()=>{window.dispatchEvent(new Event("resize"))},[l,r]),j)return t.jsx("p",{className:"text-center text-gray-500",children:"Cargando…"});if(!(a!=null&&a.id))return t.jsx("p",{className:"text-center text-pink-600",children:"No hay ciclo activo."});const O=28,B=10,d=F(a.startDate),D=a.data.reduce((e,n)=>{const s=F(n.isoDate);return s>e?s:e},d),v=g(new Date),T=D>v?D:v,z=R(g(T),d),i=Math.max(O,z+1),A=J(d,i).map(e=>{const n=a.data.find(s=>s.isoDate===e.isoDate);return n?{...n,date:e.date}:e}),u=l==="portrait"?B:i;let S=0;if(l!=="landscape"){const e=R(new Date,g(d)),n=Math.min(Math.max(e,0),i-1);let s=Math.min(i,n+1);n<u-1&&(s=Math.min(i,u)),S=Math.max(0,s-u)}const E={background:"linear-gradient(135deg, #FFFAFC 0%, #f7eaef 100%)"},U=r?E:{...E,height:l==="landscape"?"calc(min(100dvh, 100dvw) - var(--bottom-nav-safe))":"calc(100dvh - var(--bottom-nav-safe))",maxHeight:"100vh",paddingBottom:"env(safe-area-inset-bottom)"},_=e=>{c(e),h(!0)},Y=(e,n)=>{P(e,n)},H=async e=>{y(!0);try{await N(e,f),h(!1),c(null)}finally{y(!1)}},C=()=>{h(!1),c(null)},q=e=>{c(e)},I=()=>{L(e=>!e)},V=e=>{if(e.preventDefault(),p.current){p.current=!1;return}I()},W=e=>{e.pointerType==="touch"&&(e.preventDefault(),p.current=!0,I())},$=async()=>{if(r){try{await screen.orientation.unlock()}catch(e){console.error(e)}try{document.fullscreenElement&&await document.exitFullscreen()}catch(e){console.error(e)}w("portrait"),x(!1)}else try{await document.documentElement.requestFullscreen(),await screen.orientation.lock("landscape"),w("landscape"),x(!0)}catch(e){console.error(e)}};return t.jsx(G,{hideBottomNav:r,children:t.jsxs("div",{className:r?"fixed inset-0 z-50 h-[100dvh] w-[100dvw] overflow-x-auto overflow-y-auto":"relative w-full overflow-x-auto overflow-y-auto",style:U,children:[t.jsx(b,{onClick:V,onPointerUp:W,variant:"ghost",size:"icon",className:`absolute top-4 right-20 z-10 p-2 rounded-full transition-colors ${m?"bg-[#E27DBF] text-white hover:bg-[#d46ab3]":"bg-white/80 text-slate-700 hover:bg-[#E27DBF]/20"}`,children:m?t.jsx(ae,{className:"h-4 w-4"}):t.jsx(ne,{className:"h-4 w-4"})}),t.jsx(b,{onClick:$,className:"absolute top-4 right-4 z-10 bg-white/80 hover:bg-white text-gray-700 p-2 rounded-full shadow","aria-label":r?"Salir de pantalla completa":"Rotar gráfico",children:t.jsx(K,{className:"w-5 h-5"})}),t.jsx(Q,{data:A,isFullScreen:r,orientation:l,onToggleIgnore:Y,onEdit:_,cycleId:a.id,initialScrollIndex:S,visibleDays:u,showInterpretation:m,reduceMotion:!0,forceLandscape:l==="landscape"}),t.jsx(ee,{open:M,onOpenChange:e=>{e||C()},children:t.jsx(te,{hideClose:!0,className:"bg-transparent border-none p-0 text-gray-800 w-[90vw] sm:w-auto max-w-md sm:max-w-lg md:max-w-xl max-h-[85vh] overflow-y-auto",children:t.jsx(Z,{onSubmit:H,onCancel:C,initialData:f,cycleStartDate:a.startDate,cycleEndDate:a.endDate,isProcessing:k,isEditing:!!f,cycleData:a.data,onDateSelect:q})})})]})})};export{pe as default};
