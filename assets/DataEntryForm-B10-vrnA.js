import{Z as Ct,$ as St,a0 as Rt,c as ge,r as s,a1 as ot,a2 as Tt,a3 as Mt,a4 as Et,a5 as At,R as Ht,j as e,K as v,o as Z,f as O,k as g,B as W,W as Ot,m as ct,a6 as It,b as it,a as Ft,M as zt,N as Bt}from"./index-ByFXgX-t.js";import{L as je,I as Se}from"./label--L53Nrbo.js";import{b as Lt,c as Kt,d as Vt,e as $t,P as Pt,u as qt}from"./useBackClose-BFeNma-P.js";import{i as Ut,j as Yt,S as Gt,d as Wt,e as Qt,f as Xt,F as Zt,h as Jt,k as Je,l as Dt,C as er,m as Me}from"./computePeakStatuses-hwVxT-Am.js";import{T as Ue,D as Ye,P as Ae,C as De,a as tr,X as lt}from"./peak-mode-button-DTRv1E4U.js";import{l as et}from"./badge-CetW1kHg.js";import{E as tt,a as rr}from"./eye-CfXbXuuz.js";import{u as sr}from"./useCycleData-BwqH7MfP.js";var nr=36e5;function ar(d,n){Ct(2,arguments);var i=Rt(n);return St(d,i*nr)}const or=ge("CalendarDays",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]),cr=ge("CalendarPlus",[["path",{d:"M21 13V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8",key:"3spt84"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["line",{x1:"19",x2:"19",y1:"16",y2:"22",key:"1ttwzi"}],["line",{x1:"16",x2:"22",y1:"19",y2:"19",key:"1g9955"}]]),ir=ge("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),lr=ge("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),ur=ge("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]),dr=ge("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),rt=ge("Sprout",[["path",{d:"M7 20h10",key:"e6iznv"}],["path",{d:"M10 20c5.5-2.5.8-6.4 3-10",key:"161w41"}],["path",{d:"M9.5 9.4c1.1.8 1.8 2.2 2.3 3.7-2 .4-3.5.4-4.8-.3-1.2-.6-2.3-1.9-3-4.2 2.8-.5 4.4 0 5.5.8z",key:"9gtqwd"}],["path",{d:"M14.1 6a7 7 0 0 0-1.1 4c1.9-.1 3.3-.6 4.3-1.4 1-1 1.6-2.3 1.7-4.6-2.7.1-4 1-4.9 2z",key:"bkxnd2"}]]),st=ge("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);function ut(){const d=s.useRef(!1);return ot(()=>(d.current=!0,()=>{d.current=!1}),[]),d}function mr(){const d=ut(),[n,i]=s.useState(0),m=s.useCallback(()=>{d.current&&i(n+1)},[n]);return[s.useCallback(()=>Tt.postRender(m),[m]),n]}class fr extends s.Component{getSnapshotBeforeUpdate(n){const i=this.props.childRef.current;if(i&&n.isPresent&&!this.props.isPresent){const m=this.props.sizeRef.current;m.height=i.offsetHeight||0,m.width=i.offsetWidth||0,m.top=i.offsetTop,m.left=i.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function pr({children:d,isPresent:n}){const i=s.useId(),m=s.useRef(null),b=s.useRef({width:0,height:0,top:0,left:0});return s.useInsertionEffect(()=>{const{width:_,height:R,top:j,left:A}=b.current;if(n||!m.current||!_||!R)return;m.current.dataset.motionPopId=i;const M=document.createElement("style");return document.head.appendChild(M),M.sheet&&M.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${_}px !important;
            height: ${R}px !important;
            top: ${j}px !important;
            left: ${A}px !important;
          }
        `),()=>{document.head.removeChild(M)}},[n]),s.createElement(fr,{isPresent:n,childRef:m,sizeRef:b},s.cloneElement(d,{ref:m}))}const Ge=({children:d,initial:n,isPresent:i,onExitComplete:m,custom:b,presenceAffectsLayout:_,mode:R})=>{const j=Mt(hr),A=s.useId(),M=s.useMemo(()=>({id:A,initial:n,isPresent:i,custom:b,onExitComplete:p=>{j.set(p,!0);for(const w of j.values())if(!w)return;m&&m()},register:p=>(j.set(p,!1),()=>j.delete(p))}),_?void 0:[i]);return s.useMemo(()=>{j.forEach((p,w)=>j.set(w,!1))},[i]),s.useEffect(()=>{!i&&!j.size&&m&&m()},[i]),R==="popLayout"&&(d=s.createElement(pr,{isPresent:i},d)),s.createElement(Et.Provider,{value:M},d)};function hr(){return new Map}function br(d){return s.useEffect(()=>()=>d(),[])}const Ne=d=>d.key||"";function xr(d,n){d.forEach(i=>{const m=Ne(i);n.set(m,i)})}function gr(d){const n=[];return s.Children.forEach(d,i=>{s.isValidElement(i)&&n.push(i)}),n}const yr=({children:d,custom:n,initial:i=!0,onExitComplete:m,exitBeforeEnter:b,presenceAffectsLayout:_=!0,mode:R="sync"})=>{const j=s.useContext(At).forceRender||mr()[0],A=ut(),M=gr(d);let p=M;const w=s.useRef(new Map).current,E=s.useRef(p),C=s.useRef(new Map).current,B=s.useRef(!0);if(ot(()=>{B.current=!1,xr(M,C),E.current=p}),br(()=>{B.current=!0,C.clear(),w.clear()}),B.current)return s.createElement(s.Fragment,null,p.map(x=>s.createElement(Ge,{key:Ne(x),isPresent:!0,initial:i?void 0:!1,presenceAffectsLayout:_,mode:R},x)));p=[...p];const L=E.current.map(Ne),K=M.map(Ne),Q=L.length;for(let x=0;x<Q;x++){const S=L[x];K.indexOf(S)===-1&&!w.has(S)&&w.set(S,void 0)}return R==="wait"&&w.size&&(p=[]),w.forEach((x,S)=>{if(K.indexOf(S)!==-1)return;const J=C.get(S);if(!J)return;const G=L.indexOf(S);let I=x;if(!I){const h=()=>{w.delete(S);const $=Array.from(C.keys()).filter(q=>!K.includes(q));if($.forEach(q=>C.delete(q)),E.current=M.filter(q=>{const D=Ne(q);return D===S||$.includes(D)}),!w.size){if(A.current===!1)return;j(),m&&m()}};I=s.createElement(Ge,{key:Ne(J),isPresent:!1,onExitComplete:h,custom:n,presenceAffectsLayout:_,mode:R},J),w.set(S,I)}p.splice(G,0,I)}),p=p.map(x=>{const S=x.key;return w.has(S)?x:s.createElement(Ge,{key:Ne(x),isPresent:!0,presenceAffectsLayout:_,mode:R},x)}),s.createElement(s.Fragment,null,w.size?p:p.map(x=>s.cloneElement(x)))},dt=Ht.forwardRef(({className:d,...n},i)=>e.jsx("textarea",{className:v("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",d),ref:i,...n}));dt.displayName="Textarea";const be=Object.freeze({temperature:{key:"temperature",ariaLabel:"Alternar sección de temperatura",srLabel:"Temperatura"},moco:{key:"moco",ariaLabel:"Alternar sección de moco cervical",srLabel:"Moco cervical"},symbol:{key:"symbol",ariaLabel:"Alternar sección de símbolo de fertilidad",srLabel:"Símbolo de fertilidad"},sensation:{key:"sensation",ariaLabel:"Alternar sección de sensación del moco",srLabel:"Sensación del moco"},appearance:{key:"appearance",ariaLabel:"Alternar sección de apariencia del moco",srLabel:"Apariencia del moco"},observations:{key:"observations",ariaLabel:"Alternar sección de observaciones",srLabel:"Observaciones"}}),nt=(d,n,i)=>{const m=!!n;return m===!!i?null:d==="peak"?m?"Día pico: eliminado":"Día pico: seleccionado":m?"Sin Relaciones sexuales":"Con Relaciones sexuales"},vr=({peakTag:d,existingPeakIsoDate:n,selectedIsoDate:i})=>{const m=!!n,_=d==="peak"||!!(n&&i&&n===i);return{mode:_?"remove":m?"update":"assign",isPeakDay:_}},at="dataEntryForm:viewAll:global",Ee="__default__",xe={field:"rounded-3xl",dropdown:"rounded-3xl"},wr=({date:d,setDate:n,measurements:i,addMeasurement:m,updateMeasurement:b,removeMeasurement:_,confirmMeasurement:R,selectMeasurement:j,mucusSensation:A,setMucusSensation:M,mucusAppearance:p,setMucusAppearance:w,fertilitySymbol:E,setFertilitySymbol:C,observations:B,setObservations:L,hadRelations:K,setHadRelations:Q,ignored:x,setIgnored:S,peakTag:J,setPeakTag:G,existingPeakIsoDate:I,isProcessing:h,isEditing:$,cycleStartDate:q,cycleEndDate:D,recordedDates:se=[],submitCurrentState:ie,initialSectionKey:ye=null,onSyncTemperature:_e=()=>{},isSyncingTemperature:le=!1,canSyncTemperature:ve=!1,onOpenNewCycle:Ce=null})=>{const[Re,we]=s.useState(!1),[ee,ue]=s.useState(null),[U,de]=s.useState({peak:null,relations:null}),te=s.useRef(!1),me=s.useMemo(()=>[{...be.temperature,icon:Ue},{...be.moco,icon:Ye},{...be.observations,icon:Ae}],[]),He=s.useMemo(()=>[{...be.temperature,sectionKey:"temperature",icon:Ue},{...be.sensation,sectionKey:"moco",icon:Ye},{...be.appearance,sectionKey:"moco",icon:De},{...be.symbol,sectionKey:"moco",icon:rt},{...be.observations,sectionKey:"observations",icon:Ae}],[]),a=s.useMemo(()=>me.map(r=>r.key),[me]),[c,u]=s.useState(!1),[l,N]=s.useState(()=>a[0]??null),ne=s.useRef(null),fe=s.useRef(null),Y=s.useRef(null),re=s.useRef(!1),ke=s.useRef(!1),ae=s.useRef(new Map),H=s.useRef(null),F=s.useMemo(()=>c?a:l?[l]:[],[c,a,l]),oe=Z(O(q)),Ve=D?Z(O(D)):null,$e=Ve?[{before:oe},{after:Ve}]:[{before:oe}],f=d?g(d,"yyyy-MM-dd"):null,[pe,Te]=s.useState(0),Oe=s.useRef(null),Ie=s.useRef(null),ce=s.useCallback(r=>["symbol","sensation","appearance"].includes(r)?"moco":r,[]),mt=s.useCallback(r=>{r.key==="Enter"&&(r.preventDefault(),Oe.current?.focus())},[]),ft=s.useCallback(r=>{r.key==="Enter"&&(r.preventDefault(),Ie.current?.focus())},[]),Fe=s.useCallback(()=>{const r=ne.current;if(!r)return;const t=r.getBoundingClientRect(),o=parseFloat(getComputedStyle(r).top||"0"),k=Number.isNaN(o)?0:o;Te((t?.height||0)+k+12)},[]);s.useEffect(()=>{Fe();const r=new ResizeObserver(()=>Fe());ne.current&&r.observe(ne.current);const t=()=>Fe();return window.addEventListener("resize",t),window.addEventListener("orientationchange",t),()=>{r.disconnect(),window.removeEventListener("resize",t),window.removeEventListener("orientationchange",t)}},[Fe]);const ze=s.useCallback(()=>{typeof window>"u"||window.navigator?.vibrate&&window.navigator.vibrate(10)},[]),he=s.useCallback(r=>{const t=ce(r);if(!t)return;re.current=!1,N(k=>k===t?k:t);const o=f??Ee;ae.current.set(o,t)},[ce,f]),We=s.useRef(f);s.useEffect(()=>{We.current!==f&&(We.current=f,de({peak:null,relations:null}))},[f]),s.useEffect(()=>{if(typeof window>"u"||!U.peak&&!U.relations)return;const r=window.setTimeout(()=>{de({peak:null,relations:null})},4500);return()=>window.clearTimeout(r)},[U.peak,U.relations]),s.useEffect(()=>{if(!a.length){l!==null&&N(null);return}if(l&&a.includes(l))return;if(!c&&re.current){l!==null&&N(null);return}const r=f??Ee,t=ce(ae.current.get(r)),o=t&&a.includes(t)&&t||a[0]||null;if(!o){l!==null&&N(null);return}he(o)},[l,c,ce,he,a,f]);const Be=s.useCallback(r=>{if(typeof window>"u"||!r)return;const t=fe.current;if(!t)return;const o=t.querySelector(`[data-section="${r}"]`);if(!(o instanceof HTMLElement))return;const k=()=>o.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"});"requestAnimationFrame"in window?requestAnimationFrame(()=>requestAnimationFrame(k)):setTimeout(k,50)},[]);s.useEffect(()=>{if(typeof window>"u")return;const r=Y.current;if(!r)return;Y.current=null;const t=window.setTimeout(()=>{Be(r)},80);return()=>window.clearTimeout(t)},[F,Be]);const Le=s.useCallback(r=>{const t=ce(r);if(t){if(ze(),c){Y.current=t,he(t),Be(t);return}N(o=>{if(o===t)return re.current=!0,Y.current=null,null;re.current=!1,Y.current=t;const k=f??Ee;return ae.current.set(k,t),t})}},[c,ce,he,Be,f,ze]),pt=s.useCallback((r,t)=>{t&&(r.pointerType==="touch"?(ke.current=!0,Le(t)):ke.current=!1)},[Le]),ht=s.useCallback(r=>{if(r){if(ke.current){ke.current=!1;return}Le(r)}},[Le]),bt=s.useCallback(()=>{ze();const r=!c;r&&(re.current=!1),u(r);const t=f??Ee,k=ce(ae.current.get(t))??l??a[0];if(r){Y.current=k;return}const z=k??a[0];he(z),Y.current=z},[l,c,he,a,f,ze]);s.useEffect(()=>{if(te.current=!1,re.current=!1,!a.length){N(V=>V===null?V:null);return}const r=f??Ee,t=ce(ae.current.get(r)),o=t&&a.includes(t),z=H.current!==f;H.current=f;const T=ce(ye),X=!!(T&&a.includes(T))&&(z||T!==t);let P=null;if(X?(P=T,te.current=!0):o?P=t:P=a[0],!P){N(V=>V===null?V:null);return}ae.current.set(r,P),N(V=>V===P?V:P),Y.current=P},[d,a,f,ye,ce]),s.useEffect(()=>{if(!(typeof window>"u"))try{const r=window.localStorage.getItem(at);u(r==="true")}catch{u(!1)}},[]),s.useEffect(()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(at,c?"true":"false")}catch{}},[c]),s.useEffect(()=>{if(ee!==null)return;const r=i.findIndex(t=>t?!!t.use_corrected:!1);r!==-1&&ue(r)},[ee,i]);const Qe=(r,t)=>{const o=parseFloat(i[r].temperature??0),z=(parseFloat(i[r].temperature_corrected??o)+t).toFixed(2);b(r,"temperature_corrected",z);const T=parseFloat(z)-o,y=Math.round(T*10),X=i[r].time||"00:00",P=It(X,"HH:mm",new Date),V=g(ar(P,y),"HH:mm");b(r,"time_corrected",V),i[r].use_corrected||b(r,"use_corrected",!0)},{mode:Pe,isPeakDay:Ke}=vr({peakTag:J,existingPeakIsoDate:I,selectedIsoDate:f}),xt=(()=>{if(!f||!d)return"Selecciona una fecha para marcar el día pico";const r=g(d,"dd/MM/yyyy"),t=I?g(O(I),"dd/MM/yyyy"):null;return Pe==="assign"?`Marcar día pico en ${r}`:Pe==="update"?t?`Mover día pico a ${r} (desde ${t})`:`Mover día pico a ${r}`:t?`Quitar día pico del ${t}`:"Quitar día pico"})(),gt=async()=>{if(h||typeof ie!="function"||!f)return;const r=Ke?null:"peak";G(r);try{await ie({peakTagOverride:r,keepFormOpen:!0,skipReset:!0});const t=nt("peak",Ke,r==="peak");t&&de(o=>({...o,peak:t}))}catch{G(Ke?"peak":null)}},yt=r=>{S(r===!0)},vt=(r,t)=>{const o=t===!0;b(r,"use_corrected",o),!o&&ee===r&&ue(null)},wt=v("focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-transparent focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-transparent disabled:cursor-not-allowed disabled:opacity-60",K?"text-rose-600":"text-slate-600"),kt=v("inline-flex items-center gap-1 rounded-full border border-amber-200 bg-white/70 px-3 py-1 text-[11px] font-semibold uppercase tracking-wide text-amber-700 shadow-sm transition-colors",ve&&!le?"hover:bg-amber-50":"cursor-not-allowed opacity-60"),jt=async()=>{if(h||typeof ie!="function"||!f)return;const r=K,t=!r;Q(t);try{await ie({overrideHadRelations:t,keepFormOpen:!0,skipReset:!0});const o=nt("relations",r,t);o&&de(k=>({...k,relations:o}))}catch{Q(r)}},Xe=s.useMemo(()=>{const r=i.some(y=>{if(!y)return!1;const X=y.temperature,P=y.temperature_corrected;return[X,P].some(V=>V==null?!1:String(V).trim()!=="")}),t=(()=>{if(typeof E=="string"){const y=E.trim();return y?y!=="none":!1}return!!E})(),o=!!(A&&A.trim()),k=!!(p&&p.trim()),z=!!(B&&B.trim()),T=t||o||k;return{section:{temperature:r,moco:T,observations:z},dock:{temperature:r,symbol:t,sensation:o,appearance:k,observations:z,moco:T}}},[E,i,p,A,B]),qe=Xe.section,Nt=Xe.dock;s.useEffect(()=>{if(!$){te.current=!1;return}if(te.current)return;const r=a.filter(o=>qe[o]);if(r.length===0){te.current=!0;return}const t=r.includes(l)?l:r[0];he(t),Y.current=t,te.current=!0},[l,qe,$,he,a]),s.useEffect(()=>{$||(te.current=!1)},[$]);const Ze=s.useMemo(()=>{const r=Ut(E);return{temperature:{activeBorder:"border-temp",activeBg:"bg-temp-suave",activeText:"text-temp",filledText:"text-temp",idleText:"text-suave",focusRing:"ring-temp"},moco:{activeBorder:"border-moco",activeBg:"bg-moco-suave",activeText:"text-moco",filledText:"text-moco",idleText:"text-moco-suave",focusRing:"ring-moco"},symbol:r,sensation:{activeBorder:"border-sensacion",activeBg:"bg-sensacion-suave",activeText:"text-sensacion",filledText:"text-sensacion",idleText:"text-suave",focusRing:"ring-sensacion"},appearance:{activeBorder:"border-apariencia",activeBg:"bg-apariencia-suave",activeText:"text-apariencia",filledText:"text-apariencia",idleText:"text-suave",focusRing:"ring-apariencia"},observations:{activeBorder:"border-observaciones",activeBg:"bg-observaciones-suave",activeText:"text-observaciones",filledText:"text-observaciones",idleText:"text-suave",focusRing:"ring-observaciones"}}},[E]),_t=r=>{switch(r){case"temperature":return e.jsxs("div",{className:"space-y-3 rounded-3xl border border-temp bg-temp-suave p-3 shadow-sm",children:[i.map((t,o)=>{const k=`measurement_select_${o}`,z=ee===o,T=!!t.use_corrected;return e.jsxs("div",{className:v("space-y-3 rounded-3xl border bg-white/70 p-3 transition-colors",t.selected&&x?"border-[#3A2430]/30 bg-[#e6d4dd]/40":"border-amber-200/60"),children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs(je,{className:"flex items-center text-amber-800 text-sm font-semibold",children:[e.jsx(Ue,{className:"mr-2 h-5 w-5 text-orange-500"}),"Medición ",o+1]}),e.jsxs("label",{htmlFor:k,className:v("flex items-center gap-2 rounded-full border px-2 py-1 text-[10px] font-semibold uppercase tracking-wide shadow-sm",t.selected&&x?"border-[#3A2430]/30 bg-[#e6d4dd]/70 text-[#3A2430]":"border-amber-200 bg-amber-50/70 text-amber-700"),children:[e.jsx("input",{id:k,type:"radio",checked:t.selected,onChange:()=>j(o),disabled:h,className:"h-3 w-3 text-orange-500 focus:ring-orange-400"}),e.jsx("span",{children:"gráfica"}),t.selected&&x&&e.jsx(tt,{className:"h-3 w-3","aria-hidden":"true"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(Se,{"data-field":o===0?"temperature":void 0,type:"number",step:"0.01",min:"34.0",max:"40.0",value:t.temperature,onChange:y=>b(o,"temperature",y.target.value),onInput:y=>b(o,"temperature",y.target.value),placeholder:"36.50",className:v("bg-white/70 border-amber-200 text-amber-800 font-semibold placeholder-gray-400 focus:border-orange-500 focus:ring-orange-500 ",xe.field),disabled:h}),e.jsx(Se,{"data-field":o===0?"time":void 0,type:"time",value:t.time,onChange:y=>b(o,"time",y.target.value),className:v("bg-white/70 border-amber-200 text-gray-600 font-semibold placeholder-gray-400 focus:border-orange-500 focus:ring-orange-500",xe.field),disabled:h})]}),e.jsx("div",{className:"mt-3 flex flex-wrap items-center justify-between gap-2",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(W,{type:"button",size:"xs",variant:"outline",disabled:h,"aria-pressed":ee===o,className:v("rounded-full border px-3 py-1 text-xs font-semibold transition-colors",z?"border-amber-500 bg-amber-600 text-white shadow-inner hover:bg-amber-600":T?"border-amber-400 bg-amber-200/80 text-amber-900 hover:bg-amber-200":"border-amber-200 bg-white/70 text-amber-700 hover:bg-amber-50"),onClick:()=>{ee===o?ue(null):(ue(o),(t.temperature_corrected===""||t.temperature_corrected===void 0)&&b(o,"temperature_corrected",t.temperature),t.time_corrected||b(o,"time_corrected",t.time))},children:[T?e.jsx(Je,{className:"mr-1 h-3.5 w-3.5","aria-hidden":"true"}):e.jsx(Ae,{className:"mr-1 h-3.5 w-3.5","aria-hidden":"true"}),T?"Corregida":"Corregir"]}),$&&!!t.temperature&&e.jsx(W,{type:"button",size:"icon",variant:"outline",disabled:h||!t.selected,onClick:()=>yt(!x),className:v("h-9 w-9 rounded-full border transition-colors",!t.selected&&"opacity-40 cursor-not-allowed",t.selected&&x?"border-[#3A2430] bg-[#3A2430] text-white shadow-sm ring-2 ring-[#e6d4dd]":"border-amber-200 bg-white/80 text-amber-700 hover:bg-amber-50"),"aria-pressed":t.selected?x:!1,title:t.selected?x?"Restaurar":"Despreciar":"Selecciona esta medición para la gráfica","aria-label":t.selected?x?"Restaurar medición despreciada":"Despreciar medición de la gráfica":"Selecciona esta medición para la gráfica",children:t.selected&&x?e.jsx(tt,{className:"h-4 w-4"}):e.jsx(rr,{className:"h-4 w-4"})}),!t.confirmed&&e.jsxs(e.Fragment,{children:[e.jsx(W,{type:"button",size:"icon",onClick:()=>R(o),disabled:h,className:"h-7 w-7 bg-green-600","aria-label":"Confirmar medición",children:e.jsx(Je,{className:"h-4 w-4"})}),e.jsx(W,{type:"button",size:"icon",onClick:()=>_(o),disabled:h,className:"h-9 w-9 rounded-full bg-rose-600 text-white hover:bg-rose-700 shadow-sm","aria-label":"Eliminar medición",children:e.jsx(st,{className:"h-4 w-4"})})]}),t.confirmed&&$&&(()=>{const y=String(t.temperature??"").trim()===""&&String(t.temperature_corrected??"").trim()==="";return i.length>1||y?e.jsx(W,{type:"button",size:"icon",onClick:()=>_(o),disabled:h,className:"h-9 w-9 rounded-full bg-rose-600 text-white hover:bg-rose-700 shadow-sm","aria-label":"Eliminar medición",children:e.jsx(st,{className:"h-4 w-4"})}):null})()]})}),ee===o&&e.jsxs("div",{className:"mt-2 space-y-2 rounded-3xl border border-temp bg-white/80 p-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(Se,{type:"number",step:"0.01",min:"34.0",max:"40.0",value:t.temperature_corrected,onChange:y=>{const X=y.target.value;b(o,"temperature_corrected",X),t.use_corrected||b(o,"use_corrected",!0)},className:v("bg-white/70 border-amber-200 placeholder-gray-400 focus:border-orange-500 focus:ring-orange-500 text-orange-700 font-semibold",xe.field),disabled:h}),e.jsx(W,{type:"button",size:"icon",variant:"outline",disabled:h,onClick:()=>Qe(o,.1),"aria-label":"Aumentar temperatura corregida",children:e.jsx(ir,{className:"h-4 w-4"})}),e.jsx(W,{type:"button",size:"icon",variant:"outline",disabled:h,onClick:()=>Qe(o,-.1),"aria-label":"Disminuir temperatura corregida",children:e.jsx(Dt,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(lr,{className:"h-4 w-4 text-orange-500"}),e.jsx(Se,{type:"time",value:t.time_corrected,onChange:y=>b(o,"time_corrected",y.target.value),className:"bg-white/70 border-amber-200 text-gray-800 focus:border-orange-500 focus:ring-orange-500",disabled:h})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(er,{id:`use_corrected_${o}`,checked:t.use_corrected,onCheckedChange:y=>vt(o,y)}),e.jsx(je,{htmlFor:`use_corrected_${o}`,className:"text-xs",children:"Usar valor corregido"})]})]})]},o)}),e.jsxs(W,{type:"button",onClick:m,disabled:h,size:"xs",variant:"outline",className:"ml-auto flex items-center gap-1 rounded-full border-amber-300/50 bg-amber-50/80 px-3 py-2 text-xs text-amber-600 shadow-sm transition-colors hover:bg-amber-100","aria-label":"Añadir una nueva medición",children:[e.jsx(Pt,{className:"h-3 w-3"}),"Medición"]})]});case"moco":{const t=Yt(E);return e.jsxs("div",{className:"space-y-3 rounded-3xl bg-moco-suave p-3 shadow-xs",children:[e.jsxs("div",{className:"space-y-2 rounded-3xl bg-white/80 border border-sensacion p-3 shadow-sm",children:[e.jsxs(je,{htmlFor:"mucusSensation",className:"flex items-center text-slate-800 text-sm font-semibold",children:[e.jsx(Ye,{className:"mr-2 h-5 w-5 text-sensacion"}),"Sensación del moco"]}),e.jsx(Se,{"data-field":"mucusSensation",id:"mucusSensation",value:A,onChange:o=>M(o.target.value),onKeyDown:mt,className:v("bg-white/70 border-sensacion text-gray-800 placeholder-gray-400 focus:border-sensacion ring-sensacion focus:ring-2 font-semibold text-sensacion-fuerte",xe.field),disabled:h})]}),e.jsxs("div",{className:"space-y-2 rounded-3xl bg-white/80 p-3 border border-apariencia shadow-sm",children:[e.jsxs(je,{htmlFor:"mucusAppearance",className:"flex items-center text-slate-800 text-sm font-semibold",children:[e.jsx(De,{className:"mr-2 h-5 w-5 text-apariencia"}),"Apariencia del moco"]}),e.jsx(Se,{"data-field":"mucusAppearance",id:"mucusAppearance",value:p,onChange:o=>w(o.target.value),onKeyDown:ft,ref:Oe,className:v("bg-white/70 border-apariencia text-gray-800 placeholder-gray-400 focus:border-apariencia focus:ring-apariencia font-semibold text-apariencia-fuerte",xe.field),disabled:h})]}),e.jsx("div",{className:v("space-y-3 rounded-3xl border bg-gradient-to-r p-3 shadow-sm transition-colors duration-300",t.panelBorder,t.panelBackground),children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs(je,{htmlFor:"fertilitySymbol",className:"flex items-center text-slate-800 text-sm font-semibold",children:[e.jsx(rt,{className:v("mr-2 h-5 w-5 transition-colors duration-300",t.icon)}),"Símbolo de Fertilidad"]}),e.jsxs(Gt,{value:E,onValueChange:C,disabled:h,children:[e.jsx(Wt,{ref:Ie,className:v("w-full border bg-white text-gray-800 transition-colors duration-200",t.triggerBorder,t.triggerHover,t.triggerActive,t.triggerFocus,xe.field),"data-field":"fertilitySymbol",children:e.jsx(Qt,{placeholder:"Selecciona un símbolo"})}),e.jsx(Xt,{className:v("bg-white text-gray-800",t.contentBorder,xe.dropdown),children:Zt.map(o=>e.jsx(Jt,{value:o.value,className:"cursor-pointer rounded-3xl",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:v("mr-2 h-4 w-4 rounded-full border border-gray-300",o.pattern==="spotting-pattern"?"spotting-pattern-icon":o.color)}),o.label]})},o.value))})]})]})})]})}case"observations":return e.jsxs("div",{className:"space-y-2 rounded-3xl border border-observaciones bg-observaciones-suave p-3 shadow-sm",children:[e.jsxs(je,{htmlFor:"observations",className:"flex items-center text-slate-800 text-sm font-semibold",children:[e.jsx(Ae,{className:"mr-2 h-5 w-5 text-observaciones"}),"Observaciones"]}),e.jsx(dt,{"data-field":"observations",id:"observations",value:B,onChange:t=>L(t.target.value),className:v("min-h-[40px] resize-none bg-white/70 border-observaciones text-gray-800 placeholder-gray-400 focus:border-observaciones focus:ring-observaciones font-semibold text-observaciones-fuerte",xe.field),disabled:h})]});default:return null}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"col-span-3 space-y-2 rounded-3xl border border-fertiliapp bg-tarjeta p-3",children:[e.jsxs(je,{htmlFor:"date",className:"relative flex items-center text-titulo text-sm font-semibold pr-16",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(or,{className:"mr-2 h-5 w-5 text-titulo"}),"Fecha del Registro"]}),e.jsxs(W,{type:"button",variant:"ghost",size:"sm",onClick:()=>Ce?.(f),disabled:h||!f||typeof Ce!="function",className:"absolute right-0 top-1/2 h-8 -translate-y-1/2 rounded-full px-2 text-[10px] font-semibold text-fertiliapp-fuerte hover:bg-fertiliapp-suave/50","aria-label":"Iniciar nuevo ciclo",children:[e.jsx(cr,{className:"mr-1 h-5 w-5"}),e.jsxs("span",{className:"flex flex-col leading-[12px] text-left",children:[e.jsx("span",{children:"Nuevo"}),e.jsx("span",{children:"ciclo"})]})]})]}),e.jsxs(Lt,{open:Re,onOpenChange:we,children:[e.jsx(Kt,{asChild:!0,children:e.jsx(W,{variant:"outline",className:v("w-full justify-start text-left font-normal bg-white/70 border-fertiliapp-suave text-gray-800 hover:bg-white/70 hover:text-gray-800",!d&&"text-muted-foreground"),disabled:h,children:d?g(d,"PPP",{locale:et}):e.jsx("span",{children:"Selecciona una fecha"})})}),e.jsx(Vt,{className:"w-auto p-0 bg-white border-pink-200 text-gray-800 rounded-3xl",align:"start",children:e.jsx($t,{mode:"single",selected:d,onSelect:r=>{if(!r){we(!1);return}n(Z(r)),we(!1)},initialFocus:!0,locale:et,disabled:h?()=>!0:$e,modifiers:{hasRecord:se},modifiersClassNames:{hasRecord:'relative after:content-["" ] after:absolute after:inset-x-0 after:bottom-1 after:mx-auto after:w-1.5 after:h-1.5 after:rounded-full after:bg-fertiliapp-fuerte'},className:"[&_button]:text-gray-800 [&_button:hover]:bg-fertiliapp-suave [&_button[aria-selected=true]]:bg-fertiliapp-fuerte [&_button[aria-selected=true]]:text-white [&_button[aria-disabled=true]]:text-gray-400"})})]})]})}),e.jsx("div",{className:"mt-2",children:e.jsxs("div",{ref:ne,className:v("sticky top-4 z-20 flex w-full items-center gap-2 rounded-3xl border border-pink-200/70 bg-white/80 px-2 py-2 shadow-sm transition-opacity duration-200 backdrop-blur supports-[backdrop-filter]:backdrop-blur-lg sm:top-6",c?"opacity-80":"opacity-100"),children:[e.jsx("div",{className:"flex flex-1 items-center gap-1 sm:gap-2",children:He.map(r=>{const t=r.icon,o=r.sectionKey,k=F.includes(o),z=!c&&k,T=Ze[r.key]||Ze[o]||{},y=Nt[r.key]??qe[o],X=T.idleText??"text-slate-500",P=T.filledText??X;return e.jsxs("button",{type:"button",onPointerDown:V=>pt(V,o),onClick:()=>ht(o),className:v("flex h-11 w-11 items-center justify-center rounded-full border-2 transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 touch-manipulation",T.focusRing,z?v("shadow-inner scale-105",T.activeBorder,T.activeBg,T.activeText):v("border-transparent bg-transparent hover:bg-slate-100",y?P:X),!z&&c&&"opacity-70","min-h-[44px] min-w-[44px]"),"aria-label":r.ariaLabel,"aria-expanded":k,"aria-controls":`${o}-panel`,"data-active":z,children:[e.jsx(t,{className:v("h-5 w-5 transition-colors duration-200",z?T.activeText:y?P:X),"aria-hidden":"true"}),e.jsx("span",{className:"sr-only",children:r.srLabel})]},r.key)})}),e.jsxs("button",{type:"button",onClick:bt,className:v("ml-auto inline-flex min-h-[32px] min-w-[32px] items-center justify-center rounded-full border px-3 text-xs font-semibold uppercase tracking-wide transition-all duration-200","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-pink-200",c?"border-pink-200 bg-pink-50/80 text-pink-600 shadow-inner":"border-slate-300 bg-transparent text-slate-500 hover:border-slate-400 hover:text-slate-700"),"aria-pressed":c,"aria-label":c?"Compactar secciones":"Ver todas las secciones",children:[e.jsx("span",{className:"text-lg leading-none","aria-hidden":"true",children:c?"⇤":"⇵"}),e.jsx("span",{className:"sr-only",children:c?"Compactar":"Todo"})]})]})}),e.jsxs("div",{className:"mt-2 space-y-1 px-2 sm:px-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx(tr,{mode:Pe,size:"md",onClick:gt,"aria-pressed":Ke,"aria-label":xt,disabled:h||!f}),ve&&e.jsxs("button",{type:"button",className:kt,onClick:_e,disabled:h||le||!ve,"aria-label":"Sincronizar temperaturas",children:[e.jsx(ur,{className:"h-3.5 w-3.5","aria-hidden":"true"}),le?"Sincronizando...":"+ temperatura"]}),e.jsxs("button",{type:"button",className:wt,onClick:jt,disabled:h||!f,"aria-pressed":K,"aria-label":K?"Desmarcar relaciones sexuales":"Marcar relaciones sexuales",children:[e.jsx(Ot,{className:v("h-4 w-4",K?"text-rose-500 fill-current":"text-slate-400"),"aria-hidden":"true"}),e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide",children:"RS"})]})]}),(I||U.peak||U.relations)&&e.jsxs("div",{className:"mt-1 grid grid-cols-[1fr_auto] items-start gap-2 text-[11px]",children:[e.jsxs("div",{className:"min-w-0",children:[I&&e.jsx("div",{className:"text-slate-500",children:`Día pico: ${g(O(I),"dd/MM")}`}),U.peak&&e.jsx("div",{className:"font-medium text-rose-600",role:"status","aria-live":"polite",children:U.peak})]}),e.jsx("div",{className:"text-right",children:U.relations&&e.jsx("div",{className:"font-medium text-rose-600",role:"status","aria-live":"polite",children:U.relations})})]})]}),e.jsx("div",{className:"mt-2",ref:fe,children:e.jsx(yr,{initial:!1,children:me.filter(r=>F.includes(r.key)).map(r=>e.jsx(ct.div,{style:{scrollMarginTop:pe},id:`${r.key}-panel`,"data-section":r.key,initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.18,ease:"easeInOut"},className:"overflow-hidden",children:e.jsx("div",{className:"pt-2",children:_t(r.key)})},r.key))})})]})},kr=({onCancel:d,isProcessing:n,isEditing:i})=>e.jsxs("div",{className:"flex space-x-3 pt-2",children:[d&&e.jsxs(W,{type:"button",onClick:d,variant:"outline",className:"w-full rounded-3xl border-pink-200 bg-white/70 text-gray-700 hover:bg-alerta font-semibold py-2.5 text-sm",disabled:n,children:[e.jsx(lt,{className:"mr-2 h-5 w-5"}),"Cancelar"]}),e.jsxs(W,{type:"submit",className:"w-full rounded-3xl bg-ok hover:bg-ok-fuerte text-white font-semibold py-2.5 text-sm shadow-md hover:shadow-lg transition-all duration-300 transform hover:scale-102",disabled:n,children:[n?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}):e.jsx(dr,{className:"mr-2 h-5 w-5"}),i?"Actualizar":"Guardar"]})]}),jr=(d,n,i,m,b,_=[],R,j)=>{const A=(a={})=>{const c=g(new Date,"HH:mm");return{temperature:"",time:c,selected:!0,temperature_corrected:"",time_corrected:c,use_corrected:!1,confirmed:!0,...a}},M=()=>{if(n?.isoDate)return O(n.isoDate);if(j){const N=Z(O(j));if(!Number.isNaN(N.getTime()))return N}const a=Z(new Date),c=m?Z(O(m)):null,u=b?Z(O(b)):null;let l=a;return c&&l<c&&(l=c),u&&l>u&&(l=u),l},[p,w]=s.useState(M),[E,C]=s.useState(()=>{if(Array.isArray(n?.measurements)&&n.measurements.length>0){const a=n.measurements.map(c=>({temperature:c.temperature??"",time:c.time||g(new Date,"HH:mm"),selected:!!c.selected,temperature_corrected:c.temperature_corrected??"",time_corrected:c.time_corrected||c.time||g(new Date,"HH:mm"),use_corrected:!!c.use_corrected,confirmed:!0}));return a.some(c=>c.selected)||(a[0].selected=!0),a}return[A({temperature:n?.temperature_raw===null||n?.temperature_raw===void 0?"":String(n.temperature_raw),temperature_corrected:n?.temperature_corrected===null||n?.temperature_corrected===void 0?"":String(n.temperature_corrected),time:n?.timestamp?g(O(n.timestamp),"HH:mm"):g(new Date,"HH:mm"),time_corrected:n?.timestamp?g(O(n.timestamp),"HH:mm"):g(new Date,"HH:mm"),use_corrected:!!n?.use_corrected})]}),[B,L]=s.useState(n?.mucusSensation??n?.mucus_sensation??""),[K,Q]=s.useState(n?.mucusAppearance??n?.mucus_appearance??""),[x,S]=s.useState(n?.fertility_symbol||Me.NONE.value),[J,G]=s.useState(n?.observations||""),[I,h]=s.useState(n?.hadRelations??n?.had_relations??!1),[$,q]=s.useState(n?.ignored||!1),[D,se]=s.useState(n?.peak_marker==="peak"?"peak":null),ie=s.useMemo(()=>_.find(c=>c?.peak_marker==="peak")?.isoDate||null,[_]),{toast:ye}=it(),_e=s.useRef(n),le=s.useRef(j);s.useEffect(()=>{const a=!!_e.current,c=le.current!==j;if(_e.current=n,le.current=j,n){if(w(O(n.isoDate)),Array.isArray(n.measurements)&&n.measurements.length>0){const u=n.measurements.map(l=>({temperature:l.temperature??"",time:l.time||g(new Date,"HH:mm"),selected:!!l.selected,temperature_corrected:l.temperature_corrected??"",time_corrected:l.time_corrected||l.time||g(new Date,"HH:mm"),use_corrected:!!l.use_corrected,confirmed:!0}));u.some(l=>l.selected)||(u[0].selected=!0),C(u)}else C([A({temperature:n?.temperature_raw===null||n?.temperature_raw===void 0?"":String(n.temperature_raw),temperature_corrected:n?.temperature_corrected===null||n?.temperature_corrected===void 0?"":String(n.temperature_corrected),time:n?.timestamp?g(O(n.timestamp),"HH:mm"):g(new Date,"HH:mm"),time_corrected:n?.timestamp?g(O(n.timestamp),"HH:mm"):g(new Date,"HH:mm"),use_corrected:!!n?.use_corrected})]);L(n.mucusSensation??n.mucus_sensation??""),Q(n.mucusAppearance??n.mucus_appearance??""),S(n.fertility_symbol||Me.NONE.value),h(n.hadRelations??n.had_relations??!1),G(n.observations||""),q(n.ignored||!1),se(n.peak_marker==="peak"?"peak":null)}else C([A()]),L(""),Q(""),S(Me.NONE.value),G(""),h(!1),q(!1),se(null),(!a||c)&&w(M())},[n,j]),s.useEffect(()=>{if(n)return;const a=m?Z(O(m)):null,c=b?Z(O(b)):null;w(u=>{if(!u)return M();let l=u;return a&&l<a&&(l=a),c&&l>c&&(l=c),l})},[m,b,n]),s.useEffect(()=>{if(!R)return;const a=g(p,"yyyy-MM-dd"),c=_.find(u=>u.isoDate===a);R(c||null),c&&se(c.peak_marker==="peak"?"peak":null)},[p,_,R]);const ve=()=>{C(a=>{const c=g(new Date,"HH:mm");return a.length?[...a,A({temperature:a[a.length-1]?.temperature||"",time:c,time_corrected:c,selected:!1,confirmed:!1})]:[A({time:c,time_corrected:c,confirmed:!1})]})},Ce=a=>{C(c=>{const u=c.filter((l,N)=>N!==a);return u.length?(u.some(l=>l.selected)||(u[0]={...u[0],selected:!0}),u):[A()]})},Re=a=>{C(c=>{const u=[...c];return u[a]={...u[a],confirmed:!0},u})},we=(a,c,u)=>{C(l=>{const N=[...l];return N[a]={...N[a],[c]:u},N})},ee=a=>{C(c=>c.map((u,l)=>({...u,selected:l===a})))},ue=(a={})=>{const{overrideMeasurements:c,overrideIgnored:u,peakTagOverride:l,overrideHadRelations:N}=a;if(!p)return ye({title:"Error",description:"La fecha es obligatoria.",variant:"destructive"}),null;const ne=Z(O(m)),fe=b?Z(O(b)):null;if(p<ne||fe&&p>fe)return ye({title:"Error",description:"La fecha debe estar dentro del ciclo.",variant:"destructive"}),null;const Y=g(p,"yyyy-MM-dd"),re=f=>{if(f==null||f==="")return null;const pe=parseFloat(String(f).replace(",","."));return Number.isFinite(pe)?pe:null},ae=Object.prototype.hasOwnProperty.call(a,"peakTagOverride")?l:D,H=Array.isArray(c)?c:E,F=f=>{if(!f)return!1;const pe=f.temperature,Te=f.temperature_corrected,Oe=pe==null?"":String(pe).trim(),Ie=Te==null?"":String(Te).trim();return Oe!==""||Ie!==""},oe=H.filter(F),$e=Object.prototype.hasOwnProperty.call(a,"overrideHadRelations")?!!N:I;return{isoDate:Y,measurements:oe.map(f=>({temperature:re(f.temperature),time:f.time,selected:f.selected,temperature_corrected:re(f.temperature_corrected),time_corrected:f.time_corrected,use_corrected:!!f.use_corrected})),mucusSensation:B,mucusAppearance:K,fertility_symbol:x,observations:J,had_relations:$e,ignored:Object.prototype.hasOwnProperty.call(a,"overrideIgnored")?!!u:$,peak_marker:ae==="peak"?"peak":null}},U=()=>({isoDate:p?g(p,"yyyy-MM-dd"):null,measurements:E,mucusSensation:B,mucusAppearance:K,fertility_symbol:x,observations:J,had_relations:I,ignored:$,peak_marker:D==="peak"?"peak":null}),de=s.useCallback(a=>{if(a){if(a.isoDate){const c=Z(O(a.isoDate));Number.isNaN(c.getTime())||w(c)}if(Array.isArray(a.measurements)&&a.measurements.length>0){const c=a.measurements.map((u,l)=>({temperature:u.temperature??"",time:u.time||g(new Date,"HH:mm"),selected:l===0?!0:!!u.selected,temperature_corrected:u.temperature_corrected??"",time_corrected:u.time_corrected||u.time||g(new Date,"HH:mm"),use_corrected:!!u.use_corrected,confirmed:!0}));c.some(u=>u.selected)||(c[0].selected=!0),C(c)}L(a.mucusSensation??a.mucus_sensation??""),Q(a.mucusAppearance??a.mucus_appearance??""),S(a.fertility_symbol||Me.NONE.value),G(a.observations||""),h(!!(a.had_relations??a.hadRelations??!1)),q(!!a.ignored),se(a.peak_marker==="peak"?"peak":null)}},[]),te=()=>{w(M()),C([{temperature:"",time:g(new Date,"HH:mm"),selected:!0,temperature_corrected:"",time_corrected:g(new Date,"HH:mm"),use_corrected:!1,confirmed:!0}]),L(""),Q(""),S(Me.NONE.value),G(""),h(!1),se(null)},me=(a={})=>{const{keepFormOpen:c=!1,skipReset:u=!1,...l}=a,N=ue(l);if(!N)return null;const ne=d(N,{keepFormOpen:c,skipReset:u});return!i&&!u&&te(),ne};return{date:p,setDate:w,measurements:E,addMeasurement:ve,updateMeasurement:we,selectMeasurement:ee,removeMeasurement:Ce,confirmMeasurement:Re,mucusSensation:B,setMucusSensation:L,mucusAppearance:K,setMucusAppearance:Q,fertilitySymbol:x,setFertilitySymbol:S,observations:J,setObservations:G,ignored:$,setIgnored:q,peakTag:D,setPeakTag:se,existingPeakIsoDate:ie,handleSubmit:a=>(a&&typeof a.preventDefault=="function"&&a.preventDefault(),me()),submitCurrentState:me,buildDraftPayload:U,applyDraftPayload:de,hadRelations:I,setHadRelations:h}},Ar=({onSubmit:d,initialData:n,onCancel:i,cycleStartDate:m,cycleEndDate:b,isProcessing:_,isEditing:R=!1,cycleData:j=[],onDateSelect:A,defaultIsoDate:M,focusedField:p,initialSectionKey:w=null,onOpenNewCycle:E,formDraft:C=null})=>{const B=s.useRef(null);qt(!!i,i);const{toast:L}=it(),K=Ft(),{syncHealthConnectTemperatures:Q}=sr(),{isAvailable:x,hasPermissions:S,refreshPermissions:J,isAndroidApp:G}=zt(),[I,h]=s.useState(!1);s.useEffect(()=>{const H=B.current;if(!H)return;const F=oe=>{oe.target&&"scrollIntoView"in oe.target&&setTimeout(()=>{oe.target.scrollIntoView({behavior:"smooth",block:"center"})},50)};return H.addEventListener("focusin",F),()=>H.removeEventListener("focusin",F)},[]),s.useEffect(()=>{if(!p)return;const H=B.current;if(!H)return;const F=H.querySelector(`[data-field="${p}"]`);F&&requestAnimationFrame(()=>{typeof F.scrollIntoView=="function"&&F.scrollIntoView({behavior:"smooth",block:"center"}),typeof F.focus=="function"&&F.focus()})},[p]);const{date:$,setDate:q,measurements:D,addMeasurement:se,updateMeasurement:ie,removeMeasurement:ye,confirmMeasurement:_e,selectMeasurement:le,mucusSensation:ve,setMucusSensation:Ce,mucusAppearance:Re,setMucusAppearance:we,fertilitySymbol:ee,setFertilitySymbol:ue,observations:U,setObservations:de,hadRelations:te,setHadRelations:me,ignored:He,setIgnored:a,peakTag:c,setPeakTag:u,existingPeakIsoDate:l,handleSubmit:N,submitCurrentState:ne,buildDraftPayload:fe,applyDraftPayload:Y}=jr(d,n,R,m,b,j,A,M);s.useEffect(()=>{C&&Y(C)},[Y,C]);const re=s.useMemo(()=>j.map(H=>O(H.isoDate)),[j]),ke=async()=>{if(I||_)return;if(!G){L({title:"Disponible solo en Android",description:"Health Connect funciona únicamente en la app Android.",variant:"destructive"});return}if(!x){L({title:"Health Connect no disponible",description:"Instala Health Connect para sincronizar tus temperaturas.",variant:"destructive"}),K("/settings");return}let H=S;if(!H)try{H=await Bt()}catch(F){const oe=String(F?.message||F);L({title:"Health Connect: error pidiendo permisos",description:oe,variant:"destructive"})}finally{await J()}if(!H){L({title:"Permisos requeridos",description:"Activa Health Connect en ajustes para sincronizar."}),K("/settings");return}h(!0);try{await Q()}finally{h(!1)}},ae=s.useCallback(H=>{typeof E=="function"&&E(H,fe())},[fe,E]);return e.jsxs(ct.form,{ref:B,onSubmit:N,className:"space-y-4 bg-fertiliapp-secundario backdrop-blur-xl p-4 sm:p-6 rounded-3xl border-2 border-fertiliapp-suave shadow-[0_4px_20px_rgba(244,114,182,0.25)] w-full",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.18,ease:"easeOut"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-fertiliapp-fuerte rounded-full flex items-center justify-center shadow-lg",children:e.jsx(Ae,{className:"w-4 h-4 text-white"})}),e.jsx("h2",{className:"text-xl font-bold text-fertiliapp-fuerte",children:R?"Editar Registro":"Añadir Registro"})]}),i&&e.jsx(W,{type:"button",onClick:i,variant:"ghost",size:"icon",className:"text-gray-400 hover:text-fertiliapp-fuerte hover:bg-pink-50 rounded-full",children:e.jsx(lt,{className:"h-5 w-5"})})]}),e.jsx(wr,{date:$,setDate:q,measurements:D,addMeasurement:se,updateMeasurement:ie,removeMeasurement:ye,confirmMeasurement:_e,selectMeasurement:le,mucusSensation:ve,setMucusSensation:Ce,mucusAppearance:Re,setMucusAppearance:we,fertilitySymbol:ee,setFertilitySymbol:ue,observations:U,setObservations:de,hadRelations:te,setHadRelations:me,ignored:He,setIgnored:a,peakTag:c,setPeakTag:u,existingPeakIsoDate:l,isProcessing:_,isEditing:R,initialData:n,cycleStartDate:m,cycleEndDate:b,recordedDates:re,submitCurrentState:ne,initialSectionKey:w,onSyncTemperature:ke,isSyncingTemperature:I,canSyncTemperature:!!(G&&x),onOpenNewCycle:ae}),e.jsx(kr,{onCancel:i,isProcessing:_,isEditing:R})]})};export{yr as A,cr as C,Ar as D,st as T,lr as a};
