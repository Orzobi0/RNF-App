import{m as wt,j as t,R as hn,r as y,o as Pe,f as Ve,V as tn}from"./index-D1odW1ad.js";import{a as un,g as pn,i as xn}from"./computePeakStatuses-BuckH43K.js";import{i as mn}from"./peak-mode-button-BZ-YtFep.js";import{u as gn,C as yn}from"./useFertilityChart-8sBD0Slj.js";const bn=({padding:n,chartWidth:s,chartHeight:C,tempMin:d,tempMax:B,tempRange:c,getY:q,getX:ht,allDataPoints:p=[],visibleRange:M=null,responsiveFontSize:$,isFullScreen:ut,showLeftLabels:E=!1,reduceMotion:tt=!1,isScrolling:D=!1,graphBottomY:X,chartAreaHeight:h,rowsZoneHeight:L})=>{const x={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.3,ease:"easeOut"}}},K=[];if(c>0){const O=c<=2.5?.1:.5;for(let P=d;P<=B+1e-9;P+=O)K.push(parseFloat(P.toFixed(1)))}else for(let O=35.8;O<=37.2+1e-9;O+=.1)K.push(parseFloat(O.toFixed(1)));const A=p.length,pt=A>60||D,xt=tt||pt?"g":wt.g,Mt=Number.isInteger(M?.startIndex)?M.startIndex:0,u=Number.isInteger(M?.endIndex)?M.endIndex:Math.max(A-1,0),ot=A?Math.max(0,Math.min(A-1,Mt)):0,i=A?Math.max(ot,Math.min(A-1,u)):-1;return t.jsxs(t.Fragment,{children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"bgGradientChart",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"#fffbfc"}),t.jsx("stop",{offset:"50%",stopColor:"#fff5f7"}),t.jsx("stop",{offset:"100%",stopColor:"#fff1f3"})]}),t.jsxs("linearGradient",{id:"dataZoneGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"#fff7fb"}),t.jsx("stop",{offset:"50%",stopColor:"#ffe4f0"}),t.jsx("stop",{offset:"100%",stopColor:"#fff7fb"})]}),t.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"#f472b6"}),t.jsx("stop",{offset:"30%",stopColor:"#ec4899"}),t.jsx("stop",{offset:"70%",stopColor:"#db2777"}),t.jsx("stop",{offset:"100%",stopColor:"#be185d"})]}),t.jsxs("filter",{id:"softShadow",children:[t.jsx("feGaussianBlur",{in:"SourceAlpha",stdDeviation:"2"}),t.jsx("feOffset",{dx:"0",dy:"1",result:"offsetblur"}),t.jsx("feComponentTransfer",{children:t.jsx("feFuncA",{type:"linear",slope:"0.2"})}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsxs("filter",{id:"pointGlow",children:[t.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsx("filter",{id:"textShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:t.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodColor:"rgba(255, 255, 255, 0.8)"})}),t.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[t.jsx("rect",{width:"6",height:"6",fill:"#ef4444"}),t.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(255,255,255,0.85)"})]})]}),t.jsx("rect",{x:n.left,y:n.top,width:s-n.left-n.right,height:h,fill:"url(#bgGradientChart)",opacity:2,rx:12,style:{filter:"drop-shadow(0 4px 12px rgba(244, 114, 182, 0.1))"}}),t.jsx("rect",{x:n.left,y:n.top,width:s-n.left-n.right,height:h,fill:"white",stroke:"url(#tempLineGradientChart)",strokeWidth:"1",strokeOpacity:"0.2",rx:"12",style:{filter:"url(#softShadow)"}}),t.jsx("rect",{x:n.left,y:X,width:s-n.left-n.right,height:L,fill:"url(#dataZoneGradient)",rx:"8",style:{filter:"drop-shadow(0 -1px 2px rgba(244, 114, 182, 0.05))"}}),K.map((O,P)=>{const lt=q(O),N=O.toFixed(1).endsWith(".0")||O.toFixed(1).endsWith(".5"),k=N?O.toFixed(1):`.${O.toFixed(1).split(".")[1]}`;return t.jsxs(xt,{...tt||pt?{}:{variants:x},children:[t.jsx("line",{x1:n.left,y1:lt,x2:s-n.right,y2:lt,stroke:N?"#f9a8d4":"#fce7f3",strokeWidth:N?1.5:1,opacity:N?.5:.3,strokeDasharray:N?"0":"4,4",style:{filter:N&&!pt?"drop-shadow(0 1px 3px rgba(244, 114, 182, 0.15))":"none",opacity:N?1:.7}}),E&&t.jsx("text",{x:n.left-$(1),y:lt+$(.35),textAnchor:"end",fontSize:$(N?1.1:1),fontWeight:N?"700":"600",fill:N?"#be185d":"#db2777",opacity:N?.9:.7,style:{filter:pt?"none":"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:k}),t.jsx("text",{x:s-n.right+$(1),y:lt+$(.35),textAnchor:"start",fontSize:$(N?1.1:1),fontWeight:N?"700":"600",fill:N?"#be185d":"#db2777",opacity:N?.9:.7,style:{filter:pt?"none":"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:k})]},`temp-tick-${P}`)}),A>0&&Array.from({length:i-ot+1},(O,P)=>{const lt=ot+P,N=ht(lt);return t.jsx("line",{x1:N,y1:n.top,x2:N,y2:X,stroke:"#fce7f3",strokeWidth:"1",opacity:"0.6",style:{filter:pt?"none":"drop-shadow(0 0 1px rgba(244, 114, 182, 0.05))"}},`day-grid-${lt}`)}),t.jsx("rect",{x:n.left,y:n.top,width:s-n.left-n.right,height:h,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"2",strokeOpacity:"0.4",rx:"12"}),t.jsx("rect",{x:n.left+1,y:n.top+1,width:s-n.left-n.right-2,height:h-2,fill:"none",stroke:"white",strokeWidth:"0.5",rx:"11",opacity:"0.9"}),E&&t.jsx(xt,{...tt||pt?{}:{variants:x},children:t.jsx("text",{x:n.left+$(1.2),y:n.top+$(1.5),textAnchor:"middle",fontSize:$(1.4),fontWeight:"800",fill:"#be185d",style:{filter:pt?"none":"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:"°C"})})]})},In=({data:n,allDataPoints:s,getX:C,getY:d,baselineY:B,temperatureField:c="temperature",reduceMotion:q=!1,connectGaps:ht=!0})=>{if(!n||n.length<2)return null;let p="",M=null;const $=[];if(s.forEach((tt,D)=>{const X=n.find(h=>h.id===tt.id);if(X&&X[c]!==null&&X[c]!==void 0&&!X.ignored){const h=C(D),L=d(X[c]);$.push({x:h,y:L}),M!==null&&D===M+1?p+=` L ${h} ${L}`:p+=`${p?" ":""}M ${h} ${L}`,M=D}}),$.length<2)return null;const ut=p.includes("L"),E=ht&&$.length>1?$.map(({x:tt,y:D},X)=>`${X===0?"M":"L"} ${tt} ${D}`).join(" "):"";return t.jsxs(t.Fragment,{children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"#f472b6"}),t.jsx("stop",{offset:"30%",stopColor:"#ec4899"}),t.jsx("stop",{offset:"70%",stopColor:"#db2777"}),t.jsx("stop",{offset:"100%",stopColor:"#be185d"})]}),t.jsx("filter",{id:"lineShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:t.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"3",floodColor:"rgba(244, 114, 182, 0.4)"})})]}),ut&&(q?t.jsx("path",{d:p,fill:"none",stroke:"url(#tempLineGradientChartGlow)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:.4,style:{filter:"url(#lineGlow)"}}):t.jsx(wt.path,{d:p,fill:"none",stroke:"url(#tempLineGradientChartGlow)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:.4,style:{filter:"url(#lineGlow)"},initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.4},transition:{duration:.8,ease:"easeInOut",delay:.2}})),E&&(q?t.jsx("path",{d:E,fill:"none",stroke:"#d587b1",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.65}):t.jsx(wt.path,{d:E,fill:"none",stroke:"#d587b1",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.65,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.65},transition:{duration:.8,ease:"easeInOut"}})),ut&&(q?t.jsx("path",{d:p,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#lineShadow)"}}):t.jsx(wt.path,{d:p,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#lineShadow)"},initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:1},transition:{duration:1,ease:"easeInOut",delay:.4}}))]})},qe="var(--color-sensacion-fuerte)",Xe="var(--color-apariencia-fuerte)",Ke="var(--color-observaciones-fuerte)",Fe="#be123c",jn="rgba(148, 163, 184, 0.35)",wn="rgba(226, 232, 240, 0.6)",Mn="rgba(148, 163, 184, 0.5)",Ze="✖",Ge="#7f1d1d",_e="#ec4899",kn="drop-shadow(0 2px 4px rgba(244, 114, 182, 0.35))",Sn="#be185d",Cn="#2563eb",Ln="#be185d",vn="rgba(244, 114, 182, 0.35)",Je=n=>{if(!n)return"";const[s,C]=n.split("/");return`${parseInt(s,10)}/${parseInt(C,10)}`},xe='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',Rn=()=>{if(typeof document>"u")return(C,d)=>{const B=/(\d+(?:\.\d+)?)px/.exec(d||""),c=B?Number(B[1]):12;return C.length*c*.6};const s=document.createElement("canvas").getContext("2d");return s?(C,d)=>(s.font=d,s.measureText(C).width):(C,d)=>{const B=/(\d+(?:\.\d+)?)px/.exec(d||""),c=B?Number(B[1]):12;return C.length*c*.6}},Ye=(n,s,C)=>`${s} ${n}px ${C}`,Qe=(n="",{maxWidth:s,maxLines:C=2,fontSize:d,fontWeight:B=700,fontFamily:c=xe,fallback:q="–",measureTextWidth:ht})=>{if(!n)return[q,...Array.from({length:Math.max(0,C-1)},()=>"")];const p=Ye(d,B,c),M=h=>ht(h,p),$=String(n).trim(),ut=/\s/.test($),E=ut?$.split(/\s+/):Array.from($),tt=ut?" ":"",D=[],X=h=>{const L=Array.from(h);let x="";for(;L.length;){const K=x+L[0];if(M(K)<=s||!x){if(x=K,L.shift(),M(x)>s&&x.length>1){L.unshift(...Array.from(x.slice(1))),x=x[0];break}}else break}return[x,L.join("")]};for(;E.length&&D.length<C;){let h="";for(;E.length;){const L=E[0],x=h?`${h}${tt}${L}`:L;if(M(x)<=s){h=x,E.shift();continue}if(!h)if(ut){const[K,A]=X(L);h=K,A?E[0]=A:E.shift()}else{const[K,A]=X(L);h=K,A?E[0]=A:E.shift()}break}D.push(h),!h&&E.length&&D.push(E.shift())}if(E.length&&D.length){const h=D.length-1;let L=D[h]||"";for(;L&&M(`${L}…`)>s;)L=L.slice(0,-1);D[h]=L?`${L}…`:"…"}for(;D.length<C;)D.push("");return D};function He(n="",s,C="–"){return n?n.split(/\s+/).slice(0,s).join(" "):C}const On=({data:n,getX:s,getY:C,isFullScreen:d,orientation:B,responsiveFontSize:c,onPointInteraction:q,clearActivePoint:ht,activePoint:p,visibleRange:M=null,padding:$,chartHeight:ut,chartWidth:E,temperatureField:tt="temperature_chart",textRowHeight:D,compact:X=!1,reduceMotion:h=!1,isScrolling:L=!1,showInterpretation:x=!1,ovulationDetails:K=null,firstHighIndex:A=null,baselineIndices:ct=[],graphBottomLift:pt=0,graphBottomY:xt,rowsZoneHeight:Mt,showRelationsRow:u=!1,autoLabelStep:ot=!1})=>{const i={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},O={hidden:{opacity:0,scale:.3},visible:{opacity:1,scale:1,transition:{duration:.6,ease:[.34,1.56,.64,1],type:"spring",stiffness:120,damping:12}}},P=xt,lt=d?9:7.5,N=d?1:.75,k=u?lt+(d?2:1.5):null,se=lt+N,$t=Math.max(1,Math.floor(Mt/se)),F=Math.max(D,$t),Re=P+F*1,Oe=P+F*2,Et=P+F*3,me=P+F*(d?5:4.5),oe=P+F*(d?7:6),ge=P+F*(d?9:7.5),ye=u?ge+F*(d?2:1.5):null,J=Array.isArray(n)?n.length:0,b=J>60||L,Ft=h||b?"g":wt.g,Gt=E-$.left-$.right,Wt=F*(d?2:1.5),kt=Math.min(Math.max(Wt*.46,14),12),re=Number.isInteger(M?.startIndex)?M.startIndex:0,Xt=Number.isInteger(M?.endIndex)?M.endIndex:Math.max(J-1,0),St=J?Math.max(0,Math.min(J-1,re)):0,ae=J?Math.max(St,Math.min(J-1,Xt)):-1,be=y.useMemo(()=>Pe(new Date),[]),Dt=y.useMemo(()=>Rn(),[]),Ct=y.useRef(new Map),ie=J>0?Gt/J:Gt,Kt=2,_t=Math.min(12,Math.max(4,ie*.12)),G=Math.max(0,ie-_t*2),nt=c(.95),Tt=c(.9),yt=c(.9),Ht=c(.9),Bt=c(.8),Yt=c(.8),Ie=c(.8),je=y.useMemo(()=>{if(!ot||J<2)return 1;const f=Math.abs(s(1)-s(0));if(!Number.isFinite(f)||f<=0)return 1;const o=n?.find(w=>w?.date||w?.cycleDay!=null)??{},a=Je(o?.date||"00/00"),Z=String(o?.cycleDay??J??""),v=c(1.05),I=c(1),st=Dt(a,Ye(v,900,xe)),rt=Dt(Z,Ye(I,900,xe)),Rt=Math.max(st,rt)+c(.8);return Math.max(1,Math.ceil(Rt/f))},[ot,J,s,n,Dt,c]),le=y.useMemo(()=>{if(!x)return new Map;const f=Array.isArray(K?.highSequenceIndices)?K.highSequenceIndices:[],o=Z=>{const v=n?.[Z],I=v?.calcTemperature!=null?v.calcTemperature:v?.displayTemperature,st=v?.ignoredForCalc!=null?v.ignoredForCalc:v?.ignored;return v&&Number.isFinite(I)&&!st},a=new Map;return f.forEach((Z,v)=>{const I=Number(Z);Number.isInteger(I)&&I>=0&&I<J&&!a.has(I)&&o(I)&&a.set(I,v+1)}),a},[x,K,J,n]),ce=y.useMemo(()=>{if(!x)return new Map;const f=Array.isArray(ct)?ct:[];if(!f.length)return new Map;const o=new Set,a=[],Z=w=>{const j=n?.[w],m=j?.calcTemperature!=null?j.calcTemperature:j?.displayTemperature,Ut=j?.ignoredForCalc!=null?j.ignoredForCalc:j?.ignored;return j&&Number.isFinite(m)&&!Ut},v=w=>{for(let j=w;j>=0;j-=1)if(Z(j))return j;return null},I=w=>{const j=Number(w);Number.isInteger(j)&&j>=0&&j<J&&!o.has(j)&&Z(j)&&(o.add(j),a.push(j))};if(f.forEach(w=>{I(w)}),A!=null){const w=Number(A);if(Number.isInteger(w)){const j=v(w-1);j!=null&&I(j)}}if(!a.length)return new Map;const st=[...a].sort((w,j)=>w-j),rt=new Map;let Rt=1;for(let w=st.length-1;w>=0&&!(Rt>6);w-=1)rt.set(st[w],Rt),Rt+=1;return rt},[x,ct,J,A,n]),we=b?"none":"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))",Lt=b?"none":"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))",Pt=b?"none":"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))",Me=b?"none":kn,vt=b?"none":"drop-shadow(0 2px 4px rgba(244, 114, 182, 0.25))",ke=b?"none":"drop-shadow(0 1px 3px rgba(37, 99, 235, 0.45))",Se=b?"none":"drop-shadow(0 2px 4px rgba(37, 99, 235, 0.3))",de=y.useCallback((f,o,a,Z)=>{const v=Qe(f,{maxWidth:G,maxLines:3,fontSize:a,fontWeight:700,fontFamily:xe,fallback:o,measureTextWidth:Dt});return v[2]?{lines:Qe(f,{maxWidth:G,maxLines:3,fontSize:Z,fontWeight:700,fontFamily:xe,fallback:o,measureTextWidth:Dt}),fontSize:Z}:{lines:v,fontSize:a}},[G,Dt]);y.useEffect(()=>{Ct.current.clear()},[J,G,Tt,yt,Ht]);const Zt=y.useCallback((f,o,a,Z,v)=>{const I=Ct.current.get(f);if(I)return I;const st=de(o,a,Z,v);return Ct.current.set(f,st),st},[de]),Ce=y.useMemo(()=>!J||ae<St?[]:Array.from({length:ae-St+1},(f,o)=>St+o),[ae,St,J]);return t.jsxs(t.Fragment,{children:[t.jsxs("defs",{children:[t.jsx("filter",{id:"rowShadowChart",x:"-10%",y:"-10%",width:"120%",height:"120%",children:t.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"4",floodColor:"rgba(244, 114, 182, 0.2)"})}),t.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[t.jsx("rect",{width:"6",height:"6",fill:"#fb7185"}),t.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(255,255,255,0.85)"})]}),t.jsxs("filter",{id:"pointGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsxs("radialGradient",{id:"tempPointGradientChart",cx:"30%",cy:"30%",children:[t.jsx("stop",{offset:"0%",stopColor:"#FDF2F8"}),t.jsx("stop",{offset:"50%",stopColor:"#F9A8D4"}),t.jsx("stop",{offset:"85%",stopColor:"#EC4899"}),t.jsx("stop",{offset:"100%",stopColor:"#DB2777"})]}),t.jsxs("radialGradient",{id:"tempPointIgnoredGradient",cx:"30%",cy:"30%",children:[t.jsx("stop",{offset:"0%",stopColor:"#FFFFFF"}),t.jsx("stop",{offset:"80%",stopColor:"#F8FAFC"}),t.jsx("stop",{offset:"100%",stopColor:"#E2E8F0"})]}),t.jsxs("radialGradient",{id:"ovulationPointGradient",cx:"30%",cy:"30%",children:[t.jsx("stop",{offset:"0%",stopColor:"#dbeafe"}),t.jsx("stop",{offset:"50%",stopColor:"#93c5fd"}),t.jsx("stop",{offset:"85%",stopColor:"#3b82f6"}),t.jsx("stop",{offset:"100%",stopColor:"#2563eb"})]})]}),d&&B!=="portrait"&&t.jsx(Ft,{...h||b?{}:{variants:i},children:[{label:"Fecha",row:1,color:d?"#374151":"#6B7280"},{label:"Día",row:2,color:d?"#374151":"#6B7280"},{label:"Símbolo",row:3,color:d?"#374151":"#6B7280"},{label:"Sens.",row:d?5:4.5,color:qe},{label:"Apar.",row:d?7:6,color:Xe},{label:"Observ.",row:d?9:7.5,color:Ke},...u&&k!=null?[{label:"RS",row:k,color:Fe}]:[]].map(({label:f,row:o,color:a})=>t.jsx("text",{x:$.left-c(.5),y:P+F*o,textAnchor:"end",fontSize:c(1.05),fontWeight:"700",fill:a,style:{filter:we,fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:f},f))}),Ce.map(f=>{const o=n[f];if(!o)return null;const a=s(f),Z=o[tt]!=null?C(o[tt]):P,v=o.temperature_raw,I=o.temperature_corrected,st=o.use_corrected&&v!=null&&I!=null&&Math.abs(I-v)>.01,rt=st?C(v):null,Rt="#60666f",w=o[tt]!=null,j=o.use_corrected&&I!=null&&o[tt]===I,m=o.ignored||o.use_corrected&&!j,Ut=!!(o.had_relations??o.hadRelations);w||o.mucus_sensation||o.mucus_appearance||o.fertility_symbol;const fe=!ot||f%je===0||f===J-1,he=String(o.id||"").startsWith("placeholder-"),ue=K?.peakDayIndex,bt=x&&ue!=null&&!m&&w&&f===ue,Jt=un(o.fertility_symbol),Qt=pn(Jt.value),Le=Jt.pattern==="spotting-pattern"?"url(#spotting-pattern-chart)":Qt.main,te=Qt.border==="none"?"none":Qt.border||vn,Ne=Qt.border==="none"?0:Jt.value==="white"?1.6:1,zt=o.isoDate?xn(Pe(Ve(o.isoDate)),Pe(new Date)):!1,H=c(d?1.8:2),ee=Et-H*.75+H/2+2,It=o.peakStatus?String(o.peakStatus).toUpperCase():null,jt=It==="P"||It==="X",Vt=It&&!jt,Ae=jt?Ze:It||"–",ve=jt||["1","2","3"].includes(It),$e=!he&&Jt.value!=="none",e=!!o.isoDate&&!zt?{pointerEvents:"all",style:{cursor:"pointer"},onClick:qt=>q(o,f,qt)}:{},l=(o.isoDate?mn(Ve(o.isoDate),be):!1)?Ln:Rt,W=le.has(f),Y=W?le.get(f):null,dt=ce.has(f),at=dt?ce.get(f):null,R=c(d?.75:1.2),it=Math.max(.5,R*.18),U=Z-R*(d?2.6:1.8),S=Z+R*(d?1.9:1.6),g=d?He(o.mucus_sensation,Kt,zt?"":"–"):o.mucus_sensation,z=d?He(o.mucus_appearance,Kt,zt?"":"–"):o.mucus_appearance,T=d?He(o.observations,Kt,""):o.observations,et=`${o.isoDate||o.id||f}`,Q=Zt(`${et}-sens-${G}-${Tt}-${Bt}-${g??""}`,g,zt?"":"–",Tt,Bt),ft=Zt(`${et}-apar-${G}-${yt}-${Yt}-${z??""}`,z,zt?"":"–",yt,Yt),gt=Zt(`${et}-obs-${G}-${Ht}-${Ie}-${T??""}`,T,"",Ht,Ie),[mt,V,Ot]=Q.lines,[Nt,pe,At]=ft.lines,[ne,Ee,De]=gt.lines,en=Q.fontSize,nn=ft.fontSize,sn=gt.fontSize,Te=(qt,Be,fn)=>Math.max(1,[qt,Be,fn].filter(ze=>ze&&String(ze).trim()!=="").length),on=Te(mt,V,Ot),rn=Te(Nt,pe,At),an=Te(ne,Ee,De),We=(qt,Be)=>qt-(Be-1)*nt/2,ln=We(me,on),cn=We(oe,rn),dn=We(ge,an);return t.jsxs(Ft,{...h||b?{}:{variants:i},...e,children:[w&&t.jsxs(Ft,{...h||b?{}:{variants:O},children:[st&&rt!==null&&t.jsxs("g",{pointerEvents:"none",children:[t.jsx("line",{x1:a,y1:rt,x2:a,y2:Z,stroke:jn,strokeWidth:1,strokeDasharray:"4 4"}),t.jsx("circle",{cx:a,cy:rt,r:3,fill:wn,stroke:Mn,strokeWidth:1}),t.jsx("circle",{cx:a,cy:rt,r:1,fill:"rgba(255, 255, 255, 0.6)"})]}),t.jsx("circle",{cx:a,cy:Z,r:bt?3.5:2.8,fill:m?"url(#tempPointIgnoredGradient)":bt?"url(#ovulationPointGradient)":"url(#tempPointGradientChart)",stroke:o.use_corrected&&j?"#941616":m?"#94A3B8":bt?"#1d4ed8":"#E91E63",sstrokeWidth:m?1.5:bt?2.2:2,style:{filter:bt?Se:vt,cursor:"pointer"},pointerEvents:"all",onClick:qt=>q(o,f,qt)}),!m&&t.jsx("circle",{cx:a,cy:Z,r:bt?1.2:.9,fill:bt?"rgba(239, 246, 255, 0.95)":"rgba(255, 255, 255, 0.9)",style:{filter:bt?ke:Lt}}),x&&w&&!m&&W&&t.jsx("g",{pointerEvents:"none",children:t.jsx("text",{x:a,y:U,textAnchor:"middle",fontSize:R,fontWeight:"900",fill:Sn,strokeWidth:it,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',paintOrder:"stroke",filter:Lt},children:Y})}),x&&w&&!m&&dt&&t.jsx("g",{pointerEvents:"none",children:t.jsx("text",{x:a,y:S,textAnchor:"middle",fontSize:R,fontWeight:"800",fill:Cn,stroke:"#ffffff",strokeWidth:it,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',paintOrder:"stroke",filter:Lt},children:at})})]}),fe&&t.jsx("text",{x:a,y:Re,textAnchor:"middle",fontSize:c(1.05),fontWeight:"900",fill:l,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:Lt},children:Je(o.date)}),fe&&t.jsx("text",{x:a,y:Oe,textAnchor:"middle",fontSize:c(1),fontWeight:"900",fill:l,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:Lt},children:o.cycleDay}),$e?t.jsxs("g",{children:[t.jsx("rect",{x:a-H/2+1,y:Et-H*.75+1,width:H,height:H,fill:"rgba(0, 0, 0, 0.1)",rx:H*.3,opacity:.5}),t.jsx("rect",{x:a-H/2-4,y:Et-H*.75,width:H*1.4,height:H,fill:Le,stroke:te,strokeWidth:Ne,rx:H*.2,style:{filter:vt}}),It&&t.jsx("g",{pointerEvents:"none",children:jt?t.jsx("text",{x:a,y:ee,textAnchor:"middle",fontSize:c(1.35),fontWeight:"900",fill:_e,stroke:"#fff",strokeWidth:1.5,paintOrder:"stroke",style:{filter:Me},children:Ze}):t.jsx("text",{x:a,y:ee,textAnchor:"middle",fontSize:c(It?1.1:1),fontWeight:"800",fill:Ge,style:{filter:Pt},children:It})})]}):t.jsxs("g",{children:[ve&&t.jsx("rect",{x:a-H/2-4,y:Et-H*.75,width:H*1.4,height:H,fill:"transparent",stroke:jt?_e:Ge,strokeWidth:1,rx:H*.2}),t.jsx("text",{x:a,y:ee,textAnchor:"middle",fontSize:c(jt?1.35:Vt?1.1:1),fill:jt?_e:Vt?Ge:Rt,fontWeight:jt?"900":Vt?"800":"500",style:{filter:jt?Me:Vt?Pt:Lt},children:Ae})]}),!X&&t.jsxs("text",{x:a,y:ln,textAnchor:"middle",fontSize:en,fontWeight:"700",fill:qe,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:Pt},children:[t.jsx("tspan",{x:a,dy:0,children:mt}),V&&t.jsx("tspan",{x:a,dy:nt,children:V}),Ot&&t.jsx("tspan",{x:a,dy:nt,children:Ot})]}),!X&&t.jsxs("text",{x:a,y:cn,textAnchor:"middle",fontSize:nn,fontWeight:"700",fill:Xe,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:Pt},children:[t.jsx("tspan",{x:a,dy:0,children:Nt}),pe&&t.jsx("tspan",{x:a,dy:nt,children:pe}),At&&t.jsx("tspan",{x:a,dy:nt,children:At})]}),!X&&t.jsxs("text",{x:a,y:dn,textAnchor:"middle",fontSize:sn,fontWeight:"700",fill:Ke,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:Pt},children:[t.jsx("tspan",{x:a,dy:0,children:ne}),Ee&&t.jsx("tspan",{x:a,dy:nt,children:Ee}),De&&t.jsx("tspan",{x:a,dy:nt,children:De})]}),u&&ye!=null&&Ut&&t.jsx("g",{transform:`translate(${a-kt/2}, ${ye-kt/2})`,role:"img","aria-label":`Relación registrada el ${o.isoDate||`día ${f+1}`}`,children:t.jsx(tn,{width:kt,height:kt,color:Fe,fill:Fe})})]},`pt-${f}-${o.isoDate||o.timestamp}`)})]})},Nn=(n,s)=>{if(n.data!==s.data||n.getX!==s.getX||n.getY!==s.getY||n.isFullScreen!==s.isFullScreen||n.orientation!==s.orientation||n.responsiveFontSize!==s.responsiveFontSize||n.onPointInteraction!==s.onPointInteraction||n.clearActivePoint!==s.clearActivePoint||n.chartHeight!==s.chartHeight||n.chartWidth!==s.chartWidth||n.temperatureField!==s.temperatureField||n.textRowHeight!==s.textRowHeight||n.compact!==s.compact||n.reduceMotion!==s.reduceMotion||n.isScrolling!==s.isScrolling||n.showInterpretation!==s.showInterpretation||n.ovulationDetails!==s.ovulationDetails||n.firstHighIndex!==s.firstHighIndex||n.baselineIndices!==s.baselineIndices||n.graphBottomLift!==s.graphBottomLift||n.graphBottomY!==s.graphBottomY||n.rowsZoneHeight!==s.rowsZoneHeight||n.showRelationsRow!==s.showRelationsRow||n.autoLabelStep!==s.autoLabelStep)return!1;const C=n.visibleRange,d=s.visibleRange;if(C?.startIndex!==d?.startIndex||C?.endIndex!==d?.endIndex)return!1;const B=n.padding,c=s.padding;return!(B!==c&&(!B||!c||B.left!==c.left||B.right!==c.right||B.top!==c.top||B.bottom!==c.bottom))},An=hn.memo(On,Nn),$n="var(--color-sensacion-fuerte)",En="var(--color-apariencia-fuerte)",Dn="var(--color-observaciones-fuerte)",Tn=({padding:n,chartHeight:s,tempMin:C,tempMax:d,tempRange:B,getY:c,responsiveFontSize:q,textRowHeight:ht,isFullScreen:p,reduceMotion:M=!1,graphBottomY:$,rowsZoneHeight:ut,showRelationsRow:E=!1})=>{const tt={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},D=[];if(B>0){const u=B<=2.5?.1:.5;for(let ot=C;ot<=d+1e-9;ot+=u)D.push(parseFloat(ot.toFixed(1)))}else for(let u=35.8;u<=37.2+1e-9;u+=.1)D.push(parseFloat(u.toFixed(1)));const X=$,h=p?9:7.5,L=p?1:.75,x=E?h+(p?2:1.5):null,K=h+L,A=Math.max(1,Math.floor(ut/K)),ct=Math.max(ht,A),pt=y.useMemo(()=>{const u=[{label:"Fecha",row:1,color:"#374151",icon:null},{label:"Día",row:2,color:"#374151",icon:null},{label:"Símbolo",row:3,color:"#374151",icon:null},{label:"Sens.",row:p?5:4.5,color:$n,icon:{type:"text",value:"◊"}},{label:"Apar.",row:p?7:6,color:En,icon:{type:"text",value:"○"}},{label:"Obs.",row:p?9:7.5,color:Dn,icon:{type:"text",value:"✦"}}];return E&&x!=null&&u.push({label:"RS",row:x,color:"#f44336",icon:{type:"heart"}}),u},[p,x,E]),xt=M?"g":wt.g,Mt=M?{}:{variants:tt};return t.jsxs("svg",{width:n.left,height:s,className:"font-sans pointer-events-none",children:[t.jsx("defs",{children:t.jsx("filter",{id:"textShadowLegend",x:"-50%",y:"-50%",width:"200%",height:"200%",children:t.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodColor:"rgba(255, 255, 255, 0.9)"})})}),D.map((u,ot)=>{const i=c(u),O=u.toFixed(1).endsWith(".0")||u.toFixed(1).endsWith(".5"),P=O?u.toFixed(1):`.${u.toFixed(1).split(".")[1]}`;return t.jsx(xt,{...Mt,children:t.jsx("text",{x:n.left-q(1.2),y:i+q(.35),textAnchor:"end",fontSize:q(O?1.15:1),fontWeight:O?"800":"700",fill:O?"#be185d":"#db2777",opacity:O?1:.85,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:P})},`temp-tick-fixed-${ot}`)}),t.jsx(xt,{...Mt,children:pt.map(({label:u,row:ot,color:i,icon:O})=>{const P=n.left-q(2.8),lt=X+ct*ot,N=q(.95);return t.jsxs("g",{children:[O?.type==="text"&&t.jsx("text",{x:P,y:lt,textAnchor:"middle",fontSize:q(.8),fontWeight:"600",fill:i,opacity:.7,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:O.value}),O?.type==="heart"&&t.jsx("g",{transform:`translate(${P-N/2}, ${lt-N/2})`,opacity:.7,children:t.jsx(tn,{width:N,height:N,color:i,fill:i,"aria-hidden":"true"})}),t.jsx("text",{x:n.left-q(.8),y:X+ct*ot,textAnchor:"end",fontSize:q(1.05),fontWeight:"800",fill:i,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:u})]},u)})})]})},Gn=({data:n,isFullScreen:s,orientation:C,onToggleIgnore:d,onEdit:B,onTogglePeak:c,cycleId:q,initialScrollIndex:ht=0,visibleDays:p=5,showInterpretation:M=!1,reduceMotion:$=!1,forceLandscape:ut=!1,currentPeakIsoDate:E=null,showRelationsRow:tt=!1,fertilityStartConfig:D=null,fertilityCalculatorCycles:X=[],fertilityCalculatorCandidates:h=null,onShowPhaseInfo:L=null,isArchivedCycle:x=!1,cycleEndDate:K=null,exportMode:A=!1})=>{const{chartRef:ct,tooltipRef:pt,dimensions:xt,activePoint:Mt,activeIndex:u,tooltipPosition:ot,allDataPoints:i,validDataForLine:O,tempMin:P,tempMax:lt,tempRange:N,padding:k,textRowHeight:se,getY:$t,getX:F,handlePointInteraction:Re,handleToggleIgnore:Oe,responsiveFontSize:Et,clearActivePoint:me,baselineTemp:oe,baselineStartIndex:ge,baselineIndices:ye,firstHighIndex:J,ovulationDetails:_,fertilityStart:b,hasAnyObservation:Ft,graphBottomInset:Gt,todayIndex:Wt}=gn(n,s,C,d,q,p,ut,D,X,h,tt),kt=$||A,re=y.useRef(null);if(!re.current){const e=Math.random().toString(36).slice(2,10);re.current=`fertility-chart-${q??"default"}-${e}`}const Xt=re.current,St=y.useCallback((e,r)=>{if(r<=120)return r;const l=e>=20?1:2,W=Math.ceil(e*l),Y=Math.min(W,24);return Math.max(Y,12)},[]),ae=y.useMemo(()=>{const e=i.length;if(!e)return{startIndex:0,endIndex:-1};const r=St(p,e),l=Math.max(0,Math.floor(ht)-r),W=Math.min(e-1,Math.floor(ht)+p+r);return{startIndex:l,endIndex:W}},[i.length,St,ht,p]),[be,Dt]=y.useState(ae),Ct=y.useRef(null),[ie,Kt]=y.useState(!1),_t=y.useRef(null);if(!i||i.length===0)return t.jsxs("div",{className:"text-center p-8",children:[t.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-pink-100 to-rose-100 rounded-full mb-4",children:t.jsx("svg",{className:"w-8 h-8 text-pink-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),t.jsx("p",{className:"text-slate-400 font-medium",children:"No hay datos para mostrar en el gráfico"})]});const G=xt.width,nt=xt.contentHeight??xt.height,Tt=xt.scrollableContentHeight??nt,yt=nt-k.bottom-(Gt||0),Ht=Math.max(nt-yt,0),Bt=oe!=null?$t(oe):null,Yt=!!_?.confirmed,Ie=oe!=null&&Yt,je=F(0),le=i.length>0?F(i.length-1):G-k.right,ce=Yt?"#F59E0B":"#94A3B8",we=Yt?"6 4":"4 4",Lt=Yt?1:.7,Pt=3,Me=G===0,vt=u!=null?F(u):null,ke=u!=null?u>0?F(u-1):vt:null,Se=u!=null?u<i.length-1?F(u+1):vt:null,de=Math.max((G-k.left-k.right)/Math.max(i.length,1),0),Zt=u!=null?Math.max((Se!=null&&ke!=null?Se-ke:0)||de,de,0):0,Ce=y.useMemo(()=>{const e=new Map;return O.forEach(r=>{r&&r.id!=null&&e.set(r.id,r)}),e},[O]),f=y.useMemo(()=>Number.isInteger(b?.fertileStartFinalIndex)?b.fertileStartFinalIndex:null,[b]),o=Math.max(nt-k.top-k.bottom-(Gt||0),0),a=y.useCallback(e=>!Number.isFinite(e)||!i.length||e<=0?k.left:F(e),[i,F,k.left]),Z=y.useCallback(e=>!Number.isFinite(e)||!i.length||e>=i.length-1?G-k.right:F(e+1),[i,G,F,k.right]),v=y.useCallback((e,r,{inclusiveEnd:l=!0}={})=>{if(!Number.isFinite(e)||!Number.isFinite(r)||i.length===0)return null;const W=g=>Math.max(0,Math.min(i.length-1,Math.floor(g))),Y=g=>Math.max(0,Math.min(i.length-1,Math.floor(g))),dt=g=>Math.max(0,Math.min(i.length,Math.floor(g))),at=W(e),R=l?Y(r):dt(r),it=at<=0?k.left:a(at);let U;l?U=R>=i.length-1?G-k.right:Z(R):R<=0?U=k.left:R>=i.length?U=G-k.right:U=a(R);const S=Math.max(U-it,0);return S<=0?null:{x:it,width:S}},[i,G,a,Z,k.left,k.right]),I=i.length>0?i.length-1:null,st=y.useMemo(()=>{if(!x||!K||I==null)return null;const e=typeof K=="string"?K:null;if(!e)return null;const r=i.findIndex(l=>l?.isoDate===e);if(r>=0)return Math.min(r,I);for(let l=i.length-1;l>=0;l-=1){const W=i[l]?.isoDate;if(typeof W=="string"&&W<=e)return Math.min(l,I)}return null},[x,K,i,I]),rt=y.useMemo(()=>I==null?null:x?Number.isInteger(st)?Math.min(st,I):I:Number.isInteger(Wt)?Math.min(Wt,I):I,[st,x,Wt,I]),Rt=y.useMemo(()=>x?Number.isInteger(st)?st:Number.isInteger(rt)?rt:null:Number.isInteger(Wt)?Wt:null,[st,x,rt,Wt]),w=o>0?k.top+o*.5:null,j=w!=null?Math.max(yt-w,0):0,m=y.useMemo(()=>{if(!M||!Ft)return null;const e=b?.debug,r=Number.isInteger(e?.mucusInfertileStartIndex)?e.mucusInfertileStartIndex:null,l=Number.isInteger(b?.fertileWindow?.temperatureInfertileStartIndex)?b.fertileWindow.temperatureInfertileStartIndex:null,W=[r,l].filter(At=>Number.isInteger(At)).sort((At,ne)=>At-ne)[0],Y=Number.isInteger(W)?W:Number.isInteger(e?.postOvulatoryStartIndex)?e.postOvulatoryStartIndex:null,dt=Number.isInteger(r)&&Number.isInteger(l)?Math.max(r,l):null,at=Number.isInteger(dt)?dt:Number.isInteger(e?.absoluteStartIndex)?e.absoluteStartIndex:null,R={confirmed:!!_?.confirmed,rule:_?.rule??null,baselineTemp:_?.baselineTemp??null,baselineIndices:Array.isArray(_?.baselineIndices)?_.baselineIndices:[],firstHighIndex:Number.isInteger(_?.firstHighIndex)?_.firstHighIndex:null,highSequenceIndices:Array.isArray(_?.highSequenceIndices)?_.highSequenceIndices:[],confirmationIndex:Number.isInteger(_?.confirmationIndex)?_.confirmationIndex:null,startIndex:l},it={peakDayIndex:Number.isInteger(_?.peakDayIndex)?_.peakDayIndex:null,thirdDayIndex:Number.isInteger(_?.thirdDayIndex)?_.thirdDayIndex:null,startIndex:r},U=l!=null,S=r!=null;if(!U&&!S)return null;const g=Number.isInteger(Y)?Y:null;if(g==null)return null;let z="pending",T="",et="Infertilidad postovulatoria",Q="Fase postovulatoria: se ha cumplido un criterio de cierre; falta el segundo para confirmar la infertilidad absoluta.";const ft="Infertilidad absoluta",gt="Fase postovulatoria alcanzada (se ha confirmado día pico y subida de temperatura).",mt="Confirmación completa: doble criterio (día pico + temperatura).";let V=et,Ot=Q,Nt=T,pe="pending";return U&&S?(z="absolute",et=ft,Q=mt,T=gt,Number.isInteger(l)&&(!Number.isInteger(r)||l<=r)?(R.rule,Nt=`Temperatura confirmada el ${R.confirmationIndex!=null?`D${R.confirmationIndex+1}`:"—"}. A la espera de determinación del día pico.`,Ot=Nt,V="Infertilidad estimada por temperatura"):(Nt=`Alcanzado ${it.thirdDayIndex!=null?"3° día postpico":"4º día postpico"} tras alcanzar día pico el ${it.peakDayIndex+1} del ciclo`,Ot=Nt,V="Infertilidad estimada por moco")):U?(R.rule,T=`Temperatura confirmada el ${R.confirmationIndex!=null?`D${R.confirmationIndex+1}`:"—"}. A la espera de determinación del día pico.`,Q=T,et="Infertilidad estimada por temperatura",Nt=T,Ot=Q,V=et):(T=`Alcanzado ${it.thirdDayIndex!=null?"3° día postpico":"4º día postpico"} tras seleccionar día pico el ${it.peakDayIndex+1} del ciclo`,Q=T,et="Infertilidad estimada por moco",Nt=T,Ot=Q,V=et),{phase:"postOvulatory",status:z,startIndex:g,absoluteStartIndex:at,estimated:{status:pe,label:V,tooltip:Ot,message:Nt},absolute:{label:ft,tooltip:mt,message:gt},reasons:{type:"post",status:z,mucus:it,temperature:R},message:T,label:et,tooltip:Q}},[M,Ft,_,b]),Ut=y.useMemo(()=>{if(!M||o<=0||w==null||j<=0||i.length===0)return[];const e=[],r=i.length-1,l=Number.isInteger(rt)&&rt>=0?Math.min(rt,r):r,W=(S,g)=>{if(!m)return;const z=m.startIndex,T=Number.isInteger(m.absoluteStartIndex)?m.absoluteStartIndex:null,et=m.estimated??m,Q=m.absolute??m,ft=T??z,gt=m.status==="absolute"?r:Math.min(r,g);if(T!=null&&T>z){const mt=Math.min(T-1,g),V=v(z,mt);V&&S.push({key:"post-pending",phase:"postOvulatory",status:et.status??"pending",bounds:V,startIndex:z,endIndex:mt,displayLabel:et.label,tooltip:et.tooltip,message:et.message,reasons:m.reasons})}if(ft<=gt){const mt=v(ft,gt);mt&&S.push({key:"post-absolute",phase:"postOvulatory",status:T!=null?"absolute":m.status,bounds:mt,startIndex:ft,endIndex:gt,displayLabel:T!=null?Q.label:m.label,tooltip:T!=null?Q.tooltip:m.tooltip,message:T!=null?Q.message:m.message,reasons:m.reasons})}},Y=Number.isInteger(f),dt=Number.isFinite(m?.startIndex);if(!Y&&!dt){const S=Math.min(l,r);if(S<0)return e;const g=v(0,S);return g&&e.push({key:"relative-default",phase:"relativeInfertile",status:"default",bounds:g,startIndex:0,endIndex:S,displayLabel:"Relativamente infértil",tooltip:"Relativamente infértil (preovulatoria: sin día fértil por CPM/T-8 ni signos de moco fértil)",message:"Relativamente infértil",reasons:{type:"relative",fertileStartFinalIndex:null,aggregate:b?.aggregate??null,bipScore:b?.debug?.bipScore??null}}),e}if(!Y&&dt){const S=m.startIndex,g=Math.min(S-1,l);if(g>=0){const z=v(0,g);z&&e.push({key:"no-fertile-window",phase:"nodata",status:"no-fertile-window",bounds:z,startIndex:0,endIndex:g,displayLabel:"Sin ventana fértil identificable",tooltip:"Sin ventana fértil identificable",message:"Sin ventana fértil identificable",reasons:{type:"nofertile",status:"no-fertile-window",message:"No se ha identificado un inicio fértil claro en este ciclo (ni por moco, ni por calculadora, ni por marcador explícito)."}})}return Number.isFinite(m.startIndex)&&m.startIndex<=r&&W(e,l),e}if(Y&&f>0){const S=Math.min(f-1,l);if(S>=0){const g=v(0,S);g&&e.push({key:"relative",phase:"relativeInfertile",status:"default",bounds:g,startIndex:0,endIndex:S,displayLabel:"Relativamente infértil",tooltip:"Relativamente infértil (fase relativamente infértil preovulatoria)",message:"Relativamente infértil",reasons:{type:"relative",fertileStartFinalIndex:f,aggregate:b?.aggregate??null,bipScore:b?.debug?.bipScore??null}})}}const at=Y?Math.max(f,0):0,R=m?.startIndex,it=Number.isFinite(R)&&R!=null?Math.min(R-1,r):r,U=Math.min(it,l);if(U>=at){const S=v(at,U);if(S){const g=Number.isInteger(b?.debug?.explicitStartDay)?b.debug.explicitStartDay:null,z=b?.aggregate?.usedCandidates??[],T=z.some(ft=>ft?.kind==="profile"),et=z.some(ft=>ft?.kind==="calculator");let Q=null;Y&&g!=null&&g===f?Q="marker":T?Q="profiles":et&&(Q="calculator"),e.push({key:"fertile",phase:"fertile",status:"default",bounds:S,startIndex:at,endIndex:U,displayLabel:"Fértil",tooltip:"Fértil",message:"Fértil",reasons:{type:"fertile",startIndex:at,endIndex:U,source:Q,details:b?.debug??null,notes:b?.aggregate?.notes??[],statusSummary:b?.currentAssessment??null,dailyAssessments:b?.dailyAssessments??[],window:b?.fertileWindow??null,aggregate:b?.aggregate??null}})}}return m&&Number.isFinite(m.startIndex)&&m.startIndex<=r&&W(e,l),e},[M,o,w,j,i.length,f,b,m,Ft,v,rt]),fe=`${Xt}-phase-relative-gradient`,he=`${Xt}-phase-fertile-gradient`,ue=`${Xt}-phase-post-pending-gradient`,bt=`${Xt}-phase-post-absolute-gradient`,Jt=e=>e.phase==="relativeInfertile"?"#065F46":e.phase==="fertile"?"#9D174D":e.phase==="postOvulatory"?e.status==="pending"?"#075985":"#1E3A8A":e.phase==="nodata"?"#475569":"hsl(var(--foreground))",Qt="0 1px 1px var(--phase-text-shadow, rgba(15, 23, 42, 0.2))",Le=y.useMemo(()=>{if(!M||!_?.confirmed)return null;const e=Array.isArray(_?.highSequenceIndices)?_.highSequenceIndices:[];if(e.length<2)return null;const r=e.map(l=>{if(l==null||l<0||l>=i.length)return null;const W=i[l],Y=Ce.get(W?.id);return!Y||!Number.isFinite(Y.displayTemperature)?null:{x:F(l),y:$t(Y.displayTemperature)}}).filter(Boolean);return r.length<2?null:r.map(({x:l,y:W},Y)=>`${Y===0?"M":"L"} ${l} ${W}`).join(" ")},[M,_,i,Ce,F,$t]),[te,Ne]=y.useState({w:typeof window<"u"?window.innerWidth:0,h:typeof window<"u"?window.innerHeight:0}),zt=te.w<te.h;y.useEffect(()=>{const e=()=>Ne({w:window.innerWidth,h:window.innerHeight});return window.addEventListener("resize",e),window.addEventListener("orientationchange",e),()=>{window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e)}},[]);const H=y.useCallback((e=0)=>{const r=ct.current;if(!r)return;const l=i.length;if(!l){Dt({startIndex:0,endIndex:-1});return}const W=r.clientWidth||1,dt=W/Math.max(p,1)||1,at=St(p,l),R=Math.floor(e/dt),it=Math.floor((e+W)/dt);let U=R-at,S=it+at;U=Math.max(0,U),S=Math.min(l-1,S),Dt(g=>g.startIndex===U&&g.endIndex===S?g:{startIndex:U,endIndex:S})},[i.length,St,p]);y.useEffect(()=>{if(!ct.current)return;const e=ct.current.clientWidth/p;ct.current.scrollLeft=Math.max(0,e*ht),H(ct.current.scrollLeft)},[ht,p,xt.width,C,H]),y.useEffect(()=>{const e=ct.current;if(!e)return;const r=()=>{Kt(!0),_t.current&&window.clearTimeout(_t.current),_t.current=window.setTimeout(()=>Kt(!1),140),!Ct.current&&(Ct.current=window.requestAnimationFrame(()=>{Ct.current=null,H(e.scrollLeft)}))};return e.addEventListener("scroll",r,{passive:!0}),H(e.scrollLeft),()=>{e.removeEventListener("scroll",r),_t.current&&window.clearTimeout(_t.current),Ct.current&&(window.cancelAnimationFrame(Ct.current),Ct.current=null)}},[H]);const ee=!A&&s&&ut&&zt,It=ut?"landscape":C,jt=ee,Vt="w-full h-full bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100",Ae=s?`${Vt} h-full ${jt?"overflow-y-auto overflow-x-auto":"overflow-x-auto overflow-y-auto"}`:`${Vt} overflow-x-auto overflow-y-visible border border-pink-100/50`,ve=!s||It==="portrait",$e=A?()=>{}:Re,Ue=A?()=>{}:me;return t.jsx(wt.div,{className:"relative w-full h-full",initial:!1,children:t.jsxs(wt.div,{ref:ct,className:`relative p-0 ${s?"":"rounded-2xl"} ${Ae}`,style:{touchAction:"auto",boxShadow:s?"inset 0 1px 3px rgba(244, 114, 182, 0.1)":"0 8px 32px rgba(244, 114, 182, 0.12), 0 2px 8px rgba(244, 114, 182, 0.08)",...ee?{position:"absolute",top:"50%",left:"50%",width:`${te.h}px`,height:`${te.w}px`,transform:"translate(-50%, -50%) rotate(90deg)",transformOrigin:"center center"}:{}},initial:!1,children:[Me&&t.jsx("div",{className:"flex items-center justify-center w-full h-full text-slate-400",children:"Cargando..."}),t.jsx("div",{className:"inline-block",style:{width:G,height:nt},children:t.jsx("div",{className:"relative h-full overflow-y-auto",style:{height:nt,maxHeight:Tt},children:t.jsxs("div",{className:"relative",style:{width:G,height:Tt},children:[ve&&t.jsx("div",{className:"absolute left-0 top-0 h-full bg-transparent pointer-events-none z-10",style:{width:k.left},children:t.jsx(Tn,{padding:k,chartHeight:Tt,tempMin:P,tempMax:lt,tempRange:N,getY:$t,responsiveFontSize:Et,textRowHeight:se,isFullScreen:s,reduceMotion:kt,graphBottomY:yt,rowsZoneHeight:Ht,showRelationsRow:tt})}),t.jsxs(wt.svg,{width:G,height:Tt,className:"font-sans flex-shrink-0",viewBox:`0 0 ${G} ${Tt}`,preserveAspectRatio:"xMidYMid meet",initial:!1,children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),t.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),t.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),t.jsxs("linearGradient",{id:"tempAreaGradientChart",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(244, 114, 182, 0.18)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(244, 114, 182, 0.02)"})]}),t.jsxs("linearGradient",{id:fe,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"var(--phase-rel)",stopOpacity:"0"}),t.jsx("stop",{offset:"100%",stopColor:"var(--phase-rel)",stopOpacity:"var(--phase-rel-stop, 0.28)"})]}),t.jsxs("linearGradient",{id:he,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"var(--phase-fertile)",stopOpacity:"0"}),t.jsx("stop",{offset:"100%",stopColor:"var(--phase-fertile)",stopOpacity:"var(--phase-fertile-stop, 0.27)"})]}),t.jsxs("linearGradient",{id:ue,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"var(--phase-post)",stopOpacity:"0"}),t.jsx("stop",{offset:"100%",stopColor:"var(--phase-post)",stopOpacity:"var(--phase-post-stop, 0.45)"})]}),t.jsxs("linearGradient",{id:bt,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"var(--phase-post-abs)",stopOpacity:"0"}),t.jsx("stop",{offset:"100%",stopColor:"var(--phase-post-abs)",stopOpacity:"var(--phase-post-abs-stop, 0.7)"})]}),t.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[t.jsx("rect",{width:"6",height:"6",fill:"#ef4444"}),t.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(255,255,255,0.85)"})]}),t.jsxs("filter",{id:"chartShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsxs("filter",{id:"baselineGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),t.jsx("rect",{width:"100%",height:"100%",fill:"transparent"}),t.jsx(bn,{padding:k,chartWidth:G,chartHeight:nt,tempMin:P,tempMax:lt,tempRange:N,getY:$t,getX:F,allDataPoints:i,visibleRange:be,responsiveFontSize:Et,isFullScreen:s,showLeftLabels:!ve,reduceMotion:kt,isScrolling:ie,graphBottomY:yt,chartAreaHeight:Math.max(nt-k.top-k.bottom-(Gt||0),0),rowsZoneHeight:Ht}),M&&Ut.length>0&&w!=null&&j>0&&t.jsx("g",{children:Ut.map(e=>{const r=w,l=j,Y=e.phase==="postOvulatory"?e.status==="pending"?`url(#${ue})`:`url(#${bt})`:e.phase==="relativeInfertile"?`url(#${fe})`:e.phase==="fertile"?`url(#${he})`:e.phase==="nodata"?"rgba(203, 213, 225, 0.2)":`url(#${he})`,dt=s?14:13,at=Math.max(Et(1.1),dt),R=e.bounds.width<120,it=Math.max(e.bounds.width-16,0),U=Math.max(at*.58,1),S=Math.max(1,Math.floor(it/U)),g=e.tooltip??e.displayLabel??e.message??"";let z=e.displayLabel??e.message??"";if(R&&z.length>S){const V=Math.max(S-1,1);z=`${z.slice(0,V).trimEnd()}${z.length>V?"…":""}`}const T=R?e.bounds.x+8:e.bounds.x+e.bounds.width/2,et=R?"start":"middle",Q=r+l/2,ft=Jt(e),gt=V=>{typeof V?.stopPropagation=="function"&&V.stopPropagation(),typeof L=="function"&&L({phase:e.phase,status:e.status,reasons:e.reasons,message:e.message,startIndex:e.startIndex,endIndex:e.endIndex,limitIndex:Rt,label:e.displayLabel??e.message??null})},mt=V=>{(V.key==="Enter"||V.key===" ")&&(V.preventDefault(),gt(V))};return t.jsxs("g",{children:[t.jsx("rect",{x:e.bounds.x,y:r,width:e.bounds.width,height:l,fill:Y,pointerEvents:"none"}),t.jsxs("text",{x:T,y:Q,fill:ft,fontSize:at,fontWeight:600,dominantBaseline:"middle",textAnchor:et,role:"button","aria-label":g,tabIndex:0,onClick:gt,onKeyDown:mt,style:{cursor:"pointer",userSelect:"none",lineHeight:1.2,textShadow:Qt},pointerEvents:"auto",children:[t.jsx("title",{children:g}),z]})]},e.key)})}),M&&Ie&&Bt!==null&&(kt?t.jsx("line",{x1:je,y1:Bt,x2:le,y2:Bt,stroke:ce,strokeWidth:Pt,strokeDasharray:we,opacity:Lt}):t.jsx(wt.path,{d:`M ${je} ${Bt} L ${le} ${Bt}`,stroke:ce,strokeWidth:Pt,strokeDasharray:we,opacity:Lt,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:Lt},transition:{duration:4,ease:"easeInOut",delay:.5}})),t.jsx(In,{data:O,allDataPoints:i,getX:F,getY:$t,baselineY:yt,temperatureField:"displayTemperature",reduceMotion:kt,connectGaps:!A}),Le&&t.jsx("g",{pointerEvents:"none",children:t.jsx("path",{d:Le,fill:"none",stroke:"#cc0e93",strokeWidth:4,strokeLinecap:"round",strokeLinejoin:"round",opacity:.9})}),u!==null&&vt!==null&&Zt>0&&t.jsx("g",{pointerEvents:"none",children:(()=>{const e=yt,r=Math.max(3,Math.min(14,Zt*.4)),l=Math.max(r*2,se*.85);return t.jsxs(t.Fragment,{children:[t.jsx("line",{x1:vt,y1:0,x2:vt,y2:e,stroke:"rgba(235, 171, 204,0.15)",strokeWidth:r}),t.jsx("line",{x1:vt,y1:e,x2:vt,y2:nt,stroke:"rgba(235, 171, 204,0.15)",strokeWidth:l})]})})()}),t.jsx(An,{data:i,getX:F,getY:$t,isFullScreen:s,orientation:It,responsiveFontSize:Et,onPointInteraction:$e,clearActivePoint:Ue,activePoint:Mt,visibleRange:be,padding:k,chartHeight:nt,chartWidth:G,temperatureField:"displayTemperature",textRowHeight:se,graphBottomY:yt,rowsZoneHeight:Ht,compact:!1,reduceMotion:kt,isScrolling:ie,showInterpretation:M,ovulationDetails:_,baselineStartIndex:ge,firstHighIndex:J,baselineIndices:ye,graphBottomLift:Gt,showRelationsRow:tt,autoLabelStep:A})]})]})})}),!A&&Mt&&t.jsx(wt.div,{ref:pt,initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:10},transition:{duration:.12,ease:"easeOut"},children:t.jsx(yn,{point:Mt,position:ot,chartWidth:G,chartHeight:nt,onToggleIgnore:Oe,onEdit:B,onClose:me,onTogglePeak:c,currentPeakIsoDate:E})})]})})};export{Gn as F};
