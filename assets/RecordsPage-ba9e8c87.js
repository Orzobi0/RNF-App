import{c as Yt,r as n,E as ot,F as je,G as nt,H as Xt,I as Jt,J as De,K as Qt,N as Zt,O as es,Q as ts,S as ss,T as rs,V as os,W as ns,X as as,b as is,p as M,Y as le,f as U,s as He,D as ft,e as ls,j as r,m as T,B as pt,R as mt}from"./index-a6c447c5.js";import{C as cs}from"./CycleDatesEditor-3688eabe.js";import{c as ds,m as ht,h as Ie,i as _e,j as us,k as We,D as fs,F as gt,T as Nt,b as ps,d as St,e as Bt,P as Ct}from"./computePeakStatuses-5c65dc01.js";import{D as ms}from"./DeletionDialog-e098040e.js";import{u as hs,D as gs,a as xs}from"./useCycleData-1ec13a38.js";import{P as bs,e as ye,B as xt}from"./badge-29ccf1d1.js";import{e as bt}from"./checkbox-2914330c.js";import{P as vs}from"./pen-square-ec264279.js";import{P as ys,T as ws}from"./trash-2-6db2055e.js";import"./OverlapWarningDialog-60ecf11f.js";import"./input-620e50d2.js";import"./label-fe40f887.js";import"./eye-0f3c0a93.js";const vt=Yt("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]);function Rt(){const e=n.useRef(!1);return ot(()=>(e.current=!0,()=>{e.current=!1}),[]),e}function js(){const e=Rt(),[t,a]=n.useState(0),o=n.useCallback(()=>{e.current&&a(t+1)},[t]);return[n.useCallback(()=>je.postRender(o),[o]),t]}class Ds extends n.Component{getSnapshotBeforeUpdate(t){const a=this.props.childRef.current;if(a&&t.isPresent&&!this.props.isPresent){const o=this.props.sizeRef.current;o.height=a.offsetHeight||0,o.width=a.offsetWidth||0,o.top=a.offsetTop,o.left=a.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function ks({children:e,isPresent:t}){const a=n.useId(),o=n.useRef(null),l=n.useRef({width:0,height:0,top:0,left:0});return n.useInsertionEffect(()=>{const{width:u,height:c,top:p,left:m}=l.current;if(t||!o.current||!u||!c)return;o.current.dataset.motionPopId=a;const x=document.createElement("style");return document.head.appendChild(x),x.sheet&&x.sheet.insertRule(`
          [data-motion-pop-id="${a}"] {
            position: absolute !important;
            width: ${u}px !important;
            height: ${c}px !important;
            top: ${p}px !important;
            left: ${m}px !important;
          }
        `),()=>{document.head.removeChild(x)}},[t]),n.createElement(Ds,{isPresent:t,childRef:o,sizeRef:l},n.cloneElement(e,{ref:o}))}const Qe=({children:e,initial:t,isPresent:a,onExitComplete:o,custom:l,presenceAffectsLayout:u,mode:c})=>{const p=nt(Es),m=n.useId(),x=n.useMemo(()=>({id:m,initial:t,isPresent:a,custom:l,onExitComplete:f=>{p.set(f,!0);for(const g of p.values())if(!g)return;o&&o()},register:f=>(p.set(f,!1),()=>p.delete(f))}),u?void 0:[a]);return n.useMemo(()=>{p.forEach((f,g)=>p.set(g,!1))},[a]),n.useEffect(()=>{!a&&!p.size&&o&&o()},[a]),c==="popLayout"&&(e=n.createElement(ks,{isPresent:a},e)),n.createElement(Xt.Provider,{value:x},e)};function Es(){return new Map}function Ns(e){return n.useEffect(()=>()=>e(),[])}const ce=e=>e.key||"";function Ss(e,t){e.forEach(a=>{const o=ce(a);t.set(o,a)})}function Bs(e){const t=[];return n.Children.forEach(e,a=>{n.isValidElement(a)&&t.push(a)}),t}const et=({children:e,custom:t,initial:a=!0,onExitComplete:o,exitBeforeEnter:l,presenceAffectsLayout:u=!0,mode:c="sync"})=>{const p=n.useContext(Jt).forceRender||js()[0],m=Rt(),x=Bs(e);let f=x;const g=n.useRef(new Map).current,y=n.useRef(f),N=n.useRef(new Map).current,P=n.useRef(!0);if(ot(()=>{P.current=!1,Ss(x,N),y.current=f}),Ns(()=>{P.current=!0,N.clear(),g.clear()}),P.current)return n.createElement(n.Fragment,null,f.map(E=>n.createElement(Qe,{key:ce(E),isPresent:!0,initial:a?void 0:!1,presenceAffectsLayout:u,mode:c},E)));f=[...f];const H=y.current.map(ce),$=x.map(ce),ge=H.length;for(let E=0;E<ge;E++){const w=H[E];$.indexOf(w)===-1&&!g.has(w)&&g.set(w,void 0)}return c==="wait"&&g.size&&(f=[]),g.forEach((E,w)=>{if($.indexOf(w)!==-1)return;const C=N.get(w);if(!C)return;const de=H.indexOf(w);let R=E;if(!R){const oe=()=>{g.delete(w);const ne=Array.from(N.keys()).filter(V=>!$.includes(V));if(ne.forEach(V=>N.delete(V)),y.current=x.filter(V=>{const ee=ce(V);return ee===w||ne.includes(ee)}),!g.size){if(m.current===!1)return;p(),o&&o()}};R=n.createElement(Qe,{key:ce(C),isPresent:!1,onExitComplete:oe,custom:t,presenceAffectsLayout:u,mode:c},C),g.set(w,R)}f.splice(de,0,R)}),f=f.map(E=>{const w=E.key;return g.has(w)?E:n.createElement(Qe,{key:ce(E),isPresent:!0,presenceAffectsLayout:u,mode:c},E)}),n.createElement(n.Fragment,null,g.size?f:f.map(E=>n.cloneElement(E)))};function Cs(e){const t=nt(()=>De(e)),{isStatic:a}=n.useContext(Qt);if(a){const[,o]=n.useState(e);n.useEffect(()=>t.on("change",o),[])}return t}function Rs(e,t,a){n.useInsertionEffect(()=>e.on(t,a),[e,t,a])}function Ms(e,t,a){var o;if(typeof e=="string"){let l=document;t&&(Zt(!!t.current),l=t.current),a?((o=a[e])!==null&&o!==void 0||(a[e]=l.querySelectorAll(e)),e=a[e]):e=l.querySelectorAll(e)}else e instanceof Element&&(e=[e]);return Array.from(e||[])}const Ve=new WeakMap;let re;function Ts(e,t){if(t){const{inlineSize:a,blockSize:o}=t[0];return{width:a,height:o}}else return e instanceof SVGElement&&"getBBox"in e?e.getBBox():{width:e.offsetWidth,height:e.offsetHeight}}function $s({target:e,contentRect:t,borderBoxSize:a}){var o;(o=Ve.get(e))===null||o===void 0||o.forEach(l=>{l({target:e,contentSize:t,get size(){return Ts(e,a)}})})}function zs(e){e.forEach($s)}function As(){typeof ResizeObserver>"u"||(re=new ResizeObserver(zs))}function Ps(e,t){re||As();const a=Ms(e);return a.forEach(o=>{let l=Ve.get(o);l||(l=new Set,Ve.set(o,l)),l.add(t),re==null||re.observe(o)}),()=>{a.forEach(o=>{const l=Ve.get(o);l==null||l.delete(t),l!=null&&l.size||re==null||re.unobserve(o)})}}const Ge=new Set;let Ee;function Ls(){Ee=()=>{const e={width:window.innerWidth,height:window.innerHeight},t={target:window,size:e,contentSize:e};Ge.forEach(a=>a(t))},window.addEventListener("resize",Ee)}function Os(e){return Ge.add(e),Ee||Ls(),()=>{Ge.delete(e),!Ge.size&&Ee&&(Ee=void 0)}}function Fs(e,t){return typeof e=="function"?Os(e):Ps(e,t)}const Hs=50,yt=()=>({current:0,offset:[],progress:0,scrollLength:0,targetOffset:0,targetLength:0,containerLength:0,velocity:0}),Is=()=>({time:0,x:yt(),y:yt()}),_s={x:{length:"Width",position:"Left"},y:{length:"Height",position:"Top"}};function wt(e,t,a,o){const l=a[t],{length:u,position:c}=_s[t],p=l.current,m=a.time;l.current=e["scroll"+c],l.scrollLength=e["scroll"+u]-e["client"+u],l.offset.length=0,l.offset[0]=0,l.offset[1]=l.scrollLength,l.progress=es(0,l.scrollLength,l.current);const x=o-m;l.velocity=x>Hs?0:ts(l.current-p,x)}function Ws(e,t,a){wt(e,"x",t,a),wt(e,"y",t,a),t.time=a}function Vs(e,t){const a={x:0,y:0};let o=e;for(;o&&o!==t;)if(o instanceof HTMLElement)a.x+=o.offsetLeft,a.y+=o.offsetTop,o=o.offsetParent;else if(o.tagName==="svg"){const l=o.getBoundingClientRect();o=o.parentElement;const u=o.getBoundingClientRect();a.x+=l.left-u.left,a.y+=l.top-u.top}else if(o instanceof SVGGraphicsElement){const{x:l,y:u}=o.getBBox();a.x+=l,a.y+=u;let c=null,p=o.parentNode;for(;!c;)p.tagName==="svg"&&(c=p),p=o.parentNode;o=c}else break;return a}const Gs={Enter:[[0,1],[1,1]],Exit:[[0,0],[1,0]],Any:[[1,0],[0,1]],All:[[0,0],[1,1]]},tt={start:0,center:.5,end:1};function jt(e,t,a=0){let o=0;if(tt[e]!==void 0&&(e=tt[e]),typeof e=="string"){const l=parseFloat(e);e.endsWith("px")?o=l:e.endsWith("%")?e=l/100:e.endsWith("vw")?o=l/100*document.documentElement.clientWidth:e.endsWith("vh")?o=l/100*document.documentElement.clientHeight:e=l}return typeof e=="number"&&(o=t*e),a+o}const Ks=[0,0];function qs(e,t,a,o){let l=Array.isArray(e)?e:Ks,u=0,c=0;return typeof e=="number"?l=[e,e]:typeof e=="string"&&(e=e.trim(),e.includes(" ")?l=e.split(" "):l=[e,tt[e]?e:"0"]),u=jt(l[0],a,o),c=jt(l[1],t),u-c}const Us={x:0,y:0};function Ys(e){return"getBBox"in e&&e.tagName!=="svg"?e.getBBox():{width:e.clientWidth,height:e.clientHeight}}function Xs(e,t,a){let{offset:o=Gs.All}=a;const{target:l=e,axis:u="y"}=a,c=u==="y"?"height":"width",p=l!==e?Vs(l,e):Us,m=l===e?{width:e.scrollWidth,height:e.scrollHeight}:Ys(l),x={width:e.clientWidth,height:e.clientHeight};t[u].offset.length=0;let f=!t[u].interpolate;const g=o.length;for(let y=0;y<g;y++){const N=qs(o[y],x[c],m[c],p[u]);!f&&N!==t[u].interpolatorOffsets[y]&&(f=!0),t[u].offset[y]=N}f&&(t[u].interpolate=ss(t[u].offset,rs(o)),t[u].interpolatorOffsets=[...t[u].offset]),t[u].progress=t[u].interpolate(t[u].current)}function Js(e,t=e,a){if(a.x.targetOffset=0,a.y.targetOffset=0,t!==e){let o=t;for(;o&&o!==e;)a.x.targetOffset+=o.offsetLeft,a.y.targetOffset+=o.offsetTop,o=o.offsetParent}a.x.targetLength=t===e?t.scrollWidth:t.clientWidth,a.y.targetLength=t===e?t.scrollHeight:t.clientHeight,a.x.containerLength=e.clientWidth,a.y.containerLength=e.clientHeight}function Qs(e,t,a,o={}){return{measure:()=>Js(e,o.target,a),update:l=>{Ws(e,a,l),(o.offset||o.target)&&Xs(e,a,o)},notify:()=>t(a)}}const we=new WeakMap,Dt=new WeakMap,Ze=new WeakMap,kt=e=>e===document.documentElement?window:e;function Zs(e,{container:t=document.documentElement,...a}={}){let o=Ze.get(t);o||(o=new Set,Ze.set(t,o));const l=Is(),u=Qs(t,e,l,a);if(o.add(u),!we.has(t)){const p=()=>{for(const y of o)y.measure()},m=()=>{for(const y of o)y.update(ns.timestamp)},x=()=>{for(const y of o)y.notify()},f=()=>{je.read(p,!1,!0),je.read(m,!1,!0),je.update(x,!1,!0)};we.set(t,f);const g=kt(t);window.addEventListener("resize",f,{passive:!0}),t!==document.documentElement&&Dt.set(t,Fs(t,f)),g.addEventListener("scroll",f,{passive:!0})}const c=we.get(t);return je.read(c,!1,!0),()=>{var p;os(c);const m=Ze.get(t);if(!m||(m.delete(u),m.size))return;const x=we.get(t);we.delete(t),x&&(kt(t).removeEventListener("scroll",x),(p=Dt.get(t))===null||p===void 0||p(),window.removeEventListener("resize",x))}}function Et(e,t){as(!!(!t||t.current))}const er=()=>({scrollX:De(0),scrollY:De(0),scrollXProgress:De(0),scrollYProgress:De(0)});function tr({container:e,target:t,layoutEffect:a=!0,...o}={}){const l=nt(er);return(a?ot:n.useEffect)(()=>(Et("target",t),Et("container",e),Zs(({x:c,y:p})=>{l.scrollX.set(c.current),l.scrollXProgress.set(c.progress),l.scrollY.set(p.current),l.scrollYProgress.set(p.progress)},{...o,container:(e==null?void 0:e.current)||void 0,target:(t==null?void 0:t.current)||void 0})),[e,t,JSON.stringify(o.offset)]),l}const sr=e=>gt.find(t=>t.value===e)||gt[0],st=10,rt={default:{iconBg:"bg-slate-50",iconBorder:"border-slate-200",iconColor:"text-slate-500",labelColor:"text-slate-600",valueColor:"text-slate-600",chipBorder:"border-slate-200",chipBg:"bg-white/80",hoverBg:"hover:bg-slate-50",focusRing:"focus-visible:ring-2 focus-visible:ring-slate-200"},temperature:{iconBg:"bg-orange-50",iconBorder:"border-orange-100",iconColor:"text-orange-500",labelColor:"text-orange-600",valueColor:"text-orange-600",chipBorder:"border-orange-100",hoverBg:"hover:bg-orange-50",focusRing:"focus-visible:ring-2 focus-visible:ring-orange-100"},time:{iconBg:"bg-slate-50",iconBorder:"border-slate-200",iconColor:"text-slate-500",labelColor:"text-slate-500",valueColor:"text-slate-600",chipBorder:"border-slate-200",hoverBg:"hover:bg-slate-50",focusRing:"focus-visible:ring-2 focus-visible:ring-slate-200"},mucusSensation:{iconBg:"bg-sky-50",iconBorder:"border-sky-100",iconColor:"text-sky-500",labelColor:"text-sky-600",valueColor:"text-sky-600",chipBorder:"border-sky-100",hoverBg:"hover:bg-sky-50",focusRing:"focus-visible:ring-2 focus-visible:ring-sky-100"},mucusAppearance:{iconBg:"bg-emerald-50",iconBorder:"border-emerald-100",iconColor:"text-emerald-500",labelColor:"text-emerald-600",valueColor:"text-emerald-600",chipBorder:"border-emerald-100",hoverBg:"hover:bg-emerald-50",focusRing:"focus-visible:ring-2 focus-visible:ring-emerald-100"},observations:{iconBg:"bg-violet-50",iconBorder:"border-violet-100",iconColor:"text-violet-500",labelColor:"text-violet-600",valueColor:"text-violet-600",chipBorder:"border-violet-100",hoverBg:"hover:bg-violet-50",focusRing:"focus-visible:ring-2 focus-visible:ring-violet-100"}},rr=(e={})=>{const t={...rt.default,dotColor:"bg-slate-300",patternClass:e!=null&&e.pattern?"pattern-bg":""};switch(e==null?void 0:e.value){case"red":return{...t,iconBg:"bg-rose-50",iconBorder:"border-rose-100",iconColor:"text-rose-500",labelColor:"text-rose-600",valueColor:"text-rose-600",chipBorder:"border-rose-100",hoverBg:"hover:bg-rose-50",focusRing:"focus-visible:ring-2 focus-visible:ring-rose-100",dotColor:"bg-rose-400"};case"white":return{...t,iconBg:"bg-white",iconBorder:"border-slate-200",iconColor:"text-slate-500",labelColor:"text-slate-600",valueColor:"text-slate-600",chipBorder:"border-slate-200",hoverBg:"hover:bg-slate-50",focusRing:"focus-visible:ring-2 focus-visible:ring-slate-200",dotColor:"bg-slate-300"};case"green":return{...t,iconBg:"bg-emerald-50",iconBorder:"border-emerald-100",iconColor:"text-emerald-500",labelColor:"text-emerald-600",valueColor:"text-emerald-600",chipBorder:"border-emerald-100",hoverBg:"hover:bg-emerald-50",focusRing:"focus-visible:ring-2 focus-visible:ring-emerald-100",dotColor:"bg-emerald-400"};case"yellow":return{...t,iconBg:"bg-yellow-50",iconBorder:"border-yellow-100",iconColor:"text-yellow-500",labelColor:"text-yellow-600",valueColor:"text-yellow-600",chipBorder:"border-yellow-100",hoverBg:"hover:bg-yellow-50",focusRing:"focus-visible:ring-2 focus-visible:ring-yellow-100",dotColor:"bg-yellow-300"};case"spot":return{...t,iconBg:"bg-rose-50",iconBorder:"border-rose-100",iconColor:"text-rose-500",labelColor:"text-rose-600",valueColor:"text-rose-600",chipBorder:"border-rose-100",hoverBg:"hover:bg-rose-50",focusRing:"focus-visible:ring-2 focus-visible:ring-rose-100",dotColor:"bg-rose-400",patternClass:e!=null&&e.pattern?"pattern-bg":""};default:return t}},ke=e=>({...rt.default,...rt[e]||{}}),Mt=(e,{dependencies:t=[],externalRef:a,scrollContainerRef:o}={})=>{const l=n.useRef(null),u=Cs(1),c=u,{scrollY:p}=tr(),m=n.useCallback(()=>{var P;const f=l.current,g=(P=e==null?void 0:e.current)==null?void 0:P.getBoundingClientRect();if(!f||!g){u.set(1);return}const y=g.bottom+st;if(f.getBoundingClientRect().bottom<=y){u.set(0);return}u.set(1)},[e,u]);Rs(p,"change",m),n.useEffect(()=>{const f=o==null?void 0:o.current;if(!f)return;const g=()=>m();return f.addEventListener("scroll",g,{passive:!0}),m(),()=>{f.removeEventListener("scroll",g)}},[o,m,...t]);const x=n.useCallback(f=>{l.current=f,typeof a=="function"?a(f):a&&typeof a=="object"&&(a.current=f),f&&requestAnimationFrame(()=>m())},[a,m]);return n.useEffect(()=>{m();const f=()=>m();return window.addEventListener("resize",f),()=>{window.removeEventListener("resize",f)}},[m,...t]),n.useEffect(()=>{const f=l.current;if(!f||typeof ResizeObserver>"u")return;const g=new ResizeObserver(()=>m());return g.observe(f),()=>{g.disconnect()}},[m,...t]),{setRefs:x,opacity:c}},or=({isoDate:e,dayRef:t,onToggle:a,isSelected:o,displayDate:l,cycleDay:u,details:c,symbolLabel:p,isExpanded:m,onEdit:x,onDelete:f,isProcessing:g,calendarContainerRef:y,isCalendarOpen:N,scrollMarginTop:P,scrollContainerRef:H,onInlineEdit:$})=>{var V,ee,Ne,ue;const{setRefs:ge,opacity:E}=Mt(y,{dependencies:[m,N],externalRef:t,scrollContainerRef:H}),w=rr(c.symbolInfo),C=ke,de=(V=c==null?void 0:c.symbolInfo)==null?void 0:V.value,R=de&&de!=="none",oe=[{key:"temperatureTime",grouped:!0,items:[{key:"temperature",inlineKey:"temperature",palette:C("temperature"),icon:Nt,title:c.hasTemperature?`${c.displayTemp}°C`:"—",hasValue:c.hasTemperature,badge:c.showCorrectedIndicator?r.jsxs(xt,{className:"flex items-center justify-center rounded-full border border-amber-200 bg-amber-50 text-[0.65rem] font-semibold uppercase tracking-wide text-amber-500",title:"Temperatura corregida",children:[r.jsx("span",{"aria-hidden":"true",children:"•"}),r.jsx("span",{className:"sr-only",children:"Temperatura corregida"})]}):null},{key:"time",inlineKey:"time",palette:C("time"),icon:ps,title:c.timeValue||"—",hasValue:!!c.timeValue}]},{key:"sensationAppearance",grouped:!0,items:[{key:"mucusSensation",inlineKey:"mucusSensation",palette:C("mucusSensation"),icon:St,title:c.mucusSensation||"—",hasValue:!!c.mucusSensation},{key:"mucusAppearance",inlineKey:"mucusAppearance",palette:C("mucusAppearance"),icon:Bt,title:c.mucusAppearance||"—",hasValue:!!c.mucusAppearance}]},{key:"observationsAndSymbol",grouped:!0,items:[{key:"observations",inlineKey:"observations",palette:C("observations"),icon:Ct,title:(ee=c.observationsText)!=null&&ee.trim()?c.observationsText:"—",hasValue:!!((Ne=c.observationsText)!=null&&Ne.trim()),isMultiline:!0,minWidthClass:"min-w-[9rem]"},{key:"fertilitySymbol",inlineKey:"fertilitySymbol",palette:w,title:p||"Sin símbolo",hasValue:!!R,minWidthClass:"min-w-[7.5rem]"},{key:"editAction",isAction:!0,icon:ys,ariaLabel:"Editar registro",onClick:j=>{j.stopPropagation(),x(c.record)},disabled:g},{key:"deleteAction",isAction:!0,icon:ws,ariaLabel:"Eliminar registro",onClick:j=>{j.stopPropagation(),f(c.record.id)},disabled:g}]}],ne=(j,G)=>{if(j.grouped)return r.jsxs(mt.Fragment,{children:[G>0&&r.jsx("div",{className:"my-1.5 border-t border-slate-100"}),r.jsx("div",{className:"flex flex-wrap gap-1.5",children:j.items.map(v=>{if(v.isAction){const K=v.icon;return r.jsx("button",{type:"button",className:"flex h-8 w-8 items-center justify-center rounded-full border border-rose-200 bg-white/80 text-rose-600 shadow-sm transition-colors hover:bg-rose-50 focus:outline-none focus-visible:ring-2 focus-visible:ring-rose-200 disabled:cursor-not-allowed disabled:opacity-60",onClick:L=>{var xe;L.preventDefault(),L.stopPropagation(),(xe=v.onClick)==null||xe.call(v,L)},"aria-label":v.ariaLabel,disabled:v.disabled,children:r.jsx(K,{className:"h-4 w-4"})},v.key)}const z=v.palette||C(v.key),_=v.icon,Ke=v.hasValue??!!v.title,Be=v.title||"-",Ce=v.minWidthClass||"min-w-[8rem]",J=v.renderIcon?v.renderIcon():_?r.jsx("span",{className:`flex h-6 w-6 shrink-0 items-center justify-center rounded-full border ${z.iconBorder} ${z.iconBg}`,children:r.jsx(_,{className:`h-3 w-3 ${z.iconColor}`})}):null,ae=J?"gap-2.5":"gap-1.5";return r.jsxs("button",{type:"button",className:`flex ${Ce} flex-1 items-center ${ae} rounded-2xl border ${z.chipBorder} ${z.chipBg} px-2.5 py-1.5 text-left transition-colors ${z.hoverBg} focus:outline-none ${z.focusRing}`,onClick:K=>{K.stopPropagation(),K.preventDefault(),typeof $=="function"&&$(v.inlineKey||v.key)},children:[J,r.jsx("div",{className:"min-w-0 flex-1",children:r.jsxs("div",{className:"flex items-start gap-1.5",children:[r.jsx("span",{className:`text-sm font-semibold leading-tight ${Ke?z.valueColor:"text-slate-400"} ${v.isMultiline?"whitespace-pre-line break-words":"truncate"}`,children:Be}),v.badge&&r.jsx("span",{className:"shrink-0",children:v.badge})]})})]},v.key)})})]},j.key);const b=j.palette||C(j.key),I=j.icon,te=j.value?b.valueColor:"text-slate-400",Y=j.value??"—",Se=I?r.jsx("span",{className:`mt-0.5 flex h-6 w-6 shrink-0 items-center justify-center rounded-full border ${b.iconBorder} ${b.iconBg}`,children:r.jsx(I,{className:`h-3 w-3 ${b.iconColor}`})}):null,X=Se?"gap-2.5":"gap-1.5";return r.jsxs(mt.Fragment,{children:[G>0&&r.jsx("div",{className:"my-1.5 border-t border-slate-100"}),r.jsxs("button",{type:"button",className:`flex w-full items-start gap-3 rounded-2xl border ${b.chipBorder} ${b.chipBg} px-2.5 py-1.5 text-left transition-colors ${b.hoverBg} focus:outline-none ${b.focusRing}`,onClick:v=>{v.stopPropagation(),v.preventDefault(),typeof $=="function"&&$(j.key)},children:[r.jsxs("div",{className:`flex min-w-0 flex-1 items-start ${X} ${j.isMultiline?"pt-0.5":""}`,children:[Se,r.jsx("div",{className:"min-w-0 flex-1",children:r.jsx("span",{className:`block text-sm leading-snug ${te} ${j.isMultiline?"whitespace-pre-line":"truncate"}`,children:Y})})]}),j.badge&&r.jsx("span",{className:"shrink-0 self-center",children:j.badge})]})]},j.key)};return r.jsxs(T.div,{layout:!0,ref:ge,onClick:()=>a(e),className:`group relative mx-0.5 flex w-full cursor-pointer flex-col rounded-2xl border border-rose-100 bg-white/75 px-4 py-3 shadow-sm backdrop-blur-md transition-all duration-300 hover:shadow-lg sm:mx-1 sm:px-5 ${o?"bg-white/90 ring-2 ring-rose-400 shadow-rose-200/70":""}`,whileHover:{translateY:-2},style:{opacity:E,scrollMarginTop:P},children:[r.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[r.jsxs("div",{className:"flex items-center gap-1 text-sm font-semibold text-slate-700",children:[r.jsx(We,{className:"h-4 w-4 text-rose-400"}),l]}),r.jsxs("span",{className:"text-sm font-semibold text-rose-600 ",children:["D",u]}),r.jsx(ir,{hasTemperature:c.hasTemperature,hasMucusSensation:c.hasMucusSensation,hasMucusAppearance:c.hasMucusAppearance,hasObservations:c.hasObservations,peakStatus:c.peakStatus,isPeakDay:c.isPeakDay}),r.jsx("div",{className:"ml-auto flex items-center",children:r.jsx("div",{className:`flex h-6 w-6 items-center justify-center rounded-full border ${w.dotColor} ${w.patternClass} shadow-inner`,title:p})})]}),r.jsx(et,{initial:!1,children:m&&r.jsx(T.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.25,ease:"easeInOut"},className:"mt-1.5 overflow-hidden",children:r.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white/80 p-2 shadow-sm",children:[r.jsxs("div",{className:"flex flex-wrap items-center gap-1 text-[0.65rem] font-semibold uppercase tracking-wide text-slate-500",children:[r.jsx(Tt,{peakStatus:c.peakStatus,isPeakDay:c.isPeakDay,size:"small"}),(c.isPeakDay||c.peakStatus==="P")&&r.jsx("span",{className:"text-rose-600",children:"Día pico"}),((ue=c.record)==null?void 0:ue.ignored)&&r.jsxs(xt,{className:"flex items-center gap-1 rounded-full border border-slate-200 bg-slate-50 text-[0.65rem] font-semibold uppercase tracking-wide text-slate-400",title:"Registro ignorado",children:[r.jsx("span",{"aria-hidden":"true",className:"h-2 w-2 rounded-full bg-slate-300"}),r.jsx("span",{className:"sr-only",children:"Registro ignorado"})]})]}),r.jsx("div",{className:"mt-1.5 space-y-1.5",children:oe.map((j,G)=>ne(j,G))})]})})})]})},nr=({id:e,days:t,toggleEmptyGroup:a,isExpandedGroup:o,hasSelectedInGroup:l,calendarContainerRef:u,isCalendarOpen:c,children:p,scrollMarginTop:m,scrollContainerRef:x})=>{const{setRefs:f,opacity:g}=Mt(u,{dependencies:[o,c,t.length],scrollContainerRef:x});return r.jsx(T.button,{type:"button",ref:f,onClick:()=>a(e),className:`flex w-full items-center justify-between rounded-2xl border border-dashed border-rose-300 bg-white/40 px-4 py-3 text-sm font-medium text-slate-500 backdrop-blur-sm transition-all duration-200 hover:border-rose-500 hover:bg-white/70 ${l?"ring-2 ring-rose-300 text-rose-500 shadow-rose-200/70":""}`,whileHover:{scale:1.01},whileTap:{scale:.99},"aria-expanded":o,style:{opacity:g,scrollMarginTop:m},children:p})},ar=e=>{if(e==null||e==="")return null;const t=Number(String(e).replace(",","."));return Number.isNaN(t)?null:t.toFixed(2)},Tt=({peakStatus:e,isPeakDay:t,size:a="default",className:o=""})=>{let l=null,u="",c="border border-slate-200 bg-slate-100 text-slate-500";if(t||e==="P"?(l="✖",u="Día pico",c="border border-rose-200 bg-rose-100 text-rose-600"):e==="1"?(l="+1",u="Post día pico +1",c="border border-rose-200 bg-rose-50 text-rose-500"):e==="2"?(l="+2",u="Post día pico +2",c="border border-rose-200 bg-rose-50 text-rose-500"):e==="3"&&(l="+3",u="Post día pico +3",c="border border-rose-200 bg-rose-50 text-rose-500"),!l)return null;const p=a==="small"?"h-5 w-5 text-[0.6rem]":"h-6 w-6 text-xs";return r.jsx("span",{role:"img","aria-label":u,title:u,className:`flex items-center justify-center rounded-full font-semibold shadow-sm shadow-rose-200/40 transition-transform duration-200 ${p} ${c} ${o}`,children:l})},ir=({hasTemperature:e,hasMucusSensation:t,hasMucusAppearance:a,hasObservations:o,peakStatus:l,isPeakDay:u})=>{const c="flex items-center justify-center w-5 h-5 rounded-full text-[0.6rem] shadow-sm transition-transform duration-200",p=ke("temperature"),m=ke("mucusSensation"),x=ke("mucusAppearance"),f=ke("observations");return r.jsxs("div",{className:"flex items-center gap-1.5",children:[r.jsx(Tt,{peakStatus:l,isPeakDay:u,size:"small"}),e&&r.jsx("span",{className:`${c} border ${p.iconBorder} ${p.iconBg}`,children:r.jsx(Nt,{className:`h-2.5 w-2.5 ${p.iconColor}`})}),t&&r.jsx("span",{className:`${c} border ${m.iconBorder} ${m.iconBg}`,children:r.jsx(St,{className:`h-2.5 w-2.5 ${m.iconColor}`})}),a&&r.jsx("span",{className:`${c} border ${x.iconBorder} ${x.iconBg}`,children:r.jsx(Bt,{className:`h-2.5 w-2.5 ${x.iconColor}`})}),o&&r.jsx("span",{className:`${c} border ${f.iconBorder} ${f.iconBg}`,children:r.jsx(Ct,{className:`h-2.5 w-2.5 ${f.iconColor}`})})]})},wr=()=>{const{currentCycle:e,addOrUpdateDataPoint:t,deleteRecord:a,isLoading:o,updateCycleDates:l,checkCycleOverlap:u,forceUpdateCycleStart:c,refreshData:p}=hs(),{toast:m}=is(),[x,f]=n.useState(!1),[g,y]=n.useState(null),[N,P]=n.useState(null),[H,$]=n.useState(!1),[ge,E]=n.useState(!1),[w,C]=n.useState(()=>(e==null?void 0:e.startDate)||""),[de,R]=n.useState(""),[oe,ne]=n.useState(null),[V,ee]=n.useState(null),[Ne,ue]=n.useState(!1),[j,G]=n.useState(!1),[b,I]=n.useState(null),[te,Y]=n.useState(null),[Se,X]=n.useState(null),[v,z]=n.useState(null),[_,Ke]=n.useState(!0),[Be,Ce]=n.useState([]),J=n.useRef(null),ae=n.useRef(null),K=n.useRef({}),L=n.useRef(!1),xe=n.useRef(0),[Re,at]=n.useState(0),qe=n.useCallback(s=>i=>{s&&(i?K.current[s]=i:delete K.current[s])},[]),Me=n.useCallback(()=>{const s=J.current;if(!s){xe.current=0,at(0);return}const d=s.getBoundingClientRect().height;xe.current=d,at(h=>Math.abs(h-d)>.5?d:h)},[]);n.useLayoutEffect(()=>{let s=window.requestAnimationFrame(Me);const i=()=>{s&&window.cancelAnimationFrame(s),s=window.requestAnimationFrame(Me)};window.addEventListener("resize",i);let d;return typeof ResizeObserver<"u"&&(d=new ResizeObserver(()=>{s&&window.cancelAnimationFrame(s),s=window.requestAnimationFrame(Me)}),J.current&&d.observe(J.current)),()=>{window.removeEventListener("resize",i),d&&d.disconnect(),s&&window.cancelAnimationFrame(s)}},[Me]);const fe=n.useCallback((s,{behavior:i="smooth",forceAlignTop:d=!1}={})=>{const h=ae.current;if(!s||!h)return;const D=h.getBoundingClientRect(),B=s.getBoundingClientRect(),k=B.top-D.top+h.scrollTop,O=k+B.height,A=h.scrollTop,ie=A+h.clientHeight;if(d||k<A){h.scrollTo({top:Math.max(k-12,0),behavior:i});return}if(O>ie){const se=Math.max(O-h.clientHeight+12,0);h.scrollTo({top:se,behavior:i})}},[]),Te=n.useMemo(()=>Math.max(Math.round(Re+st),st),[Re]),$e=n.useMemo(()=>Te,[Te]);n.useEffect(()=>{C((e==null?void 0:e.startDate)||"")},[e==null?void 0:e.startDate]);const pe=n.useMemo(()=>{var s;return(s=e==null?void 0:e.data)!=null&&s.length?[...e.data].filter(i=>i==null?void 0:i.isoDate).sort((i,d)=>{const h=M(i.isoDate);return M(d.isoDate)-h}).map(i=>i.isoDate):[]},[e==null?void 0:e.data]);n.useEffect(()=>{if(!pe.length){I(null),Y(null);return}(!b||!pe.includes(b))&&(L.current=!1,I(pe[0]))},[pe,b]),n.useEffect(()=>{if(!b||!L.current)return;const s=K.current[b];if(!s)return;const i=window.requestAnimationFrame(()=>{fe(s,{behavior:"smooth",forceAlignTop:!0}),L.current=!1});return()=>{window.cancelAnimationFrame(i)}},[b,Be,_,fe]),n.useEffect(()=>{if(!te)return;const s=K.current[te];if(!s)return;const i=window.requestAnimationFrame(()=>{fe(s,{behavior:"smooth"})});return()=>{window.cancelAnimationFrame(i)}},[te,fe,_,Re]),n.useEffect(()=>{const s=te||b;if(!s)return;const i=K.current[s];i&&fe(i,{behavior:"auto"})},[Re,_,te,b,fe]),n.useEffect(()=>{const s=ae.current;s&&s.scrollTo({top:0,behavior:"auto"})},[]);const me=n.useMemo(()=>{var s;return(s=e==null?void 0:e.data)!=null&&s.length?e.data.map(i=>{if(!(i!=null&&i.isoDate))return null;const d=M(i.isoDate);return le(d)?d:null}).filter(Boolean):[]},[e==null?void 0:e.data]),it=n.useMemo(()=>new Set(pe),[pe]),lt=n.useMemo(()=>ds((e==null?void 0:e.data)??[]),[e==null?void 0:e.data]),ze=n.useMemo(()=>{var i;const s=new Map;return(i=e==null?void 0:e.data)!=null&&i.length&&e.data.forEach(d=>{var Fe;if(!(d!=null&&d.isoDate))return;const h=((Fe=d.measurements)==null?void 0:Fe.find(ve=>ve==null?void 0:ve.selected))||(d.temperature_chart||d.temperature_raw?{temperature:d.temperature_chart??d.temperature_raw,temperature_corrected:d.temperature_corrected??null,time:d.timestamp?U(M(d.timestamp),"HH:mm"):null,use_corrected:d.use_corrected??!1}:null),D=(h==null?void 0:h.use_corrected)??d.use_corrected??!1,B=(h==null?void 0:h.temperature_corrected)??d.temperature_corrected??null,k=(h==null?void 0:h.temperature)??d.temperature_chart??d.temperature_raw??null,A=ar(D&&B!==null&&B!==void 0&&B!==""?B:k??B),ie=A!==null,se=D&&B!==null&&B!==void 0&&B!=="";let F=null;h!=null&&h.time?F=h.time:d.timestamp&&le(M(d.timestamp))&&(F=U(M(d.timestamp),"HH:mm"));const q=d.mucusSensation??d.mucus_sensation??"",Pe=d.mucusAppearance??d.mucus_appearance??"",Le=!!q,Oe=!!Pe,Ue=Le||Oe,he=d.observations||"",Ye=!!he,Z=lt[d.isoDate]||null,Xe=d.peak_marker==="peak"||Z==="P",Je=sr(d.fertility_symbol);s.set(d.isoDate,{record:d,symbolInfo:Je,hasTemperature:ie,displayTemp:A,showCorrectedIndicator:se,timeValue:F,hasMucus:Ue,hasMucusSensation:Le,hasMucusAppearance:Oe,mucusSensation:q,mucusAppearance:Pe,hasObservations:Ye,observationsText:he,peakStatus:Z,isPeakDay:Xe})}),s},[e==null?void 0:e.data,lt]),S=n.useMemo(()=>{if(!(e!=null&&e.startDate))return null;const s=M(e.startDate);if(!le(s))return null;let i;if(e!=null&&e.endDate)i=M(e.endDate);else{const d=He(new Date),h=[s,d];me.length&&h.push(ht(me)),i=ht(h)}return le(i)?{from:s,to:i}:{from:s,to:s}},[e==null?void 0:e.startDate,e==null?void 0:e.endDate,me]),$t=n.useMemo(()=>{const s={};return S&&(s.outsideCycle=i=>Ie(i,S.from)||_e(i,S.to),s.insideCycleNoRecord=i=>{if(Ie(i,S.from)||_e(i,S.to))return!1;const d=U(i,"yyyy-MM-dd");return!it.has(d)}),me.length&&(s.hasRecord=me),s},[S,me,it]),W=n.useMemo(()=>{if(!(e!=null&&e.startDate))return[];const s=M(e.startDate);if(!le(s))return[];const i=He(s),d=He(new Date);let h=S!=null&&S.to?He(S.to):d;_e(h,d)&&(h=d),Ie(h,i)&&(h=i);const D=ft(h,i)+1;if(D<=0)return[];const B=[];for(let k=D-1;k>=0;k-=1){const O=ls(i,k),A=U(O,"yyyy-MM-dd"),ie=ft(O,i)+1,se=ze.get(A)||null;B.push({isoDate:A,date:O,cycleDay:ie,details:se})}return B},[e==null?void 0:e.startDate,S,ze]),zt=n.useMemo(()=>{if(!W.length)return{items:[],isoToGroup:{}};const s=[],i={};for(let d=0;d<W.length;){const h=W[d];if(h.details){s.push({type:"record",day:h}),d+=1;continue}let D=d;for(;D<W.length&&!W[D].details;)D+=1;if(D-d>3){const k=W.slice(d,D),O=`${k[0].isoDate}_${k[k.length-1].isoDate}`;k.forEach(({isoDate:A})=>{i[A]=O}),s.push({type:"empty-group",id:O,days:k})}else for(let k=d;k<D;k+=1)s.push({type:"empty-day",day:W[k]});d=D}return{items:s,isoToGroup:i}},[W]),{items:At,isoToGroup:ct}=zt,Pt=n.useCallback(s=>{s&&Ce(i=>i.includes(s)?i.filter(d=>d!==s):[...i,s])},[]);n.useEffect(()=>{if(!b)return;const s=ct[b];s&&Ce(i=>i.includes(s)?i:[...i,s])},[b,ct]);const Lt=n.useCallback(s=>{if(!s)return;const i=U(s,"yyyy-MM-dd");S&&(Ie(s,S.from)||_e(s,S.to))||(L.current=!0,I(i),ze.has(i)||Y(null))},[S,ze]),Q=n.useCallback(()=>{ne(null),ee(null),ue(!1)},[]),Ot=n.useCallback(()=>{C((e==null?void 0:e.startDate)||""),R(""),Q(),E(!0)},[e==null?void 0:e.startDate,Q]),be=n.useCallback(()=>{E(!1),R(""),Q(),C((e==null?void 0:e.startDate)||"")},[e==null?void 0:e.startDate,Q]),Ft=n.useCallback(()=>{Q()},[Q]),Ht=n.useCallback(async()=>{if(!w){R("La fecha de inicio es obligatoria");return}if(e!=null&&e.id){R(""),G(!0);try{const s=u?await u(e.id,w):null;if(s){ne(w),ee(s),ue(!0),G(!1);return}await l(e.id,w),await p({silent:!0}),m({title:"Fecha de inicio actualizada",description:"El ciclo se ha ajustado a la nueva fecha de inicio."}),be()}catch(s){console.error("Error updating start date from records page:",s),R("No se pudo actualizar la fecha de inicio"),m({title:"Error",description:"No se pudo actualizar la fecha de inicio.",variant:"destructive"})}finally{G(!1)}}},[w,e==null?void 0:e.id,u,l,p,m,be]),It=n.useCallback(async()=>{if(!(e!=null&&e.id)||!oe){Q();return}G(!0),ue(!1);try{await c(e.id,oe),await p({silent:!0}),m({title:"Fecha de inicio actualizada",description:"El ciclo se ha ajustado a la nueva fecha de inicio."}),be()}catch(s){console.error("Error forcing start date from records page:",s),R("No se pudo actualizar la fecha de inicio"),m({title:"Error",description:"No se pudo actualizar la fecha de inicio.",variant:"destructive"})}finally{G(!1),Q()}},[e==null?void 0:e.id,oe,c,p,m,be,Q]),dt=n.useCallback(()=>{f(!1),y(null),X(null),z(null)},[]),Ae=n.useCallback((s,i=null)=>{s&&(y(s),X(s.isoDate??null),z(i),s.isoDate&&(L.current=!1,I(s.isoDate),Y(s.isoDate)),f(!0))},[]),_t=n.useCallback(s=>Ae(s),[Ae]),Wt=n.useCallback((s,i)=>Ae(s,i),[Ae]),Vt=s=>{var d;const i=(d=e==null?void 0:e.data)==null?void 0:d.find(h=>h.id===s);P(i||null)},Gt=n.useCallback(s=>{y(s)},[]),Kt=n.useCallback((s,i)=>{s&&(L.current=!1,I(s),i&&Y(d=>d===s?null:s))},[]),ut=n.useCallback(s=>{s&&(L.current=!1,I(s),Y(null),y(null),X(s),z(null),f(!0))},[]),qt=async(s,{keepFormOpen:i=!1}={})=>{$(!0);try{await t(s,g),i||(f(!1),y(null),X(null),z(null))}catch{m({title:"Error",description:"No se pudo guardar el registro",variant:"destructive"})}finally{$(!1),i&&X((s==null?void 0:s.isoDate)??null)}},Ut=async()=>{if(N){$(!0);try{const s=N.isoDate;await a(N.id),P(null),X(null),s&&(Y(i=>i===s?null:i),b===s&&I(s))}catch{m({title:"Error",description:"No se pudo eliminar el registro",variant:"destructive"})}finally{$(!1)}}};return o&&!(e!=null&&e.id)?r.jsxs("div",{className:"min-h-[100dvh] bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100 flex items-center justify-center",children:[r.jsx("div",{className:"pointer-events-none absolute inset-0",style:{background:"radial-gradient(65% 55% at 50% 32%, rgba(244,114,182,0.18) 0%, rgba(244,114,182,0.12) 35%, rgba(244,114,182,0.06) 60%, rgba(244,114,182,0) 100%)"}}),r.jsx("p",{className:"text-center text-slate-600 text-lg",children:"Cargando..."})]}):e!=null&&e.id?r.jsxs("div",{className:"min-h-[100dvh] bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100 relative",children:[r.jsx("div",{className:"pointer-events-none absolute inset-0",style:{background:"radial-gradient(65% 55% at 50% 32%, rgba(244,114,182,0.18) 0%, rgba(244,114,182,0.12) 35%, rgba(244,114,182,0.06) 60%, rgba(244,114,182,0) 100%)"}}),r.jsxs("div",{className:"max-w-4xl mx-auto px-4 relative z-10",children:[r.jsx("div",{ref:J,className:"sticky top-1 z-50",children:r.jsx("div",{className:"relative overflow-hidden rounded-2xl ring-1 ring-rose-100/70",children:r.jsxs("div",{className:"space-y-2 p-2 sm:p-3 relative z-10",children:[r.jsx(T.div,{className:"flex flex-col gap-4",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:r.jsxs("div",{className:"flex flex-wrap items-center gap-1 justify-between sm:justify-start",children:[r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(vt,{className:"h-8 w-8 text-pink-500"}),r.jsxs("button",{type:"button",onClick:()=>Ke(s=>!s),className:"group flex items-center gap-1 rounded-full px-2 py-1 text-left shadow-sm transition-all hover:border-rose-300 hover:bg-white/20 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-400 focus-visible:ring-offset-2 focus-visible:ring-offset-rose-50","aria-expanded":_,"aria-controls":"records-calendar",children:[r.jsx("span",{className:"text-2xl sm:text-2xl font-bold text-slate-700",children:"Mis Registros"}),r.jsx("span",{className:"flex items-center gap-2",children:r.jsx(T.span,{animate:{rotate:_?180:0},className:"flex h-7 w-7 items-center justify-center rounded-full bg-rose-50 text-rose-400 shadow-inner",children:r.jsx(bt,{className:"h-4 w-4"})})})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs(pt,{type:"button",variant:"outline",size:"icon",onClick:Ot,className:"border-pink-200 rounded-full text-pink-600 hover:bg-pink-500",disabled:H||j,"aria-label":"Editar fecha de inicio",children:[r.jsx(vs,{className:"h-4 w-4"}),r.jsx("span",{className:"sr-only",children:"Editar fecha de inicio"})]}),r.jsxs(pt,{type:"button",size:"icon",onClick:()=>{const s=W.length?W[0].isoDate:e.startDate,i=b||s||null;y(null),X(i),L.current=!1,i&&(I(i),Y(null)),f(!0)},className:"rounded-full bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white shadow-lg",disabled:H,style:{filter:"drop-shadow(0 6px 12px rgba(236, 72, 153, 0.3))"},"aria-label":"Añadir registro",children:[r.jsx(bs,{className:"h-4 w-4"}),r.jsx("span",{className:"sr-only",children:"Añadir registro"})]})]})]})}),ge&&r.jsx(T.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.4},children:r.jsx(cs,{cycle:e,startDate:w,endDate:e.endDate,onStartDateChange:s=>C(s),onSave:Ht,onCancel:be,isProcessing:j,dateError:de,includeEndDate:!1,showOverlapDialog:Ne,overlapCycle:V,onConfirmOverlap:It,onCancelOverlap:Ft,onClearError:()=>R(""),saveLabel:"Guardar cambios",title:"Editar fecha de inicio",description:"Actualiza la fecha de inicio del ciclo actual. Los registros se reorganizarán automáticamente."})}),r.jsx(et,{initial:!1,children:_&&r.jsx(T.div,{id:"records-calendar",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"flex justify-center",children:r.jsx(us,{mode:"single",locale:ye,defaultMonth:b&&le(M(b))?M(b):S==null?void 0:S.to,selected:b&&le(M(b))?M(b):void 0,onDayClick:Lt,modifiers:$t,className:"w-full max-w-sm sm:max-w-md rounded-lg bg-white/40 p-2 sm:p-3 mx-auto backdrop-blur-sm [&_button]:text-slate-900 [&_button:hover]:bg-rose-100 [&_button[aria-selected=true]]:bg-rose-500",classNames:{day_selected:"border border-rose-500 text-white hover:bg-rose-500 hover:text-white focus:bg-rose-500 focus:text-white",day_today:"bg-rose-200 text-rose-700 font-semibold"},modifiersClassNames:{hasRecord:"relative font-semibold after:absolute after:bottom-1.5 after:left-1/2 after:-translate-x-1/2 after:w-1.5 after:h-1.5 after:rounded-full after:bg-rose-500 after:content-['']",outsideCycle:"text-slate-300 opacity-50 hover:text-slate-300 hover:bg-transparent",insideCycleNoRecord:"text-slate-900 hover:text-slate-900 hover:bg-rose-50"}})},"records-calendar")})]})})}),r.jsx("div",{ref:ae,className:"sticky mt-4 overflow-y-auto overscroll-contain",style:{top:Te,maxHeight:`calc(100dvh - ${Te}px)`,WebkitOverflowScrolling:"touch"},children:r.jsx(T.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},className:"relative space-y-2 px-1.5 pt-2 pb-10 sm:px-2",children:W.length===0?r.jsx(T.div,{className:"py-12 text-center",initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:r.jsxs("div",{className:"mx-auto max-w-md rounded-2xl border border-rose-100 bg-white/80 p-8 shadow-lg backdrop-blur-sm",children:[r.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-rose-100 text-rose-500 shadow-inner",children:r.jsx(vt,{className:"h-8 w-8"})}),r.jsx("h3",{className:"text-lg font-semibold text-slate-700",children:"Aún no hay días para mostrar"}),r.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Actualiza la fecha de inicio del ciclo o añade tu primer registro para comenzar a ver el historial."})]})}):At.map(s=>{var se;if(s.type==="empty-group"){const{id:F,days:q}=s;if(!q.length)return null;const Pe=q[0],Le=q[q.length-1],Oe=U(Le.date,"dd/MM",{locale:ye}),Ue=U(Pe.date,"dd/MM",{locale:ye}),he=Be.includes(F),Ye=b?q.some(Z=>Z.isoDate===b):!1;return r.jsxs(T.div,{layout:!0,className:"space-y-2",children:[r.jsxs(nr,{id:F,days:q,toggleEmptyGroup:Pt,isExpandedGroup:he,hasSelectedInGroup:Ye,calendarContainerRef:J,isCalendarOpen:_,scrollMarginTop:$e,scrollContainerRef:ae,children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(We,{className:"h-4 w-4 text-rose-300"}),r.jsx("span",{children:`${Oe} --- ${Ue} sin registro`})]}),r.jsx(T.span,{animate:{rotate:he?180:0},className:"rounded-2xl bg-rose-50 p-1 text-rose-400 shadow-inner",children:r.jsx(bt,{className:"h-4 w-4"})})]}),r.jsx(et,{initial:!1,children:he&&r.jsx(T.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2,ease:"easeInOut"},className:"space-y-2 pl-4 sm:pl-6",children:q.map(({isoDate:Z,date:Xe,cycleDay:Je})=>{const Fe=b===Z,ve=U(Xe,"dd/MM/yyyy",{locale:ye});return r.jsxs(T.button,{type:"button",ref:qe(Z),onClick:()=>ut(Z),className:`flex w-full items-center justify-between rounded-2xl border border-dashed border-rose-300 bg-white/40 px-4 py-3 text-sm font-medium text-slate-500 backdrop-blur-sm transition-all duration-200 hover:border-rose-500 hover:bg-white/70 ${Fe?"ring-2 ring-rose-300 text-rose-500 shadow-rose-200/70":""}`,whileHover:{scale:1.01},whileTap:{scale:.99},style:{scrollMarginTop:$e},children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(We,{className:"h-4 w-4 text-rose-300"}),r.jsx("span",{children:`${ve} D${Je} - Sin registro`})]}),r.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-rose-400",children:"Añadir"})]},Z)})},`${F}-items`)})]},F)}const{isoDate:i,date:d,cycleDay:h,details:D}=s.day,B=!!D,k=b===i,O=B&&te===i,A=U(d,"dd/MM/yyyy",{locale:ye}),ie=((se=D==null?void 0:D.symbolInfo)==null?void 0:se.label)||"";return B?r.jsx(or,{isoDate:i,dayRef:qe(i),onToggle:F=>Kt(F,!0),isSelected:k,displayDate:A,cycleDay:h,details:D,symbolLabel:ie,isExpanded:O,onEdit:_t,onDelete:Vt,isProcessing:H,calendarContainerRef:J,isCalendarOpen:_,scrollMarginTop:$e,scrollContainerRef:ae,onInlineEdit:F=>Wt(D.record,F)},i):r.jsxs(T.button,{type:"button",ref:qe(i),onClick:()=>ut(i),className:`flex w-full items-center justify-between rounded-2xl border border-dashed border-rose-300 bg-white/40 px-4 py-3 text-sm font-medium text-slate-500 backdrop-blur-sm transition-all duration-200 hover:border-rose-500 hover:bg-white/70 ${k?"ring-2 ring-rose-300 text-rose-500 shadow-rose-200/70":""}`,whileHover:{scale:1.01},whileTap:{scale:.99},style:{scrollMarginTop:$e},children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(We,{className:"h-4 w-4 text-rose-300"}),r.jsx("span",{children:`${A} D${h} - Sin registro`})]}),r.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-rose-400",children:"Añadir"})]},i)})})})]}),r.jsx(gs,{open:x,onOpenChange:s=>{s?f(!0):dt()},children:r.jsx(xs,{hideClose:!0,className:"bg-white border-pink-100 text-gray-800 w-[90vw] sm:w-auto max-w-md sm:max-w-lg md:max-w-xl max-h-[85vh] overflow-y-auto p-4 sm:p-6 rounded-2xl",children:r.jsx(fs,{onSubmit:qt,onCancel:dt,initialData:g,cycleStartDate:e.startDate,cycleEndDate:e.endDate,isProcessing:H,isEditing:!!g,cycleData:e.data,onDateSelect:Gt,defaultIsoDate:Se,focusedField:v})})}),r.jsx(ms,{isOpen:!!N,onClose:()=>P(null),onConfirm:Ut,title:"Eliminar registro",confirmLabel:"Eliminar registro",description:N?`¿Estás seguro de que quieres eliminar el registro del ${U(M(N.isoDate),"dd/MM/yyyy")}? Esta acción no se puede deshacer.`:"",isProcessing:H})]}):r.jsxs("div",{className:"min-h-[100dvh] bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100 flex items-center justify-center",children:[r.jsx("div",{className:"pointer-events-none absolute inset-0",style:{background:"radial-gradient(65% 55% at 50% 32%, rgba(244,114,182,0.18) 0%, rgba(244,114,182,0.12) 35%, rgba(244,114,182,0.06) 60%, rgba(244,114,182,0) 100%)"}}),r.jsx("p",{className:"text-center text-slate-600 text-lg",children:"No hay ciclo activo."})]})};export{wr as default};
