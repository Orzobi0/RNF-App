import{c as Yt,r as a,E as ot,F as je,G as at,H as Xt,I as Jt,J as De,K as Qt,N as Zt,O as es,Q as ts,S as ss,T as rs,V as os,W as as,X as ns,b as is,p as M,Y as le,f as K,s as He,z as ls,Z as cs,D as ft,e as ds,j as r,m as z,B as mt,R as pt}from"./index-c55d5272.js";import{C as us}from"./CycleDatesEditor-71225023.js";import{c as fs,m as ht,h as Ie,i as _e,j as ms,k as We,D as ps,F as gt,T as Et,b as hs,d as Nt,e as St,P as Ct}from"./computePeakStatuses-31c2acae.js";import{D as gs}from"./DeletionDialog-e7abebfe.js";import{u as xs,D as bs,a as vs}from"./useCycleData-5dcb71a4.js";import{P as ys,e as ye,B as ws}from"./badge-537eb28b.js";import{e as xt}from"./checkbox-423022af.js";import{P as js}from"./pen-square-91301378.js";import{P as Ds,T as ks}from"./trash-2-a6e4167a.js";import"./OverlapWarningDialog-c9e8ec86.js";import"./input-e74c5c89.js";import"./label-43470110.js";import"./eye-eb92638a.js";const bt=Yt("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]);function Bt(){const e=a.useRef(!1);return ot(()=>(e.current=!0,()=>{e.current=!1}),[]),e}function Es(){const e=Bt(),[t,n]=a.useState(0),o=a.useCallback(()=>{e.current&&n(t+1)},[t]);return[a.useCallback(()=>je.postRender(o),[o]),t]}class Ns extends a.Component{getSnapshotBeforeUpdate(t){const n=this.props.childRef.current;if(n&&t.isPresent&&!this.props.isPresent){const o=this.props.sizeRef.current;o.height=n.offsetHeight||0,o.width=n.offsetWidth||0,o.top=n.offsetTop,o.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function Ss({children:e,isPresent:t}){const n=a.useId(),o=a.useRef(null),l=a.useRef({width:0,height:0,top:0,left:0});return a.useInsertionEffect(()=>{const{width:u,height:c,top:m,left:p}=l.current;if(t||!o.current||!u||!c)return;o.current.dataset.motionPopId=n;const x=document.createElement("style");return document.head.appendChild(x),x.sheet&&x.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${u}px !important;
            height: ${c}px !important;
            top: ${m}px !important;
            left: ${p}px !important;
          }
        `),()=>{document.head.removeChild(x)}},[t]),a.createElement(Ns,{isPresent:t,childRef:o,sizeRef:l},a.cloneElement(e,{ref:o}))}const Qe=({children:e,initial:t,isPresent:n,onExitComplete:o,custom:l,presenceAffectsLayout:u,mode:c})=>{const m=at(Cs),p=a.useId(),x=a.useMemo(()=>({id:p,initial:t,isPresent:n,custom:l,onExitComplete:f=>{m.set(f,!0);for(const g of m.values())if(!g)return;o&&o()},register:f=>(m.set(f,!1),()=>m.delete(f))}),u?void 0:[n]);return a.useMemo(()=>{m.forEach((f,g)=>m.set(g,!1))},[n]),a.useEffect(()=>{!n&&!m.size&&o&&o()},[n]),c==="popLayout"&&(e=a.createElement(Ss,{isPresent:n},e)),a.createElement(Xt.Provider,{value:x},e)};function Cs(){return new Map}function Bs(e){return a.useEffect(()=>()=>e(),[])}const ce=e=>e.key||"";function Rs(e,t){e.forEach(n=>{const o=ce(n);t.set(o,n)})}function Ts(e){const t=[];return a.Children.forEach(e,n=>{a.isValidElement(n)&&t.push(n)}),t}const et=({children:e,custom:t,initial:n=!0,onExitComplete:o,exitBeforeEnter:l,presenceAffectsLayout:u=!0,mode:c="sync"})=>{const m=a.useContext(Jt).forceRender||Es()[0],p=Bt(),x=Ts(e);let f=x;const g=a.useRef(new Map).current,y=a.useRef(f),S=a.useRef(new Map).current,L=a.useRef(!0);if(ot(()=>{L.current=!1,Rs(x,S),y.current=f}),Bs(()=>{L.current=!0,S.clear(),g.clear()}),L.current)return a.createElement(a.Fragment,null,f.map(E=>a.createElement(Qe,{key:ce(E),isPresent:!0,initial:n?void 0:!1,presenceAffectsLayout:u,mode:c},E)));f=[...f];const H=y.current.map(ce),A=x.map(ce),ge=H.length;for(let E=0;E<ge;E++){const w=H[E];A.indexOf(w)===-1&&!g.has(w)&&g.set(w,void 0)}return c==="wait"&&g.size&&(f=[]),g.forEach((E,w)=>{if(A.indexOf(w)!==-1)return;const B=S.get(w);if(!B)return;const de=H.indexOf(w);let R=E;if(!R){const oe=()=>{g.delete(w);const ae=Array.from(S.keys()).filter(V=>!A.includes(V));if(ae.forEach(V=>S.delete(V)),y.current=x.filter(V=>{const ee=ce(V);return ee===w||ae.includes(ee)}),!g.size){if(p.current===!1)return;m(),o&&o()}};R=a.createElement(Qe,{key:ce(B),isPresent:!1,onExitComplete:oe,custom:t,presenceAffectsLayout:u,mode:c},B),g.set(w,R)}f.splice(de,0,R)}),f=f.map(E=>{const w=E.key;return g.has(w)?E:a.createElement(Qe,{key:ce(E),isPresent:!0,presenceAffectsLayout:u,mode:c},E)}),a.createElement(a.Fragment,null,g.size?f:f.map(E=>a.cloneElement(E)))};function Ms(e){const t=at(()=>De(e)),{isStatic:n}=a.useContext(Qt);if(n){const[,o]=a.useState(e);a.useEffect(()=>t.on("change",o),[])}return t}function zs(e,t,n){a.useInsertionEffect(()=>e.on(t,n),[e,t,n])}function As(e,t,n){var o;if(typeof e=="string"){let l=document;t&&(Zt(!!t.current),l=t.current),n?((o=n[e])!==null&&o!==void 0||(n[e]=l.querySelectorAll(e)),e=n[e]):e=l.querySelectorAll(e)}else e instanceof Element&&(e=[e]);return Array.from(e||[])}const Ve=new WeakMap;let re;function Ps(e,t){if(t){const{inlineSize:n,blockSize:o}=t[0];return{width:n,height:o}}else return e instanceof SVGElement&&"getBBox"in e?e.getBBox():{width:e.offsetWidth,height:e.offsetHeight}}function Ls({target:e,contentRect:t,borderBoxSize:n}){var o;(o=Ve.get(e))===null||o===void 0||o.forEach(l=>{l({target:e,contentSize:t,get size(){return Ps(e,n)}})})}function Os(e){e.forEach(Ls)}function $s(){typeof ResizeObserver>"u"||(re=new ResizeObserver(Os))}function Fs(e,t){re||$s();const n=As(e);return n.forEach(o=>{let l=Ve.get(o);l||(l=new Set,Ve.set(o,l)),l.add(t),re==null||re.observe(o)}),()=>{n.forEach(o=>{const l=Ve.get(o);l==null||l.delete(t),l!=null&&l.size||re==null||re.unobserve(o)})}}const Ge=new Set;let Ee;function Hs(){Ee=()=>{const e={width:window.innerWidth,height:window.innerHeight},t={target:window,size:e,contentSize:e};Ge.forEach(n=>n(t))},window.addEventListener("resize",Ee)}function Is(e){return Ge.add(e),Ee||Hs(),()=>{Ge.delete(e),!Ge.size&&Ee&&(Ee=void 0)}}function _s(e,t){return typeof e=="function"?Is(e):Fs(e,t)}const Ws=50,vt=()=>({current:0,offset:[],progress:0,scrollLength:0,targetOffset:0,targetLength:0,containerLength:0,velocity:0}),Vs=()=>({time:0,x:vt(),y:vt()}),Gs={x:{length:"Width",position:"Left"},y:{length:"Height",position:"Top"}};function yt(e,t,n,o){const l=n[t],{length:u,position:c}=Gs[t],m=l.current,p=n.time;l.current=e["scroll"+c],l.scrollLength=e["scroll"+u]-e["client"+u],l.offset.length=0,l.offset[0]=0,l.offset[1]=l.scrollLength,l.progress=es(0,l.scrollLength,l.current);const x=o-p;l.velocity=x>Ws?0:ts(l.current-m,x)}function Ks(e,t,n){yt(e,"x",t,n),yt(e,"y",t,n),t.time=n}function qs(e,t){const n={x:0,y:0};let o=e;for(;o&&o!==t;)if(o instanceof HTMLElement)n.x+=o.offsetLeft,n.y+=o.offsetTop,o=o.offsetParent;else if(o.tagName==="svg"){const l=o.getBoundingClientRect();o=o.parentElement;const u=o.getBoundingClientRect();n.x+=l.left-u.left,n.y+=l.top-u.top}else if(o instanceof SVGGraphicsElement){const{x:l,y:u}=o.getBBox();n.x+=l,n.y+=u;let c=null,m=o.parentNode;for(;!c;)m.tagName==="svg"&&(c=m),m=o.parentNode;o=c}else break;return n}const Us={Enter:[[0,1],[1,1]],Exit:[[0,0],[1,0]],Any:[[1,0],[0,1]],All:[[0,0],[1,1]]},tt={start:0,center:.5,end:1};function wt(e,t,n=0){let o=0;if(tt[e]!==void 0&&(e=tt[e]),typeof e=="string"){const l=parseFloat(e);e.endsWith("px")?o=l:e.endsWith("%")?e=l/100:e.endsWith("vw")?o=l/100*document.documentElement.clientWidth:e.endsWith("vh")?o=l/100*document.documentElement.clientHeight:e=l}return typeof e=="number"&&(o=t*e),n+o}const Ys=[0,0];function Xs(e,t,n,o){let l=Array.isArray(e)?e:Ys,u=0,c=0;return typeof e=="number"?l=[e,e]:typeof e=="string"&&(e=e.trim(),e.includes(" ")?l=e.split(" "):l=[e,tt[e]?e:"0"]),u=wt(l[0],n,o),c=wt(l[1],t),u-c}const Js={x:0,y:0};function Qs(e){return"getBBox"in e&&e.tagName!=="svg"?e.getBBox():{width:e.clientWidth,height:e.clientHeight}}function Zs(e,t,n){let{offset:o=Us.All}=n;const{target:l=e,axis:u="y"}=n,c=u==="y"?"height":"width",m=l!==e?qs(l,e):Js,p=l===e?{width:e.scrollWidth,height:e.scrollHeight}:Qs(l),x={width:e.clientWidth,height:e.clientHeight};t[u].offset.length=0;let f=!t[u].interpolate;const g=o.length;for(let y=0;y<g;y++){const S=Xs(o[y],x[c],p[c],m[u]);!f&&S!==t[u].interpolatorOffsets[y]&&(f=!0),t[u].offset[y]=S}f&&(t[u].interpolate=ss(t[u].offset,rs(o)),t[u].interpolatorOffsets=[...t[u].offset]),t[u].progress=t[u].interpolate(t[u].current)}function er(e,t=e,n){if(n.x.targetOffset=0,n.y.targetOffset=0,t!==e){let o=t;for(;o&&o!==e;)n.x.targetOffset+=o.offsetLeft,n.y.targetOffset+=o.offsetTop,o=o.offsetParent}n.x.targetLength=t===e?t.scrollWidth:t.clientWidth,n.y.targetLength=t===e?t.scrollHeight:t.clientHeight,n.x.containerLength=e.clientWidth,n.y.containerLength=e.clientHeight}function tr(e,t,n,o={}){return{measure:()=>er(e,o.target,n),update:l=>{Ks(e,n,l),(o.offset||o.target)&&Zs(e,n,o)},notify:()=>t(n)}}const we=new WeakMap,jt=new WeakMap,Ze=new WeakMap,Dt=e=>e===document.documentElement?window:e;function sr(e,{container:t=document.documentElement,...n}={}){let o=Ze.get(t);o||(o=new Set,Ze.set(t,o));const l=Vs(),u=tr(t,e,l,n);if(o.add(u),!we.has(t)){const m=()=>{for(const y of o)y.measure()},p=()=>{for(const y of o)y.update(as.timestamp)},x=()=>{for(const y of o)y.notify()},f=()=>{je.read(m,!1,!0),je.read(p,!1,!0),je.update(x,!1,!0)};we.set(t,f);const g=Dt(t);window.addEventListener("resize",f,{passive:!0}),t!==document.documentElement&&jt.set(t,_s(t,f)),g.addEventListener("scroll",f,{passive:!0})}const c=we.get(t);return je.read(c,!1,!0),()=>{var m;os(c);const p=Ze.get(t);if(!p||(p.delete(u),p.size))return;const x=we.get(t);we.delete(t),x&&(Dt(t).removeEventListener("scroll",x),(m=jt.get(t))===null||m===void 0||m(),window.removeEventListener("resize",x))}}function kt(e,t){ns(!!(!t||t.current))}const rr=()=>({scrollX:De(0),scrollY:De(0),scrollXProgress:De(0),scrollYProgress:De(0)});function or({container:e,target:t,layoutEffect:n=!0,...o}={}){const l=at(rr);return(n?ot:a.useEffect)(()=>(kt("target",t),kt("container",e),sr(({x:c,y:m})=>{l.scrollX.set(c.current),l.scrollXProgress.set(c.progress),l.scrollY.set(m.current),l.scrollYProgress.set(m.progress)},{...o,container:(e==null?void 0:e.current)||void 0,target:(t==null?void 0:t.current)||void 0})),[e,t,JSON.stringify(o.offset)]),l}const ar=e=>gt.find(t=>t.value===e)||gt[0],st=10,rt={default:{iconBg:"bg-slate-50",iconBorder:"border-slate-200",iconColor:"text-slate-500",labelColor:"text-slate-600",valueColor:"text-slate-600",chipBorder:"border-slate-200",chipBg:"bg-white/80",hoverBg:"hover:bg-slate-50",focusRing:"focus-visible:ring-2 focus-visible:ring-slate-200"},temperature:{iconBg:"bg-orange-50",iconBorder:"border-orange-100",iconColor:"text-orange-500",labelColor:"text-orange-600",valueColor:"text-orange-600",chipBorder:"border-orange-100",hoverBg:"hover:bg-orange-50",focusRing:"focus-visible:ring-2 focus-visible:ring-orange-100"},time:{iconBg:"bg-slate-50",iconBorder:"border-slate-200",iconColor:"text-slate-500",labelColor:"text-slate-500",valueColor:"text-slate-600",chipBorder:"border-slate-200",hoverBg:"hover:bg-slate-50",focusRing:"focus-visible:ring-2 focus-visible:ring-slate-200"},mucusSensation:{iconBg:"bg-sky-50",iconBorder:"border-sky-100",iconColor:"text-sky-500",labelColor:"text-sky-600",valueColor:"text-sky-600",chipBorder:"border-sky-100",hoverBg:"hover:bg-sky-50",focusRing:"focus-visible:ring-2 focus-visible:ring-sky-100"},mucusAppearance:{iconBg:"bg-emerald-50",iconBorder:"border-emerald-100",iconColor:"text-emerald-500",labelColor:"text-emerald-600",valueColor:"text-emerald-600",chipBorder:"border-emerald-100",hoverBg:"hover:bg-emerald-50",focusRing:"focus-visible:ring-2 focus-visible:ring-emerald-100"},observations:{iconBg:"bg-violet-50",iconBorder:"border-violet-100",iconColor:"text-violet-500",labelColor:"text-violet-600",valueColor:"text-violet-600",chipBorder:"border-violet-100",hoverBg:"hover:bg-violet-50",focusRing:"focus-visible:ring-2 focus-visible:ring-violet-100"}},nr=(e={})=>{const t={...rt.default,dotColor:"bg-slate-300",patternClass:e!=null&&e.pattern?"pattern-bg":""};switch(e==null?void 0:e.value){case"red":return{...t,iconBg:"bg-rose-50",iconBorder:"border-rose-100",iconColor:"text-rose-500",labelColor:"text-rose-600",valueColor:"text-rose-600",chipBorder:"border-rose-100",hoverBg:"hover:bg-rose-50",focusRing:"focus-visible:ring-2 focus-visible:ring-rose-100",dotColor:"bg-rose-400"};case"white":return{...t,iconBg:"bg-white",iconBorder:"border-slate-200",iconColor:"text-slate-500",labelColor:"text-slate-600",valueColor:"text-slate-600",chipBorder:"border-slate-200",hoverBg:"hover:bg-slate-50",focusRing:"focus-visible:ring-2 focus-visible:ring-slate-200",dotColor:"bg-white"};case"green":return{...t,iconBg:"bg-emerald-50",iconBorder:"border-emerald-100",iconColor:"text-emerald-500",labelColor:"text-emerald-600",valueColor:"text-emerald-600",chipBorder:"border-emerald-100",hoverBg:"hover:bg-emerald-50",focusRing:"focus-visible:ring-2 focus-visible:ring-emerald-100",dotColor:"bg-emerald-400"};case"yellow":return{...t,iconBg:"bg-yellow-50",iconBorder:"border-yellow-100",iconColor:"text-yellow-500",labelColor:"text-yellow-600",valueColor:"text-yellow-600",chipBorder:"border-yellow-100",hoverBg:"hover:bg-yellow-50",focusRing:"focus-visible:ring-2 focus-visible:ring-yellow-100",dotColor:"bg-yellow-300"};case"spot":return{...t,iconBg:"bg-rose-50",iconBorder:"border-rose-100",iconColor:"text-rose-500",labelColor:"text-rose-600",valueColor:"text-rose-600",chipBorder:"border-rose-100",hoverBg:"hover:bg-rose-50",focusRing:"focus-visible:ring-2 focus-visible:ring-rose-100",dotColor:"bg-rose-400",patternClass:e!=null&&e.pattern?"pattern-bg":""};default:return t}},ke=e=>({...rt.default,...rt[e]||{}}),Rt=(e,{dependencies:t=[],externalRef:n,scrollContainerRef:o}={})=>{const l=a.useRef(null),u=Ms(1),c=u,{scrollY:m}=or(),p=a.useCallback(()=>{var L;const f=l.current,g=(L=e==null?void 0:e.current)==null?void 0:L.getBoundingClientRect();if(!f||!g){u.set(1);return}const y=g.bottom+st;if(f.getBoundingClientRect().bottom<=y){u.set(0);return}u.set(1)},[e,u]);zs(m,"change",p),a.useEffect(()=>{const f=o==null?void 0:o.current;if(!f)return;const g=()=>p();return f.addEventListener("scroll",g,{passive:!0}),p(),()=>{f.removeEventListener("scroll",g)}},[o,p,...t]);const x=a.useCallback(f=>{l.current=f,typeof n=="function"?n(f):n&&typeof n=="object"&&(n.current=f),f&&requestAnimationFrame(()=>p())},[n,p]);return a.useEffect(()=>{p();const f=()=>p();return window.addEventListener("resize",f),()=>{window.removeEventListener("resize",f)}},[p,...t]),a.useEffect(()=>{const f=l.current;if(!f||typeof ResizeObserver>"u")return;const g=new ResizeObserver(()=>p());return g.observe(f),()=>{g.disconnect()}},[p,...t]),{setRefs:x,opacity:c}},ir=({isoDate:e,dayRef:t,onToggle:n,isSelected:o,displayDate:l,cycleDay:u,details:c,symbolLabel:m,isExpanded:p,onEdit:x,onDelete:f,isProcessing:g,calendarContainerRef:y,isCalendarOpen:S,scrollMarginTop:L,scrollContainerRef:H,onInlineEdit:A})=>{var V,ee,Ne,ue;const{setRefs:ge,opacity:E}=Rt(y,{dependencies:[p,S],externalRef:t,scrollContainerRef:H}),w=nr(c.symbolInfo),B=ke,de=(V=c==null?void 0:c.symbolInfo)==null?void 0:V.value,R=de&&de!=="none",oe=[{key:"temperatureTime",grouped:!0,items:[{key:"temperature",inlineKey:"temperature",palette:B("temperature"),icon:Et,title:c.hasTemperature?`${c.displayTemp}°C`:"—",hasValue:c.hasTemperature,badge:c.showCorrectedIndicator?r.jsxs("span",{className:"flex h-2.5 w-2.5 items-center justify-center text-amber-500",title:"Temperatura corregida",children:[r.jsx("span",{"aria-hidden":"true",className:"text-base leading-none",children:"•"}),r.jsx("span",{className:"sr-only",children:"Temperatura corregida"})]}):null},{key:"time",inlineKey:"time",palette:B("time"),icon:hs,title:c.timeValue||"—",hasValue:!!c.timeValue}]},{key:"sensationAppearance",grouped:!0,items:[{key:"mucusSensation",inlineKey:"mucusSensation",palette:B("mucusSensation"),icon:Nt,title:c.mucusSensation||"—",hasValue:!!c.mucusSensation},{key:"mucusAppearance",inlineKey:"mucusAppearance",palette:B("mucusAppearance"),icon:St,title:c.mucusAppearance||"—",hasValue:!!c.mucusAppearance}]},{key:"observationsAndSymbol",grouped:!0,items:[{key:"observations",inlineKey:"observations",palette:B("observations"),icon:Ct,title:(ee=c.observationsText)!=null&&ee.trim()?c.observationsText:"—",hasValue:!!((Ne=c.observationsText)!=null&&Ne.trim()),isMultiline:!0,minWidthClass:"min-w-[9rem]"},{key:"fertilitySymbol",inlineKey:"fertilitySymbol",palette:w,title:m||"Sin símbolo",hasValue:!!R,minWidthClass:"min-w-[7.5rem]"},{key:"editAction",isAction:!0,icon:Ds,ariaLabel:"Editar registro",onClick:j=>{j.stopPropagation(),x(c.record)},disabled:g},{key:"deleteAction",isAction:!0,icon:ks,ariaLabel:"Eliminar registro",onClick:j=>{j.stopPropagation(),f(c.record.id)},disabled:g}]}],ae=(j,q)=>{if(j.grouped)return r.jsx(pt.Fragment,{children:r.jsx("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1.5",children:j.items.map(b=>{if(b.isAction){const G=b.icon;return r.jsx("button",{type:"button",className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-md text-rose-500 transition-colors hover:bg-rose-50 hover:text-rose-600 focus:outline-none focus-visible:ring-1 focus-visible:ring-rose-300 disabled:cursor-not-allowed disabled:opacity-60",onClick:O=>{var xe;O.preventDefault(),O.stopPropagation(),(xe=b.onClick)==null||xe.call(b,O)},"aria-label":b.ariaLabel,disabled:b.disabled,children:r.jsx(G,{className:"h-4 w-4"})},b.key)}const se=b.palette||B(b.key),_=b.icon,Ke=b.hasValue??!!b.title,Ce=b.title||"-",Be=b.minWidthClass||"min-w-[8rem]",X=b.renderIcon?b.renderIcon():_?r.jsx(_,{className:`h-4 w-4 shrink-0 ${se.iconColor}`}):null,ne=X?"gap-2":"gap-1.5";return r.jsxs("button",{type:"button",className:`flex ${Be} flex-1 items-center ${ne} rounded-md px-1.5 py-1 text-left text-sm transition-colors ${se.hoverBg} focus:outline-none focus-visible:ring-1 focus-visible:ring-rose-300`,onClick:G=>{G.stopPropagation(),G.preventDefault(),typeof A=="function"&&A(b.inlineKey||b.key)},children:[X,r.jsx("div",{className:"min-w-0 flex-1",children:r.jsxs("div",{className:"flex items-start gap-1.5",children:[r.jsx("span",{className:`text-sm font-semibold leading-tight ${Ke?se.valueColor:"text-slate-400"} ${b.isMultiline?"whitespace-pre-line break-words":"truncate"}`,children:Ce}),b.badge&&r.jsx("span",{className:"shrink-0",children:b.badge})]})})]},b.key)})})},j.key);const v=j.palette||B(j.key),I=j.icon,te=j.value?v.valueColor:"text-slate-400",U=j.value??"—",Se=I?r.jsx(I,{className:`mt-0.5 h-4 w-4 shrink-0 ${v.iconColor}`}):null,Y=Se?"gap-2":"gap-1.5";return r.jsxs(pt.Fragment,{children:[q>0&&r.jsx("div",{className:"my-1.5 border-t border-slate-100"}),r.jsxs("button",{type:"button",className:`flex w-full items-start gap-3 rounded-md px-1.5 py-1.5 text-left text-sm transition-colors ${v.hoverBg} focus:outline-none focus-visible:ring-1 focus-visible:ring-rose-300`,onClick:b=>{b.stopPropagation(),b.preventDefault(),typeof A=="function"&&A(j.key)},children:[r.jsxs("div",{className:`flex min-w-0 flex-1 items-start ${Y} ${j.isMultiline?"pt-0.5":""}`,children:[Se,r.jsx("div",{className:"min-w-0 flex-1",children:r.jsx("span",{className:`block text-sm leading-snug ${te} ${j.isMultiline?"whitespace-pre-line":"truncate"}`,children:U})})]}),j.badge&&r.jsx("span",{className:"shrink-0 self-center",children:j.badge})]})]},j.key)};return r.jsxs(z.div,{layout:!0,ref:ge,onClick:()=>n(e),className:`group relative mx-0.5 flex w-full cursor-pointer flex-col rounded-2xl border border-rose-100 bg-white/75 px-4 py-3 shadow-sm backdrop-blur-md transition-all duration-300 hover:shadow-lg sm:mx-1 sm:px-5 ${o?"bg-white/90 ring-2 ring-rose-400 shadow-rose-200/70":""}`,whileHover:{translateY:-2},style:{opacity:E,scrollMarginTop:L},children:[r.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[r.jsxs("div",{className:"flex items-center gap-1 text-sm font-semibold text-slate-700",children:[r.jsx(We,{className:"h-4 w-4 text-rose-400"}),l]}),r.jsxs("span",{className:"text-sm font-semibold text-rose-600 ",children:["D",u]}),r.jsx(dr,{hasTemperature:c.hasTemperature,hasMucusSensation:c.hasMucusSensation,hasMucusAppearance:c.hasMucusAppearance,hasObservations:c.hasObservations,peakStatus:c.peakStatus,isPeakDay:c.isPeakDay}),r.jsx("div",{className:"ml-auto flex items-center",children:r.jsx("div",{className:`flex h-6 w-6 items-center justify-center rounded-full border border-slate-400 ${w.dotColor} ${w.patternClass} shadow-inner`,title:m})})]}),r.jsx(et,{initial:!1,children:p&&r.jsx(z.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.25,ease:"easeInOut"},className:"mt-1.5 overflow-hidden",children:r.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white/80 p-2 shadow-sm",children:[r.jsxs("div",{className:"flex flex-wrap items-center gap-1 text-[0.65rem] font-semibold uppercase tracking-wide text-slate-500",children:[r.jsx(Tt,{peakStatus:c.peakStatus,isPeakDay:c.isPeakDay,size:"small"}),(c.isPeakDay||c.peakStatus==="P")&&r.jsx("span",{className:"text-rose-600",children:"Día pico"}),((ue=c.record)==null?void 0:ue.ignored)&&r.jsxs(ws,{className:"flex items-center gap-1 rounded-full border border-slate-200 bg-slate-50 text-[0.65rem] font-semibold uppercase tracking-wide text-slate-400",title:"Registro ignorado",children:[r.jsx("span",{"aria-hidden":"true",className:"h-2 w-2 rounded-full bg-slate-300"}),r.jsx("span",{className:"sr-only",children:"Registro ignorado"})]})]}),r.jsx("div",{className:"mt-1.5 space-y-1",children:oe.map((j,q)=>ae(j,q))})]})})})]})},lr=({id:e,days:t,toggleEmptyGroup:n,isExpandedGroup:o,hasSelectedInGroup:l,calendarContainerRef:u,isCalendarOpen:c,children:m,scrollMarginTop:p,scrollContainerRef:x})=>{const{setRefs:f,opacity:g}=Rt(u,{dependencies:[o,c,t.length],scrollContainerRef:x});return r.jsx(z.button,{type:"button",ref:f,onClick:()=>n(e),className:`flex w-full items-center justify-between rounded-2xl border border-dashed border-rose-300 bg-white/40 px-4 py-3 text-sm font-medium text-slate-500 backdrop-blur-sm transition-all duration-200 hover:border-rose-500 hover:bg-white/70 ${l?"ring-2 ring-rose-300 text-rose-500 shadow-rose-200/70":""}`,whileHover:{scale:1.01},whileTap:{scale:.99},"aria-expanded":o,style:{opacity:g,scrollMarginTop:p},children:m})},cr=e=>{if(e==null||e==="")return null;const t=Number(String(e).replace(",","."));return Number.isNaN(t)?null:t.toFixed(2)},Tt=({peakStatus:e,isPeakDay:t,size:n="default",className:o=""})=>{let l=null,u="",c="border border-slate-200 bg-slate-100 text-slate-500";if(t||e==="P"?(l="✖",u="Día pico",c="border border-rose-200 bg-rose-100 text-rose-600"):e==="1"?(l="+1",u="Post día pico +1",c="border border-rose-200 bg-rose-50 text-rose-500"):e==="2"?(l="+2",u="Post día pico +2",c="border border-rose-200 bg-rose-50 text-rose-500"):e==="3"&&(l="+3",u="Post día pico +3",c="border border-rose-200 bg-rose-50 text-rose-500"),!l)return null;const m=n==="small"?"h-5 w-5 text-[0.6rem]":"h-6 w-6 text-xs";return r.jsx("span",{role:"img","aria-label":u,title:u,className:`flex items-center justify-center rounded-full font-semibold shadow-sm shadow-rose-200/40 transition-transform duration-200 ${m} ${c} ${o}`,children:l})},dr=({hasTemperature:e,hasMucusSensation:t,hasMucusAppearance:n,hasObservations:o,peakStatus:l,isPeakDay:u})=>{const c="flex items-center justify-center w-5 h-5 rounded-full text-[0.6rem] shadow-sm transition-transform duration-200",m=ke("temperature"),p=ke("mucusSensation"),x=ke("mucusAppearance"),f=ke("observations");return r.jsxs("div",{className:"flex items-center gap-1.5",children:[r.jsx(Tt,{peakStatus:l,isPeakDay:u,size:"small"}),e&&r.jsx("span",{className:`${c} border ${m.iconBorder} ${m.iconBg}`,children:r.jsx(Et,{className:`h-2.5 w-2.5 ${m.iconColor}`})}),t&&r.jsx("span",{className:`${c} border ${p.iconBorder} ${p.iconBg}`,children:r.jsx(Nt,{className:`h-2.5 w-2.5 ${p.iconColor}`})}),n&&r.jsx("span",{className:`${c} border ${x.iconBorder} ${x.iconBg}`,children:r.jsx(St,{className:`h-2.5 w-2.5 ${x.iconColor}`})}),o&&r.jsx("span",{className:`${c} border ${f.iconBorder} ${f.iconBg}`,children:r.jsx(Ct,{className:`h-2.5 w-2.5 ${f.iconColor}`})})]})},kr=()=>{const{currentCycle:e,addOrUpdateDataPoint:t,deleteRecord:n,isLoading:o,updateCycleDates:l,checkCycleOverlap:u,forceUpdateCycleStart:c,refreshData:m}=xs(),{toast:p}=is(),[x,f]=a.useState(!1),[g,y]=a.useState(null),[S,L]=a.useState(null),[H,A]=a.useState(!1),[ge,E]=a.useState(!1),[w,B]=a.useState(()=>(e==null?void 0:e.startDate)||""),[de,R]=a.useState(""),[oe,ae]=a.useState(null),[V,ee]=a.useState(null),[Ne,ue]=a.useState(!1),[j,q]=a.useState(!1),[v,I]=a.useState(null),[te,U]=a.useState(null),[Se,Y]=a.useState(null),[b,se]=a.useState(null),[_,Ke]=a.useState(!0),[Ce,Be]=a.useState([]),X=a.useRef(null),ne=a.useRef(null),G=a.useRef({}),O=a.useRef(!1),xe=a.useRef(0),[Re,nt]=a.useState(0),qe=a.useCallback(s=>i=>{s&&(i?G.current[s]=i:delete G.current[s])},[]),Te=a.useCallback(()=>{const s=X.current;if(!s){xe.current=0,nt(0);return}const d=s.getBoundingClientRect().height;xe.current=d,nt(h=>Math.abs(h-d)>.5?d:h)},[]);a.useLayoutEffect(()=>{let s=window.requestAnimationFrame(Te);const i=()=>{s&&window.cancelAnimationFrame(s),s=window.requestAnimationFrame(Te)};window.addEventListener("resize",i);let d;return typeof ResizeObserver<"u"&&(d=new ResizeObserver(()=>{s&&window.cancelAnimationFrame(s),s=window.requestAnimationFrame(Te)}),X.current&&d.observe(X.current)),()=>{window.removeEventListener("resize",i),d&&d.disconnect(),s&&window.cancelAnimationFrame(s)}},[Te]);const fe=a.useCallback((s,{behavior:i="smooth",forceAlignTop:d=!1}={})=>{const h=ne.current;if(!s||!h)return;const D=h.getBoundingClientRect(),N=s.getBoundingClientRect(),k=N.top-D.top+h.scrollTop,$=k+N.height,P=h.scrollTop,ie=P+h.clientHeight,Q=Math.max(k-12,0);if(d||k<P){h.scrollTo({top:Q,behavior:i});return}if($>ie){const T=Math.max($-h.clientHeight+12,0),F=N.height<=h.clientHeight;h.scrollTo({top:F?Q:T,behavior:i})}},[]),Me=a.useMemo(()=>Math.max(Math.round(Re+st),st),[Re]),ze=a.useMemo(()=>Me,[Me]);a.useEffect(()=>{B((e==null?void 0:e.startDate)||"")},[e==null?void 0:e.startDate]);const me=a.useMemo(()=>{var s;return(s=e==null?void 0:e.data)!=null&&s.length?[...e.data].filter(i=>i==null?void 0:i.isoDate).sort((i,d)=>{const h=M(i.isoDate);return M(d.isoDate)-h}).map(i=>i.isoDate):[]},[e==null?void 0:e.data]);a.useEffect(()=>{if(!me.length){I(null),U(null);return}(!v||!me.includes(v))&&(O.current=!1,I(me[0]))},[me,v]),a.useEffect(()=>{if(!v||!O.current)return;const s=G.current[v];if(!s)return;const i=window.requestAnimationFrame(()=>{fe(s,{behavior:"smooth",forceAlignTop:!0}),O.current=!1});return()=>{window.cancelAnimationFrame(i)}},[v,Ce,_,fe]),a.useEffect(()=>{if(!te)return;const s=G.current[te];if(!s)return;const i=window.requestAnimationFrame(()=>{fe(s,{behavior:"smooth",forceAlignTop:!0})});return()=>{window.cancelAnimationFrame(i)}},[te,fe,_,Re]),a.useEffect(()=>{const s=te||v;if(!s)return;const i=G.current[s];i&&fe(i,{behavior:"auto"})},[Re,_,te,v,fe]),a.useEffect(()=>{const s=ne.current;s&&s.scrollTo({top:0,behavior:"auto"})},[]);const pe=a.useMemo(()=>{var s;return(s=e==null?void 0:e.data)!=null&&s.length?e.data.map(i=>{if(!(i!=null&&i.isoDate))return null;const d=M(i.isoDate);return le(d)?d:null}).filter(Boolean):[]},[e==null?void 0:e.data]),it=a.useMemo(()=>new Set(me),[me]),lt=a.useMemo(()=>fs((e==null?void 0:e.data)??[]),[e==null?void 0:e.data]),Ae=a.useMemo(()=>{var i;const s=new Map;return(i=e==null?void 0:e.data)!=null&&i.length&&e.data.forEach(d=>{var Fe;if(!(d!=null&&d.isoDate))return;const h=((Fe=d.measurements)==null?void 0:Fe.find(ve=>ve==null?void 0:ve.selected))||(d.temperature_chart||d.temperature_raw?{temperature:d.temperature_chart??d.temperature_raw,temperature_corrected:d.temperature_corrected??null,time:d.timestamp?K(M(d.timestamp),"HH:mm"):null,use_corrected:d.use_corrected??!1}:null),D=(h==null?void 0:h.use_corrected)??d.use_corrected??!1,N=(h==null?void 0:h.temperature_corrected)??d.temperature_corrected??null,k=(h==null?void 0:h.temperature)??d.temperature_chart??d.temperature_raw??null,P=cr(D&&N!==null&&N!==void 0&&N!==""?N:k??N),ie=P!==null,Q=D&&N!==null&&N!==void 0&&N!=="";let T=null;h!=null&&h.time?T=h.time:d.timestamp&&le(M(d.timestamp))&&(T=K(M(d.timestamp),"HH:mm"));const F=d.mucusSensation??d.mucus_sensation??"",Le=d.mucusAppearance??d.mucus_appearance??"",Oe=!!F,$e=!!Le,Ue=Oe||$e,he=d.observations||"",Ye=!!he,Z=lt[d.isoDate]||null,Xe=d.peak_marker==="peak"||Z==="P",Je=ar(d.fertility_symbol);s.set(d.isoDate,{record:d,symbolInfo:Je,hasTemperature:ie,displayTemp:P,showCorrectedIndicator:Q,timeValue:T,hasMucus:Ue,hasMucusSensation:Oe,hasMucusAppearance:$e,mucusSensation:F,mucusAppearance:Le,hasObservations:Ye,observationsText:he,peakStatus:Z,isPeakDay:Xe})}),s},[e==null?void 0:e.data,lt]),C=a.useMemo(()=>{if(!(e!=null&&e.startDate))return null;const s=M(e.startDate);if(!le(s))return null;let i;if(e!=null&&e.endDate)i=M(e.endDate);else{const d=He(new Date),h=[s,d];pe.length&&h.push(ht(pe)),i=ht(h)}return le(i)?{from:s,to:i}:{from:s,to:s}},[e==null?void 0:e.startDate,e==null?void 0:e.endDate,pe]),Mt=a.useMemo(()=>{const s={};return C&&(s.outsideCycle=i=>Ie(i,C.from)||_e(i,C.to),s.insideCycleNoRecord=i=>{if(Ie(i,C.from)||_e(i,C.to))return!1;const d=K(i,"yyyy-MM-dd");return!it.has(d)}),pe.length&&(s.hasRecord=pe),s},[C,pe,it]),zt=a.useMemo(()=>({months:"flex flex-col items-center sm:flex-row sm:items-center sm:justify-center space-y-3 sm:space-x-4 sm:space-y-0",month:"space-y-3",table:"w-full border-collapse space-y-0.5",row:"flex w-full mt-1.5",head_cell:"text-muted-foreground rounded-md w-8 font-medium text-[0.75rem]",cell:"h-8 w-8 text-center text-sm p-0 relative [&:has([aria-selected])]:bg-transparent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:ls(cs({variant:"ghost",size:"icon"}),"!h-8 !w-8 !p-0 font-medium text-slate-700 aria-selected:opacity-100"),day_selected:"border border-rose-400 text-white hover:bg-rose-300 hover:text-white focus:bg-rose-300 focus:text-white",day_today:"bg-rose-200 text-rose-700 font-semibold"}),[]),W=a.useMemo(()=>{if(!(e!=null&&e.startDate))return[];const s=M(e.startDate);if(!le(s))return[];const i=He(s),d=He(new Date);let h=C!=null&&C.to?He(C.to):d;_e(h,d)&&(h=d),Ie(h,i)&&(h=i);const D=ft(h,i)+1;if(D<=0)return[];const N=[];for(let k=D-1;k>=0;k-=1){const $=ds(i,k),P=K($,"yyyy-MM-dd"),ie=ft($,i)+1,Q=Ae.get(P)||null;N.push({isoDate:P,date:$,cycleDay:ie,details:Q})}return N},[e==null?void 0:e.startDate,C,Ae]),At=a.useMemo(()=>{if(!W.length)return{items:[],isoToGroup:{}};const s=[],i={};for(let d=0;d<W.length;){const h=W[d];if(h.details){s.push({type:"record",day:h}),d+=1;continue}let D=d;for(;D<W.length&&!W[D].details;)D+=1;if(D-d>3){const k=W.slice(d,D),$=`${k[0].isoDate}_${k[k.length-1].isoDate}`;k.forEach(({isoDate:P})=>{i[P]=$}),s.push({type:"empty-group",id:$,days:k})}else for(let k=d;k<D;k+=1)s.push({type:"empty-day",day:W[k]});d=D}return{items:s,isoToGroup:i}},[W]),{items:Pt,isoToGroup:ct}=At,Lt=a.useCallback(s=>{s&&Be(i=>i.includes(s)?i.filter(d=>d!==s):[...i,s])},[]);a.useEffect(()=>{if(!v)return;const s=ct[v];s&&Be(i=>i.includes(s)?i:[...i,s])},[v,ct]);const Ot=a.useCallback(s=>{if(!s)return;const i=K(s,"yyyy-MM-dd");C&&(Ie(s,C.from)||_e(s,C.to))||(O.current=!0,I(i),Ae.has(i)||U(null))},[C,Ae]),J=a.useCallback(()=>{ae(null),ee(null),ue(!1)},[]),$t=a.useCallback(()=>{B((e==null?void 0:e.startDate)||""),R(""),J(),E(!0)},[e==null?void 0:e.startDate,J]),be=a.useCallback(()=>{E(!1),R(""),J(),B((e==null?void 0:e.startDate)||"")},[e==null?void 0:e.startDate,J]),Ft=a.useCallback(()=>{J()},[J]),Ht=a.useCallback(async()=>{if(!w){R("La fecha de inicio es obligatoria");return}if(e!=null&&e.id){R(""),q(!0);try{const s=u?await u(e.id,w):null;if(s){ae(w),ee(s),ue(!0),q(!1);return}await l(e.id,w),await m({silent:!0}),p({title:"Fecha de inicio actualizada",description:"El ciclo se ha ajustado a la nueva fecha de inicio."}),be()}catch(s){console.error("Error updating start date from records page:",s),R("No se pudo actualizar la fecha de inicio"),p({title:"Error",description:"No se pudo actualizar la fecha de inicio.",variant:"destructive"})}finally{q(!1)}}},[w,e==null?void 0:e.id,u,l,m,p,be]),It=a.useCallback(async()=>{if(!(e!=null&&e.id)||!oe){J();return}q(!0),ue(!1);try{await c(e.id,oe),await m({silent:!0}),p({title:"Fecha de inicio actualizada",description:"El ciclo se ha ajustado a la nueva fecha de inicio."}),be()}catch(s){console.error("Error forcing start date from records page:",s),R("No se pudo actualizar la fecha de inicio"),p({title:"Error",description:"No se pudo actualizar la fecha de inicio.",variant:"destructive"})}finally{q(!1),J()}},[e==null?void 0:e.id,oe,c,m,p,be,J]),dt=a.useCallback(()=>{f(!1),y(null),Y(null),se(null)},[]),Pe=a.useCallback((s,i=null)=>{s&&(y(s),Y(s.isoDate??null),se(i),s.isoDate&&(O.current=!1,I(s.isoDate),U(s.isoDate)),f(!0))},[]),_t=a.useCallback(s=>Pe(s),[Pe]),Wt=a.useCallback((s,i)=>Pe(s,i),[Pe]),Vt=s=>{var d;const i=(d=e==null?void 0:e.data)==null?void 0:d.find(h=>h.id===s);L(i||null)},Gt=a.useCallback(s=>{y(s)},[]),Kt=a.useCallback((s,i)=>{s&&(O.current=!1,I(s),i&&U(d=>d===s?null:s))},[]),ut=a.useCallback(s=>{s&&(O.current=!1,I(s),U(null),y(null),Y(s),se(null),f(!0))},[]),qt=async(s,{keepFormOpen:i=!1}={})=>{A(!0);try{await t(s,g),i||(f(!1),y(null),Y(null),se(null))}catch{p({title:"Error",description:"No se pudo guardar el registro",variant:"destructive"})}finally{A(!1),i&&Y((s==null?void 0:s.isoDate)??null)}},Ut=async()=>{if(S){A(!0);try{const s=S.isoDate;await n(S.id),L(null),Y(null),s&&(U(i=>i===s?null:i),v===s&&I(s))}catch{p({title:"Error",description:"No se pudo eliminar el registro",variant:"destructive"})}finally{A(!1)}}};return o&&!(e!=null&&e.id)?r.jsxs("div",{className:"relative flex h-full flex-col items-center justify-center bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100",children:[r.jsx("div",{className:"pointer-events-none absolute inset-0",style:{background:"radial-gradient(65% 55% at 50% 32%, rgba(244,114,182,0.18) 0%, rgba(244,114,182,0.12) 35%, rgba(244,114,182,0.06) 60%, rgba(244,114,182,0) 100%)"}}),r.jsx("p",{className:"text-center text-slate-600 text-lg",children:"Cargando..."})]}):e!=null&&e.id?r.jsxs("div",{className:"relative flex h-full flex-col bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100",children:[r.jsx("div",{className:"pointer-events-none absolute inset-0",style:{background:"radial-gradient(65% 55% at 50% 32%, rgba(244,114,182,0.18) 0%, rgba(244,114,182,0.12) 35%, rgba(244,114,182,0.06) 60%, rgba(244,114,182,0) 100%)"}}),r.jsxs("div",{className:"mx-auto grid w-full max-w-6xl grid-cols-1 gap-6 px-4 relative z-10",children:[r.jsx("div",{ref:X,className:"sticky top-1 z-50 w-full max-w-lg mx-auto",children:r.jsx("div",{className:"relative overflow-hidden rounded-2xl ring-1 ring-rose-100/70",children:r.jsxs("div",{className:"space-y-1.5 p-2 sm:p-2.5 relative z-10",children:[r.jsx(z.div,{className:"flex flex-col gap-4",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:r.jsxs("div",{className:"flex flex-wrap items-center gap-1 justify-between sm:justify-start",children:[r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(bt,{className:"h-8 w-8 text-pink-500"}),r.jsxs("button",{type:"button",onClick:()=>Ke(s=>!s),className:"group flex items-center gap-1 rounded-full px-2 py-1 text-left shadow-sm transition-all hover:border-rose-800 hover:bg-white/20 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-400 focus-visible:ring-offset-2 focus-visible:ring-offset-rose-50","aria-expanded":_,"aria-controls":"records-calendar",children:[r.jsx("span",{className:"text-2xl sm:text-2xl font-bold text-slate-700",children:"Mis Registros"}),r.jsx("span",{className:"flex items-center gap-2",children:r.jsx(z.span,{animate:{rotate:_?180:0},className:"flex h-7 w-7 items-center justify-center rounded-full bg-rose-50 text-rose-400 shadow-inner",children:r.jsx(xt,{className:"h-4 w-4"})})})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs(mt,{type:"button",variant:"outline",size:"icon",onClick:$t,className:"border-pink-200 rounded-full text-pink-600 hover:bg-pink-500",disabled:H||j,"aria-label":"Editar fecha de inicio",children:[r.jsx(js,{className:"h-4 w-4"}),r.jsx("span",{className:"sr-only",children:"Editar fecha de inicio"})]}),r.jsxs(mt,{type:"button",size:"icon",onClick:()=>{const s=W.length?W[0].isoDate:e.startDate,i=v||s||null;y(null),Y(i),O.current=!1,i&&(I(i),U(null)),f(!0)},className:"rounded-full bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white shadow-lg",disabled:H,style:{filter:"drop-shadow(0 6px 12px rgba(236, 72, 153, 0.3))"},"aria-label":"Añadir registro",children:[r.jsx(ys,{className:"h-4 w-4"}),r.jsx("span",{className:"sr-only",children:"Añadir registro"})]})]})]})}),ge&&r.jsx(z.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.4},children:r.jsx(us,{cycle:e,startDate:w,endDate:e.endDate,onStartDateChange:s=>B(s),onSave:Ht,onCancel:be,isProcessing:j,dateError:de,includeEndDate:!1,showOverlapDialog:Ne,overlapCycle:V,onConfirmOverlap:It,onCancelOverlap:Ft,onClearError:()=>R(""),saveLabel:"Guardar cambios",title:"Editar fecha de inicio",description:"Actualiza la fecha de inicio del ciclo actual. Los registros se reorganizarán automáticamente."})}),r.jsx(et,{initial:!1,children:_&&r.jsx(z.div,{id:"records-calendar",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"flex justify-center",children:r.jsx(ms,{mode:"single",locale:ye,defaultMonth:v&&le(M(v))?M(v):C==null?void 0:C.to,selected:v&&le(M(v))?M(v):void 0,onDayClick:Ot,modifiers:Mt,className:"w-full max-w-xs sm:max-w-sm rounded-3xl bg-white/40 !p-2 sm:!p-2.5 mx-auto backdrop-blur-sm [&_button]:text-slate-900 [&_button:hover]:bg-rose-100 [&_button[aria-selected=true]]:bg-rose-400",classNames:zt,modifiersClassNames:{hasRecord:"relative font-semibold after:absolute after:bottom-0.5 after:left-1/2 after:-translate-x-1/2 after:w-1.5 after:h-1.5 after:rounded-full after:bg-rose-400 after:content-['']",outsideCycle:"text-slate-300 opacity-50 hover:text-slate-300 hover:bg-transparent",insideCycleNoRecord:"text-slate-900 hover:text-slate-900 hover:bg-rose-50"}})},"records-calendar")})]})})}),r.jsx("div",{ref:ne,className:"sticky overflow-y-auto overscroll-contain w-full max-w-4xl mx-auto",style:{top:Me,maxHeight:`calc(100dvh - ${Me}px - var(--bottom-nav-safe, 0px))`,WebkitOverflowScrolling:"touch"},children:r.jsx(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},className:"relative space-y-2 px-1.5 pt-2 pb-[calc(var(--bottom-nav-safe,0px))] sm:px-2 lg:px-4",children:W.length===0?r.jsx(z.div,{className:"py-12 text-center",initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:r.jsxs("div",{className:"mx-auto max-w-md rounded-3xl border border-rose-100 bg-white/80 p-8 shadow-lg backdrop-blur-sm",children:[r.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-rose-100 text-rose-500 shadow-inner",children:r.jsx(bt,{className:"h-8 w-8"})}),r.jsx("h3",{className:"text-lg font-semibold text-slate-700",children:"Aún no hay días para mostrar"}),r.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Actualiza la fecha de inicio del ciclo o añade tu primer registro para comenzar a ver el historial."})]})}):Pt.map(s=>{var Q;if(s.type==="empty-group"){const{id:T,days:F}=s;if(!F.length)return null;const Le=F[0],Oe=F[F.length-1],$e=K(Oe.date,"dd/MM",{locale:ye}),Ue=K(Le.date,"dd/MM",{locale:ye}),he=Ce.includes(T),Ye=v?F.some(Z=>Z.isoDate===v):!1;return r.jsxs(z.div,{layout:!0,className:"space-y-2",children:[r.jsxs(lr,{id:T,days:F,toggleEmptyGroup:Lt,isExpandedGroup:he,hasSelectedInGroup:Ye,calendarContainerRef:X,isCalendarOpen:_,scrollMarginTop:ze,scrollContainerRef:ne,children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(We,{className:"h-4 w-4 text-rose-300"}),r.jsx("span",{children:`${$e} --- ${Ue} sin registro`})]}),r.jsx(z.span,{animate:{rotate:he?180:0},className:"rounded-2xl bg-rose-50 p-1 text-rose-400 shadow-inner",children:r.jsx(xt,{className:"h-4 w-4"})})]}),r.jsx(et,{initial:!1,children:he&&r.jsx(z.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2,ease:"easeInOut"},className:"space-y-2 pl-4 sm:pl-6",children:F.map(({isoDate:Z,date:Xe,cycleDay:Je})=>{const Fe=v===Z,ve=K(Xe,"dd/MM/yyyy",{locale:ye});return r.jsxs(z.button,{type:"button",ref:qe(Z),onClick:()=>ut(Z),className:`flex w-full items-center justify-between rounded-2xl border border-dashed border-rose-300 bg-white/40 px-4 py-3 text-sm font-medium text-slate-500 backdrop-blur-sm transition-all duration-200 hover:border-rose-500 hover:bg-white/70 ${Fe?"ring-2 ring-rose-300 text-rose-500 shadow-rose-200/70":""}`,whileHover:{scale:1.01},whileTap:{scale:.99},style:{scrollMarginTop:ze},children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(We,{className:"h-4 w-4 text-rose-300"}),r.jsx("span",{children:`${ve} D${Je} - Sin registro`})]}),r.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-rose-400",children:"Añadir"})]},Z)})},`${T}-items`)})]},T)}const{isoDate:i,date:d,cycleDay:h,details:D}=s.day,N=!!D,k=v===i,$=N&&te===i,P=K(d,"dd/MM/yyyy",{locale:ye}),ie=((Q=D==null?void 0:D.symbolInfo)==null?void 0:Q.label)||"";return N?r.jsx(ir,{isoDate:i,dayRef:qe(i),onToggle:T=>Kt(T,!0),isSelected:k,displayDate:P,cycleDay:h,details:D,symbolLabel:ie,isExpanded:$,onEdit:_t,onDelete:Vt,isProcessing:H,calendarContainerRef:X,isCalendarOpen:_,scrollMarginTop:ze,scrollContainerRef:ne,onInlineEdit:T=>Wt(D.record,T)},i):r.jsxs(z.button,{type:"button",ref:qe(i),onClick:()=>ut(i),className:`flex w-full items-center justify-between rounded-2xl border border-dashed border-rose-300 bg-white/40 px-4 py-3 text-sm font-medium text-slate-500 backdrop-blur-sm transition-all duration-200 hover:border-rose-500 hover:bg-white/70 ${k?"ring-2 ring-rose-300 text-rose-500 shadow-rose-200/70":""}`,whileHover:{scale:1.01},whileTap:{scale:.99},style:{scrollMarginTop:ze},children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(We,{className:"h-4 w-4 text-rose-300"}),r.jsx("span",{children:`${P} D${h} - Sin registro`})]}),r.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-rose-400",children:"Añadir"})]},i)})})})]}),r.jsx(bs,{open:x,onOpenChange:s=>{s?f(!0):dt()},children:r.jsx(vs,{hideClose:!0,className:"bg-white border-pink-100 text-gray-800 w-[90vw] sm:w-auto max-w-md sm:max-w-lg md:max-w-xl max-h-[85vh] overflow-y-auto p-4 sm:p-6 rounded-2xl",children:r.jsx(ps,{onSubmit:qt,onCancel:dt,initialData:g,cycleStartDate:e.startDate,cycleEndDate:e.endDate,isProcessing:H,isEditing:!!g,cycleData:e.data,onDateSelect:Gt,defaultIsoDate:Se,focusedField:b})})}),r.jsx(gs,{isOpen:!!S,onClose:()=>L(null),onConfirm:Ut,title:"Eliminar registro",confirmLabel:"Eliminar registro",description:S?`¿Estás seguro de que quieres eliminar el registro del ${K(M(S.isoDate),"dd/MM/yyyy")}? Esta acción no se puede deshacer.`:"",isProcessing:H})]}):r.jsxs("div",{className:"relative flex h-full flex-col items-center justify-center bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100",children:[r.jsx("div",{className:"pointer-events-none absolute inset-0",style:{background:"radial-gradient(65% 55% at 50% 32%, rgba(244,114,182,0.18) 0%, rgba(244,114,182,0.12) 35%, rgba(244,114,182,0.06) 60%, rgba(244,114,182,0) 100%)"}}),r.jsx("p",{className:"text-center text-slate-600 text-lg",children:"No hay ciclo activo."})]})};export{kr as default};
