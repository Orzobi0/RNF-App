import{c as v,r as f,j as e,m as l}from"./index-5c8ff718.js";import{D as M}from"./DataEntryForm-1b130c4f.js";import{B as w}from"./button-cd48e5a1.js";import{u as N}from"./useBackClose-d5b49bbd.js";import{D as k,a as D,b as S,c as P,d as I,e as F}from"./dialog-995f36a3.js";import{I as A}from"./input-1d10c911.js";import{f as h,u as T,d as O,p as E,s as H}from"./useCycleData-d25ac977.js";import{P as L}from"./plus-b6df2cb6.js";import"./label-607c7139.js";import"./select-a5d88587.js";import"./fertilitySymbols-5c7dd69c.js";const B=v("CalendarPlus",[["path",{d:"M21 13V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8",key:"3spt84"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["line",{x1:"19",x2:"19",y1:"16",y2:"22",key:"1ttwzi"}],["line",{x1:"16",x2:"22",y1:"19",y2:"19",key:"1g9955"}]]),z=v("FilePlus",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"12",x2:"12",y1:"18",y2:"12",key:"1tsf04"}],["line",{x1:"9",x2:"15",y1:"15",y2:"15",key:"110plj"}]]),j=({isOpen:t,onClose:n,onConfirm:o,currentCycleStartDate:x})=>{const[m,a]=f.useState(h(new Date,"yyyy-MM-dd"));N(t,n);const s=!x,y=()=>{o(m)},c=s?"":h(new Date(x),"dd/MM/yyyy"),i=(()=>{if(s)return"";const r=new Date(m);return r.setDate(r.getDate()-1),h(r,"dd/MM/yyyy")})();return e.jsx(k,{open:t,onOpenChange:n,children:e.jsxs(D,{className:"bg-white border-pink-100 text-gray-800",children:[e.jsxs(S,{children:[e.jsx(P,{children:"Iniciar nuevo ciclo"}),e.jsx(I,{className:"text-gray-600",children:s?"Este será tu primer ciclo. Selecciona la fecha de inicio.":`¿Estás seguro de que quieres iniciar un nuevo ciclo? Los datos del ciclo actual (${c} - ${i}) serán archivados.`})]}),e.jsxs("div",{className:"my-4 space-y-2",children:[e.jsx("label",{htmlFor:"startDate",className:"text-gray-700 text-sm",children:"Fecha de inicio del nuevo ciclo"}),e.jsx(A,{id:"startDate",type:"date",value:m,onChange:r=>a(r.target.value),max:h(new Date,"yyyy-MM-dd"),min:s?void 0:h(new Date(x),"yyyy-MM-dd"),className:"bg-gray-50 border-gray-200 text-gray-800"})]}),e.jsxs(F,{className:"sm:justify-end",children:[e.jsx(w,{variant:"outline",onClick:n,className:"border-gray-300 text-gray-700 hover:bg-gray-100",children:"Cancelar"}),e.jsx(w,{variant:"primary",onClick:y,className:"bg-pink-600 hover:bg-pink-700 text-white",children:s?"Iniciar ciclo":"Confirmar nuevo ciclo"})]})]})})},W=({cycleData:t})=>{const n=t.records||[],o=a=>{switch(a){case"red":return{main:"#ef4444",light:"#fee2e2",glow:"rgba(239, 68, 68, 0.3)"};case"white":return{main:"#f8fafc",light:"#ffe4e6",glow:"rgba(248, 250, 252, 0.3)"};case"green":return{main:"#22c55e",light:"#d1fae5",glow:"rgba(34, 197, 94, 0.3)"};case"spot":return{main:"#ec4899",light:"#fce7f3",glow:"rgba(236, 72, 153, 0.3)"};default:return{main:"#d1d5db",light:"#f8fafc",glow:"rgba(209, 213, 219, 0.3)"}}},m=(()=>{const a=Math.max(t.currentDay,28),s=45;return Array.from({length:a},(y,c)=>{const i=c+1,r=n.find(C=>C.cycleDay===i),p=c/a*2*Math.PI-Math.PI/2,g=50+s*Math.cos(p),d=50+s*Math.sin(p);let u=i<=t.currentDay&&r?o(r.fertility_symbol):{main:"#e5e7eb",light:"#f1f5f9",glow:"rgba(229, 231, 235, 0.3)"};const b=i===t.currentDay;return b&&!r&&(u={main:"#3b82f6",light:"#bfdbfe",glow:"rgba(59, 130, 246, 0.4)"}),{x:g,y:d,day:i,colors:u,isActive:i<=t.currentDay,isToday:b}})})();return e.jsxs("div",{className:"relative min-h-[100dvh] flex flex-col",children:[e.jsxs(l.div,{className:"px-4 pt-12 pb-4 text-center flex-shrink-0",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.4},children:[e.jsx("h1",{className:"text-xl font-bold text-gray-800 mb-1",children:new Date().toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long"})}),e.jsxs("p",{className:"text-sm font-medium text-pink-700 bg-white/20 backdrop-blur-sm rounded-full px-3 py-1.5 inline-block",children:["Día ",t.currentDay," del ciclo"]})]}),e.jsxs(l.div,{className:"px-4 flex-grow flex flex-col justify-start",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.4,delay:.1},children:[e.jsx("div",{className:"text-center mb-4 flex-shrink-0",children:e.jsxs(l.div,{className:"relative inline-flex items-center justify-center w-64 h-64 mb-4",initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200,damping:15,delay:.3},children:[e.jsxs("svg",{className:"w-full h-full",viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"15",fill:"none",stroke:"rgba(255, 255, 255, 0.2)",strokeWidth:"0.5"}),[7,14,21,28].map(a=>{const s=a/28*2*Math.PI-Math.PI/2,y=50+37*Math.cos(s),c=50+37*Math.sin(s),i=50+43*Math.cos(s),r=50+43*Math.sin(s);return e.jsx("line",{x1:y,y1:c,x2:i,y2:r,stroke:"rgba(255, 255, 255, 0.3)",strokeWidth:"0.5"},a)}),m.map((a,s)=>e.jsxs("g",{children:[e.jsx("circle",{cx:a.x+.3,cy:a.y+.3,r:a.isToday?3.5:2.5,fill:"rgba(0, 0, 0, 0.2)",opacity:a.isActive?1:.5}),e.jsx(l.circle,{cx:a.x,cy:a.y,r:a.isToday?3.5:2.5,fill:a.isActive?a.isToday?a.colors.light:a.colors.main:"#e5e7eb",stroke:a.colors.border||(a.isActive?"rgba(255,255,255,0.4)":"#cbd5e1"),strokeWidth:a.colors.border?.6:(a.isActive,.8),initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.6,delay:.8+s*.02,type:"spring",stiffness:400,damping:25},style:{filter:a.isActive?"drop-shadow(0 1px 3px rgba(0,0,0,0.3))":"drop-shadow(0 1px 2px rgba(0,0,0,0.2))"}}),a.isActive&&e.jsx(l.circle,{cx:a.x,cy:a.y,r:"0.6",fill:(a.colors.main==="#ffffff","#e5e7eb"),initial:{scale:0},animate:{scale:1},transition:{duration:.3,delay:1.2+s*.02}})]},s))]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsxs(l.div,{className:"text-center bg-white/10 backdrop-blur-md rounded-full p-4",initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{delay:1,type:"spring",stiffness:200},style:{filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.1))"},children:[e.jsx("span",{className:"text-3xl font-bold text-pink-700 block",children:t.currentDay}),e.jsx("span",{className:"text-xs text-pink-700 font-medium mt-0.5 block",children:"día del ciclo"})]}),e.jsx(l.div,{className:"mt-2 px-2.5 py-1 bg-white/20 backdrop-blur-sm rounded-full border border-white/30",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:1.3},style:{filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.1))"},children:e.jsx("span",{className:"text-xs font-medium text-gray-800",children:t.currentDay<=7?"Menstrual":t.currentDay<=14?"Folicular":t.currentDay<=21?"Ovulatoria":"Lútea"})})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mx-1 mb-20 flex-shrink-0",children:[e.jsxs(l.div,{className:"bg-white/80 backdrop-blur-md rounded-2xl p-3",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.4,delay:.5},style:{filter:"drop-shadow(0 2px 8px rgba(0,0,0,0.1))"},children:[e.jsx("h3",{className:"text-xs font-semibold text-gray-800 mb-2 text-center",children:"Símbolos de fertilidad"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{color:"#ef4444",label:"Menstrual",symbol:"red"},{color:"#f8fafc",label:"Fértil",symbol:"white"},{color:"#22c55e",label:"Infértil",symbol:"green"},{color:"#ec4899",label:"Spotting",symbol:"spot"}].map(a=>e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-3 h-3 rounded-full shadow-sm",style:{backgroundColor:a.color,border:a.stroke?`1px solid ${a.stroke}`:"1px solid rgba(0,0,0,0.1)"}}),e.jsx("div",{className:"absolute inset-0 rounded-full bg-white",style:{width:"5px",height:"5px",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:a.stroke&&a.color==="#f8fafc"?"#6b7280":"white",opacity:a.color==="#f8fafc"?1:.7}})]}),e.jsx("span",{className:"text-xs font-medium text-gray-800 text-center leading-tight",children:a.label})]},a.symbol))}),e.jsxs("div",{className:"flex items-center justify-center gap-1 pt-2 mt-2 border-t border-gray-200",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-[#bfdbfe] shadow-sm relative",children:e.jsx("div",{className:"absolute inset-0 rounded-full bg-white w-1.5 h-1.5 top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"})}),e.jsx("span",{className:"text-xs font-medium text-gray-800",children:"Día actual"})]})]}),e.jsxs(l.div,{className:"bg-white/60 backdrop-blur-md rounded-2xl p-3 text-xs text-gray-800",initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.4,delay:.6},style:{filter:"drop-shadow(0 2px 8px rgba(0,0,0,0.1))"},children:[e.jsxs("h3",{className:"font-semibold mb-2 text-gray-900 flex items-center gap-1.5 justify-center",children:[e.jsx("div",{className:"w-2 h-2 bg-pink-500 rounded-full shadow-sm"}),"Información del ciclo"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-pink-800 mb-1",children:"CPM"}),e.jsx("div",{className:"text-gray-600 bg-gray-100 px-2 py-1 rounded-lg text-xs",children:"Datos incompletos"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-pink-800 mb-1",children:"T-8"}),e.jsx("div",{className:"text-gray-600 bg-gray-100 px-2 py-1 rounded-lg text-xs",children:"Datos incompletos"})]})]})]})]})]})]})},$=({onAddRecord:t,onAddCycle:n})=>{const[o,x]=f.useState(!1);return e.jsxs("div",{className:"fixed bottom-[calc(var(--bottom-nav-height)+1rem)] right-6 flex flex-col items-end space-y-3 z-50",children:[o&&e.jsxs(e.Fragment,{children:[e.jsx(l.button,{onClick:t,className:"w-12 h-12 rounded-full bg-gradient-to-br from-pink-500 to-rose-500 text-white shadow-lg flex items-center justify-center",whileTap:{scale:.95},whileHover:{scale:1.05},initial:{opacity:0,y:20,scale:.8},animate:{opacity:1,y:0,scale:1},style:{filter:"drop-shadow(0 6px 12px rgba(236, 72, 153, 0.3))"},children:e.jsx(z,{className:"h-5 w-5"})}),e.jsx(l.button,{onClick:n,className:"w-12 h-12 rounded-full bg-gradient-to-br from-purple-500 to-indigo-500 text-white shadow-lg flex items-center justify-center",whileTap:{scale:.95},whileHover:{scale:1.05},initial:{opacity:0,y:20,scale:.8},animate:{opacity:1,y:0,scale:1},style:{filter:"drop-shadow(0 6px 12px rgba(147, 51, 234, 0.3))"},children:e.jsx(B,{className:"h-5 w-5"})})]}),e.jsx(l.button,{onClick:()=>x(!o),className:"w-14 h-14 bg-gradient-to-br from-pink-500 to-rose-500 text-white rounded-full shadow-lg flex items-center justify-center",whileTap:{scale:.95},whileHover:{scale:1.05},initial:{scale:0},animate:{scale:1},style:{filter:"drop-shadow(0 6px 16px rgba(236, 72, 153, 0.4))"},children:e.jsx(L,{className:"h-6 w-6"})})]})},Z=()=>{const{currentCycle:t,addOrUpdateDataPoint:n,startNewCycle:o,isLoading:x}=T(),[m,a]=f.useState(!1),[s,y]=f.useState(!1),[c,i]=f.useState(!1);if(N(m,()=>a(!1)),x)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-rose-50 via-pink-50 to-rose-100 flex items-center justify-center",children:e.jsx("p",{className:"text-center text-gray-600 text-lg",children:"Cargando..."})});if(!(t!=null&&t.id))return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-rose-50 via-pink-50 to-rose-100 flex items-center justify-center",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("p",{className:"text-gray-600 text-lg",children:"No hay ciclo activo."}),e.jsx("button",{onClick:()=>i(!0),className:"px-6 py-3 rounded-lg bg-pink-600 hover:bg-pink-700 text-white shadow",children:"Iniciar ciclo"})]}),e.jsx(j,{isOpen:c,onClose:()=>i(!1),onConfirm:async d=>{await o(d),i(!1),a(!0)}})]});const r=O(H(new Date),E(t.startDate))+1,p=async d=>{y(!0);try{await n(d),a(!1)}finally{y(!1)}},g=async d=>{await o(d),i(!1),a(!0)};return e.jsxs("div",{className:"min-h-[100dvh] bg-gradient-to-br from-rose-50 via-pink-50 to-rose-100 relative overflow-x-hidden",children:[e.jsx("div",{className:"max-w-md mx-auto h-[100dvh]",children:e.jsx(l.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full",children:e.jsx(W,{cycleData:{...t,currentDay:r,records:t.data}})})}),e.jsx(k,{open:m,onOpenChange:d=>a(d),children:e.jsx(D,{hideClose:!0,className:"bg-white border-pink-100 text-gray-800 w-[90vw] sm:w-auto max-w-md sm:max-w-lg md:max-w-xl max-h-[85vh] overflow-y-auto p-4 sm:p-6 rounded-2xl",children:e.jsx(M,{onSubmit:p,onCancel:()=>a(!1),cycleStartDate:t.startDate,cycleEndDate:t.endDate,isProcessing:s})})}),e.jsx($,{onAddRecord:()=>a(!0),onAddCycle:()=>i(!0)}),e.jsx(j,{isOpen:c,onClose:()=>i(!1),onConfirm:g,currentCycleStartDate:t.startDate})]})};export{Z as default};
