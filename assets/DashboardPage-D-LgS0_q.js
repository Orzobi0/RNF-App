import{c as Lt,h as ss,i as ns,r as a,p as rs,d as ls,s as os,e as is,a as cs,b as us,u as ds,f as Me,g as gt,k as Ct,l as Nt,j as e,m as U,B as ge,n as ms}from"./index-C041RoKp.js";import{N as ma,L as fa,C as fs,P as ps}from"./NewCycleDialog-pYL8DOtB.js";import{i as ga,C as Jt,D as xs,c as hs,g as bs,a as ys,A as pa}from"./computePeakStatuses-Dl9gvYQS.js";import{u as gs,D as it,a as ct,b as Ot,c as At,d as xa,e as Bt}from"./useCycleData-fUMApAkg.js";import{c as vs,u as Cs,C as Ns}from"./useFertilityChart-Bo-tTrQP.js";import{I as _t}from"./input-D9upNPQ0.js";import{L as Rt}from"./label-DmhTYPl7.js";import{l as ha,P as ws}from"./badge-BbO7fxzd.js";import"./OverlapWarningDialog-CRNazV6l.js";import"./checkbox-DTslPdqR.js";import"./eye-fkTjB7nE.js";const ba=Lt("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]),js=Lt("CalendarPlus",[["path",{d:"M21 13V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8",key:"3spt84"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["line",{x1:"19",x2:"19",y1:"16",y2:"22",key:"1ttwzi"}],["line",{x1:"16",x2:"22",y1:"19",y2:"19",key:"1g9955"}]]),ya=Lt("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),Ds=Lt("FilePlus",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"12",x2:"12",y1:"18",y2:"12",key:"1tsf04"}],["line",{x1:"9",x2:"15",y1:"15",y2:"15",key:"110plj"}]]);function Ss(){!ss.current&&ns();const[p]=a.useState(rs.current);return p}const Ms="metrics",Fs="summary",Wt=async(p,c)=>{if(!p||!c||typeof c!="object")throw new Error("A valid userId and data object are required to save metrics.");const $=ls(is,`users/${p}/${Ms}`,Fs);await os($,c,{merge:!0})},vt=20;function ks({cycleCount:p,deduction:c}){return typeof c=="number"&&Number.isFinite(c)?c:(typeof p=="number"&&Number.isFinite(p)?p:0)>=12?20:21}function Is({computedCpmData:p,cpmSelection:c,isManualCpm:$,manualCpmBaseValue:O,manualCpmValue:Re,formatNumber:Z}){const J=typeof p.shortestCycle?.duration=="number"&&Number.isFinite(p.shortestCycle.duration)?p.shortestCycle.duration:null,ve=typeof p.value=="number"&&Number.isFinite(p.value)?p.value:null,ee=$&&c==="manual",k=c==="auto",le=c==="none",j=ee?O:k?J:null,oe=ee?Re:k?ve:null,te=Z(j,{maximumFractionDigits:0}),Y=Z(oe,{maximumFractionDigits:2}),Ce=`Ciclo más corto: ${te??"—"}`,Le=`CPM = ${Y??"—"}`;let X="Sin datos disponibles",B=!0;if(typeof oe=="number"&&Number.isFinite(oe)){if(ee)typeof O=="number"&&Number.isFinite(O)?(X=`${Z(O,{maximumFractionDigits:0})??`${O}`} − ${vt}`,B=!1):(X="Valor definido manualmente",B=!0);else if(k&&typeof J=="number"&&Number.isFinite(J)){const ie=ks({cycleCount:p.cycleCount??0,deduction:p.deduction});X=`${Z(J,{maximumFractionDigits:0})??`${J}`} − ${ie}`,B=!1}}return(typeof oe!="number"||!Number.isFinite(oe))&&(X="Sin datos disponibles",B=!0),{title:"CPM",baseText:Ce,finalText:Le,microCopy:X,microCopyMuted:B,modeLabel:le?"Sin usar":ee?"Manual":"Auto",microCopyId:"cpm-metric-microcopy",baseValue:j,finalValue:oe,baseFormatted:te,finalFormatted:Y,isManual:ee}}function Ts({computedT8Data:p,t8Selection:c,isManualT8:$,manualT8BaseValue:O,manualT8Value:Re,formatNumber:Z}){const J=typeof p.earliestCycle?.riseDay=="number"&&Number.isFinite(p.earliestCycle.riseDay)?p.earliestCycle.riseDay:null,ve=typeof p.value=="number"&&Number.isFinite(p.value)?p.value:null,ee=p&&typeof p.canCompute=="boolean"?p.canCompute:!0,k=$&&c==="manual",le=c==="auto"&&ee,j=c==="none",oe=k?O:le?J:null,te=k?Re:le?ve:null,Y=Z(oe,{maximumFractionDigits:0}),Ce=Z(te,{maximumFractionDigits:0}),Le=`Día de subida: ${Y??"—"}`,X=`T-8 = ${Ce??"—"}`;let B="Sin datos disponibles",ue=!0;return typeof te=="number"&&Number.isFinite(te)&&(k?typeof O=="number"&&Number.isFinite(O)?(B=`${Z(O,{maximumFractionDigits:0})??`${O}`} − 8`,ue=!1):(B="Valor definido manualmente",ue=!0):le&&typeof J=="number"&&Number.isFinite(J)&&(B=`${Z(J,{maximumFractionDigits:0})??`${J}`} − 8`,ue=!1)),(typeof te!="number"||!Number.isFinite(te))&&(B="Sin datos disponibles",ue=!0),{title:"T-8",baseText:Le,finalText:X,microCopy:B,microCopyMuted:ue,modeLabel:j?"Sin usar":k?"Manual":"Auto",microCopyId:"t8-metric-microcopy",baseValue:oe,finalValue:te,baseFormatted:Y,finalFormatted:Ce,isManual:k}}const Es=({cycleData:p,onEdit:c,onTogglePeak:$,currentPeakIsoDate:O,onEditStartDate:Re=()=>{},handleOpenCpmDialog:Z=()=>{},handleOpenT8Dialog:J=()=>{},cpmMetric:ve={},t8Metric:ee={}})=>{const k=p.records||[],[le,j]=a.useState(null),[oe,te]=a.useState({clientX:0,clientY:0}),[Y,Ce]=a.useState(!1),[Le,X]=a.useState(!1),[B,ue]=a.useState([]),ie=a.useRef(!0),Ne=a.useRef(null),Oe=a.useRef(null),Ye=a.useRef(new Map),ut=a.useRef(null),de=Ss(),y=p.startDate?Me(p.startDate):null,_=Nt(new Date),ae=a.useMemo(()=>hs(k),[k]);a.useEffect(()=>{const n=Ye.current,d=new Map,m=[];k.forEach(x=>{if(!x)return;let h=x.cycleDay;if(!h&&y&&x.isoDate)try{h=Ct(Me(x.isoDate),y)+1}catch{h=null}if(!h)return;const T=JSON.stringify({temp:x.displayTemperature??x.temperature_chart??null,symbol:x.fertility_symbol??null,sensation:x.mucus_sensation??x.mucusSensation??"",appearance:x.mucus_appearance??x.mucusAppearance??"",observations:x.observations??"",relations:x.had_relations??x.hadRelations??!1,updatedAt:x.updatedAt??x.timestamp??null});if(d.set(h,T),n.size>0){const S=n.get(h);(!S||S!==T)&&m.push(h)}}),Ye.current=d,!de&&m.length&&ue(x=>{const h=new Set(x);return m.forEach(T=>h.add(T)),Array.from(h)})},[y,de,k]),a.useEffect(()=>{if(de||B.length===0)return;const n=setTimeout(()=>{ue([])},1400);return ut.current=n,()=>{ut.current&&clearTimeout(ut.current)}},[de,B]);const K=28,Fe=140,E=Fe+15,se=E*2,we=a.useMemo(()=>{const n=k.reduce((d,m)=>{const x=m?.cycleDay??null;if(x)return Math.max(d,x);if(!y||!m?.isoDate)return d;try{const h=Me(m.isoDate),T=Ct(h,y)+1;return Number.isFinite(T)?Math.max(d,T):d}catch(h){return console.error("Error calculating record day for wheel:",h),d}},0);return Math.max(p.currentDay,n,K)},[p.currentDay,k,y,K]),H=Math.max(we-K,0),D=H>0,Ie=a.useMemo(()=>D?Math.max(0,Math.min(Math.max(p.currentDay-K,0),H)):0,[p.currentDay,D,H,K]),[I,q]=a.useState(Ie);a.useEffect(()=>{ie.current||(ie.current=!0)},[Ie,I]),a.useEffect(()=>{if(!D){ie.current=!0,q(0);return}q(n=>{const d=Math.min(n,H),m=Math.max(0,Math.min(Math.max(p.currentDay-K,0),H)),x=p.currentDay>=d+1&&p.currentDay<=d+K;return ie.current?x?d!==n?d:n:m:(ie.current=!0,m)})},[D,H,p.currentDay,K]);const Te=a.useCallback(n=>Math.max(0,Math.min(n,H)),[H]),A=a.useCallback(n=>{!D||n===0||q(d=>Te(d+n))},[Te,D]),G=a.useRef(0),R=a.useRef(0),me=a.useCallback(n=>{!D||n===0||(R.current+=n,!G.current&&(G.current=requestAnimationFrame(()=>{const d=Math.sign(R.current);q(m=>Te(m+d)),R.current=0,G.current=0})))},[D,Te]),L=a.useCallback(n=>{if(!D)return;n.preventDefault();const d=Math.abs(n.deltaY)>Math.abs(n.deltaX)?n.deltaY:n.deltaX;d!==0&&me(d>0?1:-1)},[A,D]),Ee=a.useCallback(n=>{D&&(Ne.current=n.touches?.[0]?.clientX??null)},[D]),Q=a.useCallback(n=>{if(!D||Ne.current===null)return;const d=n.touches?.[0]?.clientX??null;if(d===null)return;const m=d-Ne.current;Math.abs(m)<24||(me(m<0?1:-1),Ne.current=d)},[A,D]),Ke=a.useCallback(()=>{Ne.current=null},[]),z=a.useCallback(n=>({...bs(n),...n==="spot"?{pattern:"url(#spotting-pattern-dashboard)"}:{}}),[]),ze=a.useMemo(()=>k.reduce((n,d)=>{if(!d)return n;const m=Number(d.cycleDay);if(Number.isFinite(m)&&m>0)return n.has(m)||n.set(m,d),n;if(!y||!d.isoDate)return n;try{const x=Me(d.isoDate),h=Ct(x,y)+1;Number.isFinite(h)&&h>0&&!n.has(h)&&n.set(h,{...d,cycleDay:h})}catch(x){console.error("Error mapping record by day for wheel:",x)}return n},new Map),[k,y]),wt={main:"#b4a9b0",light:"#c1b6bd",glow:"rgba(212, 194, 206, 0.16)",border:"#c1b6bd"},Dt=Array.from({length:K},(n,d)=>{const m=I+d+1,x=ze.get(m)??null,h=y?ms(y,m-1):null,T=h?gt(h,"yyyy-MM-dd"):null,S=h?ga(Nt(h),_):!1,ce=x?{...x,cycleDay:x.cycleDay??m}:null,V=(d+I)/K*2*Math.PI-Math.PI/2,Ve=E+Fe*Math.cos(V),St=E+Fe*Math.sin(V);let Be=m<=p.currentDay&&ce?z(ce.fertility_symbol):wt;!ce&&m<p.currentDay?Be={main:"transparent",light:"transparent",glow:"rgba(180, 169, 176, 0.1)",border:"rgba(180, 169, 176, 0.4)"}:(S||m>p.currentDay)&&(Be={main:"transparent",light:"transparent",glow:"rgba(251, 192, 203, 0.1)",border:"rgba(252, 170, 185, 0.35)"});const Mt=m===p.currentDay;Mt&&(ce?Be={...z(ce.fertility_symbol),border:"rgba(251, 113, 133, 0.8)"}:Be={main:"transparent",light:"transparent",glow:"rgba(251, 113, 133, 0.4)",border:"rgba(251, 113, 133, 0.8)"});const Je=T&&ae[T]||null;return{x:Ve,y:St,day:m,colors:Be,isActive:m<=p.currentDay,isToday:Mt,hasRecord:!!ce,record:ce,isoDate:T,canShowPlaceholder:!!(!ce&&T&&!S),peakStatus:Je}}),He=a.useMemo(()=>new Set(B),[B]),dt=I*360/K,qe=-dt*Math.PI/180,mt=Math.cos(qe),We=Math.sin(qe),je=a.useCallback((n,d)=>{const m=n-E,x=d-E;return{x:E+m*mt-x*We,y:E+m*We+x*mt}},[E,mt,We]),ft=2*Math.PI/K,ne=-Math.PI/2-ft/2,De=Fe-18,Pe=Fe+10,fe=E+De*Math.cos(ne),Ae=E+De*Math.sin(ne),pe=E+Pe*Math.cos(ne),Se=E+Pe*Math.sin(ne);a.useEffect(()=>{D&&j(null)},[I,D]);const Ge=(n,d)=>{if(d.stopPropagation(),!Oe.current){j(null);return}const m=Oe.current.getBoundingClientRect();let x,h;d.touches&&d.touches[0]?(x=d.touches[0].clientX,h=d.touches[0].clientY):(x=d.clientX,h=d.clientY);const T=n.canShowPlaceholder&&n.isoDate?{id:`placeholder-${n.isoDate}`,isoDate:n.isoDate,cycleDay:n.day,fertility_symbol:null,mucus_sensation:"",mucusSensation:"",mucus_appearance:"",mucusAppearance:"",observations:"",temperature_chart:null,displayTemperature:null,ignored:!1,peakStatus:n.peakStatus,peak_marker:n.peakStatus==="P"?"peak":null}:null,S=n.record?{...n.record,cycleDay:n.record.cycleDay??n.day,peakStatus:n.peakStatus,peak_marker:n.record.peak_marker??(n.peakStatus==="P"?"peak":null)}:T;if(S&&O&&S.isoDate===O&&(S.peak_marker="peak",S.peakStatus=S.peakStatus||"P"),!S){j(null);return}te({clientX:x-m.left,clientY:h-m.top}),j(S)};return a.useEffect(()=>{if(!le)return;const n=d=>{Oe.current&&!Oe.current.contains(d.target)&&j(null)};return document.addEventListener("mousedown",n),document.addEventListener("touchstart",n),()=>{document.removeEventListener("mousedown",n),document.removeEventListener("touchstart",n)}},[le]),e.jsxs("div",{className:"relative flex flex-col space-y-4",children:[e.jsxs(U.div,{className:"relative overflow-hidden px-4 pt-4 pb-3 text-center flex-shrink-0",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.4},children:[e.jsx("h1",{className:"text-xl font-bold text-titulo mb-1",children:new Date().toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long"})}),e.jsxs("button",{type:"button",onClick:Re,className:"inline-flex items-center gap-1.5 rounded-full bg-white/60 px-3 py-1.5 text-sm font-semibold text-subtitulo shadow-sm transition-colors focus:outline-none focus:ring-2 focus:ring-rose-300 focus:ring-offset-2 focus:ring-offset-transparent hover:bg-white",title:"Editar fecha de inicio del ciclo",children:[e.jsx(ps,{className:"w-4 h-4"}),"Ciclo actual"]})]}),e.jsxs(U.div,{className:"px-4 flex-grow flex flex-col justify-start mt-2",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.4,delay:.1},children:[e.jsxs("div",{className:"relative overflow-hidden rounded-[75px]   p-4  mb-4",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[e.jsx("div",{className:"absolute inset-0 "}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 h-1/2 "})]}),e.jsx("div",{className:"relative text-center flex-shrink-0",children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(U.div,{ref:Oe,className:"relative inline-flex items-center justify-center mb-4 drop-shadow-[0_15px_35px_rgba(221,86,101,0.22)]",style:{width:se,height:se},initial:{opacity:0},animate:{opacity:1},transition:{duration:.18,ease:"easeOut"},onWheel:L,onTouchStart:Ee,onTouchMove:Q,onTouchEnd:Ke,children:[e.jsxs("svg",{className:"w-full h-full wheel-no-tap",viewBox:`0 0 ${se} ${se}`,onClick:()=>j(null),children:[e.jsxs("defs",{children:[e.jsxs("pattern",{id:"spotting-pattern-dashboard",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[e.jsx("rect",{width:"6",height:"6",fill:"#ef4444"}),e.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(255,255,255,0.85)"})]}),e.jsxs("radialGradient",{id:"ringGlow",cx:"50%",cy:"50%",r:"78%",fx:"30%",fy:"20%",children:[e.jsx("stop",{offset:"0%",stopColor:"#FFE7E8",stopOpacity:"0.98"}),e.jsx("stop",{offset:"60%",stopColor:"#FFC0C1",stopOpacity:"0.95"}),e.jsx("stop",{offset:"100%",stopColor:"#FFB5B3",stopOpacity:"0.95"})]}),e.jsxs("filter",{id:"circleDepthShadow",children:[e.jsx("feDropShadow",{dx:"0",dy:"10",stdDeviation:"10",floodColor:"rgba(221,86,101,0.22)",floodOpacity:"1"}),e.jsx("feDropShadow",{dx:"0",dy:"4",stdDeviation:"4",floodColor:"rgba(221,86,101,0.18)",floodOpacity:"1"})]}),e.jsx("filter",{id:"dotShadow",x:"-30%",y:"-30%",width:"160%",height:"160%",colorInterpolationFilters:"sRGB",children:e.jsx("feDropShadow",{dx:"0",dy:"0.8",stdDeviation:"0.8",floodColor:"#000",floodOpacity:"0.22"})}),e.jsx("filter",{id:"whiteSymbolShadow",children:e.jsx("feDropShadow",{dx:"0",dy:"0.5",stdDeviation:"0.8",floodColor:"rgba(189,16,44,0.3)"})}),e.jsx("filter",{id:"activePointHighlight",children:e.jsx("feDropShadow",{dx:"0",dy:"-1",stdDeviation:"0.5",floodColor:"rgba(255,255,255,0.7)",floodOpacity:"1"})}),e.jsxs("filter",{id:"bevel",children:[e.jsx("feFlood",{floodColor:"rgba(255,255,255,0.4)",result:"top"}),e.jsx("feFlood",{floodColor:"rgba(0,0,0,0.2)",result:"bottom"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"top"}),e.jsx("feMergeNode",{in:"bottom"}),e.jsx("feMergeNode",{})]})]})]}),e.jsx("circle",{cx:E,cy:E,r:Fe-28,fill:"url(#ringGlow)",stroke:"rgba(255,225,228,0.8)",strokeWidth:1.2,filter:"url(#circleDepthShadow)"}),D&&e.jsx("line",{x1:fe,y1:Ae,x2:pe,y2:Se,stroke:"rgba(244,63,94,0.55)",strokeWidth:5,strokeLinecap:"round",opacity:.8}),e.jsx(U.g,{transition:{type:"tween",duration:.18,ease:[.2,.8,.2,1]},initial:!1,animate:ie.current?{rotate:-dt}:!1,style:{transformOrigin:"center",transformBox:"view-box",willChange:"transform"},children:Dt.map((n,d)=>e.jsxs("g",{children:[e.jsx("g",{filter:n.isActive?"url(#activePointHighlight)":n.isToday?"url(#bevel)":void 0,children:e.jsx(U.circle,{cx:n.x,cy:n.y,r:n.isToday?12:11,fill:n.colors.pattern||(n.isActive?n.colors.main:"rgba(255,255,255,0.001)"),stroke:n.colors.border&&n.colors.border!=="none"?n.colors.border:"rgba(255,255,255,0.3)",strokeWidth:n.colors.border&&n.colors.border!=="none"?n.isToday?2.2:1.2:0,filter:n.fertilitysymbol==="white"?"url(#whiteSymbolShadow)":n.isActive?"url(#dotShadow)":void 0,strokeLinecap:"round",onClick:m=>Ge(n,m),initial:!1,animate:{scale:1,opacity:1,y:0},transition:{duration:.5,ease:"easeOut"},whileTap:de||!ie.current?void 0:{y:2,scale:.75,opacity:.95,transition:{duration:.08,ease:"easeOut"}},style:{cursor:"pointer"}})}),!de&&He.has(n.day)&&e.jsxs(U.g,{pointerEvents:"none",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{transformOrigin:`${n.x}px ${n.y}px`},children:[e.jsx(U.circle,{cx:n.x,cy:n.y-12,r:4,fill:n.colors.main,initial:{y:-18,scale:.5,opacity:0},animate:{y:[-18,0,2],scale:[.5,1.05,.8],opacity:[0,1,0]},transition:{duration:.6,ease:"easeOut",times:[0,.6,1]}}),e.jsx(U.circle,{cx:n.x,cy:n.y,r:n.isToday?12:10,stroke:n.colors.border==="none"?n.colors.main:n.colors.border||n.colors.main,strokeWidth:2,fill:"none",initial:{scale:.5,opacity:.9},animate:{scale:1.4,opacity:0},transition:{duration:.55,ease:[.16,1,.3,1],delay:.05}}),e.jsx(U.circle,{cx:n.x,cy:n.y,r:n.isToday?14:12,stroke:n.colors.border==="none"?n.colors.main:n.colors.border||n.colors.main,strokeWidth:1.5,fill:"none",initial:{scale:.6,opacity:.6},animate:{scale:1.9,opacity:0},transition:{duration:.9,ease:"easeOut",delay:.1}})]},`dot-splash-${n.day}`),n.isToday&&e.jsx("circle",{cx:n.x,cy:n.y,r:8.5,fill:"none",stroke:"rgba(244,63,94,0.8)",strokeWidth:3,className:"animate-pulse",style:{pointerEvents:"none"}})]},d))}),Dt.map((n,d)=>{if(!n.peakStatus)return null;const{x:m,y:x}=je(n.x,n.y);return n.peakStatus==="P"?e.jsx("text",{x:m,y:x+4,textAnchor:"middle",fontSize:"14",fontWeight:"900",fill:"#ec4899",style:{pointerEvents:"none"},children:"✖"}):e.jsx("text",{x:m,y:x+4,textAnchor:"middle",fontSize:"12",fontWeight:"800",fill:"#7f1d1d",style:{pointerEvents:"none"},children:n.peakStatus})})]}),le&&e.jsx("div",{onClick:n=>n.stopPropagation(),children:e.jsx(Ns,{point:le,position:oe,chartWidth:Oe.current?.clientWidth||0,chartHeight:Oe.current?.clientHeight||0,onEdit:c,onClose:()=>j(null),onTogglePeak:$,currentPeakIsoDate:O})}),e.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none",children:e.jsxs(U.div,{className:"flex flex-col items-center gap-2",initial:{opacity:0},animate:{opacity:1},transition:{duration:.2,delay:.2,ease:"easeOut"},children:[e.jsx("div",{className:"flex items-center justify-center ",children:e.jsx("p",{className:"text-6xl font-semibold text-fertiliapp-fuerte leading-none",children:p.currentDay})}),e.jsx("p",{className:"mt-1 text-[15px] font-medium uppercase tracking-wide text-fertiliapp-fuerte",children:"DÍA DEL CICLO"})]})})]}),D&&e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("button",{type:"button",className:"p-2 rounded-full text-fertiliapp-fuerte shadow-xs transition hover:border hover:bg-fertiliapp-fuerte/20",onClick:()=>A(-1),disabled:I===0,children:e.jsx(ys,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-medium text-fertiliapp-fuerte",children:["Día ",I+1]}),e.jsx("span",{className:"text-xs text-fertiliapp-fuerte",children:"•"}),e.jsxs("span",{className:"text-xs font-medium text-fertiliapp-fuerte",children:["Día ",Math.min(I+K,we)]})]}),e.jsx("input",{type:"range",min:0,max:H,value:I,onChange:n=>q(Te(Number(n.target.value))),className:"w-40 range-fertiliapp"})]}),e.jsx("button",{type:"button",className:"p-2 rounded-full text-fertiliapp-fuerte shadow-xs transition hover:border hover:bg-fertiliapp-fuerte/20",onClick:()=>me(1),disabled:I===H,children:e.jsx(Jt,{className:"w-4 h-4"})})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mx-2 mb-6 mt-2 flex-shrink-0 items-start",children:[e.jsxs(U.div,{className:`relative overflow-hidden rounded-3xl bg-white/60 border border-secundario-suave shadow-[0_14px_35px_rgba(148,163,184,0.18)] backdrop-blur-md p-1 transition-[width] duration-300 ease-in-out mx-auto ${Y?"w-full":"w-[80%]"}`,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.4,delay:.5},children:[e.jsxs("button",{type:"button",onClick:()=>Ce(n=>!n),className:"group flex w-full items-center justify-between gap-3 rounded-2xl px-3 py-2 text-left transition",children:[e.jsx("span",{className:"text-sm font-semibold text-slate-700 tracking-tight uppercase",children:"SÍMBOLOS"}),e.jsx("div",{className:"absolute top-4.5 right-4 w-1.5 h-1.5 bg-secundario rounded-full"})]}),e.jsx(pa,{initial:!1,children:Y&&e.jsx(U.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.25,ease:"easeInOut"},className:"grid grid-cols-2 gap-2.5 rounded-3xl bg-white/40 p-2 overflow-hidden",children:[{label:"Menstrual",color:"#fb7185"},{label:"Moco (Fértil)",color:"#fdf5f8",stroke:"#fb7185"},{label:"Seco",color:"#67C5A4"},{label:"Moco (No fértil)",color:"#F7B944"},{label:"Spotting",color:"#fb7185",stroke:"#fee2e2",pattern:!0},{label:"Hoy",isToday:!0}].map(n=>e.jsxs("div",{className:"flex flex-col items-center gap-1.5",children:[n.isToday?e.jsxs("div",{className:"relative flex items-center justify-center",children:[e.jsx("div",{className:"w-5 h-5 rounded-full border border-rose-400/80 bg-transparent"}),e.jsx("div",{className:"absolute inset-0 -m-1 rounded-full border-[3px] border-rose-500/80 animate-pulse"})]}):e.jsx("div",{className:`w-5 h-5 rounded-full border ${n.pattern?"pattern-bg":""}`,style:{backgroundColor:n.color,borderColor:n.stroke||"transparent"}}),e.jsx("span",{className:`text-xs font-medium text-center leading-none ${n.isToday?"text-gray-700 font-semibold":"text-gray-700"}`,children:n.label})]},n.label))},"symbols")})]}),e.jsxs(U.div,{className:`relative overflow-hidden rounded-3xl bg-white/60 border border-secundario-suave shadow-[0_14px_35px_rgba(148,163,184,0.18)] backdrop-blur-md p-1 transition-[width] duration-300 ease-in-out mx-auto ${Le?"w-full":"w-[80%]"}`,initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.4,delay:.6},children:[e.jsxs("button",{type:"button",onClick:()=>X(n=>!n),className:"group flex w-full items-center justify-between gap-3 rounded-2xl px-3 py-2 text-left transition",children:[e.jsx("span",{className:"text-sm font-semibold text-slate-800 tracking-tight uppercase",children:"CÁLCULO"}),e.jsx("div",{className:"absolute top-4.5 right-4 w-1.5 h-1.5 bg-secundario rounded-full"})]}),e.jsx(pa,{initial:!1,children:Le&&e.jsxs(U.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.25,ease:"easeInOut"},className:"grid grid-cols-2 gap-2.5 rounded-3xl bg-white/40 p-2 overflow-hidden",children:[e.jsxs("button",{type:"button",onClick:Z,className:"flex flex-col items-center gap-1.5","aria-label":"Editar CPM (Ciclo más corto)",children:[e.jsx("span",{className:"flex items-center justify-center text-[10px] font-medium text-gray-700 leading-tight text-center h-8",children:"Ciclo más corto"}),e.jsx("div",{className:"h-10 flex items-end",children:e.jsx("div",{className:"flex items-center justify-center rounded-full border border-rose-200/70 bg-white/70 shadow-sm w-10 h-10 text-base font-bold text-rose-700",children:ve?.baseFormatted??"—"})})]}),e.jsxs("button",{type:"button",onClick:Z,className:"flex flex-col items-center gap-1.5","aria-label":"Editar CPM (resultado)",children:[e.jsx("span",{className:"flex items-center justify-center text-[10px] font-medium text-gray-700 leading-tight text-center h-8",children:"CPM"}),e.jsx("div",{className:"h-10 flex items-end",children:e.jsx("div",{className:"flex items-center justify-center rounded-full border border-rose-200/70 bg-white/80 shadow-sm w-10 h-10 text-sm font-semibold text-rose-700",children:ve?.finalFormatted??"—"})}),e.jsx("span",{className:"text-[9px] font-semibold text-rose-600 mt-0.5",children:ve?.modeLabel??"Auto"})]}),e.jsxs("button",{type:"button",onClick:J,className:"flex flex-col items-center gap-1.5","aria-label":"Editar T-8 (Día de subida)",children:[e.jsx("span",{className:"flex items-center justify-center text-[10px] font-medium text-gray-700 leading-tight text-center h-8",children:"Día de subida"}),e.jsx("div",{className:"h-10 flex items-end",children:e.jsx("div",{className:"flex items-center justify-center rounded-full border border-rose-200/70 bg-white/70 shadow-sm w-10 h-10 text-base font-bold text-rose-700",children:ee?.baseFormatted??"—"})})]}),e.jsxs("button",{type:"button",onClick:J,className:"flex flex-col items-center gap-1.5","aria-label":"Editar T-8 (resultado)",children:[e.jsx("span",{className:"flex items-center justify-center text-[10px] font-medium text-gray-700 leading-tight text-center h-8",children:"T-8"}),e.jsx("div",{className:"h-10 flex items-end",children:e.jsx("div",{className:"flex items-center justify-center rounded-full border border-rose-200/70 bg-white/80 shadow-sm w-10 h-10 text-sm font-semibold text-rose-700",children:ee?.finalFormatted??"—"})}),e.jsx("span",{className:"text-[9px] font-semibold text-rose-600 mt-0.5",children:ee?.modeLabel??"Auto"})]})]},"calc-card")})]})]})]})]})},Ps=({onAddRecord:p,onAddCycle:c})=>{const[$,O]=a.useState(!1);return e.jsxs("div",{className:"fixed right-4 top-12 md:top-6 flex flex-col-reverse items-end space-y-2 z-50",children:[$&&e.jsxs("div",{className:"flex flex-col space-y-2 mt-1",children:[e.jsxs(U.button,{onClick:p,className:"flex items-center gap-1 px-4 h-10 rounded-full bg-fertiliapp-fuerte hover:brightness-50 text-white/90 shadow-sm shadow-[#DD5665]",whileTap:{scale:.8},whileHover:{scale:1.05},initial:{opacity:0,y:20,scale:.8},animate:{opacity:1,y:0,scale:1},style:{filter:"drop-shadow(0 6px 12px rgba(244, 114, 182, 0.28))"},children:[e.jsx(Ds,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm font-medium tracking-tight",children:"Añadir registro"})]}),e.jsxs(U.button,{onClick:c,className:"flex items-center gap-3 px-4 h-10 rounded-full bg-white/80 hover:brightness-50 text-fertiliapp-fuerte shadow-sm shadow-[#DD5665]",whileTap:{scale:.95},whileHover:{scale:1.05},initial:{opacity:0,y:20,scale:.8},animate:{opacity:1,y:0,scale:1},style:{filter:"drop-shadow(0 6px 12px rgba(244, 114, 182, 0.2))"},children:[e.jsx(js,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm font-medium tracking-tight",children:"Nuevo ciclo"})]})]}),e.jsx(U.button,{onClick:()=>O(!$),className:"flex items-center justify-center rounded-full bg-white/80 border border-fertiliapp-fuerte text-fertiliapp-fuerte hover:brightness-95 shadow-sm shadow-[#5BA9B8] w-12 h-12 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-300 focus-visible:ring-offset-2",whileTap:{scale:.95},whileHover:{scale:1.05},initial:{scale:0},animate:{scale:1},style:{filter:"drop-shadow(0 4px 12px rgba(221, 86, 101, 0.35))"},children:e.jsx(U.span,{animate:{rotate:$?135:0},transition:{type:"spring",stiffness:260,damping:20},children:e.jsx(ws,{className:"h-5 w-5"})})})]})},Ws=()=>{const p=cs(),{currentCycle:c,archivedCycles:$,addOrUpdateDataPoint:O,startNewCycle:Re,isLoading:Z,updateCycleDates:J,checkCycleOverlap:ve,forceUpdateCycleStart:ee,refreshData:k,setCycleIgnoreForAutoCalculations:le}=gs(),{toast:j}=us(),[oe,te]=a.useState(!1),[Y,Ce]=a.useState(()=>c?.startDate||""),[Le,X]=a.useState(""),[B,ue]=a.useState(null),[ie,Ne]=a.useState(null),[Oe,Ye]=a.useState(!1),[ut,de]=a.useState(!1),{user:y,preferences:_,savePreferences:ae}=ds(),[K,Fe]=a.useState(!1),[ke,E]=a.useState(""),[se,we]=a.useState(""),[H,D]=a.useState(""),[Ie,I]=a.useState(""),[q,Te]=a.useState(null),[A,G]=a.useState(null),[R,me]=a.useState(null),[L,Ee]=a.useState(!1),[Q,Ke]=a.useState("auto"),[z,ze]=a.useState("auto"),[wt,jt]=a.useState(!1),[Dt,He]=a.useState(!1),[dt,qe]=a.useState(!1),[mt,We]=a.useState(!1),[je,ft]=a.useState(""),[ne,De]=a.useState(""),[Pe,fe]=a.useState(""),[Ae,pe]=a.useState(""),[Se,Ge]=a.useState(null),[n,d]=a.useState(null),[m,x]=a.useState(null),[h,T]=a.useState(!1),[S,ce]=a.useState("auto"),[V,Ve]=a.useState("auto"),[St,Be]=a.useState(!1),[Mt,Je]=a.useState(!1),[Xt,zt]=a.useState(!1),[Yt,Kt]=a.useState([]),Qe=a.useRef(!1),Ze=a.useRef(!1),Vt=a.useRef(null),qt=a.useRef(!1),Gt=a.useRef(!1),xe=a.useMemo(()=>y?.uid?`rnf_manual_cpm_${y.uid}`:null,[y?.uid]),he=a.useMemo(()=>y?.uid?`rnf_manual_cpm_base_${y.uid}`:null,[y?.uid]),be=a.useMemo(()=>y?.uid?`rnf_manual_t8_${y.uid}`:null,[y?.uid]),ye=a.useMemo(()=>y?.uid?`rnf_manual_t8_base_${y.uid}`:null,[y?.uid]),pt=a.useCallback(async t=>{if(!(!y?.uid||!ae)&&["auto","manual","none"].includes(t))try{await ae({cpmMode:t})}catch(s){console.error("Failed to persist CPM mode",s)}},[ae,y?.uid]),xt=a.useCallback(async t=>{if(!(!y?.uid||!ae)&&["auto","manual","none"].includes(t))try{await ae({t8Mode:t})}catch(s){console.error("Failed to persist T-8 mode",s)}},[ae,y?.uid]);a.useEffect(()=>{Qe.current=!1},[xe]),a.useEffect(()=>{Ze.current=!1},[be]),a.useEffect(()=>{if(!he){G(null);return}const t=_?.manualCpmBase;if(t!==void 0){if(typeof t=="number"&&Number.isFinite(t)){if(G(t),typeof window<"u")try{localStorage.setItem(he,JSON.stringify({value:t}))}catch(s){console.error("Failed to sync manual CPM base value to local storage",s)}}else if(G(null),typeof window<"u")try{localStorage.removeItem(he)}catch(s){console.error("Failed to clear manual CPM base value from local storage",s)}return}if(!(typeof window>"u"))try{const s=localStorage.getItem(he);if(s){const o=JSON.parse(s);o&&typeof o.value=="number"&&Number.isFinite(o.value)?G(o.value):G(null)}else G(null)}catch(s){console.error("Failed to restore manual CPM base value from local storage",s)}},[he,_?.manualCpmBase]),a.useEffect(()=>{if(!ye){d(null);return}const t=_?.manualT8Base;if(t!==void 0){if(typeof t=="number"&&Number.isFinite(t)){if(d(t),typeof window<"u")try{localStorage.setItem(ye,JSON.stringify({value:t}))}catch(s){console.error("Failed to sync manual T-8 base value to local storage",s)}}else if(d(null),typeof window<"u")try{localStorage.removeItem(ye)}catch(s){console.error("Failed to clear manual T-8 base value from local storage",s)}return}if(!(typeof window>"u"))try{const s=localStorage.getItem(ye);if(s){const o=JSON.parse(s);o&&typeof o.value=="number"&&Number.isFinite(o.value)?d(o.value):d(null)}else d(null)}catch(s){console.error("Failed to restore manual T-8 base value from local storage",s)}},[ye,_?.manualT8Base]);const et=a.useCallback(async({finalValue:t,baseValue:s})=>{if(!y?.uid||!ae)return;const o=t==null?null:Number(t),l=s===void 0?void 0:s==null?null:Number(s),i={manualCpm:o};l!==void 0&&(i.manualCpmBase=l);try{await ae(i),xe&&typeof window<"u"&&(i.manualCpm===null?localStorage.removeItem(xe):localStorage.setItem(xe,JSON.stringify({value:i.manualCpm}))),l!==void 0&&he&&typeof window<"u"&&(l===null?localStorage.removeItem(he):localStorage.setItem(he,JSON.stringify({value:l}))),await Wt(y.uid,{manual:{cpm:{value:o,base:l===void 0?A:l}},manualUpdatedAt:new Date().toISOString()})}catch(r){throw console.error("Failed to persist manual CPM value in profile",r),r}},[he,A,xe,ae,y?.uid]),tt=a.useCallback(async({finalValue:t,baseValue:s})=>{if(!y?.uid||!ae)return;const o=t==null?null:Number(t),l=s===void 0?void 0:s==null?null:Number(s),i={manualT8:o};l!==void 0&&(i.manualT8Base=l);try{await ae(i),be&&typeof window<"u"&&(i.manualT8===null?localStorage.removeItem(be):localStorage.setItem(be,JSON.stringify({value:i.manualT8}))),l!==void 0&&ye&&typeof window<"u"&&(l===null?localStorage.removeItem(ye):localStorage.setItem(ye,JSON.stringify({value:l}))),await Wt(y.uid,{manual:{t8:{value:o,riseDay:l===void 0?n:l}},manualUpdatedAt:new Date().toISOString()})}catch(r){throw console.error("Failed to persist manual T-8 value in profile",r),r}},[ye,n,be,ae,y?.uid]);a.useEffect(()=>{if(!xe){me(null),Ee(!1),Qe.current=!1;return}const t=_?.manualCpm;if(typeof t=="number"&&Number.isFinite(t)){if(me(t),Ee(!0),typeof window<"u")try{localStorage.setItem(xe,JSON.stringify({value:t}))}catch(s){console.error("Failed to sync manual CPM value to local storage",s)}return}if(t===null&&(me(null),Ee(!1),typeof window<"u"))try{localStorage.removeItem(xe)}catch(s){console.error("Failed to clear manual CPM value from local storage",s)}},[xe,_?.manualCpm]),a.useEffect(()=>{if(!be){x(null),T(!1),Ze.current=!1;return}const t=_?.manualT8;if(typeof t=="number"&&Number.isFinite(t)){if(x(t),T(!0),typeof window<"u")try{localStorage.setItem(be,JSON.stringify({value:t}))}catch(s){console.error("Failed to sync manual T-8 value to local storage",s)}return}if(t===null&&(x(null),T(!1),typeof window<"u"))try{localStorage.removeItem(be)}catch(s){console.error("Failed to clear manual T-8 value from local storage",s)}},[be,_?.manualT8]),a.useEffect(()=>{if(!xe||Qe.current||!y?.uid)return;if(_?.manualCpm!==void 0){Qe.current=!0;return}if(typeof window>"u"){Qe.current=!0;return}try{const s=localStorage.getItem(xe);if(s){const o=JSON.parse(s);if(o&&typeof o.value=="number"&&Number.isFinite(o.value)){me(o.value),Ee(!0);let l=A;try{if(he){const i=localStorage.getItem(he);if(i){const r=JSON.parse(i);r&&typeof r.value=="number"&&Number.isFinite(r.value)?l=r.value:l=null}}}catch(i){console.error("Failed to read manual CPM base value from local storage",i)}G(typeof l=="number"&&Number.isFinite(l)?l:null),et({finalValue:o.value,baseValue:l}).catch(i=>console.error("Failed to migrate manual CPM value to profile storage",i))}}}catch(s){console.error("Failed to restore manual CPM value from local storage",s)}finally{Qe.current=!0}},[he,A,xe,et,_?.manualCpm,y?.uid]),a.useEffect(()=>{if(!be||Ze.current||!y?.uid)return;if(_?.manualT8!==void 0){Ze.current=!0;return}if(typeof window>"u"){Ze.current=!0;return}try{const s=localStorage.getItem(be);if(s){const o=JSON.parse(s);if(o&&typeof o.value=="number"&&Number.isFinite(o.value)){x(o.value),T(!0);let l=n;try{if(ye){const i=localStorage.getItem(ye);if(i){const r=JSON.parse(i);r&&typeof r.value=="number"&&Number.isFinite(r.value)?l=r.value:l=null}}}catch(i){console.error("Failed to read manual T-8 base value from local storage",i)}d(typeof l=="number"&&Number.isFinite(l)?l:null),tt({finalValue:o.value,baseValue:l}).catch(i=>console.error("Failed to migrate manual T-8 value to profile storage",i))}}}catch(s){console.error("Failed to restore manual T-8 value from local storage",s)}finally{Ze.current=!0}},[ye,n,be,tt,_?.manualT8,y?.uid]),a.useEffect(()=>{Ce(c?.startDate||"")},[c?.startDate]);const Ut=a.useCallback(t=>{if(!t?.startDate)return null;try{const s=Me(t.startDate);if(Number.isNaN(s.getTime()))return null;const o=gt(s,"dd/MM/yyyy",{locale:ha});if(!t.endDate)return`${o} - En curso`;const l=Me(t.endDate);if(Number.isNaN(l.getTime()))return o;const i=gt(l,"dd/MM/yyyy",{locale:ha});return`${o} - ${i}`}catch{return null}},[]),Ft=a.useMemo(()=>{const t=[];if(Array.isArray($)&&$.length>0&&$.forEach((s,o)=>{const l=Ut(s);t.push({...s,displayName:s.name||l||`Ciclo archivado ${o+1}`,dateRangeLabel:l,source:"archived",ignoredForAutoCalculations:!!s.ignoredForAutoCalculations})}),c?.id){const s=Ut(c);t.push({...c,displayName:c.name||s||"Ciclo actual",dateRangeLabel:s,source:"current",ignoredForAutoCalculations:!!c.ignoredForAutoCalculations})}return t},[$,c,Ut]),N=a.useMemo(()=>{const o=[...Ft.map(u=>{if(!u.startDate||!u.endDate)return null;try{const w=Me(u.startDate),M=Me(u.endDate);if(Number.isNaN(w.getTime())||Number.isNaN(M.getTime())||ga(w,M))return null;const f=Ct(Nt(M),Nt(w))+1;return!Number.isFinite(f)||f<=0?null:{...u,duration:f,ignoredForAutoCalculations:!!u.ignoredForAutoCalculations}}catch(w){return console.error("Failed to compute cycle duration for CPM calculation",w),null}}).filter(Boolean)].sort((u,w)=>{const M=typeof u.duration=="number"&&Number.isFinite(u.duration)?u.duration:Number.POSITIVE_INFINITY,f=typeof w.duration=="number"&&Number.isFinite(w.duration)?w.duration:Number.POSITIVE_INFINITY;return M-f}).map(u=>{const w=!!u.ignoredForAutoCalculations;return{...u,isIgnored:w,isIncluded:!w}}),l=o.filter(u=>u.isIncluded),i=o.length-l.length,r=l.length;if(r<6)return{value:null,cycleCount:r,shortestCycle:null,deduction:null,canCompute:!1,cyclesConsidered:o,ignoredCount:i};const b=l[0]??null,C=r>=12?20:21,v=typeof b?.duration=="number"&&Number.isFinite(b.duration)?b.duration-C:null;return{value:v,cycleCount:r,shortestCycle:b,deduction:C,canCompute:v!==null,cyclesConsidered:o,ignoredCount:i}},[Ft]),g=a.useMemo(()=>{const t=f=>{if(f==null||f==="")return null;const F=Number.parseFloat(String(f).replace(",","."));return Number.isFinite(F)?F:null},s=f=>{if(!f)return null;const F=t(f.temperature),P=t(f.temperature_corrected);return f.use_corrected&&P!==null?P:F!==null?F:P!==null?P:null},o=f=>{const F=[f?.temperature_chart,f?.temperature_raw,f?.temperature_corrected];for(const P of F){const re=t(P);if(re!==null)return re}if(Array.isArray(f?.measurements)){const re=f.measurements.find($e=>$e&&$e.selected&&s($e)!==null)||f.measurements.find($e=>s($e)!==null);if(re){const $e=s(re);if($e!==null)return $e}}return null},l=f=>{if(!f)return null;try{const F=Me(f);return Number.isNaN(F.getTime())?null:F}catch{return null}},i=Ft.filter(f=>f&&f.startDate&&Array.isArray(f.data)&&f.data.length>0).sort((f,F)=>{const P=l(f.startDate),re=l(F.startDate);return!P&&!re?0:P?re?re-P:-1:1}),r=[],b=[];for(const f of i){const F=f.data.filter(yt=>yt&&yt.isoDate).map(yt=>({...yt,displayTemperature:o(yt)}));if(F.length===0)continue;const{ovulationDetails:P}=vs(F);if(!P?.confirmed)continue;const re=Number.isInteger(P?.ovulationIndex)?P.ovulationIndex:Number.isInteger(P?.confirmationIndex)?P.confirmationIndex:null;if(re==null||re<0||re>=F.length)continue;const $e=F[re],Pt=Number($e?.cycleDay);if(!Number.isFinite(Pt)||Pt<=0)continue;const as=Math.max(1,Pt-8),$t=!!f.ignoredForAutoCalculations,da={cycleId:f.id,riseDay:Pt,t8Day:as,displayName:f.displayName||f.name||"Ciclo sin nombre",dateRangeLabel:f.dateRangeLabel,isIgnored:$t,isIncluded:!$t,ignoredForAutoCalculations:$t};r.push(da),!$t&&b.length<12&&b.push(da)}const C=b.length,v=r.reduce((f,F)=>f+(F.isIgnored?1:0),0);if(C===0)return{value:null,cycleCount:C,earliestCycle:null,cyclesConsidered:r,canCompute:!1,rawValue:null,ignoredCount:v};const u=b.reduce((f,F)=>F.t8Day<f.t8Day?F:f),w=u.t8Day,M=C>=6;return{value:M?w:null,cycleCount:C,earliestCycle:u,cyclesConsidered:r,canCompute:M,rawValue:w,ignoredCount:v}},[Ft]);a.useEffect(()=>{if(qt.current||!_)return;let t=_?.cpmMode;["auto","manual","none"].includes(t)||(t=L?"manual":N.canCompute?"auto":"none"),Ke(t),ze(t),qt.current=!0},[N.canCompute,L,_]),a.useEffect(()=>{if(Gt.current||!_)return;let t=_?.t8Mode;["auto","manual","none"].includes(t)||(t=h?"manual":g.canCompute?"auto":"none"),ce(t),Ve(t),Gt.current=!0},[g.canCompute,h,_]),a.useEffect(()=>{if(!y?.uid){Vt.current=null;return}const t=r=>typeof r=="number"&&Number.isFinite(r)?r:null,s=r=>r?{id:r.id??null,name:r.name??null,displayName:r.displayName??null,startDate:r.startDate??null,endDate:r.endDate??null,duration:t(r.duration),source:r.source??null,dateRangeLabel:r.dateRangeLabel??null}:null,o=r=>r?{id:r.id??null,name:r.name??null,displayName:r.displayName??null,startDate:r.startDate??null,endDate:r.endDate??null,riseDay:t(r.riseDay),t8Day:t(r.t8Day),source:r.source??null,dateRangeLabel:r.dateRangeLabel??null}:null,l={automatic:{cpm:{value:t(N?.value),cycleCount:t(N?.cycleCount)??0,ignoredCount:t(N?.ignoredCount)??0,deduction:t(N?.deduction),canCompute:!!N?.canCompute,shortestCycle:s(N?.shortestCycle)},t8:{value:t(g?.value),cycleCount:t(g?.cycleCount)??0,ignoredCount:t(g?.ignoredCount)??0,canCompute:!!g?.canCompute,riseDay:t(g?.earliestCycle?.riseDay),earliestCycle:o(g?.earliestCycle)}}},i=JSON.stringify(l);Vt.current!==i&&(Vt.current=i,Wt(y.uid,{...l,automaticUpdatedAt:new Date().toISOString()}).catch(r=>{console.error("Failed to persist automatic metrics snapshot",r)}))},[N,g,y?.uid]);const W=a.useMemo(()=>{const t=N.cycleCount??0,s=`${t} ciclo${t===1?"":"s"}`,o=6,l=["auto","manual","none"].includes(Q)?Q:"auto",i=l==="manual"&&L?"Manual":l==="auto"&&N.canCompute?"Automático":l==="none"?"Sin usar":"Automático",r=N.cyclesConsidered??[],b=!!N.canCompute,C=N.ignoredCount??0,v=typeof N.deduction=="number"&&Number.isFinite(N.deduction)?N.deduction:null,u=N.shortestCycle??null,w=typeof N.value=="number"&&Number.isFinite(N.value)?N.value:null;let M;if(t===0)M=C>0?"Todos los ciclos disponibles están ignorados para el cálculo automático.":"Aún no hay ciclos finalizados con fecha de finalización.";else if(!b)M=`Hay ${s} finalizado${t===1?"":"s"}. Se necesitan ${o} para calcular el CPM automáticamente.`,C>0&&(M+=` (${C} ciclo${C===1?"":"s"} ignorado${C===1?"":"s"}).`);else{const f=u?.dateRangeLabel||u?.displayName||u?.name||"Ciclo sin nombre",F=typeof u?.duration=="number"&&Number.isFinite(u.duration)?`${u.duration} días`:"duración desconocida",P=[`Calculado con ${s}.`,`Ciclo más corto: ${f} (${F}).`];v!==null&&P.push(`Deducción aplicada: ${v} días.`),w!==null&&P.push(`Resultado: ${w} días.`),C>0&&P.push(`${C} ciclo${C===1?"":"s"} ignorado${C===1?"":"s"}.`),M=P.join(" ")}return{sourceLabel:i,summary:M,highlightLabel:s,cycleCount:t,requiredCycles:o,canCompute:b,detailsAvailable:r.length>0,cycles:r,deduction:v,shortestCycle:u,value:w,ignoredCount:C}},[N,Q,L]),Ht=a.useMemo(()=>{const t=g.cycleCount,s=`${t} ciclo${t===1?"":"s"}`,o=6,l=["auto","manual","none"].includes(S)?S:"auto",i=l==="manual"&&h?"Manual":l==="auto"&&g.canCompute?"Automático":l==="none"?"Sin usar":"Automático",r=g.ignoredCount??0,b=g.earliestCycle?.displayName||g.earliestCycle?.name||"Ciclo sin nombre",C=g.earliestCycle?.riseDay,v=typeof C=="number"&&Number.isFinite(C)?`Día ${C}`:"día desconocido",u=g.earliestCycle?.t8Day,w=typeof u=="number"&&Number.isFinite(u)?`T-8 Día ${u}`:null;let M;if(t===0)M=r>0?"Los ciclos disponibles están ignorados para el cálculo automático.":"Aún no hay ciclos con ovulación confirmada por temperatura.";else if(!g.canCompute)M=`Hay ${s} con ovulación confirmada por temperatura (se necesitan ${o}).`,r>0&&(M+=` ${r} ciclo${r===1?"":"s"} ignorado${r===1?"":"s"}.`);else{const f=[`${b} (${v}${w?` → ${w}`:""}).`];r>0&&f.push(`${r} ciclo${r===1?"":"s"} ignorado${r===1?"":"s"}.`),M=f.join(" ")}return{sourceLabel:i,summary:M,highlightLabel:s,cycleCount:t,requiredCycles:o,ignoredCount:r}},[g,h,S]),Ue=a.useCallback((t,s)=>typeof t!="number"||!Number.isFinite(t)?null:t.toLocaleString("es-ES",s),[]),va=a.useMemo(()=>Is({computedCpmData:N,cpmSelection:Q,isManualCpm:L,manualCpmBaseValue:A,manualCpmValue:R,formatNumber:Ue}),[N,Q,Ue,L,A,R]),Ca=a.useMemo(()=>Ts({computedT8Data:g,t8Selection:S,isManualT8:h,manualT8BaseValue:n,manualT8Value:m,formatNumber:Ue}),[g,Ue,h,n,m,S]),Na=Ue(W.value,{maximumFractionDigits:1})??(typeof W.value=="number"&&Number.isFinite(W.value)?`${W.value}`:"—");Ue(R,{maximumFractionDigits:1})??(typeof R=="number"&&Number.isFinite(R)&&`${R}`);const Qt=["auto","manual","none"].includes(Q)?Q:"auto",kt=Qt==="manual"?L?"manual":"none":Qt==="auto"&&N.canCompute?"auto":"none",wa=kt==="manual"?"Manual":kt==="auto"?"Automático":"Sin usar",ja=Ue(g.value,{maximumFractionDigits:0})??(typeof g.value=="number"&&Number.isFinite(g.value)?`${g.value}`:"—");Ue(m,{maximumFractionDigits:0})??(typeof m=="number"&&Number.isFinite(m)&&`${m}`);const Zt=["auto","manual","none"].includes(S)?S:"auto",It=Zt==="manual"?h?"manual":"none":Zt==="auto"&&g.canCompute?"auto":"none",Da=It==="manual"?"Manual":It==="auto"?"Automático":"Sin usar";a.useMemo(()=>q||(se.trim()?"final":ke.trim()?"base":null),[ke,q,se]);const ea=a.useMemo(()=>{if(z==="manual"){if(H||Ie)return!0;const t=ke.trim()!==""&&!H,s=se.trim()!==""&&!Ie;return!t&&!s}return!1},[z,H,ke,Ie,se]),Sa=a.useMemo(()=>!!(L||ke.trim()||se.trim()),[L,ke,se]);a.useMemo(()=>Se||(ne.trim()?"final":je.trim()?"base":null),[je,Se,ne]);const ta=a.useMemo(()=>{if(V==="manual"){if(Pe||Ae)return!0;const t=je.trim()!==""&&!Pe,s=ne.trim()!==""&&!Ae;return!t&&!s}return!1},[Pe,je,Ae,ne,V]),Ma=a.useMemo(()=>!!(h||je.trim()||ne.trim()),[h,je,ne]),aa=a.useCallback(t=>{if(!t)return;const s=t.cycleId||t.id;if(s){if(c?.id&&s===c.id){p("/");return}p(`/cycle/${s}`)}},[c?.id,p]),sa=a.useCallback(async(t,s)=>{if(t){Kt(o=>o.includes(t)?o:[...o,t]);try{await le(t,s),j({title:s?"Ciclo ignorado":"Ciclo incluido",description:s?"El ciclo se excluyó del cálculo automático.":"El ciclo se volvió a incluir en el cálculo automático."})}catch{}finally{Kt(o=>o.filter(l=>l!==t))}}},[le,j]),at=a.useCallback((t,s)=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),s())},[]),Fa=a.useCallback(()=>{const t=typeof N.shortestCycle?.duration=="number"&&Number.isFinite(N.shortestCycle.duration)?N.shortestCycle.duration:null,s=typeof N.value=="number"&&Number.isFinite(N.value)?N.value:null,o=typeof A=="number"&&Number.isFinite(A),l=typeof R=="number"&&Number.isFinite(R),i=L&&o?A:t,r=L&&l?R:s;E(typeof i=="number"&&Number.isFinite(i)?String(i):""),we(typeof r=="number"&&Number.isFinite(r)?String(r):""),D(""),I(""),Te(null),ze(Q),jt(!1),Fe(!0)},[N,Q,L,A,R]),Tt=a.useCallback(()=>{jt(!1),He(!1),qe(!1),Fe(!1)},[]),ka=a.useCallback(t=>{const{value:s}=t.target;if(E(s),Te("base"),D(""),I(""),!s.trim()){we("");return}const o=Number.parseInt(s,10);if(!Number.isFinite(o)){D("Introduce un número entero válido."),we("");return}const l=o-vt;if(l<0){D("El resultado debe ser ≥ 0 días"),we("");return}we(String(l))},[]),Ia=a.useCallback(t=>{const{value:s}=t.target;if(we(s),Te("final"),I(""),D(""),!s.trim()){E("");return}const o=s.replace(",","."),l=Number.parseFloat(o);if(!Number.isFinite(l)){I("Introduce un número válido."),E("");return}if(l<0){I("El CPM debe ser ≥ 0"),E("");return}const i=l+vt,r=Math.round(i);E(String(r))},[]),na=a.useCallback(async()=>{if(H||Ie)return!1;const t=ke.trim(),s=se.trim(),o=q??(s?"final":t?"base":null);if(!o)return I("Introduce un valor."),fasle;let l=A,i;if(o==="base"){if(!t)return D("Introduce un número entero válido."),!1;const v=Number.parseInt(t,10);if(!Number.isFinite(v))return D("Introduce un número entero válido."),!1;const u=v-vt;if(u<0)return D("El resultado debe ser ≥ 0 días"),!1;l=v,i=u,we(String(u)),I("")}else{if(!s)return I("Introduce un valor."),!1;const v=s.replace(",","."),u=Number.parseFloat(v);if(!Number.isFinite(u)||u<0)return I("El CPM debe ser ≥ 0 días"),!1;i=u;const w=Number.parseInt(t,10);Number.isFinite(w)&&w-vt>=0?l=w:t||(l=null)}const r=R,b=L,C=A;me(i),Ee(!0),G(typeof l=="number"&&Number.isFinite(l)?l:null);try{return await et({finalValue:i,baseValue:l}),Fe(!1),j({title:"CPM actualizado",description:"El CPM manual se guardó en tu perfil."}),!0}catch(v){return console.error("Failed to save manual CPM value",v),me(r),G(C),Ee(b),I("No se pudo guardar el CPM. Inténtalo de nuevo."),fasle}},[L,H,ke,A,q,Ie,se,R,et,j]),ra=a.useCallback(async()=>{const t=R,s=L,o=A;me(null),G(null),Ee(!1),E(""),we(""),D(""),I(""),Te(null);try{await et({finalValue:null,baseValue:null}),j({title:"CPM borrado",description:"El valor manual se eliminó. Puedes guardar un nuevo valor o continuar con el cálculo automático."})}catch(l){console.error("Failed to delete manual CPM value",l),me(t),G(o),Ee(s),I("No se pudo borrar el CPM. Inténtalo de nuevo.")}},[L,A,R,et,j]),Ta=a.useCallback(async()=>{qe(!0);try{await ra(),He(!1);const t=W.canCompute?"auto":"none";Ke(t),ze(t),await pt(t)}finally{qe(!1)}},[W.canCompute,ra,pt]),st=a.useCallback(t=>{ze(t)},[]),Ea=a.useCallback(async()=>{const t=z;if(t==="manual"){if(!await na())return;Ke("manual"),ze("manual"),await pt("manual");return}const s=["auto","none"].includes(t)?t:"auto";Ke(s),ze(s),await pt(s),Tt()},[z,Tt,na,pt]),Pa=a.useCallback(()=>{const t=typeof n=="number"&&Number.isFinite(n),s=typeof m=="number"&&Number.isFinite(m),o=h&&t?n:null,l=h&&s?m:null;ft(typeof o=="number"&&Number.isFinite(o)?String(o):""),De(typeof l=="number"&&Number.isFinite(l)?String(l):""),fe(""),pe(""),Ge(null),Ve(S),Be(!1),We(!0)},[h,n,m,S]),Et=a.useCallback(()=>{We(!1),Be(!1),Je(!1),zt(!1)},[]),$a=a.useCallback(t=>{const{value:s}=t.target;if(ft(s),Ge("base"),fe(""),pe(""),!s.trim()){De("");return}const o=Number.parseInt(s,10);if(!Number.isFinite(o)){fe("Introduce un número entero válido."),De("");return}if(o<9){fe("El T-8 debe ser ≥ 1"),De("");return}const l=Math.max(1,o-8);De(String(l))},[]),Oa=a.useCallback(t=>{const{value:s}=t.target;if(De(s),Ge("final"),pe(""),fe(""),!s.trim())return;const o=Number.parseInt(s,10);(!Number.isFinite(o)||o<1)&&pe("El T-8 debe ser ≥ 1")},[]),la=a.useCallback(async()=>{if(Pe||Ae)return!1;const t=je.trim(),s=ne.trim(),o=Se??(s?"final":t?"base":null);if(!o)return pe("Introduce un valor."),!1;let l=n,i;if(o==="base"){if(!t)return fe("Introduce un número entero válido."),!1;const v=Number.parseInt(t,10);if(!Number.isFinite(v))return fe("Introduce un número entero válido."),!1;if(v<9)return fe("El T-8 debe ser ≥ 1"),!1;const u=Math.max(1,v-8);l=v,i=u,De(String(u)),pe("")}else{if(!s)return pe("Introduce un valor."),!1;const v=Number.parseInt(s,10);if(!Number.isFinite(v)||v<1)return pe("El T-8 debe ser ≥ 1"),!1;i=v;const u=Number.parseInt(t,10);Number.isFinite(u)&&u>=9?l=u:t||(l=null)}const r=m,b=h,C=n;x(i),T(!0),d(typeof l=="number"&&Number.isFinite(l)?l:null);try{return await tt({finalValue:i,baseValue:l}),We(!1),j({title:"T-8 actualizado",description:"El T-8 manual se guardó en tu perfil."}),!0}catch(v){return console.error("Failed to save manual T-8 value",v),x(r),d(C),T(b),pe("No se pudo guardar el T-8. Inténtalo de nuevo."),!1}},[h,Pe,je,n,Se,Ae,ne,m,tt,j]),oa=a.useCallback(async()=>{const t=m,s=h,o=n;x(null),d(null),T(!1),ft(""),De(""),fe(""),pe(""),Ge(null);try{await tt({finalValue:null,baseValue:null}),j({title:"T-8 borrado",description:"El valor manual se eliminó. Puedes guardar un nuevo valor o continuar con el cálculo automático."})}catch(l){console.error("Failed to delete manual T-8 value",l),x(t),d(o),T(s),fe("No se pudo borrar el T-8. Inténtalo de nuevo.")}},[h,n,m,tt,j]),Aa=a.useCallback(async()=>{zt(!0);try{await oa(),Je(!1);const t=g.canCompute?"auto":"none";ce(t),Ve(t),await xt(t)}finally{zt(!1)}},[g.canCompute,oa,xt]),nt=a.useCallback(t=>{Ve(t)},[]),Ba=a.useCallback(async()=>{const t=V;if(t==="manual"){if(!await la())return;ce("manual"),Ve("manual"),await xt("manual");return}const s=["auto","none"].includes(t)?t:"auto";ce(s),Ve(s),await xt(s),Et()},[Et,la,xt,V]),_e=a.useCallback(()=>{ue(null),Ne(null),Ye(!1)},[]),_a=a.useCallback(()=>{Ce(c?.startDate||""),X(""),_e(),te(!0)},[c?.startDate,_e]),rt=a.useCallback(()=>{te(!1),X(""),_e(),Ce(c?.startDate||"")},[c?.startDate,_e]),Ra=a.useCallback(()=>{_e()},[_e]),La=a.useCallback(async()=>{if(!Y){X("La fecha de inicio es obligatoria");return}if(c?.id){X(""),de(!0);try{const t=ve?await ve(c.id,Y):null;if(t){ue(Y),Ne(t),Ye(!0),de(!1);return}await J(c.id,Y),await k({silent:!0}),j({title:"Fecha de inicio actualizada",description:"El ciclo se ha ajustado a la nueva fecha de inicio."}),rt()}catch(t){console.error("Error updating start date from dashboard:",t),X("No se pudo actualizar la fecha de inicio"),j({title:"Error",description:"No se pudo actualizar la fecha de inicio.",variant:"destructive"})}finally{de(!1)}}},[Y,c?.id,ve,J,k,j,rt]),za=a.useCallback(async()=>{if(!c?.id||!B){_e();return}de(!0),Ye(!1);try{await ee(c.id,B),await k({silent:!0}),j({title:"Fecha de inicio actualizada",description:"El ciclo se ha ajustado a la nueva fecha de inicio."}),rt()}catch(t){console.error("Error forcing start date from dashboard:",t),X("No se pudo actualizar la fecha de inicio"),j({title:"Error",description:"No se pudo actualizar la fecha de inicio.",variant:"destructive"})}finally{de(!1),_e()}},[c?.id,B,ee,k,j,rt,_e]),[Va,Xe]=a.useState(!1),[Ua,ia]=a.useState(!1),[ca,lt]=a.useState(!1),[ht,bt]=a.useState(null),[Ha,ot]=a.useState(null),Wa=!!(ht&&String(ht.id||"").startsWith("placeholder-")),Ja=a.useMemo(()=>c?.data?.find(s=>s?.peak_marker==="peak")?.isoDate||null,[c?.data]),ua=a.useCallback(()=>{Xe(!1),bt(null),ot(null)},[]),Xa=a.useCallback(t=>{bt(t)},[]),Ya=a.useCallback((t,s=null)=>{bt(t),ot(s??null),Xe(!0)},[]),Ka=a.useCallback(async(t,s=!0)=>{if(!c?.id||!t?.isoDate)return;const o=i=>{if(i==null||i==="")return null;const r=parseFloat(String(i).replace(",","."));return Number.isFinite(r)?r:null},l=s??!(t.peak_marker==="peak"||t.peakStatus==="P");try{const i=t.timestamp?gt(Me(t.timestamp),"HH:mm"):gt(new Date,"HH:mm");let r=Array.isArray(t.measurements)&&t.measurements.length>0?t.measurements:[{temperature:t.temperature_chart??t.temperature_raw??null,temperature_corrected:t.temperature_corrected??null,time:t.time??i,time_corrected:t.time_corrected??i,selected:!0,use_corrected:t.use_corrected??!1}];r.length===0&&(r=[{temperature:null,temperature_corrected:null,time:i,time_corrected:i,selected:!0,use_corrected:!1}]);const b=r.map((u,w)=>{const M=u.time||i,f=u.time_corrected||M;return{temperature:o(u.temperature??u.temperature_raw),time:M,selected:w===0?!0:!!u.selected,temperature_corrected:o(u.temperature_corrected),time_corrected:f,use_corrected:!!u.use_corrected}});b.some(u=>u.selected)||(b[0].selected=!0);const C={isoDate:t.isoDate,measurements:b,mucusSensation:t.mucus_sensation??t.mucusSensation??"",mucusAppearance:t.mucus_appearance??t.mucusAppearance??"",fertility_symbol:t.fertility_symbol??"none",observations:t.observations??"",ignored:t.ignored??!1,peak_marker:l?"peak":null},v=t?.id&&!String(t.id).startsWith("placeholder-")?t:null;await O(C,v)}catch(i){console.error("Error toggling peak marker from dashboard:",i)}},[O,c?.id]),qa=a.useMemo(()=>{if(!c?.startDate)return null;try{return Ct(Nt(new Date),Me(c.startDate))+1}catch(t){return console.error("Error calculating current day:",t),null}},[c?.startDate]),Ga=a.useMemo(()=>{const t=[],s=b=>["auto","manual","none"].includes(b)?b:"auto",o=(b,C,v)=>{const u=Number(C);if(!Number.isFinite(u)||u<=0)return;const w=Number(v),M=Number.isFinite(w)&&w>0,f=M?b==="CPM"?`ciclo base: ${w}`:`base ${b}: ${w}`:null;t.push({source:b,day:Math.max(1,u),reason:f?`Manual desde dashboard (${f})`:"Manual desde dashboard",kind:"calculator",isManual:!0,manualBase:M?w:null})},l=(b,C,v)=>{if(!v)return;const u=Number(C);Number.isFinite(u)&&t.push({source:b,day:Math.max(1,u),reason:"Automático desde dashboard",kind:"calculator"})},i=s(Q);i==="manual"?o("CPM",R,A):i==="auto"&&l("CPM",N?.value,N?.canCompute);const r=s(S);return r==="manual"?o("T8",m,n):r==="auto"&&l("T8",g?.value,g?.canCompute),t},[N?.canCompute,N?.value,g?.canCompute,g?.value,Q,A,R,n,m,S]),Qa=a.useMemo(()=>({calculators:{cpm:Q!=="none",t8:S!=="none"}}),[Q,S]),Za=a.useMemo(()=>{const t=[];return Array.isArray($)&&$.length>0&&t.push(...$),c&&t.push(c),t},[$,c]);if(Cs(c?.data??[],!1,"portrait",void 0,c?.id,5,!1,Qa,Za,Ga,!1),Z&&!c?.id)return e.jsx("div",{className:"mx-auto flex min-h-screen max-w-md items-center justify-center px-4 py-4",children:e.jsx("div",{className:"w-full rounded-3xl  p-4 text-center shadow-sm",children:e.jsx("p",{className:"text-sm font-semibold text-fertiliapp-fuerte",children:"Cargando..."})})});if(!c?.id)return e.jsxs("div",{className:"mx-auto flex min-h-screen max-w-md items-center justify-center px-4 py-4",children:[e.jsxs("div",{className:"w-full space-y-4 rounded-3xl border border-rose-100/70 bg-white/80 p-4 text-center shadow-sm",children:[e.jsx("p",{className:"text-[15px] font-semibold text-slate-800",children:"No hay ciclo activo."}),e.jsx("button",{onClick:()=>lt(!0),className:"h-11 w-full rounded-full bg-fertiliapp-fuerte px-4 text-sm font-semibold text-white shadow-sm transition hover:brightness-95",children:"Iniciar ciclo"})]}),e.jsx(ma,{isOpen:ca,onClose:()=>lt(!1),onConfirm:async t=>{await Re(t),lt(!1),ot(null),Xe(!0)}})]});if(!c?.startDate)return e.jsx("div",{className:"mx-auto flex min-h-screen max-w-md items-center justify-center px-4 py-4",children:e.jsx("div",{className:"w-full rounded-3xl border border-rose-100/70 bg-white/80 p-4 text-center shadow-sm",children:e.jsx("p",{className:"text-sm font-semibold text-slate-800",children:"Cargando..."})})});const es=async(t,{keepFormOpen:s=!1}={})=>{ia(!0);try{await O(t,ht),s||(Xe(!1),bt(null),ot(null))}finally{ia(!1)}},ts=async t=>{await Re(t),lt(!1),ot(null),Xe(!0)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mx-auto flex h-[calc(var(--app-vh,1vh)*100 - var(--bottom-nav-safe))] w-full flex-col space-y-4 px-4 pb-10 pt-4",children:e.jsxs(U.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"flex flex-1 flex-col gap-3",children:[e.jsx(Es,{cycleData:{...c,currentDay:qa,records:c.data},onEdit:Ya,onTogglePeak:Ka,currentPeakIsoDate:Ja,onEditStartDate:_a,handleOpenCpmDialog:Fa,handleOpenT8Dialog:Pa,cpmMetric:va,t8Metric:Ca}),e.jsx(it,{open:K,onOpenChange:t=>{t||Tt()},children:e.jsxs(ct,{className:"flex max-h-[90vh] w-[90vw] max-w-sm flex-col overflow-hidden rounded-3xl border border-rose-100 bg-white/95 p-0 text-gray-800 shadow-xl",children:[e.jsxs(Ot,{className:"space-y-2 px-4 pt-4 text-left",children:[e.jsx(At,{children:"Editar CPM"}),e.jsx(xa,{children:e.jsx("div",{className:"text-xs",children:"Puedes usar el valor calculado automáticamente o fijar un valor manual."})})]}),e.jsxs("div",{className:"flex-1 space-y-3 overflow-y-auto px-4 pb-4",children:[e.jsx("div",{className:"rounded-2xl border border-rose-100 bg-rose-50/70 px-3 py-2",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("div",{className:"space-y-1",children:e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-rose-600",children:"Estado actual"})}),e.jsx("span",{className:`rounded-full px-3 py-1 text-[11px] font-semibold ${kt==="manual"?"bg-rose-100 text-rose-700":kt==="auto"?"bg-emerald-50 text-emerald-700":"bg-gray-100 text-gray-600"}`,children:wa})]})}),e.jsxs("div",{role:"radio",tabIndex:0,onClick:()=>st("auto"),onKeyDown:t=>at(t,()=>st("auto")),className:`cursor-pointer rounded-2xl border px-3 py-3 shadow-sm transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-300/70 ${z==="auto"?"border-emerald-300 bg-emerald-50/60":"border-rose-100 bg-white/80 hover:border-fertiliapp-suave"} ${W.canCompute?"":"opacity-70"}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold text-rose-900",children:"Cálculo automático"}),e.jsx("span",{className:"text-[11px] font-semibold text-rose-600",children:W.canCompute&&W.value!==null?`CPM automático: ${Na} días`:"No disponible todavía"}),e.jsx("p",{className:"text-[10px] text-rose-600",children:"Basado en tus ciclos completados."})]}),e.jsx("span",{className:`mt-0.5 flex h-5 w-5 items-center justify-center rounded-full border-2 ${z==="auto"?"border-emerald-400 bg-emerald-400":"border-fertiliapp-suave bg-white"}`,children:z==="auto"&&e.jsx("span",{className:"h-2.5 w-2.5 rounded-full bg-white"})})]}),e.jsxs("div",{className:"mt-2 rounded-2xl border border-rose-100 bg-rose-50/70 px-3 py-2.5 text-[11px] text-rose-900",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs font-semibold text-rose-700",children:[e.jsx("span",{children:"Datos disponibles"}),e.jsx("button",{type:"button",onClick:()=>jt(t=>!t),className:"rounded-full bg-white/70 px-2 py-0.5 text-[11px] font-semibold text-rose-600 transition hover:bg-white/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-300/70","aria-expanded":wt,children:W.highlightLabel})]}),W.summary&&e.jsx("p",{className:"mt-1 text-[11px] text-rose-500",children:W.summary}),!W.detailsAvailable&&e.jsx("p",{className:"mt-1 text-[11px] text-rose-500",children:"Aún no hay ciclos finalizados con fecha de finalización."}),wt&&W.detailsAvailable&&e.jsx("div",{className:"mt-2 space-y-2",children:W.cycles.length>0?e.jsx("ul",{className:"space-y-1",children:W.cycles.map((t,s)=>{const o=t.cycleId||t.id||`${t.displayName||t.name||t.startDate||"cycle"}-${s}`,l=typeof t.duration=="number"&&Number.isFinite(t.duration)?`${t.duration} días`:"duración desconocida",i=!!(W.shortestCycle&&W.shortestCycle===t),r=t.cycleId||t.id,b=!!(t.isIgnored||t.ignoredForAutoCalculations),C=r?Yt.includes(r):!1,v=`rounded-2xl border px-3 py-2 shadow-sm transition hover:border-rose-200 hover:bg-white ${b?"border-rose-200 bg-rose-50/80 opacity-80":"border-rose-100 bg-white/50"}`;return e.jsx("li",{children:e.jsxs("div",{className:"flex items-stretch gap-2",children:[e.jsxs("div",{className:`${v} flex-1`,children:[e.jsx("button",{type:"button",onClick:()=>aa(t),className:"block w-full rounded-2xl px-1 py-0.5 text-left transition hover:bg-white/60 hover:text-rose-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-300/70",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-xs font-semibold text-rose-700",children:t.dateRangeLabel||t.displayName||t.name||"Ciclo sin nombre"}),e.jsx(Jt,{className:"h-4 w-4 text-rose-400","aria-hidden":"true"})]})}),e.jsxs("div",{className:"mt-1 flex flex-wrap items-center justify-between gap-2 text-[11px] text-rose-500",children:[e.jsxs("span",{children:["Duración: ",l]}),i&&e.jsx("span",{className:"rounded-full bg-rose-100 px-2 py-0.5 font-semibold text-rose-600",children:"Ciclo más corto"})]}),b&&e.jsx("p",{className:"mt-1 text-[11px] text-rose-400",children:"Ignorado para el cálculo automático."})]}),e.jsx(ge,{type:"button",variant:"outline",size:"xs",disabled:!r||C,onClick:()=>r&&sa(r,!b),className:"shrink-0 self-center h-8 w-8 p-0 bg-transparent border-transparent",title:b?"Incluir ciclo en el cálculo automático":"Ignorar ciclo para el cálculo automático","aria-label":b?"Incluir ciclo en el cálculo automático":"Ignorar ciclo para el cálculo automático","aria-pressed":b,children:C?e.jsxs(e.Fragment,{children:[e.jsx(fa,{className:"h-4 w-4 animate-spin text-rose-500","aria-hidden":"true"}),e.jsx("span",{className:"sr-only",children:"Guardando…"})]}):b?e.jsx(ba,{className:"h-4 w-4 text-rose-500","aria-hidden":"true"}):e.jsx(ya,{className:"h-4 w-4 text-green-800/70","aria-hidden":"true"})})]})},o)})}):e.jsx("p",{className:"text-[11px] text-rose-500",children:"Aún no hay ciclos finalizados con fecha de finalización."})})]})]}),e.jsxs("div",{role:"radio",tabIndex:0,"aria-checked":z==="manual",onClick:()=>st("manual"),onKeyDown:t=>at(t,()=>st("manual")),className:`cursor-pointer rounded-2xl border px-3 py-3 shadow-sm transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-300/70 ${z==="manual"?"border-emerald-300 bg-emerald-50/60":"border-rose-100 bg-white/80 hover:border-rose-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("div",{className:"space-y-1",children:e.jsx("p",{className:"text-sm font-semibold text-rose-900",children:"Valor manual"})}),e.jsx("span",{className:`mt-0.5 flex h-5 w-5 items-center justify-center rounded-full border-2 ${z==="manual"?"border-emerald-400 bg-emerald-400":"border-rose-300 bg-white"}`,children:z==="manual"&&e.jsx("span",{className:"h-2.5 w-2.5 rounded-full bg-white"})})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(Rt,{htmlFor:"manual-cpm-base",className:"text-xs text-gray-600",children:"Ciclo más corto"}),e.jsx(_t,{id:"manual-cpm-base",type:"number",inputMode:"numeric",step:"1",min:"0",value:ke,onChange:ka,placeholder:"Introduce un entero","aria-describedby":q?"manual-cpm-helper":void 0}),H&&e.jsx("p",{className:"text-xs text-red-500",children:H})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(Rt,{htmlFor:"manual-cpm-final",className:"text-xs text-gray-600",children:"CPM obtenido"}),e.jsx(_t,{id:"manual-cpm-final",type:"number",inputMode:"decimal",step:"0.1",min:"0",value:se,onChange:Ia,placeholder:"Introduce el valor","aria-describedby":q?"manual-cpm-helper":void 0}),Ie&&e.jsx("p",{className:"text-xs text-red-500",children:Ie})]})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-end gap-2",children:[q&&e.jsx("div",{className:"mt-2 flex justify-center",children:e.jsx("span",{id:"manual-cpm-helper",className:"rounded-full bg-rose-50 px-3 py-1 text-xs font-medium text-rose-600",children:q==="base"?"Usando Ciclo más corto como base":"Usando CPM (final)"})}),e.jsx(ge,{type:"button",variant:"outline",onClick:()=>He(!0),disabled:!Sa,className:"h-8 shrink-0 rounded-full border border-rose-200 px-3 text-xs text-rose-600 hover:bg-rose-50 hover:text-rose-700",children:"Borrar"})]}),ea&&z==="manual"&&!L&&e.jsx("p",{className:"mt-2 text-[11px] text-rose-500",children:"Introduce un valor válido antes de seleccionar."})]}),e.jsx("div",{role:"radio",tabIndex:0,"aria-checked":z==="none",onClick:()=>st("none"),onKeyDown:t=>at(t,()=>st("none")),className:`cursor-pointer rounded-2xl border px-3 py-2 text-left shadow-sm transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-300/70 ${z==="none"?"border-emerald-300 bg-emerald-50/60":"border-dashed border-rose-200 bg-white/70 hover:border-rose-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"space-y-1",children:e.jsx("p",{className:"text-sm font-semibold text-rose-900",children:"No usar ningún valor"})}),e.jsx("span",{className:`mt-0.5 flex h-5 w-5 items-center justify-center rounded-full border-2 ${z==="none"?"border-emerald-400 bg-emerald-400":"border-rose-300 bg-white"}`,children:z==="none"&&e.jsx("span",{className:"h-2.5 w-2.5 rounded-full bg-white"})})]})})]}),e.jsx(Bt,{className:"mt-0 flex flex-col gap-3 px-4 pb-4",children:e.jsxs("div",{className:"flex w-full items-center justify-end gap-2",children:[e.jsx(ge,{type:"button",variant:"secondary",onClick:Tt,className:"h-8 rounded-full px-4 text-xs",children:"Cancelar"}),e.jsx(ge,{type:"button",onClick:Ea,disabled:ea,className:"h-8 rounded-full px-4 text-xs",children:"Guardar"})]})})]})}),e.jsx(it,{open:Dt,onOpenChange:He,children:e.jsxs(ct,{className:"w-[90vw] max-w-xs rounded-2xl border border-rose-100",children:[e.jsx(Ot,{children:e.jsx(At,{children:"¿Estás segura de que quieres borrar el valor manual de CPM?"})}),e.jsxs(Bt,{className:"flex flex-col gap-2 sm:flex-row sm:justify-end sm:gap-3",children:[e.jsx(ge,{type:"button",variant:"secondary",onClick:()=>He(!1),className:"w-full sm:w-auto",children:"Cancelar"}),e.jsx(ge,{type:"button",variant:"destructive",onClick:Ta,disabled:dt,className:"w-full sm:w-auto",children:dt?"Borrando…":"Borrar"})]})]})}),e.jsx(it,{open:mt,onOpenChange:t=>{t||Et()},children:e.jsxs(ct,{className:"flex max-h-[90vh] w-[90vw] max-w-sm flex-col rounded-3xl border border-rose-100 bg-white/95 text-gray-800 shadow-xl overflow-hidden p-0",children:[e.jsxs(Ot,{className:"space-y-2 px-4 pt-4 text-left",children:[e.jsx(At,{children:"Editar T-8"}),e.jsx(xa,{children:e.jsx("div",{className:"text-xs",children:"Puedes usar el valor calculado automáticamente o fijar un valor manual."})})]}),e.jsxs("div",{className:"flex-1 space-y-3 overflow-y-auto px-4 pb-4",children:[e.jsx("div",{className:"rounded-2xl border border-rose-100 bg-rose-50/70 px-3 py-2",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("div",{className:"space-y-1",children:e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-rose-600",children:"Estado actual"})}),e.jsx("span",{className:`rounded-full px-3 py-1 text-[11px] font-semibold ${It==="manual"?"bg-rose-100 text-rose-700":It==="auto"?"bg-emerald-50 text-emerald-700":"bg-gray-100 text-gray-600"}`,children:Da})]})}),e.jsxs("div",{role:"radio",tabIndex:0,onClick:()=>nt("auto"),onKeyDown:t=>at(t,()=>nt("auto")),className:`cursor-pointer rounded-2xl border px-3 py-3 shadow-sm transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-300/70 ${V==="auto"?"border-emerald-300 bg-emerald-50/60":"border-rose-100 bg-white/80 hover:border-rose-200"} ${g.canCompute?"":"opacity-70"}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold text-rose-900",children:"Cálculo automático"}),e.jsx("span",{className:"text-[11px] font-semibold text-rose-600",children:g.canCompute&&g.value!==null?`T-8 automático: Día ${ja}`:"No disponible todavía"}),e.jsx("p",{className:"text-[10px] text-rose-600",children:"Basado en tus ciclos completados."})]}),e.jsx("span",{className:`mt-0.5 flex h-5 w-5 items-center justify-center rounded-full border-2 ${V==="auto"?"border-emerald-400 bg-emerald-400":"border-rose-300 bg-white"}`,children:V==="auto"&&e.jsx("span",{className:"h-2.5 w-2.5 rounded-full bg-white"})})]}),e.jsxs("div",{className:"mt-2 rounded-2xl border border-rose-100 bg-rose-50/70 px-3 py-2.5 text-[11px] text-rose-900",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs font-semibold text-rose-700",children:[e.jsx("span",{children:"Datos disponibles"}),e.jsx("button",{type:"button",onClick:()=>Be(t=>!t),className:"rounded-full bg-white/70 px-2 py-0.5 text-[11px] font-semibold text-rose-600 transition hover:bg-white/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-300/70","aria-expanded":St,children:Ht.highlightLabel})]}),Ht.summary&&e.jsx("p",{className:"mt-1 text-[11px] text-rose-500",children:Ht.summary}),g.cycleCount===0&&e.jsx("p",{className:"mt-1 text-[11px] text-rose-500",children:"Aún no hay ciclos con ovulación confirmada por temperatura."}),St&&g.cycleCount>0&&e.jsx("div",{className:"mt-2 space-y-2",children:g.cyclesConsidered.length>0?e.jsx("ul",{className:"space-y-1",children:g.cyclesConsidered.map((t,s)=>{const o=t.cycleId||`${t.displayName}-${t.riseDay}-${s}`,l=typeof t.riseDay=="number"&&Number.isFinite(t.riseDay)?t.riseDay:"—",i=t.cycleId||t.id,r=!!(t.isIgnored||t.ignoredForAutoCalculations),b=i?Yt.includes(i):!1,C=`rounded-2xl border px-3 py-2 shadow-sm transition hover:border-rose-200 hover:bg-white ${r?"border-rose-200 bg-rose-50/80 opacity-80":"border-rose-100 bg-white/40"}`;return e.jsx("li",{children:e.jsxs("div",{className:"flex items-stretch gap-2",children:[e.jsxs("div",{className:`${C} flex-1`,children:[e.jsx("button",{type:"button",onClick:()=>aa(t),className:"block w-full rounded-2xl px-1 py-0.5 text-left transition hover:bg-white/60 hover:text-rose-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-300/70",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-xs font-semibold text-rose-700",children:t.dateRangeLabel||t.displayName||t.name||"Ciclo sin nombre"}),e.jsx(Jt,{className:"h-4 w-4 text-rose-400","aria-hidden":"true"})]})}),e.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-2 text-[11px] text-rose-500",children:[e.jsxs("span",{children:["Día de subida: ",l]}),Number.isFinite(t.t8Day)&&e.jsxs("span",{children:["T-8: Día ",t.t8Day]})]}),r&&e.jsx("p",{className:"mt-1 text-[11px] text-rose-400",children:"Ignorado para el cálculo automático."})]}),e.jsx(ge,{type:"button",variant:"outline",size:"icon",disabled:!i||b,onClick:()=>i&&sa(i,!r),className:"shrink-0 self-center h-8 w-8 p-0 bg-transparent border-transparent",title:r?"Incluir ciclo en el cálculo automático":"Ignorar ciclo para el cálculo automático","aria-label":r?"Incluir ciclo en el cálculo automático":"Ignorar ciclo para el cálculo automático","aria-pressed":r,children:b?e.jsxs(e.Fragment,{children:[e.jsx(fa,{className:"h-4 w-4 animate-spin text-rose-500","aria-hidden":"true"}),e.jsx("span",{className:"sr-only",children:"Guardando…"})]}):r?e.jsx(ba,{className:"h-4 w-4 text-rose-500","aria-hidden":"true"}):e.jsx(ya,{className:"h-4 w-4 text-green-800/70","aria-hidden":"true"})})]})},o)})}):e.jsx("p",{className:"text-[11px] text-rose-500",children:"Aún no hay ciclos con ovulación confirmada por temperatura."})})]})]}),e.jsxs("div",{role:"radio",tabIndex:0,"aria-checked":V==="manual",onClick:()=>nt("manual"),onKeyDown:t=>at(t,()=>nt("manual")),className:`cursor-pointer rounded-2xl border px-3 py-3 shadow-sm transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-300/70 ${V==="manual"?"border-emerald-300 bg-emerald-50/60":"border-rose-100 bg-white/80 hover:border-rose-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("div",{className:"space-y-1",children:e.jsx("p",{className:"text-sm font-semibold text-rose-900",children:"Valor manual"})}),e.jsx("span",{className:`mt-0.5 flex h-5 w-5 items-center justify-center rounded-full border-2 ${V==="manual"?"border-emerald-400 bg-emerald-400":"border-rose-300 bg-white"}`,children:V==="manual"&&e.jsx("span",{className:"h-2.5 w-2.5 rounded-full bg-white"})})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(Rt,{htmlFor:"manual-t8-base",className:"text-xs text-gray-600",children:"Ciclo con subida (día)"}),e.jsx(_t,{id:"manual-t8-base",type:"number",inputMode:"numeric",step:"1",min:"9",value:je,onChange:$a,placeholder:"Día de subida","aria-describedby":Se?"manual-t8-helper":void 0}),Pe&&e.jsx("p",{className:"text-xs text-red-500",children:Pe})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(Rt,{htmlFor:"manual-t8-final",className:"text-xs text-gray-600",children:"T-8 manual (día)"}),e.jsx(_t,{id:"manual-t8-final",type:"number",inputMode:"numeric",step:"1",min:"1",value:ne,onChange:Oa,placeholder:"Día del T-8","aria-describedby":Se?"manual-t8-helper":void 0}),Ae&&e.jsx("p",{className:"text-xs text-red-500",children:Ae})]})]}),e.jsx("div",{className:"mt-3 flex flex-wrap items-end gap-2",children:Se&&e.jsx("div",{className:"mt-2 flex justify-center",children:e.jsx("span",{id:"manual-t8-helper",className:"rounded-full bg-rose-50 px-3 py-1 text-xs font-medium text-rose-600",children:Se==="base"?"Usando día de subida como base":"Usando T-8 manual"})})}),e.jsx(ge,{type:"button",variant:"outline",onClick:()=>Je(!0),disabled:!Ma,className:"h-8 shrink-0 rounded-full border border-rose-200 px-3 text-xs text-rose-600 hover:bg-rose-50 hover:text-rose-700",children:"Borrar"}),ta&&V==="manual"&&!h&&e.jsx("p",{className:"mt-2 text-[11px] text-rose-500",children:"Introduce un valor válido antes de seleccionar."})]}),e.jsx("div",{role:"radio",tabIndex:0,"aria-checked":V==="none",onClick:()=>nt("none"),onKeyDown:t=>at(t,()=>nt("none")),className:`cursor-pointer rounded-2xl border px-3 py-2 text-left shadow-sm transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-300/70 ${V==="none"?"border-emerald-300 bg-emerald-50/60":"border-dashed border-rose-200 bg-white/70 hover:border-rose-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"space-y-1",children:e.jsx("p",{className:"text-sm font-semibold text-rose-900",children:"No usar ningún valor"})}),e.jsx("span",{className:`mt-0.5 flex h-5 w-5 items-center justify-center rounded-full border-2 ${V==="none"?"border-emerald-400 bg-emerald-400":"border-rose-300 bg-white"}`,children:V==="none"&&e.jsx("span",{className:"h-2.5 w-2.5 rounded-full bg-white"})})]})})]}),e.jsx(Bt,{className:"mt-0 flex flex-col gap-3 px-4 pb-4",children:e.jsxs("div",{className:"flex w-full items-center justify-end gap-2",children:[e.jsx(ge,{type:"button",variant:"secondary",onClick:Et,className:"h-8 rounded-full px-4 text-xs",children:"Cancelar"}),e.jsx(ge,{type:"button",onClick:Ba,disabled:ta,className:"h-8 rounded-full px-4 text-xs",children:"Guardar"})]})})]})}),e.jsx(it,{open:Mt,onOpenChange:Je,children:e.jsxs(ct,{className:"w-[90vw] max-w-xs rounded-2xl border border-rose-100",children:[e.jsx(Ot,{children:e.jsx(At,{children:"¿Estás segura de que quieres borrar el valor manual de T-8?"})}),e.jsxs(Bt,{className:"flex flex-col gap-2 sm:flex-row sm:justify-end sm:gap-3",children:[e.jsx(ge,{type:"button",variant:"secondary",onClick:()=>Je(!1),className:"w-full sm:w-auto",children:"Cancelar"}),e.jsx(ge,{type:"button",variant:"destructive",onClick:Aa,disabled:Xt,className:"w-full sm:w-auto",children:Xt?"Borrando…":"Borrar"})]})]})}),e.jsx(it,{open:oe,onOpenChange:t=>{t||rt()},children:e.jsx(ct,{hideClose:!0,className:"bg-transparent border-none p-0 text-gray-800 w-[90vw] sm:w-auto max-w-md sm:max-w-lg md:max-w-xl max-h-[85vh] overflow-y-auto",children:e.jsx(fs,{cycle:c,startDate:Y,endDate:c.endDate,onStartDateChange:t=>Ce(t),onSave:La,onCancel:rt,isProcessing:ut,dateError:Le,includeEndDate:!1,showOverlapDialog:Oe,overlapCycle:ie,onConfirmOverlap:za,onCancelOverlap:Ra,onClearError:()=>X(""),saveLabel:"Guardar cambios",title:"Editar fecha de inicio",description:"Selecciona una nueva fecha de inicio para el ciclo actual. Los registros se reorganizarán automáticamente.",className:"w-full"})})})]})}),e.jsx(it,{open:Va,onOpenChange:t=>{t?Xe(!0):ua()},children:e.jsx(ct,{hideClose:!0,className:"bg-transparent border-none p-0 text-gray-800 w-[90vw] sm:w-auto max-w-md sm:max-w-lg md:max-w-xl max-h-[85vh] overflow-y-auto",children:e.jsx(xs,{onSubmit:es,onCancel:ua,initialData:ht,cycleStartDate:c.startDate,cycleEndDate:c.endDate,isProcessing:Ua,isEditing:!!ht&&!Wa,cycleData:c.data,onDateSelect:Xa,initialSectionKey:Ha})})}),e.jsx(Ps,{onAddRecord:()=>{bt(null),ot(null),Xe(!0)},onAddCycle:()=>lt(!0)}),e.jsx(ma,{isOpen:ca,onClose:()=>lt(!1),onConfirm:ts,currentCycleStartDate:c.startDate})]})};export{Ws as default};
