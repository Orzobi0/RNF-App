import{c as it,m as le,j as e,r as x,s as Ae,p as Be,D as lt,e as at,f as Ge,d as Xe,h as ct,M as We,B as Re,L as qe}from"./index-830127db.js";import{g as dt,i as ht,c as ut,D as ft}from"./computePeakStatuses-630ea28a.js";import{C as pt}from"./ChartTooltip-859bf87e.js";import{u as xt,D as mt,a as gt}from"./useCycleData-5b813aa3.js";import{A as yt}from"./arrow-left-e0350310.js";import{E as bt,a as wt}from"./eye-dba9030b.js";import"./input-cbf91fa7.js";import"./label-da4c6ed7.js";import"./checkbox-be556efa.js";import"./badge-96ec44c3.js";const jt=it("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),kt=({padding:r,chartWidth:c,chartHeight:N,tempMin:A,tempMax:K,tempRange:E,getY:L,getX:w,allDataPoints:m=[],responsiveFontSize:u,isFullScreen:U,showLeftLabels:Y=!1,reduceMotion:k=!1})=>{const C={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.3,ease:"easeOut"}}},B=[];if(E>0){const i=E<=2.5?.1:.5;for(let p=A;p<=K+1e-9;p+=i)B.push(parseFloat(p.toFixed(1)))}else for(let i=35;i<=37.5+1e-9;i+=.5)B.push(parseFloat(i.toFixed(1)));const o=k?"g":le.g;return e.jsxs(e.Fragment,{children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"bgGradientChart",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(254, 242, 242, 0.95)"}),e.jsx("stop",{offset:"30%",stopColor:"rgba(255, 241, 242, 0.9)"}),e.jsx("stop",{offset:"70%",stopColor:"rgba(255, 245, 255, 0.95)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(254, 242, 242, 0.8)"})]}),e.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),e.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),e.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),e.jsxs("filter",{id:"chartGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsx("filter",{id:"textShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodColor:"rgba(255, 255, 255, 0.8)"})}),e.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[e.jsx("rect",{width:"6",height:"6",fill:"#ef4444"}),e.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(255,255,255,0.85)"})]})]}),e.jsx("rect",{x:r.left,y:r.top,width:c-r.left-r.right,height:N-r.top-r.bottom,fill:"url(#bgGradientChart)",opacity:2,rx:12,style:{filter:"drop-shadow(0 4px 12px rgba(244, 114, 182, 0.1))"}}),B.map((i,p)=>{const j=L(i),n=i.toFixed(1).endsWith(".0")||i.toFixed(1).endsWith(".5"),D=n?i.toFixed(1):`.${i.toFixed(1).split(".")[1]}`;return e.jsxs(o,{...k?{}:{variants:C},children:[e.jsx("line",{x1:r.left,y1:j,x2:c-r.right,y2:j,stroke:n?"rgba(244, 114, 182, 0.3)":"rgba(244, 114, 182, 0.15)",strokeWidth:n?3:2,strokeDasharray:n?"0":"4,4",style:{filter:n?"drop-shadow(0 1px 3px rgba(244, 114, 182, 0.15))":"none",opacity:n?1:.7}}),Y&&e.jsx("text",{x:r.left-u(1),y:j+u(.35),textAnchor:"end",fontSize:u(n?1.1:1),fontWeight:n?"700":"600",fill:n?"#E91E63":"#EC4899",style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:D}),e.jsx("text",{x:c-r.right+u(1),y:j+u(.35),textAnchor:"start",fontSize:u(n?1.1:1),fontWeight:n?"700":"600",fill:n?"#E91E63":"#EC4899",style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:D})]},`temp-tick-${p}`)}),m.map((i,p)=>{const j=w(p);return e.jsx("line",{x1:j,y1:r.top,x2:j,y2:N-r.bottom,stroke:"rgba(244, 114, 182, 0.08)",strokeWidth:2.8,style:{filter:"drop-shadow(0 0 1px rgba(244, 114, 182, 0.05))"}},`day-grid-${p}`)}),e.jsx("rect",{x:r.left,y:r.top,width:c-r.left-r.right,height:N-r.top-r.bottom,fill:"none",stroke:"rgba(244, 114, 182, 0.4)",strokeWidth:4,rx:8,style:{filter:"drop-shadow(0 4px 12px rgba(244, 114, 182, 0.15))",strokeDasharray:"0"}}),Y&&e.jsx(o,{...k?{}:{variants:C},children:e.jsx("text",{x:r.left+u(1.2),y:r.top+u(1.5),textAnchor:"middle",fontSize:u(1.4),fontWeight:"800",fill:"#E91E63",style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:"°C"})})]})},Ct=({data:r,allDataPoints:c,getX:N,getY:A,baselineY:K,temperatureField:E="temperature",reduceMotion:L=!1})=>{if(!r||r.length<2)return null;let w="",m=null;const u=[];if(c.forEach((k,C)=>{const B=r.find(o=>o.id===k.id);if(B&&B[E]!==null&&B[E]!==void 0&&!B.ignored){const o=N(C),i=A(B[E]);u.push({x:o,y:i}),m!==null&&C===m+1?w+=` L ${o} ${i}`:w+=`${w?" ":""}M ${o} ${i}`,m=C}}),u.length<2)return null;const U=w.includes("L"),Y=u.length>1?u.map(({x:k,y:C},B)=>`${B===0?"M":"L"} ${k} ${C}`).join(" "):"";return e.jsxs(e.Fragment,{children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),e.jsx("stop",{offset:"30%",stopColor:"#EC4899"}),e.jsx("stop",{offset:"70%",stopColor:"#E91E63"}),e.jsx("stop",{offset:"100%",stopColor:"#C2185B"})]}),e.jsxs("linearGradient",{id:"tempLineGradientChartGlow",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(244, 114, 182, 0.6)"}),e.jsx("stop",{offset:"30%",stopColor:"rgba(236, 72, 153, 0.7)"}),e.jsx("stop",{offset:"70%",stopColor:"rgba(233, 30, 99, 0.8)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(194, 24, 91, 0.6)"})]}),e.jsxs("filter",{id:"lineGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"4",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsx("filter",{id:"lineShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"3",floodColor:"rgba(244, 114, 182, 0.4)"})})]}),U&&(L?e.jsx("path",{d:w,fill:"none",stroke:"url(#tempLineGradientChartGlow)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:.4,style:{filter:"url(#lineGlow)"}}):e.jsx(le.path,{d:w,fill:"none",stroke:"url(#tempLineGradientChartGlow)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:.4,style:{filter:"url(#lineGlow)"},initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.4},transition:{duration:.8,ease:"easeInOut",delay:.2}})),Y&&(L?e.jsx("path",{d:Y,fill:"none",stroke:"#d587b1",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.65}):e.jsx(le.path,{d:Y,fill:"none",stroke:"#d587b1",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.65,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.65},transition:{duration:.8,ease:"easeInOut"}})),U&&(L?e.jsx("path",{d:w,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#lineShadow)"}}):e.jsx(le.path,{d:w,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#lineShadow)"},initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:1},transition:{duration:1,ease:"easeInOut",delay:.4}})),U&&(L?e.jsx("path",{d:w,fill:"none",stroke:"rgba(255, 255, 255, 0.6)",strokeWidth:"0.3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.8}):e.jsx(le.path,{d:w,fill:"none",stroke:"rgba(255, 255, 255, 0.6)",strokeWidth:"0.3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.8,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.8},transition:{duration:1.2,ease:"easeInOut",delay:.6}}))]})},Je="#1565C0",Qe="#2E7D32",Ze="#6A1B9A",Et="#EFF6FF",St="#EEF2FF",It="#ECFDF5",Mt="#F0FDFA",vt="#F5F3FF",Lt="#FAF5FF",At="rgba(148, 163, 184, 0.35)",Bt="rgba(226, 232, 240, 0.6)",Dt="rgba(148, 163, 184, 0.5)",et="✖",Ye="#7f1d1d",ze="#ec4899",tt="drop-shadow(0 2px 4px rgba(244, 114, 182, 0.35))",Pt="#be185d",Nt="#2563eb",Ft=r=>{if(!r)return"";const[c,N]=r.split("/");return`${parseInt(c,10)}/${parseInt(N,10)}`},Ve=(r="",c,N,A="–")=>{if(!r)return[A,""];if(r.length<=c)return[r,""];if(N){const m=r.slice(0,c),u=r.slice(c,c*2);return[m,u]}const K=m=>{if(!m)return["",""];if(m.length<=c)return[m,""];const u=m.indexOf(" ",c);return u===-1?[m.slice(0,c),m.slice(c)]:[m.slice(0,u),m.slice(u+1)]},[E,L]=K(r),[w]=K(L.trimStart());return[E,w]},He=(r="",c,N="–")=>r?r.split(/\s+/).slice(0,c).join(" "):N,Rt=({data:r,getX:c,getY:N,isFullScreen:A,orientation:K,responsiveFontSize:E,onPointInteraction:L,clearActivePoint:w,activePoint:m,padding:u,chartHeight:U,chartWidth:Y,temperatureField:k="temperature_chart",textRowHeight:C,compact:B=!1,reduceMotion:o=!1,showInterpretation:i=!1,ovulationDetails:p=null,firstHighIndex:j=null,baselineIndices:n=[]})=>{const D={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},I={hidden:{opacity:0,scale:.3},visible:{opacity:1,scale:1,transition:{duration:.6,ease:[.34,1.56,.64,1],type:"spring",stiffness:120,damping:12}}},G=U-u.bottom,Z=G+C*1,g=G+C*2,J=G+C*3,P=G+C*(A?5:4.5),$=G+C*(A?7:6),re=G+C*(A?9:7.5),de=Y-u.left-u.right,oe=C*(A?2:1.5),ae=o?"g":le.g,ce=Array.isArray(r)?r.length:0,xe=x.useMemo(()=>{if(!i)return new Map;const a=Array.isArray(p==null?void 0:p.highSequenceIndices)?p.highSequenceIndices:[],d=new Map;return a.forEach((y,z)=>{const _=Number(y);Number.isInteger(_)&&_>=0&&_<ce&&!d.has(_)&&d.set(_,z+1)}),d},[i,p,ce]),me=x.useMemo(()=>{if(!i)return new Map;const a=Array.isArray(n)?n:[];if(!a.length)return new Map;const d=new Set,y=[],z=M=>{const Q=Number(M);Number.isInteger(Q)&&Q>=0&&Q<ce&&!d.has(Q)&&(d.add(Q),y.push(Q))};if(a.forEach(M=>{z(M)}),j!=null){const M=Number(j);Number.isInteger(M)&&z(M-1)}if(!y.length)return new Map;const _=[...y].sort((M,Q)=>M-Q),q=new Map;let H=1;for(let M=_.length-1;M>=0&&!(H>6);M-=1)q.set(_[M],H),H+=1;return q},[i,n,ce,j]);return e.jsxs(e.Fragment,{children:[e.jsxs("defs",{children:[e.jsx("filter",{id:"rowShadowChart",x:"-10%",y:"-10%",width:"120%",height:"120%",children:e.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"4",floodColor:"rgba(244, 114, 182, 0.2)"})}),e.jsxs("filter",{id:"pointGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("linearGradient",{id:"sensationGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:Et}),e.jsx("stop",{offset:"100%",stopColor:St})]}),e.jsxs("linearGradient",{id:"appearanceGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:It}),e.jsx("stop",{offset:"100%",stopColor:Mt})]}),e.jsxs("linearGradient",{id:"observationGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:vt}),e.jsx("stop",{offset:"100%",stopColor:Lt})]}),e.jsxs("radialGradient",{id:"tempPointGradientChart",cx:"30%",cy:"30%",children:[e.jsx("stop",{offset:"0%",stopColor:"#FCE7F3"}),e.jsx("stop",{offset:"40%",stopColor:"#F472B6"}),e.jsx("stop",{offset:"80%",stopColor:"#E91E63"}),e.jsx("stop",{offset:"100%",stopColor:"#C2185B"})]}),e.jsxs("radialGradient",{id:"tempPointIgnoredGradient",cx:"30%",cy:"30%",children:[e.jsx("stop",{offset:"0%",stopColor:"#FFFFFF"}),e.jsx("stop",{offset:"80%",stopColor:"#F8FAFC"}),e.jsx("stop",{offset:"100%",stopColor:"#E2E8F0"})]}),e.jsxs("radialGradient",{id:"ovulationPointGradient",cx:"30%",cy:"30%",children:[e.jsx("stop",{offset:"0%",stopColor:"#bfdbfe"}),e.jsx("stop",{offset:"45%",stopColor:"#60a5fa"}),e.jsx("stop",{offset:"85%",stopColor:"#2563eb"}),e.jsx("stop",{offset:"100%",stopColor:"#1d4ed8"})]})]}),!B&&e.jsxs("g",{children:[e.jsx("rect",{x:u.left,y:P-oe/2,width:de,height:oe,fill:"url(#sensationGradientChart)",rx:4,style:{filter:"url(#rowShadowChart)"}}),e.jsx("rect",{x:u.left,y:$-oe/2,width:de,height:oe,fill:"url(#appearanceGradientChart)",rx:4,style:{filter:"url(#rowShadowChart)"}}),e.jsx("rect",{x:u.left,y:re-oe/2,width:de,height:oe,fill:"url(#observationGradientChart)",rx:4,style:{filter:"url(#rowShadowChart)"}})]}),A&&K!=="portrait"&&e.jsx(le.g,{variants:D,children:[{label:"Fecha",row:1,color:A?"#374151":"#6B7280"},{label:"Día",row:2,color:A?"#374151":"#6B7280"},{label:"Símbolo",row:3,color:A?"#374151":"#6B7280"},{label:"Sens.",row:A?5:4.5,color:Je},{label:"Apar.",row:A?7:6,color:Qe},{label:"Observ.",row:A?9:7.5,color:Ze}].map(({label:a,row:d,color:y})=>e.jsx("text",{x:u.left-E(.5),y:G+C*d,textAnchor:"end",fontSize:E(1.05),fontWeight:"700",fill:y,style:{filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:a},a))}),r.map((a,d)=>{const y=c(d),z=a[k]!=null?N(a[k]):G,_=a.temperature_raw,q=a.temperature_corrected,H=a.use_corrected&&_!=null&&q!=null&&Math.abs(q-_)>.01,M=H?N(_):null,Q=A?"#374151":"#6B7280",he=a[k]!=null;he||a.mucus_sensation||a.mucus_appearance||a.fertility_symbol;const ge=String(a.id||"").startsWith("placeholder-"),ve=p==null?void 0:p.peakDayIndex,s=i&&ve!=null&&!a.ignored&&he&&d===ve,f=dt(a.fertility_symbol);let l="transparent";if(f!=null&&f.color){const pe=f.color.replace(/^bg-/,"");pe==="red-500"?l="#ef4444":pe==="white"?l="#ffffff":pe==="green-500"?l="#22c55e":pe==="pink-300"?l="#f9a8d4":pe==="yellow-400"&&(l="#facc15")}const v=a.isoDate?ht(Ae(Be(a.isoDate)),Ae(new Date)):!1,h=E(A?1.8:2),T=J-h*.75+h/2+2,O=a.peakStatus?String(a.peakStatus).toUpperCase():null,V=O==="P"||O==="X",W=O&&!V,ie=V?et:O||"–",ye=V||["1","2","3"].includes(O),ue=!ge&&f.value!=="none",b=!!a.isoDate&&!v?{pointerEvents:"all",style:{cursor:"pointer"},onClick:pe=>L(a,d,pe)}:{},S=xe.has(d),ee=S?xe.get(d):null,R=me.has(d),X=R?me.get(d):null,fe=E(A?.75:1.2),be=Math.max(.5,fe*.18),Ee=z-fe*(A?2.6:1.8),ne=z+fe*(A?1.9:1.6),we=A?4:7,Se=2,[De,Le]=Ve(A?He(a.mucus_sensation,Se,v?"":"–"):a.mucus_sensation,we,!1,v?"":"–"),[$e,_e]=Ve(A?He(a.mucus_appearance,Se,v?"":"–"):a.mucus_appearance,we,!1,v?"":"–"),[Te,Oe]=Ve(A?He(a.observations,Se,""):a.observations,we,!1,"");return e.jsxs(ae,{...o?{}:{variants:D},...b,children:[he&&e.jsxs(ae,{...o?{}:{variants:I},children:[H&&M!==null&&e.jsxs("g",{pointerEvents:"none",children:[e.jsx("line",{x1:y,y1:M,x2:y,y2:z,stroke:At,strokeWidth:1,strokeDasharray:"4 4"}),e.jsx("circle",{cx:y,cy:M,r:3.5,fill:Bt,stroke:Dt,strokeWidth:1}),e.jsx("circle",{cx:y,cy:M,r:1.2,fill:"rgba(255, 255, 255, 0.6)"})]}),e.jsx("circle",{cx:y,cy:z,r:s?2:1.5,fill:s?"rgba(59, 130, 246, 0.28)":"rgba(244, 114, 182, 0.2)",opacity:.85,style:{filter:"url(#pointGlow)"}}),e.jsx("circle",{cx:y,cy:z,r:s?4.2:3.5,fill:"none",stroke:a.ignored?"rgba(148, 163, 184, 0.4)":s?"rgba(37, 99, 235, 0.55)":"rgba(244, 114, 182, 0.3)",strokeWidth:s?2:1.5,opacity:s?.9:.6}),e.jsx("circle",{cx:y,cy:z,r:s?4.6:4,fill:a.ignored?"url(#tempPointIgnoredGradient)":s?"url(#ovulationPointGradient)":"url(#tempPointGradientChart)",stroke:a.use_corrected?"#F59E0B":a.ignored?"#94A3B8":s?"#1d4ed8":"#E91E63",strokeWidth:a.ignored?2:s?3.2:3,style:{filter:s?"drop-shadow(0 3px 8px rgba(37, 99, 235, 0.45))":"drop-shadow(0 3px 6px rgba(244, 114, 182, 0.4))",cursor:"pointer"},pointerEvents:"all",onClick:pe=>L(a,d,pe)}),!a.ignored&&e.jsx("circle",{cx:y,cy:z,r:s?1.8:1.5,fill:s?"rgba(239, 246, 255, 0.95)":"rgba(255, 255, 255, 0.9)",style:{filter:s?"drop-shadow(0 1px 3px rgba(37, 99, 235, 0.45))":"drop-shadow(0 1px 2px rgba(244, 114, 182, 0.3))"}}),s&&e.jsx("circle",{cx:y,cy:z,r:6.5,fill:"none",stroke:"rgba(37, 99, 235, 0.35)",strokeWidth:1.2,strokeDasharray:"4 3"}),i&&he&&!a.ignored&&S&&e.jsx("g",{pointerEvents:"none",children:e.jsx("text",{x:y,y:Ee,textAnchor:"middle",fontSize:fe,fontWeight:"900",fill:Pt,strokeWidth:be,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',paintOrder:"stroke",filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:ee})}),i&&he&&!a.ignored&&R&&e.jsx("g",{pointerEvents:"none",children:e.jsx("text",{x:y,y:ne,textAnchor:"middle",fontSize:fe,fontWeight:"800",fill:Nt,stroke:"#ffffff",strokeWidth:be,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',paintOrder:"stroke",filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.85))"},children:X})})]}),e.jsx("text",{x:y,y:Z,textAnchor:"middle",fontSize:E(1.05),fontWeight:"900",fill:Q,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:Ft(a.date)}),e.jsx("text",{x:y,y:g,textAnchor:"middle",fontSize:E(1),fontWeight:"900",fill:Q,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:a.cycleDay}),ue?e.jsxs("g",{children:[e.jsx("rect",{x:y-h/2+1,y:J-h*.75+1,width:h,height:h,fill:"rgba(0, 0, 0, 0.1)",rx:h*.3,opacity:.5}),e.jsx("rect",{x:y-h/2-4,y:J-h*.75,width:h*1.4,height:h,fill:f.pattern==="spotting-pattern"?"url(#spotting-pattern-chart)":l,stroke:f.value==="white"?"#CBD5E1":"rgba(233, 30, 99, 0.4)",strokeWidth:f.value==="white"?2:1,rx:h*.2,style:{filter:"drop-shadow(0 2px 4px rgba(244, 114, 182, 0.25))"}}),O&&e.jsx("g",{pointerEvents:"none",children:V?e.jsx("text",{x:y,y:T,textAnchor:"middle",fontSize:E(1.35),fontWeight:"900",fill:ze,stroke:"#fff",strokeWidth:1.5,paintOrder:"stroke",style:{filter:tt},children:et}):e.jsx("text",{x:y,y:T,textAnchor:"middle",fontSize:E(O?1.1:1),fontWeight:"800",fill:Ye,style:{filter:"drop-shadow(0 1px 1px rgba(255,255,255,0.9))"},children:O})})]}):e.jsxs("g",{children:[ye&&e.jsx("rect",{x:y-h/2-4,y:J-h*.75,width:h*1.4,height:h,fill:"transparent",stroke:V?ze:Ye,strokeWidth:1,rx:h*.2}),e.jsx("text",{x:y,y:T,textAnchor:"middle",fontSize:E(V?1.35:W?1.1:1),fill:V?ze:W?Ye:Q,fontWeight:V?"900":W?"800":"500",style:{filter:V?tt:W?"drop-shadow(0 1px 1px rgba(255,255,255,0.9))":"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:ie})]}),!B&&e.jsxs("text",{x:y,y:P,textAnchor:"middle",fontSize:E(.9),fontWeight:"700",fill:Je,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[e.jsx("tspan",{x:y,dy:0,children:De}),Le&&e.jsx("tspan",{x:y,dy:E(1.1),children:Le})]}),!B&&e.jsxs("text",{x:y,y:$,textAnchor:"middle",fontSize:E(.9),fontWeight:"700",fill:Qe,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[e.jsx("tspan",{x:y,dy:0,children:$e}),_e&&e.jsx("tspan",{x:y,dy:E(1.1),children:_e})]}),!B&&e.jsxs("text",{x:y,y:re,textAnchor:"middle",fontSize:E(.9),fontWeight:"700",fill:Ze,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[e.jsx("tspan",{x:y,dy:0,children:Te}),Oe&&e.jsx("tspan",{x:y,dy:E(1.1),children:Oe})]})]},`pt-${d}-${a.isoDate||a.timestamp}`)})]})},_t="#1565C0",Tt="#2E7D32",Ot="#6A1B9A",Wt=({padding:r,chartHeight:c,tempMin:N,tempMax:A,tempRange:K,getY:E,responsiveFontSize:L,textRowHeight:w,isFullScreen:m})=>{const u={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},U=[];if(K>0){const k=K<=2.5?.1:.5;for(let C=N;C<=A+1e-9;C+=k)U.push(parseFloat(C.toFixed(1)))}else for(let k=35;k<=37.5+1e-9;k+=.5)U.push(parseFloat(k.toFixed(1)));const Y=c-r.bottom;return e.jsxs("svg",{width:r.left,height:c,className:"font-sans pointer-events-none",children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"legendBgGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(255, 228, 230, 1)"}),e.jsx("stop",{offset:"30%",stopColor:"rgba(255, 229, 235, 1)  "}),e.jsx("stop",{offset:"70%",stopColor:"rgba(255, 241, 242, 1)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(255, 236, 240, 0.6)"})]}),e.jsxs("linearGradient",{id:"legendAccentGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),e.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),e.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),e.jsx("filter",{id:"legendShadowChart",x:"-20%",y:"-20%",width:"140%",height:"140%",children:e.jsx("feDropShadow",{dx:"0",dy:"3",stdDeviation:"4",floodColor:"rgba(244, 114, 182, 0.2)"})}),e.jsx("filter",{id:"textShadowLegend",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodColor:"rgba(255, 255, 255, 0.9)"})})]}),e.jsx("rect",{x:0,y:Y+w*.5,width:r.left,height:w*(m?9.5:8),fill:"url(#legendBgGradientChart)",rx:12,style:{filter:"url(#legendShadowChart)"}}),U.map((k,C)=>{const B=E(k),o=k.toFixed(1).endsWith(".0")||k.toFixed(1).endsWith(".5"),i=o?k.toFixed(1):`.${k.toFixed(1).split(".")[1]}`;return e.jsx(le.g,{variants:u,children:e.jsx("text",{x:r.left-L(1.2),y:B+L(.35),textAnchor:"end",fontSize:L(o?1.15:1),fontWeight:o?"800":"700",fill:o?"#E91E63":"#EC4899",style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:i})},`temp-tick-fixed-${C}`)}),e.jsx(le.g,{variants:u,children:[{label:"Fecha",row:1,color:"#374151",icon:null},{label:"Día",row:2,color:"#374151",icon:null},{label:"Símbolo",row:3,color:"#374151",icon:null},{label:"Sens.",row:m?5:4.5,color:_t,icon:"◊"},{label:"Apar.",row:m?7:6,color:Tt,icon:"○"},{label:"Observ.",row:m?9:7.5,color:Ot,icon:"✦"}].map(({label:k,row:C,color:B,icon:o})=>e.jsxs("g",{children:[o&&e.jsx("text",{x:r.left-L(2.8),y:Y+w*C,textAnchor:"middle",fontSize:L(.8),fontWeight:"600",fill:B,opacity:.7,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:o}),e.jsx("text",{x:r.left-L(.8),y:Y+w*C,textAnchor:"end",fontSize:L(1.05),fontWeight:"800",fill:B,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:k})]},k))})]})},nt=35.5,rt=37.5,Gt=(r=[])=>{var B;const c=o=>o&&o.displayTemperature!=null&&!o.ignored,K=o=>{if(!o||o.length!==6)return null;const i=o.map(n=>n.temp);if(i.some(n=>!Number.isFinite(n)))return null;const p=i.reduce((n,D)=>D>n?D:n,i[0]),j=i.reduce((n,D)=>D>=p-.05&&D<p?n+1:n,0);return j>=2?null:{baselineTemp:p,baselineStartIndex:o[0].index,baselineIndices:o.map(n=>n.index),baselineBorderlineCount:j}},E=o=>{const i=[];for(let p=o;p<r.length;p+=1){const j=r[p];if(!c(j))continue;const n=j.displayTemperature;if(Number.isFinite(n)&&(i.push({index:p,temp:n}),i.length>6&&i.shift(),i.length===6)){const D=K(i);if(!D)continue;let I=null;for(let G=p+1;G<r.length;G+=1){const Z=r[G];if(!c(Z))continue;const g=Z.displayTemperature;if(Number.isFinite(g)&&g>D.baselineTemp){I=G;break}}return{baselineTemp:D.baselineTemp,baselineStartIndex:D.baselineStartIndex,baselineIndices:D.baselineIndices,baselineBorderlineCount:D.baselineBorderlineCount,firstHighIndex:I}}}return null},L={confirmed:!1,confirmationIndex:null,infertileStartIndex:null,rule:null,highSequenceIndices:[],usedIndices:[],ovulationIndex:null};let w=null,m=null,u=null,U=[],Y=L,k=0;const C=({baselineTemp:o,firstHighIndex:i})=>{if(i==null)return{confirmed:!1};const p=o+.2,j=[],n=[],D=new Set,I=P=>{P==null||D.has(P)||(D.add(P),n.push(P))};let G=null,Z=!1;const g=i>0?i-1:null,J=()=>g!=null?[g,...n]:[...n];for(let P=i;P<r.length;P++){const $=r[P];if(!c($))break;const re=$.displayTemperature;if(!Number.isFinite(re))break;if(re>o){if(I(P),j.push({index:P,temp:re}),j.length===3&&j[2].temp>=p)return{confirmed:!0,confirmationIndex:j[2].index,usedIndices:J(),highSequenceIndices:[...n],rule:"3-high"};if(j.length===4&&j[2].temp<p&&j[3].temp>o)return{confirmed:!0,confirmationIndex:j[3].index,usedIndices:J(),highSequenceIndices:[...n],rule:"german-3+1"};if(G!==null&&j.length===3&&j[2].temp>=p)return{confirmed:!0,confirmationIndex:j[2].index,usedIndices:J(),highSequenceIndices:[...n],rule:"german-2nd-exception"};if(j.length===5&&j[3].temp>o&&j[4].temp>=p)return{confirmed:!0,confirmationIndex:j[4].index,usedIndices:J(),highSequenceIndices:[...n],rule:"5-high"};continue}if(re>=o-.05&&G===null&&j.length>0&&j.length<3){G=P,I(P),j.push({index:P,temp:o});continue}if(!Z&&j.length>0&&j.length<3){Z=!0,I(P);continue}break}return{confirmed:!1,usedIndices:J(),highSequenceIndices:[...n]}};for(;k<r.length;){const o=E(k);if(!o)break;if(w=o.baselineTemp,m=o.baselineStartIndex,U=Array.isArray(o.baselineIndices)?[...o.baselineIndices]:[],u=o.firstHighIndex,o.baselineBorderlineCount,u==null){k=m+1;continue}const i=C(o);if(i!=null&&i.requireRebaseline){k=m+1;continue}if(i!=null&&i.confirmed){const p=(B=i.highSequenceIndices)!=null&&B.length?i.highSequenceIndices[0]:null;Y={confirmed:!0,confirmationIndex:i.confirmationIndex,infertileStartIndex:i.confirmationIndex,rule:i.rule,highSequenceIndices:i.highSequenceIndices??i.usedIndices,usedIndices:i.usedIndices,ovulationIndex:u??p??null};break}k=m+1}return{baselineTemp:w,baselineStartIndex:m,firstHighIndex:u,baselineIndices:U,ovulationDetails:Y}},$t=(r,c,N,A,K,E=5,L=!1)=>{const w=x.useRef(null),m=x.useRef(null),[u,U]=x.useState({width:0,height:0}),[Y,k]=x.useState(null),[C,B]=x.useState({x:0,y:0}),[o,i]=x.useState(null),p=x.useCallback(()=>{k(null),i(null)},[]),j=x.useMemo(()=>ut(r),[r]),n=x.useMemo(()=>{const s=l=>{if(l==null||l==="")return null;const v=parseFloat(String(l).replace(",","."));return Number.isFinite(v)?v:null},f=l=>{if(!l)return null;const v=s(l.temperature),h=s(l.temperature_corrected);return l.use_corrected&&h!==null?h:v!==null?v:h!==null?h:null};return r.map(l=>{const v=[l==null?void 0:l.temperature_chart,l==null?void 0:l.temperature_raw,l==null?void 0:l.temperature_corrected];let h=null;for(const O of v)if(O!=null&&O!==""){h=O;break}if(h==null&&Array.isArray(l==null?void 0:l.measurements)){const V=l.measurements.find(W=>W&&W.selected&&f(W)!==null)||l.measurements.find(W=>f(W)!==null);V&&(h=f(V))}const T=l==null?void 0:l.isoDate;return{...l,displayTemperature:s(h),peakStatus:T&&j[T]||null}})},[r,j]);x.useLayoutEffect(()=>{const s=()=>{if(!w.current)return;const l=w.current.parentElement||w.current;let v=l.clientWidth||600,h=l.clientHeight||400,T=w.current.clientWidth>0?w.current.clientWidth:v,O,V;if(c){let W=window.innerWidth,ie=window.innerHeight;if(L&&ie>W&&([W,ie]=[ie,W]),T=W,N==="portrait"&&!L){const ye=Math.max(30,W*.05);O=(W-ye)/E*r.length}else O=W/E*r.length;V=ie}else O=T/E*r.length,V=h;U({width:O,height:V})};s(),window.addEventListener("resize",s);let f;if(w.current){const l=w.current.parentElement||w.current;f=new ResizeObserver(s),f.observe(l)}return()=>{window.removeEventListener("resize",s),f&&f.disconnect()}},[c,r.length,E,N,L]);const D=x.useMemo(()=>n.filter(s=>s&&s.isoDate&&!s.ignored&&s.displayTemperature!==null&&s.displayTemperature!==void 0),[n]),I=x.useMemo(()=>n.filter(s=>s&&s.isoDate),[n]),G=D.length>0,Z=x.useMemo(()=>{var s;if(!I.length)return null;for(let f=0;f<I.length;f+=1)if(((s=I[f])==null?void 0:s.peakStatus)==="P")return f;return null},[I]),g=x.useMemo(()=>{var v;if(!I.length)return null;let s=null;for(let h=0;h<I.length;h+=1)if(((v=I[h])==null?void 0:v.peakStatus)==="3"){s=h;break}if(s!=null){const h=s+1;return h>=I.length?s:h}if(Z==null)return null;const f=I[Z];if(!(f!=null&&f.isoDate))return null;const l=Be(f.isoDate);for(let h=Z+1;h<I.length;h+=1){const T=I[h];if(!(T!=null&&T.isoDate))continue;if(lt(Be(T.isoDate),l)>=4)return h}return null},[I,Z]),{baselineTemp:J,baselineStartIndex:P,firstHighIndex:$,baselineIndices:re,ovulationDetails:de}=x.useMemo(()=>Gt(n),[n]),oe=x.useMemo(()=>({...de??{confirmed:!1,confirmationIndex:null,infertileStartIndex:null,rule:null,highSequenceIndices:[],usedIndices:[],ovulationIndex:null},peakDayIndex:Z,peakInfertilityStartIndex:g}),[de,Z,g]),{tempMin:ae,tempMax:ce}=x.useMemo(()=>{const s=D.map(v=>v.displayTemperature).filter(v=>v!=null);if(s.length===0)return{tempMin:nt,tempMax:rt};let f=Math.min(...s,nt),l=Math.max(...s,rt);if(f=Math.floor(f*2)/2,l=Math.ceil(l*2)/2,l-f<2){const v=(f+l)/2;f=v-1,l=v+1}return{tempMin:f,tempMax:l}},[D]),xe=ce-ae,me=u.width,a=u.height,d=9,y=(s=1)=>{if(!c)return d*s;const f=Math.min(me,a);return Math.max(8,Math.min(d*s,f/(I.length>0?40/s:40)))},z=y(c?1.6:2.5),_=L||N==="landscape",H=z*(_?9:5),M={top:c?Math.max(_?6:12,a*(_?.015:.03)):12,right:c?Math.max(_?35:30,me*(_?.02:.05)):50,bottom:(c?Math.max(_?0:40,a*(_?0:.11)):60)+H+25,left:c?Math.max(_?45:20,me*(_?.02:.05)):50},Q=s=>{if(s==null||xe===0)return a-M.bottom;const f=a-M.top-M.bottom;return f<=0?a-M.bottom:a-M.bottom-(s-ae)/xe*f},he=s=>{const f=c&&!(L||N==="landscape")?5:10,l=c&&!(L||N==="landscape")?25:0,v=me-M.left-M.right-f-l*(I.length-1);if(v<=0)return M.left+f+l*s;const h=I.length>1?I.length-1:1;return h===0||I.length===0?M.left+f+l*s:M.left+f+s*(v/(I.length===1?1:h))+l*s},ge=(s,f,l)=>{if(!s){p();return}const v=w.current.getBoundingClientRect();let h,T;if(l.type.startsWith("touch")){const ie=l.changedTouches[0];h=ie.clientX,T=ie.clientY}else h=l.clientX,T=l.clientY;const O=he(f),V=s.displayTemperature??s.temperature_chart??null,W=Q(V);B({svgX:O,svgY:W,clientX:h-v.left+w.current.scrollLeft,clientY:T-v.top+w.current.scrollTop}),i(f),k(s)};return x.useEffect(()=>{const s=f=>{var l;if(m.current&&!m.current.contains(f.target)){const v=(l=w.current)==null?void 0:l.querySelectorAll("circle, text, rect");let h=!1;if(v){for(let T of v)if(T.contains(f.target)){h=!0;break}}h||p()}};return Y&&(document.addEventListener("mousedown",s),document.addEventListener("touchstart",s)),()=>{document.removeEventListener("mousedown",s),document.removeEventListener("touchstart",s)}},[Y,p]),{chartRef:w,tooltipRef:m,dimensions:u,activePoint:Y,activeIndex:o,tooltipPosition:C,processedData:n,validDataForLine:D,allDataPoints:I,tempMin:ae,tempMax:ce,tempRange:xe,padding:M,textRowHeight:z,setActivePoint:k,setActiveIndex:i,getY:Q,getX:he,handlePointInteraction:ge,clearActivePoint:p,handleToggleIgnore:s=>{A&&s&&(A(K,s),p())},responsiveFontSize:y,baselineTemp:J,baselineStartIndex:P,baselineIndices:re,firstHighIndex:$,ovulationDetails:oe,hasTemperatureData:G}},Ut=({data:r,isFullScreen:c,orientation:N,onToggleIgnore:A,onEdit:K,onTogglePeak:E,cycleId:L,initialScrollIndex:w=0,visibleDays:m=5,showInterpretation:u=!1,reduceMotion:U=!1,forceLandscape:Y=!1,currentPeakIsoDate:k=null})=>{const{chartRef:C,tooltipRef:B,dimensions:o,activePoint:i,activeIndex:p,tooltipPosition:j,allDataPoints:n,validDataForLine:D,tempMin:I,tempMax:G,tempRange:Z,padding:g,textRowHeight:J,getY:P,getX:$,handlePointInteraction:re,handleToggleIgnore:de,responsiveFontSize:oe,clearActivePoint:ae,baselineTemp:ce,baselineStartIndex:xe,baselineIndices:me,firstHighIndex:a,ovulationDetails:d,hasTemperatureData:y}=$t(r,c,N,A,L,m,Y),z=x.useRef(null);if(!z.current){const F=Math.random().toString(36).slice(2,10);z.current=`fertility-chart-${L??"default"}-${F}`}const _=z.current;if(!n||n.length===0)return e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-pink-100 to-rose-100 rounded-full mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-pink-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),e.jsx("p",{className:"text-slate-400 font-medium",children:"No hay datos para mostrar en el gráfico"})]});const q=o.width,H=o.height,M=ce!=null?P(ce):null,Q=!!(d!=null&&d.confirmed),he=ce!=null,ge=$(0),ve=n.length>0?$(n.length-1):q-g.right,s=Q?"#F59E0B":"#94A3B8",f=Q?"6 4":"4 4",l=Q?1:.7,v=3,h=q===0,T=p!=null?$(p):null,O=p!=null?p>0?$(p-1):T:null,V=p!=null?p<n.length-1?$(p+1):T:null,W=Math.max((q-g.left-g.right)/Math.max(n.length,1),0),ie=p!=null?Math.max((V!=null&&O!=null?V-O:0)||W,W,0):0,ye=x.useMemo(()=>{const F=new Map;return D.forEach(te=>{te&&te.id!=null&&F.set(te.id,te)}),F},[D]),ue=x.useMemo(()=>d!=null&&d.confirmed&&Number.isFinite(d==null?void 0:d.infertileStartIndex)?d.infertileStartIndex:null,[d]),t=x.useMemo(()=>Number.isFinite(d==null?void 0:d.peakInfertilityStartIndex)?d.peakInfertilityStartIndex:null,[d]),b=x.useMemo(()=>ue==null||t==null?null:Math.max(ue,t),[ue,t]),S=Math.max(H-g.top-g.bottom,0),ee=`${_}-temperature-below`,R=`${_}-temperature-above`,X=x.useCallback(F=>!Number.isFinite(F)||!n.length||F<=0?g.left:$(F),[n,$,g.left]),fe=x.useCallback(F=>!Number.isFinite(F)||!n.length||F>=n.length-1?q-g.right:$(F+1),[n,q,$,g.right]),be=x.useCallback((F,te,{inclusiveEnd:se=!0}={})=>{if(!Number.isFinite(F)||!Number.isFinite(te)||n.length===0)return null;const je=Ce=>Math.max(0,Math.min(n.length-1,Math.floor(Ce))),Ie=Ce=>Math.max(0,Math.min(n.length-1,Math.floor(Ce))),Ue=Ce=>Math.max(0,Math.min(n.length,Math.floor(Ce))),Pe=je(F),Me=se?Ie(te):Ue(te),Fe=Pe<=0?g.left:X(Pe);let ke;se?ke=Me>=n.length-1?q-g.right:fe(Me):Me<=0?ke=g.left:Me>=n.length?ke=q-g.right:ke=X(Me);const Ne=Math.max(ke-Fe,0);return Ne<=0?null:{x:Fe,width:Ne}},[n,q,X,fe,g.left,g.right]),Ee=x.useMemo(()=>{if(!y||S<=0)return{below:null,above:null};const F=H-g.bottom,te=g.top,se=n.map((ke,Ne)=>{const Ce=ke?ye.get(ke.id):null;return!Ce||!Number.isFinite(Ce.displayTemperature)?null:{index:Ne,x:$(Ne),y:P(Ce.displayTemperature)}}).filter(Boolean);if(!se.length)return{below:null,above:null};const je=se[0],Ie=se[se.length-1],Ue=X(je.index),Pe=q-g.right,Me=[...se];Me[Me.length-1].x!==Pe&&Me.push({index:Ie.index,x:Pe,y:Ie.y});const Fe=ke=>[`M ${Ue} ${ke}`,`L ${je.x} ${je.y}`,...Me.slice(1).map(({x:Ce,y:ot})=>`L ${Ce} ${ot}`),`L ${Pe} ${ke}`,"Z"].join(" ");return{below:Fe(F),above:Fe(te)}},[n,S,H,q,X,$,P,y,g.bottom,g.right,g.top,ye]),ne=x.useMemo(()=>{if(!u||!(d!=null&&d.confirmed)||ue==null||S<=0)return null;const F=b==null,te=b??n.length-1;return te<ue?null:be(ue,te,{inclusiveEnd:F})},[u,d,ue,S,b,n.length,be]),we=x.useMemo(()=>{if(!u||t==null||S<=0)return null;const F=b==null,te=b??n.length-1;return te<t?null:be(t,te,{inclusiveEnd:F})},[u,t,S,b,n.length,be]),Se=x.useMemo(()=>!u||b==null||S<=0?null:be(b,n.length-1),[u,b,S,n.length,be]),De=x.useMemo(()=>{if(!u||!(d!=null&&d.confirmed))return null;const F=Array.isArray(d==null?void 0:d.highSequenceIndices)?d.highSequenceIndices:[];if(F.length<2)return null;const te=F.map(se=>{if(se==null||se<0||se>=n.length)return null;const je=n[se],Ie=ye.get(je==null?void 0:je.id);return!Ie||!Number.isFinite(Ie.displayTemperature)?null:{x:$(se),y:P(Ie.displayTemperature)}}).filter(Boolean);return te.length<2?null:te.map(({x:se,y:je},Ie)=>`${Ie===0?"M":"L"} ${se} ${je}`).join(" ")},[u,d,n,ye,$,P]),[Le,$e]=x.useState({w:typeof window<"u"?window.innerWidth:0,h:typeof window<"u"?window.innerHeight:0}),_e=Le.w<Le.h;x.useEffect(()=>{const F=()=>$e({w:window.innerWidth,h:window.innerHeight});return window.addEventListener("resize",F),window.addEventListener("orientationchange",F),()=>{window.removeEventListener("resize",F),window.removeEventListener("orientationchange",F)}},[]),x.useEffect(()=>{if(!C.current)return;const F=C.current.clientWidth/m;C.current.scrollLeft=Math.max(0,F*w)},[w,m,o.width,N]);const Te=Y&&_e,Oe=Te,pe="w-full h-full bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100",st=c?`${pe} min-h-full ${Oe?"flex items-stretch justify-start overflow-y-auto overflow-x-hidden":"flex items-center justify-start overflow-x-auto overflow-y-hidden"}`:`${pe} overflow-x-auto overflow-y-hidden border border-pink-100/50`,Ke=!c||N==="portrait";return e.jsxs(le.div,{className:"relative w-full h-full",initial:!1,children:[Ke&&e.jsx("div",{className:"absolute left-0 top-0 h-full bg-transparent pointer-events-none z-10",style:{width:g.left},children:e.jsx(Wt,{padding:g,chartHeight:H,tempMin:I,tempMax:G,tempRange:Z,getY:P,responsiveFontSize:oe,textRowHeight:J,isFullScreen:c})}),e.jsxs(le.div,{ref:C,className:`relative p-0 ${c?"":"rounded-2xl"} ${st}`,style:{boxShadow:c?"inset 0 1px 3px rgba(244, 114, 182, 0.1)":"0 8px 32px rgba(244, 114, 182, 0.12), 0 2px 8px rgba(244, 114, 182, 0.08)",...Te?{position:"absolute",top:0,left:0,width:`${Le.h}px`,height:`${Le.w}px`,transform:"rotate(90deg) translateY(-100%)",transformOrigin:"top left"}:{}},initial:!1,children:[h&&e.jsx("div",{className:"flex items-center justify-center w-full h-full text-slate-400",children:"Cargando..."}),e.jsxs(le.svg,{width:q,height:H,className:"font-sans flex-shrink-0",viewBox:`0 0 ${q} ${H}`,preserveAspectRatio:"xMidYMid meet",initial:!1,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),e.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),e.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),e.jsxs("linearGradient",{id:"tempAreaGradientChart",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(244,114,182,0.25)"}),e.jsx("stop",{offset:"50%",stopColor:"rgba(236,72,153,0.15)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(233,30,99,0.05)"})]}),e.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[e.jsx("rect",{width:"6",height:"6",fill:"#ef4444"}),e.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(255,255,255,0.85)"})]}),e.jsxs("filter",{id:"chartShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("filter",{id:"baselineGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("pattern",{id:"temperatureInfertilityPattern",patternUnits:"userSpaceOnUse",width:"14",height:"14",children:[e.jsx("rect",{width:"14",height:"14",fill:"rgba(191, 219, 254, 0.45)"}),e.jsx("path",{d:"M0 0 L14 14",stroke:"rgba(59, 130, 246, 0.55)",strokeWidth:"1.4"}),e.jsx("path",{d:"M14 0 L0 14",stroke:"rgba(59, 130, 246, 0.55)",strokeWidth:"1.4"})]}),e.jsxs("pattern",{id:"peakInfertilityPattern",patternUnits:"userSpaceOnUse",width:"12",height:"12",children:[e.jsx("rect",{width:"12",height:"12",fill:"rgba(167, 243, 208, 0.42)"}),e.jsx("circle",{cx:"3",cy:"3",r:"1.7",fill:"rgba(13, 148, 136, 0.55)"}),e.jsx("circle",{cx:"9",cy:"9",r:"1.7",fill:"rgba(13, 148, 136, 0.55)"})]}),e.jsxs("pattern",{id:"absoluteInfertilityPattern",patternUnits:"userSpaceOnUse",width:"16",height:"16",children:[e.jsx("rect",{width:"16",height:"16",fill:"rgba(56, 189, 248, 0.45)"}),e.jsx("path",{d:"M0 0 L16 16",stroke:"rgba(13, 148, 136, 0.6)",strokeWidth:"1.2"}),e.jsx("path",{d:"M16 0 L0 16",stroke:"rgba(13, 148, 136, 0.6)",strokeWidth:"1.2"}),e.jsx("circle",{cx:"4",cy:"12",r:"1.6",fill:"rgba(19, 78, 74, 0.6)"}),e.jsx("circle",{cx:"12",cy:"4",r:"1.6",fill:"rgba(19, 78, 74, 0.6)"})]}),y&&Ee.below&&e.jsx("clipPath",{id:ee,clipPathUnits:"userSpaceOnUse",children:e.jsx("path",{d:Ee.below})}),y&&Ee.above&&e.jsx("clipPath",{id:R,clipPathUnits:"userSpaceOnUse",children:e.jsx("path",{d:Ee.above})})]}),e.jsx("rect",{width:"100%",height:"100%",fill:"transparent"}),e.jsx(kt,{padding:g,chartWidth:q,chartHeight:H,tempMin:I,tempMax:G,tempRange:Z,getY:P,getX:$,allDataPoints:n,responsiveFontSize:oe,isFullScreen:c,showLeftLabels:!Ke,reduceMotion:U}),u&&e.jsxs(e.Fragment,{children:[we&&(y&&Ee.below?e.jsx("rect",{x:we.x,y:g.top,width:we.width,height:S,fill:"url(#peakInfertilityPattern)",opacity:.75,pointerEvents:"none",clipPath:`url(#${ee})`}):e.jsx("rect",{x:we.x,y:g.top,width:we.width,height:S,fill:"url(#peakInfertilityPattern)",opacity:.75,pointerEvents:"none"})),ne&&(y&&Ee.above?e.jsx("rect",{x:ne.x,y:g.top,width:ne.width,height:S,fill:"url(#temperatureInfertilityPattern)",opacity:.7,pointerEvents:"none",clipPath:`url(#${R})`}):e.jsx("rect",{x:ne.x,y:g.top,width:ne.width,height:S,fill:"url(#temperatureInfertilityPattern)",opacity:.7,pointerEvents:"none"})),Se&&e.jsx("rect",{x:Se.x,y:g.top,width:Se.width,height:S,fill:"url(#absoluteInfertilityPattern)",opacity:.5,pointerEvents:"none"})]}),u&&he&&M!==null&&(U?e.jsx("line",{x1:ge,y1:M,x2:ve,y2:M,stroke:s,strokeWidth:v,strokeDasharray:f,opacity:l}):e.jsx(le.path,{d:`M ${ge} ${M} L ${ve} ${M}`,stroke:s,strokeWidth:v,strokeDasharray:f,opacity:l,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:l},transition:{duration:4,ease:"easeInOut",delay:.5}})),e.jsx(Ct,{data:D,allDataPoints:n,getX:$,getY:P,baselineY:H-g.bottom,temperatureField:"displayTemperature",reduceMotion:U}),De&&e.jsx("path",{d:De,fill:"none",stroke:"#cc0e93",strokeWidth:6,strokeLinecap:"round",strokeLinejoin:"round",opacity:.85,style:{filter:"drop-shadow(0 2px 6px rgba(206, 14, 147, 0.4))"},pointerEvents:"none"}),p!==null&&T!==null&&ie>0&&e.jsx("g",{pointerEvents:"none",children:e.jsx("line",{x1:T,y1:0,x2:T,y2:H,stroke:"rgba(235, 171, 204,0.15)",strokeWidth:Math.max(3,Math.min(14,ie*.4)),strokeLinecap:"round"})}),e.jsx(Rt,{data:n,getX:$,getY:P,isFullScreen:c,orientation:N,responsiveFontSize:oe,onPointInteraction:re,clearActivePoint:ae,activePoint:i,padding:g,chartHeight:H,chartWidth:q,temperatureField:"displayTemperature",textRowHeight:J,compact:!1,reduceMotion:U,showInterpretation:u,ovulationDetails:d,baselineStartIndex:xe,firstHighIndex:a,baselineIndices:me})]}),i&&e.jsx(le.div,{ref:B,initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:10},transition:{duration:.12,ease:"easeOut"},children:e.jsx(pt,{point:i,position:j,chartWidth:q,chartHeight:H,onToggleIgnore:de,onEdit:K,onClose:ae,onTogglePeak:E,currentPeakIsoDate:k})})]})]})};function qt(r,c){if(!r||!c)return[];const N=typeof r=="string"?Be(r):r;return[...Array(c)].map((A,K)=>{const E=at(N,K),L=Ge(E,"yyyy-MM-dd"),w=Ge(E,"dd/MM"),m=Xe(Ae(E),Ae(N))+1;return{date:w,isoDate:L,cycleDay:m,temperature:null,mucusSensation:null,mucusAppearance:null,id:`placeholder-${L}`,ignored:!1,peak_marker:null}})}const tn=()=>{const{cycleId:r}=ct(),{currentCycle:c,archivedCycles:N,isLoading:A,addOrUpdateDataPoint:K,toggleIgnoreRecord:E,getCycleById:L}=xt(),[w,m]=x.useState(null),[u,U]=x.useState(!1),[Y,k]=x.useState(!1),C=!r||r===c.id,B=C?null:N.find(t=>t.id===r);x.useEffect(()=>{if(C){m(null),U(!1),k(!1);return}if(B){m(null),U(!1),k(!1);return}let t=!0;return U(!0),L(r).then(b=>{t&&(b?(m(b),k(!1)):(m(null),k(!0)))}).catch(()=>{t&&(m(null),k(!0))}).finally(()=>{t&&U(!1)}),()=>{t=!1}},[C,B,L,r]);const o=C?c:B||w,i=!C&&!B,p=!C&&(o==null?void 0:o.id),j=C?A&&!(c!=null&&c.id):u||A&&!B&&!w,[n,D]=x.useState(typeof window<"u"&&window.innerWidth>window.innerHeight?"landscape":"portrait"),[I,G]=x.useState(!1),[Z,g]=x.useState(!1),[J,P]=x.useState(null),[$,re]=x.useState(!1),[de,oe]=x.useState(!1),ae=x.useRef(!1),ce=!!(J&&String(J.id||"").startsWith("placeholder-"));if(x.useEffect(()=>{const t=async()=>{var S,ee;const b=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement);if(G(b),!b){try{const R=typeof window<"u"?(S=window.screen)==null?void 0:S.orientation:null;await((ee=R==null?void 0:R.unlock)==null?void 0:ee.call(R))}catch{}D("portrait")}};return document.addEventListener("fullscreenchange",t),document.addEventListener("webkitfullscreenchange",t),document.addEventListener("mozfullscreenchange",t),document.addEventListener("MSFullscreenChange",t),()=>{document.removeEventListener("fullscreenchange",t),document.removeEventListener("webkitfullscreenchange",t),document.removeEventListener("mozfullscreenchange",t),document.removeEventListener("MSFullscreenChange",t)}},[]),x.useLayoutEffect(()=>{window.dispatchEvent(new Event("resize"))},[n,I]),j)return e.jsx(We,{children:e.jsx("div",{className:"flex h-full flex-col items-center justify-center space-y-4 bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100 px-4 py-8 text-center text-pink-600",children:e.jsx("p",{children:"Cargando…"})})});if(!(o!=null&&o.id))return r&&Y?e.jsx(We,{children:e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 px-4 py-8 text-center text-pink-600",children:[e.jsx("p",{children:"No se encontró el ciclo solicitado."}),e.jsx(Re,{asChild:!0,className:"bg-gradient-to-r from-pink-500 to-rose-500 text-white shadow",children:e.jsx(qe,{to:"/archived-cycles",children:"Volver a Mis Ciclos"})})]})}):e.jsx(We,{children:e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 px-4 py-8 text-center text-pink-600",children:[e.jsx("p",{children:"No hay ciclo activo."}),e.jsx(Re,{asChild:!0,className:"bg-gradient-to-r from-pink-500 to-rose-500 text-white shadow",children:e.jsx(qe,{to:"/records",children:"Ir a Mis Registros"})})]})});const xe=28,me=10,a=Be(o.startDate),d=o.data||[],y=x.useMemo(()=>{const t=Array.isArray(d)?d.find(b=>(b==null?void 0:b.peak_marker)==="peak"):null;return(t==null?void 0:t.isoDate)||null},[d]),z=d.reduce((t,b)=>{const S=Be(b.isoDate);return S>t?S:t},a),_=Ae(new Date),q=z>_?z:_,H=Xe(Ae(q),a),M=Math.max(xe,H+1),he=qt(a,M).map(t=>{const b=d.find(S=>S.isoDate===t.isoDate);return b?{...b,date:t.date}:t}),ge=n==="portrait"?me:xe;let ve=0;if(n!=="landscape"){const t=Xe(new Date,Ae(a)),b=Math.min(Math.max(t,0),M-1);let S=Math.min(M,b+1);b<ge-1&&(S=Math.min(M,ge)),ve=Math.max(0,S-ge)}const s={background:"linear-gradient(135deg, #FFFAFC 0%, #f7eaef 100%)"},f=I?s:{...s,height:n==="landscape"?"calc(min(100dvh, 100dvw) - var(--bottom-nav-safe))":"calc(100dvh - var(--bottom-nav-safe))",maxHeight:"100vh",paddingBottom:"env(safe-area-inset-bottom)"},l=t=>{P(t),g(!0)},v=async(t,b)=>{try{if(await E(t,b),i){const S=await L(t);S&&m(S)}}catch(S){console.error("Error toggling ignore state:",S)}},h=async(t,b=!0)=>{if(!(o!=null&&o.id)||!(t!=null&&t.isoDate))return;const S=R=>{if(R==null||R==="")return null;const X=parseFloat(String(R).replace(",","."));return Number.isFinite(X)?X:null},ee=b??!(t.peak_marker==="peak"||t.peakStatus==="P");re(!0);try{const R=t.timestamp?Ge(Be(t.timestamp),"HH:mm"):Ge(new Date,"HH:mm");let X=Array.isArray(t.measurements)&&t.measurements.length>0?t.measurements:[{temperature:t.temperature_chart??t.temperature_raw??null,temperature_corrected:t.temperature_corrected??null,time:R,time_corrected:t.time_corrected??R,selected:!0,use_corrected:t.use_corrected??!1}];X.length===0&&(X=[{temperature:null,temperature_corrected:null,time:R,time_corrected:R,selected:!0,use_corrected:!1}]);const fe=X.map((ne,we)=>{const Se=ne.time||R,De=ne.time_corrected||Se;return{temperature:S(ne.temperature??ne.temperature_raw),time:Se,selected:we===0?!0:!!ne.selected,temperature_corrected:S(ne.temperature_corrected),time_corrected:De,use_corrected:!!ne.use_corrected}});fe.some(ne=>ne.selected)||(fe[0].selected=!0);const be={isoDate:t.isoDate,measurements:fe,mucusSensation:t.mucus_sensation??t.mucusSensation??"",mucusAppearance:t.mucus_appearance??t.mucusAppearance??"",fertility_symbol:t.fertility_symbol??"none",observations:t.observations??"",ignored:t.ignored??!1,peak_marker:ee?"peak":null},Ee=t!=null&&t.id&&!String(t.id).startsWith("placeholder-")?t:null;await K(be,Ee,o.id)}catch(R){console.error("Error toggling peak marker:",R)}finally{re(!1)}},T=async(t,{keepFormOpen:b=!1}={})=>{if(o!=null&&o.id){re(!0);try{if(await K(t,J,o.id),i){const S=await L(o.id);S&&m(S)}b||(g(!1),P(null))}finally{re(!1)}}},O=()=>{g(!1),P(null)},V=t=>{P(t)},W=()=>{oe(t=>!t)},ie=t=>{if(t.preventDefault(),ae.current){ae.current=!1;return}W()},ye=t=>{t.pointerType==="touch"&&(t.preventDefault(),ae.current=!0,W())},ue=async()=>{var S;const t=document.documentElement,b=typeof window<"u"?(S=window.screen)==null?void 0:S.orientation:null;if(I){if(b!=null&&b.unlock)try{await b.unlock()}catch(ee){console.error(ee)}try{const ee=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen,R=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;ee&&R&&await ee.call(document)}catch(ee){console.error(ee)}D("portrait"),G(!1)}else{let ee=!1,R=!1;try{const X=t.requestFullscreen||t.webkitRequestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen;R=!!X,X&&(await X.call(t),ee=!0)}catch(X){console.error(X)}if(b!=null&&b.lock)try{await b.lock("landscape")}catch(X){console.error(X)}D("landscape"),G(ee||!R)}};return e.jsx(We,{hideBottomNav:I,children:e.jsxs("div",{className:I?"fixed inset-0 z-50 h-[100dvh] w-[100dvw] overflow-x-auto overflow-y-auto":"relative w-full overflow-x-auto overflow-y-auto",style:f,children:[p&&!I&&e.jsx(Re,{asChild:!0,variant:"ghost",className:"absolute top-4 left-4 z-10 bg-white/80 text-slate-700 hover:bg-[#E27DBF]/20",children:e.jsxs(qe,{to:`/cycle/${o.id}`,className:"flex items-center gap-1",children:[e.jsx(yt,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline"})]})}),e.jsx(Re,{onClick:ie,onPointerUp:ye,variant:"ghost",size:"icon",className:`absolute top-4 right-20 z-10 p-2 rounded-full transition-colors ${de?"bg-[#E27DBF] text-white hover:bg-[#d46ab3]":"bg-white/80 text-slate-700 hover:bg-[#E27DBF]/20"}`,children:de?e.jsx(bt,{className:"h-4 w-4"}):e.jsx(wt,{className:"h-4 w-4"})}),e.jsx(Re,{onClick:ue,className:"absolute top-4 right-4 z-10 bg-white/80 hover:bg-white text-gray-700 p-2 rounded-full shadow","aria-label":I?"Salir de pantalla completa":"Rotar gráfico",children:e.jsx(jt,{className:"w-5 h-5"})}),e.jsx(Ut,{data:he,isFullScreen:I,orientation:n,onToggleIgnore:v,onEdit:l,onTogglePeak:h,cycleId:o.id,initialScrollIndex:ve,visibleDays:ge,showInterpretation:de,reduceMotion:!0,forceLandscape:n==="landscape",currentPeakIsoDate:y}),e.jsx(mt,{open:Z,onOpenChange:t=>{t||O()},children:e.jsx(gt,{hideClose:!0,className:"bg-transparent border-none p-0 text-gray-800 w-[90vw] sm:w-auto max-w-md sm:max-w-lg md:max-w-xl max-h-[85vh] overflow-y-auto",children:e.jsx(ft,{onSubmit:T,onCancel:O,initialData:J,cycleStartDate:o.startDate,cycleEndDate:o.endDate,isProcessing:$,isEditing:!!J&&!ce,cycleData:o.data,onDateSelect:V})})})]})})};export{tn as default};
