import{r as y,j as e,m as a,B as d,f as K,p as U}from"./index-c55d5272.js";import{e as me,B as xe}from"./badge-537eb28b.js";import{g as he,X as be,e as Z,P as F,T as ge,d as ue}from"./computePeakStatuses-31c2acae.js";import{a as fe,E as pe}from"./eye-eb92638a.js";const Pe=({point:t,position:o,chartWidth:j,chartHeight:v,onToggleIgnore:w,onEdit:c,onClose:m,onTogglePeak:N,currentPeakIsoDate:H})=>{if(!t)return null;const k=.6,$=200,E=120,u=$*k,ee=E*k,C=y.useRef(null),[B,te]=y.useState(ee),[f,T]=y.useState(!1);y.useEffect(()=>{C.current&&te(C.current.offsetHeight),T(!1)},[t]);const se=o.clientX>j*.66,re=o.clientY+B>v;let x=se?o.clientX-u-10:o.clientX+10,h=re?o.clientY:o.clientY+10;x+u>j&&(x=j-u-10),h+B>v&&(h=v-B-10),x<10&&(x=10),h<10&&(h=10);const b=!t.id||String(t.id).startsWith("placeholder-"),L=t.temperature_chart??t.displayTemperature??null,S=he(t.fertility_symbol),X=t.timestamp||t.isoDate,n=r=>{if(r==null)return null;const l=String(r).trim();return l.length?l:null},ae=r=>{if(!r)return null;try{const l=U(r),s=l.getTime();return Number.isNaN(s)?null:K(l,"HH:mm")}catch{return null}},ie=(()=>{if(!Array.isArray(t.measurements)||t.measurements.length===0)return null;const r=t.measurements.filter(Boolean);if(!r.length)return null;const l=[...r.filter(s=>s==null?void 0:s.selected),...r.filter(s=>!(s!=null&&s.selected))];for(const s of l){const J=!!(s!=null&&s.use_corrected)?n(s==null?void 0:s.time_corrected)??n(s==null?void 0:s.time):n(s==null?void 0:s.time);if(J)return J}return null})(),le=(t.use_corrected?[n(t.time_corrected),n(t.time)]:[n(t.time)]).find(Boolean)??ae(t.timestamp),O=ie??le,A=t.mucus_sensation??t.mucusSensation??"",_=t.mucus_appearance??t.mucusAppearance??"",P=t.observations??"",R=S&&S.value!=="none",Y=L!=null,oe=!!(A&&A.trim()||_&&_.trim()),Q=!!(P&&P.trim()),ne=!(Y||R||oe||Q),z=t.peakStatus||(t.peak_marker==="peak"?"P":null),V=z&&{P:"Día pico",1:"Post pico 1",2:"Post pico 2",3:"Post pico 3"}[z]||null,D=!!(N&&t.isoDate),M=!!H,i=M&&t.isoDate===H||z==="P"||t.peak_marker==="peak",de=M&&!i,W="Día pico",p=i?"Quitar día pico":M?"Actualizar día pico":"Marcar día pico",ce=i?"bg-rose-600 text-white border border-rose-600 hover:bg-rose-700 focus-visible:ring-rose-400":de?"bg-amber-400 text-amber-900 border border-amber-300 hover:bg-amber-500 hover:text-white focus-visible:ring-amber-300":"bg-rose-500 text-white border border-rose-500 hover:bg-rose-600 focus-visible:ring-rose-300",q=[["flex items-center justify-center gap-1.5 px-2.5 py-1.5 rounded-xl text-sm font-semibold sm:text-sm","transition-all duration-200 shadow-sm hover:shadow-md","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-300"].join(" "),ce,f?"opacity-70 cursor-not-allowed":null].filter(Boolean).join(" "),G=async()=>{if(!(!N||f)){T(!0);try{await N(t,!i),m&&m()}catch(r){console.error("Error toggling peak marker from tooltip:",r)}finally{T(!1)}}},I=()=>{c&&(c(t),m&&m())},g=(r=>{switch(r){case"red":return{bg:"bg-red-500",light:"bg-red-50",border:"border-red-200",text:"text-red-700",glow:"shadow-red-200/50"};case"white":return{bg:"bg-slate-100 border-2 border-slate-300",light:"bg-slate-50",border:"border-slate-200",text:"text-slate-700",glow:"shadow-slate-200/50"};case"green":return{bg:"bg-green-500",light:"bg-green-50",border:"border-green-200",text:"text-green-700",glow:"shadow-green-200/50"};case"yellow":return{bg:"bg-yellow-400",light:"bg-yellow-50",border:"border-yellow-200",text:"text-yellow-700",glow:"shadow-yellow-200/50"};case"spot":return{bg:"bg-red-500 pattern-bg",light:"bg-red-50",border:"border-red-200",text:"text-red-700",glow:"shadow-red-200/50"};default:return{bg:"bg-gray-400",light:"bg-gray-50",border:"border-gray-200",text:"text-gray-700",glow:"shadow-gray-200/50"}}})(t.fertility_symbol);return e.jsxs(a.div,{ref:C,initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:20},transition:{duration:.25,ease:[.16,1,.3,1]},className:"absolute z-50",style:{top:h,left:x,width:u},children:[e.jsx("div",{className:"origin-top-left",style:{transform:`scale(${k})`,width:$,minHeight:E},children:e.jsxs("div",{className:"relative bg-gradient-to-br from-white/98 to-rose-50/95 backdrop-blur-xl rounded-3xl border border-pink-100 shadow-2xl overflow-hidden",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:m,className:"absolute top-2 right-2 text-gray-400 hover:text-pink-600 hover:bg-pink-50/80 rounded-full w-6 h-6 transition-all duration-200",children:e.jsx(be,{size:20})}),e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"mb-2",children:e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx("div",{className:"w-5 h-5 bg-gradient-to-br from-pink-500 to-rose-500 rounded-full absolute top-2 left-2 flex items-center justify-center shadow-lg",children:e.jsx(Z,{className:"w-2 h-2 text-white",fill:"currentColor"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-center text-lg text-gray-800",children:X?K(U(X),"dd/MM",{locale:me}):"Fecha"}),e.jsxs("p",{className:"text-sm text-pink-600 font-medium",children:["Día ",t.cycleDay||"N/A"," del ciclo"]}),V&&e.jsx("div",{className:"mt-1 flex justify-center",children:e.jsx(xe,{className:"bg-rose-100 text-rose-600 border border-rose-200 px-2 py-0 text-[11px]",children:V})})]})]})}),ne?e.jsxs("div",{className:"pt-1 space-y-3",children:[e.jsx(a.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:.1},className:"rounded-xl border border-dashed border-pink-200 bg-pink-50/60 p-2 text-center",children:e.jsx("p",{className:"text-sm font-semibold text-pink-600",children:"Sin datos registrados para este día."})}),c&&e.jsx(a.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:.15},className:"flex justify-center",children:e.jsxs(d,{onClick:I,variant:"outline",size:"sm",className:"flex items-center gap-1.5 px-2 py-1.5 bg-white/80 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 border-gray-200 hover:border-blue-300 text-gray-700 hover:text-blue-700 rounded-lg transition-all duration-200 shadow-sm hover:shadow-md text-xs",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Añadir datos"})]})}),D&&e.jsx(a.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:.2},className:"flex justify-center",children:e.jsx(d,{onClick:G,variant:i?"outline":"default",size:"sm",disabled:f,className:q,"aria-label":p,title:p,"aria-pressed":i,children:e.jsx("span",{className:"font-medium",children:W})})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1",children:[Y&&e.jsx(a.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.1},className:"bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl p-1 border border-amber-100/50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gradient-to-br from-amber-500 to-orange-600 rounded-lg flex items-center justify-center shadow-md",children:e.jsx(ge,{className:"w-4 h-4 text-white"})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-md font-bold text-gray-800",children:parseFloat(L).toFixed(2)}),e.jsx("span",{className:"text-md text-gray-600",children:"°C"}),t.use_corrected&&e.jsx("div",{className:"w-2 h-2 bg-amber-500 rounded-full shadow-[0_0_4px_rgba(245,158,11,0.65)]",title:"Temperatura corregida"})]}),O&&e.jsx("span",{className:"text-sm font-medium text-gray-500 whitespace-nowrap",children:O})]})})]})}),R&&e.jsx(a.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.15},className:`${g.light} rounded-xl p-1 ${g.border} border`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-6 h-6 ${g.bg} rounded-lg flex items-center justify-center shadow-lg ${g.glow} shadow-lg`,children:e.jsx("div",{className:"w-2 h-2 bg-white/90 rounded-full shadow-sm"})}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("span",{className:`text-md font-semibold ${g.text}`,children:S.label})})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-1",children:[e.jsx(a.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-1 border border-blue-100/50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center shadow-md",children:e.jsx(ue,{className:"w-4 h-4 text-white"})}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("span",{className:"text-md font-semibold text-blue-800",children:A||"-"})})]})}),e.jsx(a.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.25},className:"bg-gradient-to-r from-emerald-50 to-teal-50 rounded-xl p-1 border border-emerald-100/50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-lg flex items-center justify-center shadow-md",children:e.jsx(Z,{className:"w-4 h-4 text-white"})}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("span",{className:"text-md font-semibold text-green-800",children:_||"-"})})]})}),Q&&e.jsx(a.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"bg-gradient-to-r from-violet-50 to-purple-50 rounded-xl p-1 border border-violet-100/50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gradient-to-br from-violet-500 to-purple-600 rounded-lg flex items-center justify-center shadow-md",children:e.jsx(F,{className:"w-4 h-4 text-white"})}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("span",{className:"text-sm font-semibold text-violet-800",children:P})})]})})]})]}),(c||w&&!b&&t.id||D&&!b)&&e.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"flex justify-center gap-2 pt-2 border-t border-gray-100",children:[c&&e.jsxs(d,{onClick:I,variant:"outline",size:"sm",className:"flex items-center gap-1.5 px-2 py-1.5 bg-white/80 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 border-gray-200 hover:border-blue-300 text-gray-700 hover:text-blue-700 rounded-lg transition-all duration-200 shadow-sm hover:shadow-md text-sm",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:b?"Añadir datos":""})]}),D&&!b&&e.jsx(d,{onClick:G,variant:i?"outline":"default",size:"sm",disabled:f,className:q,"aria-label":p,title:p,"aria-pressed":i,children:e.jsx("span",{className:"font-medium text-xs sm:text-sm",children:W})}),w&&!b&&t.id&&e.jsx(d,{onClick:()=>w(t.id),variant:"outline",size:"sm",className:`flex items-center gap-1.5 px-2 py-1.5 rounded-lg transition-all duration-200 shadow-sm hover:shadow-md text-sm ${t.ignored?"bg-green-50 hover:bg-green-100 border-green-200 hover:border-green-300 text-green-700":"bg-red-50 hover:bg-red-100 border-red-200 hover:border-red-300 text-red-700"}`,children:t.ignored?e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium"})]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium"})]})})]})]})]})]})}),e.jsx("div",{className:"absolute -inset-2 bg-gradient-to-br from-pink-200/25 to-rose-300/25 rounded-3xl blur-2xl -z-10"})]})};export{Pe as C};
