import{r as c,j as a,M as U}from"./index-1b0fe1a0.js";import{g as Y,R as H,F as q}from"./generatePlaceholders-26f1d0e5.js";import{a as V,p as C,s as f,d as E}from"./useCycleData-270ed225.js";import{D as W}from"./DataEntryForm-8234e9d4.js";import{D as G,a as J}from"./dialog-9f479f94.js";import"./ChartTooltip-2ac35f64.js";import"./eye-16f81715.js";import"./eye-off-ea0ccfbb.js";import"./input-2e2fdcf0.js";import"./label-a061ee7d.js";const re=()=>{const{currentCycle:t,isLoading:F,addOrUpdateDataPoint:I,toggleIgnoreRecord:b}=V(),[r,g]=c.useState(typeof window<"u"&&window.innerWidth>window.innerHeight?"landscape":"portrait"),[o,p]=c.useState(!1),[R,u]=c.useState(!1),[h,i]=c.useState(null),[j,y]=c.useState(!1);if(c.useLayoutEffect(()=>{window.dispatchEvent(new Event("resize"))},[r,o]),F)return a.jsx("p",{className:"text-center text-gray-500",children:"Cargando…"});if(!(t!=null&&t.id))return a.jsx("p",{className:"text-center text-pink-600",children:"No hay ciclo activo."});const N=28,M=10,d=C(t.startDate),w=t.data.reduce((e,n)=>{const s=C(n.isoDate);return s>e?s:e},d),x=f(new Date),L=w>x?w:x,P=E(f(L),d),l=Math.max(N,P+1),O=Y(d,l).map(e=>{const n=t.data.find(s=>s.isoDate===e.isoDate);return n?{...n,date:e.date}:e}),m=r==="portrait"?M:l;let D=0;if(r!=="landscape"){const e=E(new Date,f(d)),n=Math.min(Math.max(e,0),l-1);let s=Math.min(l,n+1);n<m-1&&(s=Math.min(l,m)),D=Math.max(0,s-m)}const S={background:"linear-gradient(135deg, #FFFAFC 0%, #f7eaef 100%)"},T=o?S:{...S,height:r==="landscape"?"calc(min(100dvh, 100dvw) - var(--bottom-nav-safe))":"calc(100dvh - var(--bottom-nav-safe))",maxHeight:"100vh",paddingBottom:"env(safe-area-inset-bottom)"},k=e=>{i(e),u(!0)},A=(e,n)=>{b(e,n)},_=async e=>{y(!0);try{await I(e,h),u(!1),i(null)}finally{y(!1)}},v=()=>{u(!1),i(null)},z=e=>{i(e)},B=async()=>{if(o){try{await screen.orientation.unlock()}catch(e){console.error(e)}try{document.fullscreenElement&&await document.exitFullscreen()}catch(e){console.error(e)}g("portrait"),p(!1)}else try{await document.documentElement.requestFullscreen(),await screen.orientation.lock("landscape"),g("landscape"),p(!0)}catch(e){console.error(e)}};return a.jsx(U,{hideBottomNav:o,children:a.jsxs("div",{className:o?"fixed inset-0 z-50 h-[100dvh] w-[100dvw] overflow-x-auto overflow-y-auto":"relative w-full overflow-x-auto overflow-y-auto",style:T,children:[a.jsx("button",{onClick:B,className:"absolute top-4 right-4 z-10 bg-white/80 hover:bg-white text-gray-700 p-2 rounded-full shadow","aria-label":o?"Salir de pantalla completa":"Rotar gráfico",children:a.jsx(H,{className:"w-5 h-5"})}),a.jsx(q,{data:O,isFullScreen:o,orientation:r,onToggleIgnore:A,onEdit:k,cycleId:t.id,initialScrollIndex:D,visibleDays:m,reduceMotion:!0,forceLandscape:r==="landscape"}),a.jsx(G,{open:R,onOpenChange:e=>{e||v()},children:a.jsx(J,{hideClose:!0,className:"bg-transparent border-none p-0 text-gray-800 w-[90vw] sm:w-auto max-w-md sm:max-w-lg md:max-w-xl max-h-[85vh] overflow-y-auto",children:a.jsx(W,{onSubmit:_,onCancel:v,initialData:h,cycleStartDate:t.startDate,cycleEndDate:t.endDate,isProcessing:j,isEditing:!!h,cycleData:t.data,onDateSelect:z})})})]})})};export{re as default};
