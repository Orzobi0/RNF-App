import{r as o,j as a,p as C,s as g,d as F,M as G,B as R}from"./index-00d866bf.js";import{g as J,R as K,F as Q}from"./generatePlaceholders-84d4ebe7.js";import{a as X}from"./useCycleData-f8d63aaa.js";import{D as Z}from"./DataEntryForm-8cc4c6ac.js";import{D as ee,a as te}from"./dialog-ac3ab53e.js";import{E as ae}from"./eye-off-6a9408c7.js";import{E as ne}from"./eye-d7a8097f.js";import"./ChartTooltip-e7d15225.js";import"./input-d6ccd637.js";import"./label-bb718494.js";const pe=()=>{const{currentCycle:t,isLoading:j,addOrUpdateDataPoint:N,toggleIgnoreRecord:P}=X(),[i,w]=o.useState(typeof window<"u"&&window.innerWidth>window.innerHeight?"landscape":"portrait"),[s,x]=o.useState(!1),[M,h]=o.useState(!1),[f,c]=o.useState(null),[k,y]=o.useState(!1),[m,L]=o.useState(!1),p=o.useRef(!1);if(o.useLayoutEffect(()=>{window.dispatchEvent(new Event("resize"))},[i,s]),j&&!(t!=null&&t.id))return a.jsx("p",{className:"text-center text-gray-500",children:"Cargando…"});if(!(t!=null&&t.id))return a.jsx("p",{className:"text-center text-pink-600",children:"No hay ciclo activo."});const O=28,B=10,d=C(t.startDate),D=t.data.reduce((e,n)=>{const r=C(n.isoDate);return r>e?r:e},d),v=g(new Date),T=D>v?D:v,z=F(g(T),d),l=Math.max(O,z+1),A=J(d,l).map(e=>{const n=t.data.find(r=>r.isoDate===e.isoDate);return n?{...n,date:e.date}:e}),u=i==="portrait"?B:l;let S=0;if(i!=="landscape"){const e=F(new Date,g(d)),n=Math.min(Math.max(e,0),l-1);let r=Math.min(l,n+1);n<u-1&&(r=Math.min(l,u)),S=Math.max(0,r-u)}const E={background:"linear-gradient(135deg, #FFFAFC 0%, #f7eaef 100%)"},U=s?E:{...E,height:i==="landscape"?"calc(min(100dvh, 100dvw) - var(--bottom-nav-safe))":"calc(100dvh - var(--bottom-nav-safe))",maxHeight:"100vh",paddingBottom:"env(safe-area-inset-bottom)"},_=e=>{c(e),h(!0)},Y=(e,n)=>{P(e,n)},H=async e=>{y(!0);try{await N(e,f),h(!1),c(null)}finally{y(!1)}},I=()=>{h(!1),c(null)},q=e=>{c(e)},b=()=>{L(e=>!e)},V=e=>{if(e.preventDefault(),p.current){p.current=!1;return}b()},W=e=>{e.pointerType==="touch"&&(e.preventDefault(),p.current=!0,b())},$=async()=>{if(s){try{await screen.orientation.unlock()}catch(e){console.error(e)}try{document.fullscreenElement&&await document.exitFullscreen()}catch(e){console.error(e)}w("portrait"),x(!1)}else try{await document.documentElement.requestFullscreen(),await screen.orientation.lock("landscape"),w("landscape"),x(!0)}catch(e){console.error(e)}};return a.jsx(G,{hideBottomNav:s,children:a.jsxs("div",{className:s?"fixed inset-0 z-50 h-[100dvh] w-[100dvw] overflow-x-auto overflow-y-auto":"relative w-full overflow-x-auto overflow-y-auto",style:U,children:[a.jsx(R,{onClick:V,onPointerUp:W,variant:"ghost",size:"icon",className:`absolute top-4 right-20 z-10 p-2 rounded-full transition-colors ${m?"bg-[#E27DBF] text-white hover:bg-[#d46ab3]":"bg-white/80 text-slate-700 hover:bg-[#E27DBF]/20"}`,children:m?a.jsx(ae,{className:"h-4 w-4"}):a.jsx(ne,{className:"h-4 w-4"})}),a.jsx(R,{onClick:$,className:"absolute top-4 right-4 z-10 bg-white/80 hover:bg-white text-gray-700 p-2 rounded-full shadow","aria-label":s?"Salir de pantalla completa":"Rotar gráfico",children:a.jsx(K,{className:"w-5 h-5"})}),a.jsx(Q,{data:A,isFullScreen:s,orientation:i,onToggleIgnore:Y,onEdit:_,cycleId:t.id,initialScrollIndex:S,visibleDays:u,showInterpretation:m,reduceMotion:!0,forceLandscape:i==="landscape"}),a.jsx(ee,{open:M,onOpenChange:e=>{e||I()},children:a.jsx(te,{hideClose:!0,className:"bg-transparent border-none p-0 text-gray-800 w-[90vw] sm:w-auto max-w-md sm:max-w-lg md:max-w-xl max-h-[85vh] overflow-y-auto",children:a.jsx(Z,{onSubmit:H,onCancel:I,initialData:f,cycleStartDate:t.startDate,cycleEndDate:t.endDate,isProcessing:k,isEditing:!!f,cycleData:t.data,onDateSelect:q})})})]})})};export{pe as default};
