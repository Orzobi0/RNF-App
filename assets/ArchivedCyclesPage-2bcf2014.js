import{r,j as e,B as x,b as $,m as k,A as P,L as B,p as d,f as E,C as L,g as R}from"./index-65a39a90.js";import{D as U,a as V,b as G,c as H,d as W,e as J,u as K}from"./useCycleData-834d83be.js";import{u as Q,P as T,e as q,B as X}from"./badge-b2616664.js";import{I as z}from"./input-49c2a17b.js";import{O as Y}from"./OverlapWarningDialog-26e0e497.js";import{T as Z,D as _}from"./DeletionDialog-aaefd1b0.js";import{E as ee}from"./eye-020a87c7.js";const I=({isOpen:h,onClose:f,onConfirm:b,initialStartDate:u,initialEndDate:g,includeEndDate:m=!0,title:A="Editar Fechas del Ciclo",description:S,cycleId:C,checkOverlap:v})=>{const[t,a]=r.useState(u||""),[o,i]=r.useState(g||""),[p,y]=r.useState(""),[N,w]=r.useState(null),[D,M]=r.useState(null),[O,l]=r.useState(!1);Q(h,f),r.useEffect(()=>{a(u||""),i(g||"")},[u,g]);const F=async()=>{if(m&&!o){y("La fecha de fin es obligatoria");return}if(m&&t&&o&&o<t){y("La fecha de fin no puede ser anterior al inicio");return}const c=m?{startDate:t,endDate:o}:{startDate:t};if(v&&C&&t){const s=await v(C,t);if(s){w(s),M(c),l(!0);return}}b(c)};return e.jsxs(e.Fragment,{children:[e.jsx(U,{open:h,onOpenChange:f,children:e.jsxs(V,{className:"bg-white border-pink-100 text-gray-800",children:[e.jsxs(G,{children:[e.jsx(H,{children:A}),e.jsx(W,{className:"text-gray-600",children:S??(m?"Modifica la fecha de inicio y fin del ciclo.":"Modifica la fecha de inicio del ciclo.")})]}),e.jsxs("div",{className:"my-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"startDate",className:"text-gray-700 text-sm",children:"Inicio del ciclo"}),e.jsx(z,{id:"startDate",type:"date",value:t,onChange:c=>a(c.target.value),className:"bg-gray-50 border-gray-200 text-gray-800"})]}),m&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"endDate",className:"text-gray-700 text-sm",children:"Fin del ciclo"}),e.jsx(z,{id:"endDate",type:"date",value:o||"",onChange:c=>{i(c.target.value),y("")},className:"bg-gray-50 border-gray-200 text-gray-800"}),p&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:p})]})]}),e.jsxs(J,{className:"sm:justify-end",children:[e.jsx(x,{variant:"outline",onClick:f,className:"border-gray-300 text-gray-700 hover:bg-gray-100",children:"Cancelar"}),e.jsx(x,{variant:"primary",onClick:F,className:"bg-pink-600 hover:bg-pink-700 text-white",children:"Guardar"})]})]})}),e.jsx(Y,{isOpen:O,conflictCycle:N,onCancel:()=>l(!1),onConfirm:()=>{l(!1),D&&b({...D,force:!0})}})]})},ce=()=>{const{currentCycle:h,archivedCycles:f,isLoading:b,addArchivedCycle:u,updateCycleDates:g,deleteCycle:m,checkCycleOverlap:A,forceUpdateCycleStart:S}=K(),{toast:C}=$(),[v,t]=r.useState(!1),[a,o]=r.useState(null),[i,p]=r.useState(null),[y,N]=r.useState(!1),w=async({startDate:s,endDate:n})=>{try{await u(s,n),t(!1)}catch{}},D=async({startDate:s,endDate:n,force:j})=>{if(a)try{j?(await S(a.id,s),n!==void 0&&await g(a.id,void 0,n)):await g(a.id,s,n),o(null)}catch{}},M=s=>{p(s)},O=async()=>{if(i){N(!0);try{await m(i.id),C({title:"Ciclo eliminado",description:"El ciclo ha sido eliminado."}),p(null)}catch(s){console.error("Error deleting archived cycle:",s)}finally{N(!1)}}},l=h.id?[{...h,isCurrent:!0,needsCompletion:!h.endDate},...f]:f,F=l&&l.length>0;if(b&&!F)return e.jsxs("div",{className:"min-h-[100dvh] bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100 flex items-center justify-center",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0",style:{background:"radial-gradient(65% 55% at 50% 32%, rgba(244,114,182,0.18) 0%, rgba(244,114,182,0.12) 35%, rgba(244,114,182,0.06) 60%, rgba(244,114,182,0) 100%)"}}),e.jsx("div",{className:"text-center text-slate-600 p-8",children:"Cargando ciclos archivados..."})]});if(!l||l.length===0)return e.jsxs("div",{className:"min-h-[100dvh] bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100 relative",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0",style:{background:"radial-gradient(65% 55% at 50% 32%, rgba(244,114,182,0.18) 0%, rgba(244,114,182,0.12) 35%, rgba(244,114,182,0.06) 60%, rgba(244,114,182,0) 100%)"}}),e.jsx("div",{className:"flex items-center justify-center min-h-[100dvh] px-4",children:e.jsx(k.div,{className:"text-center text-slate-600 flex flex-col items-center max-w-md",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs("div",{className:"bg-white/70 backdrop-blur-md rounded-3xl p-8 border border-pink-200/50 shadow-lg",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-pink-100 to-rose-100 rounded-full flex items-center justify-center",children:e.jsx(P,{className:"w-10 h-10 text-pink-500"})}),e.jsx("h2",{className:"text-2xl font-semibold text-slate-700 mb-4",children:"No hay ciclos archivados"}),e.jsx("p",{className:"text-slate-600 mb-8",children:"Cuando inicies un nuevo ciclo, el anterior aparecerá aquí."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsx(x,{asChild:!0,className:"bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white shadow-lg",children:e.jsx(B,{to:"/",children:"Volver al Ciclo Actual"})}),e.jsxs(x,{onClick:()=>t(!0),className:"bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white shadow-lg",children:[e.jsx(T,{className:"mr-2 h-4 w-4"})," Crear Ciclo"]})]})]})})}),e.jsx(I,{isOpen:v,onClose:()=>t(!1),onConfirm:w,title:"Añadir Ciclo Anterior",description:"Ingresa las fechas de un ciclo previo para añadir registros."})]});const c=[...l].sort((s,n)=>d(n.startDate)-d(s.startDate));return e.jsxs("div",{className:"min-h-[100dvh] bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100 relative",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0",style:{background:"radial-gradient(65% 55% at 50% 32%, rgba(244,114,182,0.18) 0%, rgba(244,114,182,0.12) 35%, rgba(244,114,182,0.06) 60%, rgba(244,114,182,0) 100%)"}}),e.jsxs("div",{className:"w-full max-w-4xl mx-auto px-4 py-6 relative z-10",children:[e.jsxs(k.div,{className:"flex flex-col sm:flex-row justify-between items-center mb-8",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsxs("h1",{className:"text-3xl sm:text-4xl font-bold text-slate-700 mb-4 sm:mb-0 flex items-center",children:[e.jsx(P,{className:"mr-3 h-8 w-8 text-pink-500"}),"Mis Ciclos"]}),e.jsxs(x,{onClick:()=>t(!0),className:"bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white shadow-lg",style:{filter:"drop-shadow(0 6px 12px rgba(236, 72, 153, 0.3))"},children:[e.jsx(T,{className:"mr-2 h-4 w-4"})," Añadir Ciclo"]})]}),e.jsx(k.div,{className:"space-y-4",variants:{hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.1}}},initial:"hidden",animate:"show",children:c.map(s=>{const n=s.endDate?E(d(s.endDate),"dd/MM/yyyy",{locale:q}):"En curso",j=s.data?s.data.length:0;return e.jsx(k.div,{className:"bg-white/80 backdrop-blur-md border border-pink-200/50 shadow-lg hover:shadow-xl transition-all duration-300 hover:bg-white/90 rounded-xl",variants:{hidden:{opacity:0,y:20},show:{opacity:1,y:0}},children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center",children:[e.jsxs("div",{className:"flex items-start space-x-4 flex-1",children:[e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-pink-100 to-rose-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(L,{className:"w-6 h-6 text-pink-600"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center flex-wrap gap-2 mb-2",children:e.jsxs("h2",{className:"text-lg font-semibold text-slate-700",children:[E(d(s.startDate),"dd/MM/yyyy",{locale:q})," - ",n]})}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-slate-600",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(R,{className:"w-4 h-4 text-slate-500"}),e.jsxs("span",{children:[j," registro",j!==1?"s":""]})]}),s.endDate&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(L,{className:"w-4 h-4 text-slate-500"}),e.jsxs("span",{children:[Math.ceil((d(s.endDate)-d(s.startDate))/(1e3*60*60*24))+1," días"]})]}),s.isCurrent&&e.jsx(X,{className:"bg-gradient-to-r from-pink-500 to-rose-500 text-white text-xs",children:"Ciclo actual"})]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4 sm:mt-0 w-full sm:w-auto",children:[e.jsx(x,{asChild:!0,variant:"outline",size:"sm",className:"flex-1 sm:flex-none border-pink-300 text-pink-600 hover:bg-pink-50 hover:border-pink-400",children:e.jsxs(B,{to:s.isCurrent?"/":`/cycle/${s.id}`,children:[e.jsx(ee,{className:"mr-2 h-4 w-4"})," Ver"]})}),e.jsxs(x,{variant:"default",size:"sm",className:"flex-1 sm:flex-none bg-rose-500 text-white hover:bg-rose-600",onClick:()=>M(s),children:[e.jsx(Z,{className:"mr-2 h-4 w-4"})," Eliminar"]})]})]})})},s.id)})})]}),e.jsx(I,{isOpen:v,onClose:()=>t(!1),onConfirm:w,title:"Añadir Ciclo Anterior",description:"Ingresa las fechas de un ciclo previo para añadir registros."}),e.jsx(I,{isOpen:!!a,onClose:()=>o(null),onConfirm:D,initialStartDate:a==null?void 0:a.startDate,initialEndDate:a==null?void 0:a.endDate,cycleId:a==null?void 0:a.id,checkOverlap:A,title:"Editar Fechas del Ciclo",description:"Actualiza las fechas del ciclo."}),e.jsx(_,{isOpen:!!i,onClose:()=>p(null),onConfirm:O,title:"Eliminar ciclo",confirmLabel:"Eliminar ciclo",description:i?`¿Estás seguro de que quieres eliminar el ciclo ${E(d(i.startDate),"dd/MM/yyyy")} - ${i.endDate?E(d(i.endDate),"dd/MM/yyyy"):"En curso"}? Esta acción no se puede deshacer.`:"",isProcessing:y})]})};export{ce as default};
