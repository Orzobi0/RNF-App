import{c as S,j as e,B as o,r as v,k as g,o as L,f as j,g as T}from"./index-D1odW1ad.js";import{O as q}from"./DeletionDialog-CrQi-hGn.js";import{u as B}from"./useBackClose-C7RhtkvF.js";import{D as H,a as V,b as W,c as z,d as G,e as P}from"./useCycleData-CiVYlgIv.js";import{I as X}from"./input-CElQ2eSE.js";const le=S("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),re=S("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]),_=S("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),I=t=>{if(!t)return"";const a=new Date(t);if(Number.isNaN(a.getTime()))return t;const n=String(a.getDate()).padStart(2,"0"),l=String(a.getMonth()+1).padStart(2,"0"),c=String(a.getFullYear());return`${n}/${l}/${c}`},ie=({cycle:t,startDate:a,endDate:n,onStartDateChange:l,onEndDateChange:c,onSave:i,onCancel:y,isProcessing:u=!1,dateError:m="",includeEndDate:h=!0,showOverlapDialog:x=!1,overlapCycle:s=null,onConfirmOverlap:N,onCancelOverlap:D,title:w="Editar fechas del ciclo",description:k="Actualiza las fechas de inicio y fin del ciclo. Guarda los cambios cuando termines.",saveLabel:M="Guardar",cancelLabel:r="Cancelar",onClearError:d,className:b="mb-6 mx-auto w-full max-w-xl",onDeleteCycle:C,deleteTitle:A="Eliminar ciclo",deleteDescription:O="Esta acción no se puede deshacer. Se eliminarán todos los registros asociados.",deleteLabel:R="Eliminar ciclo",isDeletingCycle:Y=!1,onUndoCycle:$,isUndoingCycle:p=!1})=>{const E=t?.startDate?I(t.startDate):null,Z=t?.endDate?I(t.endDate):"En curso",F=E?`Fecha actual: ${E}${h?` — ${Z}`:""}`:null,J=f=>{d&&d(),l?.(f.target.value)},K=f=>{d&&d(),c?.(f.target.value)},Q=f=>{f.preventDefault(),i?.()};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`${b} rounded-3xl border border-rose-100 bg-white/90 p-5 shadow-md`,children:e.jsx("form",{onSubmit:Q,className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-titulo mb-1",children:w}),e.jsx("p",{className:"text-sm text-slate-600",children:k}),F&&e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:F}),e.jsxs("div",{className:`grid ${h?"grid-cols-2 gap-4":"grid-cols-1 gap-4"}`,children:[e.jsxs("label",{className:"flex h-full flex-col text-sm text-slate-700",children:["Inicio del ciclo",e.jsx("input",{type:"date",value:a||"",onChange:J,className:"mt-1 w-full rounded-lg border border-fertiliapp-suave bg-white px-3 py-2 text-slate-800 focus:border-fertiliapp-suave focus:outline-none focus:ring-2 focus:ring-fertiliapp-suave"})]}),h&&e.jsxs("label",{className:"flex h-full flex-col text-sm text-slate-700",children:["Fin del ciclo",e.jsx("input",{type:"date",value:n||"",onChange:K,className:"mt-1 w-full rounded-lg border border-fertiliapp-suave bg-white px-3 py-2 text-slate-800 focus:border-fertiliapp-suave focus:outline-none focus:ring-2 focus:ring-fertiliapp-suave"})]})]}),m&&e.jsx("p",{className:"mt-2 text-sm text-red-500",children:m}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-3 justify-center",children:[e.jsx(o,{type:"button",variant:"outline",onClick:y,className:"border-fertiliapp-suave text-titulo hover:brightness-95",disabled:u||p,children:r}),e.jsx(o,{type:"submit",className:"bg-fertiliapp-fuerte text-white shadow hover:brightness-95",disabled:u||p,children:M})]}),$&&e.jsxs("div",{className:"mt-4 rounded-3xl bg-amber-50 p-4 text-left",children:[e.jsx("h3",{className:"font-semibold text-slate-800 mb-2",children:"Deshacer ciclo"}),e.jsx("p",{className:"text-sm text-slate-700 mb-3",children:"Une el ciclo actual con el anterior y mueve todos los registros."}),e.jsx(o,{type:"button",onClick:$,disabled:u||p,className:"w-full sm:w-auto bg-amber-500 hover:brightness-95 text-white shadow-md",children:p?"Deshaciendo…":"Deshacer ciclo"})]}),C&&e.jsxs("div",{className:"mt-6 rounded-3xl bg-alerta-2-suave p-4 text-left",children:[e.jsx("h3",{className:"font-semibold text-slate-800 mb-2",children:A}),O&&e.jsx("p",{className:"text-sm text-slate-800 mb-3",children:O}),e.jsxs(o,{type:"button",onClick:C,disabled:u||Y||p,className:"w-full sm:w-auto bg-alerta-2 hover:brightness-95 text-white shadow-md",children:[e.jsx(_,{className:"mr-2 h-4 w-4"}),R]})]})]})})}),e.jsx(q,{isOpen:x,conflictCycle:s,onCancel:D,onConfirm:N})]})},ne=({isOpen:t,onClose:a,onConfirm:n,currentCycleStartDate:l,currentCycleRecords:c=[]})=>{const[i,y]=v.useState(g(new Date,"yyyy-MM-dd")),[u,m]=v.useState(!1),[h,x]=v.useState(null);B(t,a);const s=!l,N=v.useMemo(()=>{if(s||!i||!c.length)return!1;const r=L(j(i));return T(r)?c.some(d=>{if(!d?.isoDate)return!1;const b=L(j(d.isoDate));return T(b)?b.getTime()>=r.getTime():!1}):!1},[c,s,i]),D=()=>{if(!s&&N){x(i),m(!0);return}n(i)},w=()=>{h&&(m(!1),n(h),x(null))},k=s?"":g(j(l),"dd/MM/yyyy"),M=(()=>{if(s)return"";const r=new Date(i);return r.setDate(r.getDate()-1),g(r,"dd/MM/yyyy")})();return e.jsxs(e.Fragment,{children:[e.jsx(H,{open:t,onOpenChange:a,children:e.jsxs(V,{className:"bg-white border-pink-100 text-gray-800 rounded-3xl",children:[e.jsxs(W,{children:[e.jsx(z,{children:"Iniciar nuevo ciclo"}),e.jsx(G,{className:"text-gray-600",children:s?"Este será tu primer ciclo. Selecciona la fecha de inicio.":`¿Estás seguro de que quieres iniciar un nuevo ciclo? Los datos del ciclo actual (${k} - ${M}) serán archivados.`})]}),e.jsxs("div",{className:"my-4 space-y-2",children:[e.jsx("label",{htmlFor:"startDate",className:"text-gray-700 text-sm",children:"Fecha de inicio del nuevo ciclo"}),e.jsx(X,{id:"startDate",type:"date",value:i,onChange:r=>y(r.target.value),max:g(new Date,"yyyy-MM-dd"),min:s?void 0:g(j(l),"yyyy-MM-dd"),className:"bg-gray-50 border-gray-200 text-gray-800"})]}),e.jsxs(P,{className:"sm:justify-end",children:[e.jsx(o,{variant:"outline",onClick:a,className:"border-gray-300 text-subtitulo hover:brightness-95",children:"Cancelar"}),e.jsx(o,{variant:"primary",onClick:D,className:"bg-fertiliapp-fuerte hover:brightness-95 text-white",children:s?"Iniciar ciclo":"Confirmar nuevo ciclo"})]})]})}),e.jsx(q,{isOpen:u,onCancel:()=>{m(!1),x(null)},onConfirm:w,conflictCycle:s?null:{startDate:l,endDate:null},message:"Este nuevo ciclo actual coincide en fechas con el ciclo anterior. Los registros se pasarán al nuevo ciclo si continúas. ¿Deseas continuar?"})]})},oe=({isOpen:t,onClose:a,onConfirm:n})=>(B(t,a),e.jsx(H,{open:t,onOpenChange:l=>{l||a()},children:e.jsxs(V,{className:"bg-white/95 backdrop-blur border border-fertiliapp-fuerte text-slate-700",children:[e.jsxs(W,{children:[e.jsx(z,{className:"text-lg font-semibold text-fertiliapp-fuerte",children:"Modo postparto activado"}),e.jsx(G,{className:"text-slate-600",children:"Se ha añadido un nuevo ciclo. ¿Deseas desactivar el modo postparto?"})]}),e.jsxs(P,{className:"sm:justify-end gap-2",children:[e.jsx(o,{type:"button",variant:"outline",onClick:a,className:"border-pink-200 text-fertiliapp-fuerte hover:bg-pink-50 hover:text-fertiliapp-fuerte",children:"No"}),e.jsx(o,{type:"button",onClick:n,className:"bg-fertiliapp-fuerte hover:brightness-95 text-white shadow-lg",children:"Sí"})]})]})}));export{ie as C,le as L,ne as N,oe as P,_ as T,re as a};
