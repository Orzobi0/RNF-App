import{c as dt,m as J,j as e,r as b,s as Le,p as Fe,e as ht,f as Ue,d as tt,h as ft,M as Ge,B as Te,L as He}from"./index-9c052d95.js";import{g as ut,i as pt,b as xt,D as mt}from"./computePeakStatuses-53226450.js";import{u as yt,C as gt}from"./useFertilityChart-1eac94a6.js";import{u as bt,D as jt,a as wt}from"./useCycleData-5c7fca7c.js";import{A as kt}from"./arrow-left-e3d1f6f1.js";import{E as Et,a as Ct}from"./eye-2851a226.js";import"./input-38433acf.js";import"./label-79a0a783.js";import"./checkbox-33f1ec29.js";import"./badge-4d2a43e0.js";const St=dt("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),Lt=({padding:r,chartWidth:c,chartHeight:v,tempMin:p,tempMax:$,tempRange:x,getY:w,getX:S,allDataPoints:f=[],responsiveFontSize:a,isFullScreen:F,showLeftLabels:T=!1,reduceMotion:m=!1})=>{const u={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.3,ease:"easeOut"}}},C=[];if(x>0){const g=x<=2.5?.1:.5;for(let k=p;k<=$+1e-9;k+=g)C.push(parseFloat(k.toFixed(1)))}else for(let g=35.8;g<=37.2+1e-9;g+=.1)C.push(parseFloat(g.toFixed(1)));const o=m?"g":J.g;return e.jsxs(e.Fragment,{children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"bgGradientChart",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(254, 242, 242, 0.95)"}),e.jsx("stop",{offset:"30%",stopColor:"rgba(255, 241, 242, 0.9)"}),e.jsx("stop",{offset:"70%",stopColor:"rgba(255, 245, 255, 0.95)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(254, 242, 242, 0.8)"})]}),e.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),e.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),e.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),e.jsxs("filter",{id:"chartGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsx("filter",{id:"textShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodColor:"rgba(255, 255, 255, 0.8)"})}),e.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[e.jsx("rect",{width:"6",height:"6",fill:"#ef4444"}),e.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(255,255,255,0.85)"})]})]}),e.jsx("rect",{x:r.left,y:r.top,width:c-r.left-r.right,height:v-r.top-r.bottom,fill:"url(#bgGradientChart)",opacity:2,rx:12,style:{filter:"drop-shadow(0 4px 12px rgba(244, 114, 182, 0.1))"}}),C.map((g,k)=>{const Y=w(g),n=g.toFixed(1).endsWith(".0")||g.toFixed(1).endsWith(".5"),Q=n?g.toFixed(1):`.${g.toFixed(1).split(".")[1]}`;return e.jsxs(o,{...m?{}:{variants:u},children:[e.jsx("line",{x1:r.left,y1:Y,x2:c-r.right,y2:Y,stroke:n?"rgba(244, 114, 182, 0.3)":"rgba(244, 114, 182, 0.15)",strokeWidth:n?3:2,strokeDasharray:n?"0":"4,4",style:{filter:n?"drop-shadow(0 1px 3px rgba(244, 114, 182, 0.15))":"none",opacity:n?1:.7}}),T&&e.jsx("text",{x:r.left-a(1),y:Y+a(.35),textAnchor:"end",fontSize:a(n?1.1:1),fontWeight:n?"700":"600",fill:n?"#E91E63":"#EC4899",style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:Q}),e.jsx("text",{x:c-r.right+a(1),y:Y+a(.35),textAnchor:"start",fontSize:a(n?1.1:1),fontWeight:n?"700":"600",fill:n?"#E91E63":"#EC4899",style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:Q})]},`temp-tick-${k}`)}),f.map((g,k)=>{const Y=S(k);return e.jsx("line",{x1:Y,y1:r.top,x2:Y,y2:v-r.bottom,stroke:"rgba(244, 114, 182, 0.08)",strokeWidth:2.8,style:{filter:"drop-shadow(0 0 1px rgba(244, 114, 182, 0.05))"}},`day-grid-${k}`)}),e.jsx("rect",{x:r.left,y:r.top,width:c-r.left-r.right,height:v-r.top-r.bottom,fill:"none",stroke:"rgba(244, 114, 182, 0.4)",strokeWidth:4,rx:8,style:{filter:"drop-shadow(0 4px 12px rgba(244, 114, 182, 0.15))",strokeDasharray:"0"}}),T&&e.jsx(o,{...m?{}:{variants:u},children:e.jsx("text",{x:r.left+a(1.2),y:r.top+a(1.5),textAnchor:"middle",fontSize:a(1.4),fontWeight:"800",fill:"#E91E63",style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:"°C"})})]})},Mt=({data:r,allDataPoints:c,getX:v,getY:p,baselineY:$,temperatureField:x="temperature",reduceMotion:w=!1})=>{if(!r||r.length<2)return null;let S="",f=null;const a=[];if(c.forEach((m,u)=>{const C=r.find(o=>o.id===m.id);if(C&&C[x]!==null&&C[x]!==void 0&&!C.ignored){const o=v(u),g=p(C[x]);a.push({x:o,y:g}),f!==null&&u===f+1?S+=` L ${o} ${g}`:S+=`${S?" ":""}M ${o} ${g}`,f=u}}),a.length<2)return null;const F=S.includes("L"),T=a.length>1?a.map(({x:m,y:u},C)=>`${C===0?"M":"L"} ${m} ${u}`).join(" "):"";return e.jsxs(e.Fragment,{children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),e.jsx("stop",{offset:"30%",stopColor:"#EC4899"}),e.jsx("stop",{offset:"70%",stopColor:"#E91E63"}),e.jsx("stop",{offset:"100%",stopColor:"#C2185B"})]}),e.jsxs("linearGradient",{id:"tempLineGradientChartGlow",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(244, 114, 182, 0.6)"}),e.jsx("stop",{offset:"30%",stopColor:"rgba(236, 72, 153, 0.7)"}),e.jsx("stop",{offset:"70%",stopColor:"rgba(233, 30, 99, 0.8)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(194, 24, 91, 0.6)"})]}),e.jsxs("filter",{id:"lineGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"4",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsx("filter",{id:"lineShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"3",floodColor:"rgba(244, 114, 182, 0.4)"})})]}),F&&(w?e.jsx("path",{d:S,fill:"none",stroke:"url(#tempLineGradientChartGlow)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:.4,style:{filter:"url(#lineGlow)"}}):e.jsx(J.path,{d:S,fill:"none",stroke:"url(#tempLineGradientChartGlow)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:.4,style:{filter:"url(#lineGlow)"},initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.4},transition:{duration:.8,ease:"easeInOut",delay:.2}})),T&&(w?e.jsx("path",{d:T,fill:"none",stroke:"#d587b1",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.65}):e.jsx(J.path,{d:T,fill:"none",stroke:"#d587b1",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.65,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.65},transition:{duration:.8,ease:"easeInOut"}})),F&&(w?e.jsx("path",{d:S,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#lineShadow)"}}):e.jsx(J.path,{d:S,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#lineShadow)"},initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:1},transition:{duration:1,ease:"easeInOut",delay:.4}})),F&&(w?e.jsx("path",{d:S,fill:"none",stroke:"rgba(255, 255, 255, 0.6)",strokeWidth:"0.3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.8}):e.jsx(J.path,{d:S,fill:"none",stroke:"rgba(255, 255, 255, 0.6)",strokeWidth:"0.3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.8,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.8},transition:{duration:1.2,ease:"easeInOut",delay:.6}}))]})},nt="#1565C0",ot="#2E7D32",at="#6A1B9A",vt="#EFF6FF",It="#ECFDF5",Ot="#F5F3FF",Ke=.2,Xe="drop-shadow(0 1px 2px rgba(15, 23, 42, 0.08))",At="rgba(148, 163, 184, 0.35)",_t="rgba(226, 232, 240, 0.6)",Bt="rgba(148, 163, 184, 0.5)",it="✖",Je="#7f1d1d",Qe="#ec4899",lt="drop-shadow(0 2px 4px rgba(244, 114, 182, 0.35))",Ft="#be185d",Nt="#2563eb",Rt="#be185d",Wt=r=>{if(!r)return"";const[c,v]=r.split("/");return`${parseInt(c,10)}/${parseInt(v,10)}`},Ze=(r="",c,v,p="–")=>{if(!r)return[p,""];if(r.length<=c)return[r,""];if(v){const f=r.slice(0,c),a=r.slice(c,c*2);return[f,a]}const $=f=>{if(!f)return["",""];if(f.length<=c)return[f,""];const a=f.indexOf(" ",c);return a===-1?[f.slice(0,c),f.slice(c)]:[f.slice(0,a),f.slice(a+1)]},[x,w]=$(r),[S]=$(w.trimStart());return[x,S]},et=(r="",c,v="–")=>r?r.split(/\s+/).slice(0,c).join(" "):v,Pt=({data:r,getX:c,getY:v,isFullScreen:p,orientation:$,responsiveFontSize:x,onPointInteraction:w,clearActivePoint:S,activePoint:f,padding:a,chartHeight:F,chartWidth:T,temperatureField:m="temperature_chart",textRowHeight:u,compact:C=!1,reduceMotion:o=!1,showInterpretation:g=!1,ovulationDetails:k=null,firstHighIndex:Y=null,baselineIndices:n=[]})=>{const Q={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},Z={hidden:{opacity:0,scale:.3},visible:{opacity:1,scale:1,transition:{duration:.6,ease:[.34,1.56,.64,1],type:"spring",stiffness:120,damping:12}}},V=F-a.bottom,ve=V+u*1,d=V+u*2,H=V+u*3,G=V+u*(p?5:4.5),_=V+u*(p?7:6),pe=V+u*(p?9:7.5),xe=T-a.left-a.right,se=u*(p?2:1.5),me=o?"g":J.g,ce=Array.isArray(r)?r.length:0,Ie=b.useMemo(()=>Le(new Date),[]),Oe=b.useMemo(()=>{if(!g)return new Map;const s=Array.isArray(k==null?void 0:k.highSequenceIndices)?k.highSequenceIndices:[],L=new Map;return s.forEach((l,W)=>{const j=Number(l);Number.isInteger(j)&&j>=0&&j<ce&&!L.has(j)&&L.set(j,W+1)}),L},[g,k,ce]),ye=b.useMemo(()=>{if(!g)return new Map;const s=Array.isArray(n)?n:[];if(!s.length)return new Map;const L=new Set,l=[],W=O=>{const z=Number(O);Number.isInteger(z)&&z>=0&&z<ce&&!L.has(z)&&(L.add(z),l.push(z))};if(s.forEach(O=>{W(O)}),Y!=null){const O=Number(Y);Number.isInteger(O)&&W(O-1)}if(!l.length)return new Map;const j=[...l].sort((O,z)=>O-z),N=new Map;let U=1;for(let O=j.length-1;O>=0&&!(U>6);O-=1)N.set(j[O],U),U+=1;return N},[g,n,ce,Y]);return e.jsxs(e.Fragment,{children:[e.jsxs("defs",{children:[e.jsx("filter",{id:"rowShadowChart",x:"-10%",y:"-10%",width:"120%",height:"120%",children:e.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"4",floodColor:"rgba(244, 114, 182, 0.2)"})}),e.jsxs("filter",{id:"pointGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("radialGradient",{id:"tempPointGradientChart",cx:"30%",cy:"30%",children:[e.jsx("stop",{offset:"0%",stopColor:"#FCE7F3"}),e.jsx("stop",{offset:"40%",stopColor:"#F472B6"}),e.jsx("stop",{offset:"80%",stopColor:"#E91E63"}),e.jsx("stop",{offset:"100%",stopColor:"#C2185B"})]}),e.jsxs("radialGradient",{id:"tempPointIgnoredGradient",cx:"30%",cy:"30%",children:[e.jsx("stop",{offset:"0%",stopColor:"#FFFFFF"}),e.jsx("stop",{offset:"80%",stopColor:"#F8FAFC"}),e.jsx("stop",{offset:"100%",stopColor:"#E2E8F0"})]}),e.jsxs("radialGradient",{id:"ovulationPointGradient",cx:"30%",cy:"30%",children:[e.jsx("stop",{offset:"0%",stopColor:"#bfdbfe"}),e.jsx("stop",{offset:"45%",stopColor:"#60a5fa"}),e.jsx("stop",{offset:"85%",stopColor:"#2563eb"}),e.jsx("stop",{offset:"100%",stopColor:"#1d4ed8"})]})]}),!C&&e.jsxs("g",{children:[e.jsx("rect",{x:a.left,y:G-se/2,width:xe,height:se,fill:vt,fillOpacity:Ke,strokeWidth:1.5,rx:6,style:{filter:Xe}}),e.jsx("rect",{x:a.left,y:_-se/2,width:xe,height:se,fill:It,fillOpacity:Ke,strokeWidth:1.5,rx:6,style:{filter:Xe}}),e.jsx("rect",{x:a.left,y:pe-se/2,width:xe,height:se,fill:Ot,fillOpacity:Ke,strokeWidth:1.5,rx:6,style:{filter:Xe}})]}),p&&$!=="portrait"&&e.jsx(J.g,{variants:Q,children:[{label:"Fecha",row:1,color:p?"#374151":"#6B7280"},{label:"Día",row:2,color:p?"#374151":"#6B7280"},{label:"Símbolo",row:3,color:p?"#374151":"#6B7280"},{label:"Sens.",row:p?5:4.5,color:nt},{label:"Apar.",row:p?7:6,color:ot},{label:"Observ.",row:p?9:7.5,color:at}].map(({label:s,row:L,color:l})=>e.jsx("text",{x:a.left-x(.5),y:V+u*L,textAnchor:"end",fontSize:x(1.05),fontWeight:"700",fill:l,style:{filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:s},s))}),r.map((s,L)=>{const l=c(L),W=s[m]!=null?v(s[m]):V,j=s.temperature_raw,N=s.temperature_corrected,U=s.use_corrected&&j!=null&&N!=null&&Math.abs(N-j)>.01,O=U?v(j):null,z=p?"#374151":"#6B7280",ee=s[m]!=null;ee||s.mucus_sensation||s.mucus_appearance||s.fertility_symbol;const Me=String(s.id||"").startsWith("placeholder-"),we=k==null?void 0:k.peakDayIndex,R=g&&we!=null&&!s.ignored&&ee&&L===we,K=ut(s.fertility_symbol);let re="transparent";if(K!=null&&K.color){const X=K.color.replace(/^bg-/,"");X==="red-500"?re="#ef4444":X==="white"?re="#ffffff":X==="green-500"?re="#22c55e":X==="pink-300"?re="#f9a8d4":X==="yellow-400"&&(re="#facc15")}const ge=s.isoDate?pt(Le(Fe(s.isoDate)),Le(new Date)):!1,M=x(p?1.8:2),be=H-M*.75+M/2+2,te=s.peakStatus?String(s.peakStatus).toUpperCase():null,q=te==="P"||te==="X",je=te&&!q,ke=q?it:te||"–",ne=q||["1","2","3"].includes(te),t=!Me&&K.value!=="none",h=!!s.isoDate&&!ge?{pointerEvents:"all",style:{cursor:"pointer"},onClick:X=>w(s,L,X)}:{},E=(s.isoDate?xt(Fe(s.isoDate),Ie):!1)?Rt:z,I=Oe.has(L),Ee=I?Oe.get(L):null,oe=ye.has(L),de=oe?ye.get(L):null,B=x(p?.75:1.2),he=Math.max(.5,B*.18),Ce=W-B*(p?2.6:1.8),Ae=W+B*(p?1.9:1.6),Se=p?4:7,Ne=2,[Ye,Re]=Ze(p?et(s.mucus_sensation,Ne,ge?"":"–"):s.mucus_sensation,Se,!1,ge?"":"–"),[Ve,We]=Ze(p?et(s.mucus_appearance,Ne,ge?"":"–"):s.mucus_appearance,Se,!1,ge?"":"–"),[ze,Pe]=Ze(p?et(s.observations,Ne,""):s.observations,Se,!1,"");return e.jsxs(me,{...o?{}:{variants:Q},...h,children:[ee&&e.jsxs(me,{...o?{}:{variants:Z},children:[U&&O!==null&&e.jsxs("g",{pointerEvents:"none",children:[e.jsx("line",{x1:l,y1:O,x2:l,y2:W,stroke:At,strokeWidth:1,strokeDasharray:"4 4"}),e.jsx("circle",{cx:l,cy:O,r:3.5,fill:_t,stroke:Bt,strokeWidth:1}),e.jsx("circle",{cx:l,cy:O,r:1.2,fill:"rgba(255, 255, 255, 0.6)"})]}),e.jsx("circle",{cx:l,cy:W,r:R?2:1.5,fill:R?"rgba(59, 130, 246, 0.28)":"rgba(244, 114, 182, 0.2)",opacity:.85,style:{filter:"url(#pointGlow)"}}),e.jsx("circle",{cx:l,cy:W,r:R?4.2:3.5,fill:"none",stroke:s.ignored?"rgba(148, 163, 184, 0.4)":R?"rgba(37, 99, 235, 0.55)":"rgba(244, 114, 182, 0.3)",strokeWidth:R?2:1.5,opacity:R?.9:.6}),e.jsx("circle",{cx:l,cy:W,r:R?4.6:4,fill:s.ignored?"url(#tempPointIgnoredGradient)":R?"url(#ovulationPointGradient)":"url(#tempPointGradientChart)",stroke:s.use_corrected?"#941616":s.ignored?"#94A3B8":R?"#1d4ed8":"#E91E63",strokeWidth:s.ignored?2:R?3.2:3,style:{filter:R?"drop-shadow(0 3px 8px rgba(37, 99, 235, 0.45))":"drop-shadow(0 3px 6px rgba(244, 114, 182, 0.4))",cursor:"pointer"},pointerEvents:"all",onClick:X=>w(s,L,X)}),!s.ignored&&e.jsx("circle",{cx:l,cy:W,r:R?1.8:1.5,fill:R?"rgba(239, 246, 255, 0.95)":"rgba(255, 255, 255, 0.9)",style:{filter:R?"drop-shadow(0 1px 3px rgba(37, 99, 235, 0.45))":"drop-shadow(0 1px 2px rgba(244, 114, 182, 0.3))"}}),R&&e.jsx("circle",{cx:l,cy:W,r:6.5,fill:"none",stroke:"rgba(37, 99, 235, 0.35)",strokeWidth:1.2,strokeDasharray:"4 3"}),g&&ee&&!s.ignored&&I&&e.jsx("g",{pointerEvents:"none",children:e.jsx("text",{x:l,y:Ce,textAnchor:"middle",fontSize:B,fontWeight:"900",fill:Ft,strokeWidth:he,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',paintOrder:"stroke",filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:Ee})}),g&&ee&&!s.ignored&&oe&&e.jsx("g",{pointerEvents:"none",children:e.jsx("text",{x:l,y:Ae,textAnchor:"middle",fontSize:B,fontWeight:"800",fill:Nt,stroke:"#ffffff",strokeWidth:he,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',paintOrder:"stroke",filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.85))"},children:de})})]}),e.jsx("text",{x:l,y:ve,textAnchor:"middle",fontSize:x(1.05),fontWeight:"900",fill:E,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:Wt(s.date)}),e.jsx("text",{x:l,y:d,textAnchor:"middle",fontSize:x(1),fontWeight:"900",fill:E,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:s.cycleDay}),t?e.jsxs("g",{children:[e.jsx("rect",{x:l-M/2+1,y:H-M*.75+1,width:M,height:M,fill:"rgba(0, 0, 0, 0.1)",rx:M*.3,opacity:.5}),e.jsx("rect",{x:l-M/2-4,y:H-M*.75,width:M*1.4,height:M,fill:K.pattern==="spotting-pattern"?"url(#spotting-pattern-chart)":re,stroke:K.value==="white"?"#CBD5E1":"rgba(233, 30, 99, 0.4)",strokeWidth:K.value==="white"?2:1,rx:M*.2,style:{filter:"drop-shadow(0 2px 4px rgba(244, 114, 182, 0.25))"}}),te&&e.jsx("g",{pointerEvents:"none",children:q?e.jsx("text",{x:l,y:be,textAnchor:"middle",fontSize:x(1.35),fontWeight:"900",fill:Qe,stroke:"#fff",strokeWidth:1.5,paintOrder:"stroke",style:{filter:lt},children:it}):e.jsx("text",{x:l,y:be,textAnchor:"middle",fontSize:x(te?1.1:1),fontWeight:"800",fill:Je,style:{filter:"drop-shadow(0 1px 1px rgba(255,255,255,0.9))"},children:te})})]}):e.jsxs("g",{children:[ne&&e.jsx("rect",{x:l-M/2-4,y:H-M*.75,width:M*1.4,height:M,fill:"transparent",stroke:q?Qe:Je,strokeWidth:1,rx:M*.2}),e.jsx("text",{x:l,y:be,textAnchor:"middle",fontSize:x(q?1.35:je?1.1:1),fill:q?Qe:je?Je:z,fontWeight:q?"900":je?"800":"500",style:{filter:q?lt:je?"drop-shadow(0 1px 1px rgba(255,255,255,0.9))":"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:ke})]}),!C&&e.jsxs("text",{x:l,y:G,textAnchor:"middle",fontSize:x(.9),fontWeight:"700",fill:nt,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[e.jsx("tspan",{x:l,dy:0,children:Ye}),Re&&e.jsx("tspan",{x:l,dy:x(1.1),children:Re})]}),!C&&e.jsxs("text",{x:l,y:_,textAnchor:"middle",fontSize:x(.9),fontWeight:"700",fill:ot,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[e.jsx("tspan",{x:l,dy:0,children:Ve}),We&&e.jsx("tspan",{x:l,dy:x(1.1),children:We})]}),!C&&e.jsxs("text",{x:l,y:pe,textAnchor:"middle",fontSize:x(.9),fontWeight:"700",fill:at,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[e.jsx("tspan",{x:l,dy:0,children:ze}),Pe&&e.jsx("tspan",{x:l,dy:x(1.1),children:Pe})]})]},`pt-${L}-${s.isoDate||s.timestamp}`)})]})},Dt="#1565C0",$t="#2E7D32",Tt="#6A1B9A",Gt=({padding:r,chartHeight:c,tempMin:v,tempMax:p,tempRange:$,getY:x,responsiveFontSize:w,textRowHeight:S,isFullScreen:f})=>{const a={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},F=[];if($>0){const m=$<=2.5?.1:.5;for(let u=v;u<=p+1e-9;u+=m)F.push(parseFloat(u.toFixed(1)))}else for(let m=35.8;m<=37.2+1e-9;m+=.1)F.push(parseFloat(m.toFixed(1)));const T=c-r.bottom;return e.jsxs("svg",{width:r.left,height:c,className:"font-sans pointer-events-none",children:[e.jsx("defs",{children:e.jsx("filter",{id:"textShadowLegend",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodColor:"rgba(255, 255, 255, 0.9)"})})}),e.jsx("rect",{x:0,y:T+S*.5,width:r.left,height:S*(f?9.5:8),fill:"rgba(255, 255, 255, 0.3)",stroke:"rgba(255, 228, 230, 0.9)",strokeWidth:1,rx:12,style:{filter:"drop-shadow(0 1px 2px rgba(244, 63, 94, 0.08))"}}),F.map((m,u)=>{const C=x(m),o=m.toFixed(1).endsWith(".0")||m.toFixed(1).endsWith(".5"),g=o?m.toFixed(1):`.${m.toFixed(1).split(".")[1]}`;return e.jsx(J.g,{variants:a,children:e.jsx("text",{x:r.left-w(1.2),y:C+w(.35),textAnchor:"end",fontSize:w(o?1.15:1),fontWeight:o?"800":"700",fill:o?"#E91E63":"#EC4899",style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:g})},`temp-tick-fixed-${u}`)}),e.jsx(J.g,{variants:a,children:[{label:"Fecha",row:1,color:"#374151",icon:null},{label:"Día",row:2,color:"#374151",icon:null},{label:"Símbolo",row:3,color:"#374151",icon:null},{label:"Sens.",row:f?5:4.5,color:Dt,icon:"◊"},{label:"Apar.",row:f?7:6,color:$t,icon:"○"},{label:"Observ.",row:f?9:7.5,color:Tt,icon:"✦"}].map(({label:m,row:u,color:C,icon:o})=>e.jsxs("g",{children:[o&&e.jsx("text",{x:r.left-w(2.8),y:T+S*u,textAnchor:"middle",fontSize:w(.8),fontWeight:"600",fill:C,opacity:.7,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:o}),e.jsx("text",{x:r.left-w(.8),y:T+S*u,textAnchor:"end",fontSize:w(1.05),fontWeight:"800",fill:C,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:m})]},m))})]})},Ut=({data:r,isFullScreen:c,orientation:v,onToggleIgnore:p,onEdit:$,onTogglePeak:x,cycleId:w,initialScrollIndex:S=0,visibleDays:f=5,showInterpretation:a=!1,reduceMotion:F=!1,forceLandscape:T=!1,currentPeakIsoDate:m=null})=>{const{chartRef:u,tooltipRef:C,dimensions:o,activePoint:g,activeIndex:k,tooltipPosition:Y,allDataPoints:n,validDataForLine:Q,tempMin:Z,tempMax:V,tempRange:ve,padding:d,textRowHeight:H,getY:G,getX:_,handlePointInteraction:pe,handleToggleIgnore:xe,responsiveFontSize:se,clearActivePoint:me,baselineTemp:ce,baselineStartIndex:Ie,baselineIndices:Oe,firstHighIndex:ye,ovulationDetails:s,hasTemperatureData:L}=yt(r,c,v,p,w,f,T),l=b.useRef(null);if(!l.current){const y=Math.random().toString(36).slice(2,10);l.current=`fertility-chart-${w??"default"}-${y}`}const W=l.current;if(!n||n.length===0)return e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-pink-100 to-rose-100 rounded-full mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-pink-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),e.jsx("p",{className:"text-slate-400 font-medium",children:"No hay datos para mostrar en el gráfico"})]});const j=o.width,N=o.height,U=ce!=null?G(ce):null,O=!!(s!=null&&s.confirmed),z=ce!=null,ee=_(0),Me=n.length>0?_(n.length-1):j-d.right,we=O?"#F59E0B":"#94A3B8",R=O?"6 4":"4 4",K=O?1:.7,re=3,ge=j===0,M=k!=null?_(k):null,be=k!=null?k>0?_(k-1):M:null,te=k!=null?k<n.length-1?_(k+1):M:null,q=Math.max((j-d.left-d.right)/Math.max(n.length,1),0),je=k!=null?Math.max((te!=null&&be!=null?te-be:0)||q,q,0):0,ke=b.useMemo(()=>{const y=new Map;return Q.forEach(A=>{A&&A.id!=null&&y.set(A.id,A)}),y},[Q]),ne=b.useMemo(()=>s!=null&&s.confirmed&&Number.isFinite(s==null?void 0:s.infertileStartIndex)?s.infertileStartIndex:null,[s]),t=b.useMemo(()=>Number.isFinite(s==null?void 0:s.peakInfertilityStartIndex)?s.peakInfertilityStartIndex:null,[s]),i=b.useMemo(()=>ne==null||t==null?null:Math.max(ne,t),[ne,t]),h=Math.max(N-d.top-d.bottom,0),P=`${W}-temperature-below`,E=`${W}-temperature-above`,I=b.useCallback(y=>!Number.isFinite(y)||!n.length||y<=0?d.left:_(y),[n,_,d.left]),Ee=b.useCallback(y=>!Number.isFinite(y)||!n.length||y>=n.length-1?j-d.right:_(y+1),[n,j,_,d.right]),oe=b.useCallback((y,A,{inclusiveEnd:D=!0}={})=>{if(!Number.isFinite(y)||!Number.isFinite(A)||n.length===0)return null;const ae=le=>Math.max(0,Math.min(n.length-1,Math.floor(le))),fe=le=>Math.max(0,Math.min(n.length-1,Math.floor(le))),qe=le=>Math.max(0,Math.min(n.length,Math.floor(le))),_e=ae(y),ue=D?fe(A):qe(A),$e=_e<=0?d.left:I(_e);let ie;D?ie=ue>=n.length-1?j-d.right:Ee(ue):ue<=0?ie=d.left:ue>=n.length?ie=j-d.right:ie=I(ue);const Be=Math.max(ie-$e,0);return Be<=0?null:{x:$e,width:Be}},[n,j,I,Ee,d.left,d.right]),de=b.useMemo(()=>{if(!L||h<=0)return{below:null,above:null};const y=N-d.bottom,A=d.top,D=n.map((ie,Be)=>{const le=ie?ke.get(ie.id):null;return!le||!Number.isFinite(le.displayTemperature)?null:{index:Be,x:_(Be),y:G(le.displayTemperature)}}).filter(Boolean);if(!D.length)return{below:null,above:null};const ae=D[0],fe=D[D.length-1],qe=I(ae.index),_e=j-d.right,ue=[...D];ue[ue.length-1].x!==_e&&ue.push({index:fe.index,x:_e,y:fe.y});const $e=ie=>[`M ${qe} ${ie}`,`L ${ae.x} ${ae.y}`,...ue.slice(1).map(({x:le,y:ct})=>`L ${le} ${ct}`),`L ${_e} ${ie}`,"Z"].join(" ");return{below:$e(y),above:$e(A)}},[n,h,N,j,I,_,G,L,d.bottom,d.right,d.top,ke]),B=b.useMemo(()=>{if(!a||!(s!=null&&s.confirmed)||ne==null||h<=0)return null;const y=i==null,A=i??n.length-1;return A<ne?null:oe(ne,A,{inclusiveEnd:y})},[a,s,ne,h,i,n.length,oe]),he=b.useMemo(()=>{if(!a||t==null||h<=0)return null;const y=i==null,A=i??n.length-1;return A<t?null:oe(t,A,{inclusiveEnd:y})},[a,t,h,i,n.length,oe]),Ce=b.useMemo(()=>!a||i==null||h<=0?null:oe(i,n.length-1),[a,i,h,n.length,oe]),Ae=b.useMemo(()=>{if(!a||!(s!=null&&s.confirmed))return null;const y=Array.isArray(s==null?void 0:s.highSequenceIndices)?s.highSequenceIndices:[];if(y.length<2)return null;const A=y.map(D=>{if(D==null||D<0||D>=n.length)return null;const ae=n[D],fe=ke.get(ae==null?void 0:ae.id);return!fe||!Number.isFinite(fe.displayTemperature)?null:{x:_(D),y:G(fe.displayTemperature)}}).filter(Boolean);return A.length<2?null:A.map(({x:D,y:ae},fe)=>`${fe===0?"M":"L"} ${D} ${ae}`).join(" ")},[a,s,n,ke,_,G]),[Se,Ne]=b.useState({w:typeof window<"u"?window.innerWidth:0,h:typeof window<"u"?window.innerHeight:0}),Ye=Se.w<Se.h;b.useEffect(()=>{const y=()=>Ne({w:window.innerWidth,h:window.innerHeight});return window.addEventListener("resize",y),window.addEventListener("orientationchange",y),()=>{window.removeEventListener("resize",y),window.removeEventListener("orientationchange",y)}},[]),b.useEffect(()=>{if(!u.current)return;const y=u.current.clientWidth/f;u.current.scrollLeft=Math.max(0,y*S)},[S,f,o.width,v]);const Re=T&&Ye,Ve=Re,We="w-full h-full bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100",ze=c?`${We} min-h-full ${Ve?"flex items-stretch justify-start overflow-y-auto overflow-x-hidden":"flex items-center justify-start overflow-x-auto overflow-y-hidden"}`:`${We} overflow-x-auto overflow-y-hidden border border-pink-100/50`,Pe=!c||v==="portrait",X=14,st=`linear-gradient(to right, transparent, rgba(0,0,0,0.95) ${X}px, rgba(0,0,0,0.95) calc(100% - ${X}px), transparent)`,rt=`linear-gradient(to bottom, transparent, rgba(0,0,0,0.95) ${X}px, rgba(0,0,0,0.95) calc(100% - ${X}px), transparent)`,De={maskImage:`${st}, ${rt}`,maskMode:"alpha",maskRepeat:"no-repeat",maskSize:"100% 100%",maskComposite:"intersect",WebkitMaskImage:`${st}, ${rt}`,WebkitMaskRepeat:"no-repeat",WebkitMaskSize:"100% 100%",WebkitMaskComposite:"source-in"};return e.jsxs(J.div,{className:"relative w-full h-full",initial:!1,children:[Pe&&e.jsx("div",{className:"absolute left-0 top-0 h-full bg-transparent pointer-events-none z-10",style:{width:d.left},children:e.jsx(Gt,{padding:d,chartHeight:N,tempMin:Z,tempMax:V,tempRange:ve,getY:G,responsiveFontSize:se,textRowHeight:H,isFullScreen:c})}),e.jsxs(J.div,{ref:u,className:`relative p-0 ${c?"":"rounded-2xl"} ${ze}`,style:{boxShadow:c?"inset 0 1px 3px rgba(244, 114, 182, 0.1)":"0 8px 32px rgba(244, 114, 182, 0.12), 0 2px 8px rgba(244, 114, 182, 0.08)",...Re?{position:"absolute",top:0,left:0,width:`${Se.h}px`,height:`${Se.w}px`,transform:"rotate(90deg) translateY(-100%)",transformOrigin:"top left"}:{}},initial:!1,children:[ge&&e.jsx("div",{className:"flex items-center justify-center w-full h-full text-slate-400",children:"Cargando..."}),e.jsxs(J.svg,{width:j,height:N,className:"font-sans flex-shrink-0",viewBox:`0 0 ${j} ${N}`,preserveAspectRatio:"xMidYMid meet",initial:!1,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),e.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),e.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),e.jsxs("linearGradient",{id:"tempAreaGradientChart",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(244,114,182,0.25)"}),e.jsx("stop",{offset:"50%",stopColor:"rgba(236,72,153,0.15)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(233,30,99,0.05)"})]}),e.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[e.jsx("rect",{width:"6",height:"6",fill:"#ef4444"}),e.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(255,255,255,0.85)"})]}),e.jsxs("filter",{id:"chartShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("filter",{id:"baselineGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("pattern",{id:"temperatureInfertilityPattern",patternUnits:"userSpaceOnUse",width:"14",height:"14",children:[e.jsx("rect",{width:"14",height:"14",fill:"rgba(191, 219, 254, 0.45)"}),e.jsx("path",{d:"M0 0 L14 14",stroke:"rgba(59, 130, 246, 0.55)",strokeWidth:"1.4"}),e.jsx("path",{d:"M14 0 L0 14",stroke:"rgba(59, 130, 246, 0.55)",strokeWidth:"1.4"})]}),e.jsxs("pattern",{id:"peakInfertilityPattern",patternUnits:"userSpaceOnUse",width:"12",height:"12",children:[e.jsx("rect",{width:"12",height:"12",fill:"rgba(167, 243, 208, 0.42)"}),e.jsx("circle",{cx:"3",cy:"3",r:"1.7",fill:"rgba(13, 148, 136, 0.55)"}),e.jsx("circle",{cx:"9",cy:"9",r:"1.7",fill:"rgba(13, 148, 136, 0.55)"})]}),e.jsxs("pattern",{id:"absoluteInfertilityPattern",patternUnits:"userSpaceOnUse",width:"16",height:"16",children:[e.jsx("rect",{width:"16",height:"16",fill:"rgba(56, 189, 248, 0.45)"}),e.jsx("path",{d:"M0 0 L16 16",stroke:"rgba(13, 148, 136, 0.6)",strokeWidth:"1.2"}),e.jsx("path",{d:"M16 0 L0 16",stroke:"rgba(13, 148, 136, 0.6)",strokeWidth:"1.2"}),e.jsx("circle",{cx:"4",cy:"12",r:"1.6",fill:"rgba(19, 78, 74, 0.6)"}),e.jsx("circle",{cx:"12",cy:"4",r:"1.6",fill:"rgba(19, 78, 74, 0.6)"})]}),L&&de.below&&e.jsx("clipPath",{id:P,clipPathUnits:"userSpaceOnUse",children:e.jsx("path",{d:de.below})}),L&&de.above&&e.jsx("clipPath",{id:E,clipPathUnits:"userSpaceOnUse",children:e.jsx("path",{d:de.above})})]}),e.jsx("rect",{width:"100%",height:"100%",fill:"transparent"}),e.jsx(Lt,{padding:d,chartWidth:j,chartHeight:N,tempMin:Z,tempMax:V,tempRange:ve,getY:G,getX:_,allDataPoints:n,responsiveFontSize:se,isFullScreen:c,showLeftLabels:!Pe,reduceMotion:F}),a&&e.jsxs(e.Fragment,{children:[he&&(L&&de.below?e.jsx("rect",{x:he.x,y:d.top,width:he.width,height:h,fill:"url(#peakInfertilityPattern)",opacity:.75,pointerEvents:"none",clipPath:`url(#${P})`,style:De}):e.jsx("rect",{x:he.x,y:d.top,width:he.width,height:h,fill:"url(#peakInfertilityPattern)",opacity:.75,pointerEvents:"none",style:De})),B&&(L&&de.above?e.jsx("rect",{x:B.x,y:d.top,width:B.width,height:h,fill:"url(#temperatureInfertilityPattern)",opacity:.7,pointerEvents:"none",clipPath:`url(#${E})`,style:De}):e.jsx("rect",{x:B.x,y:d.top,width:B.width,height:h,fill:"url(#temperatureInfertilityPattern)",opacity:.7,pointerEvents:"none",style:De})),Ce&&e.jsx("rect",{x:Ce.x,y:d.top,width:Ce.width,height:h,fill:"url(#absoluteInfertilityPattern)",opacity:.5,pointerEvents:"none",style:De})]}),a&&z&&U!==null&&(F?e.jsx("line",{x1:ee,y1:U,x2:Me,y2:U,stroke:we,strokeWidth:re,strokeDasharray:R,opacity:K}):e.jsx(J.path,{d:`M ${ee} ${U} L ${Me} ${U}`,stroke:we,strokeWidth:re,strokeDasharray:R,opacity:K,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:K},transition:{duration:4,ease:"easeInOut",delay:.5}})),e.jsx(Mt,{data:Q,allDataPoints:n,getX:_,getY:G,baselineY:N-d.bottom,temperatureField:"displayTemperature",reduceMotion:F}),Ae&&e.jsx("path",{d:Ae,fill:"none",stroke:"#cc0e93",strokeWidth:6,strokeLinecap:"round",strokeLinejoin:"round",opacity:.85,style:{filter:"drop-shadow(0 2px 6px rgba(206, 14, 147, 0.4))"},pointerEvents:"none"}),k!==null&&M!==null&&je>0&&e.jsx("g",{pointerEvents:"none",children:(()=>{const y=N-d.bottom,A=Math.max(3,Math.min(14,je*.4)),D=Math.max(A*2,H*.85);return e.jsxs(e.Fragment,{children:[e.jsx("line",{x1:M,y1:0,x2:M,y2:y,stroke:"rgba(235, 171, 204,0.15)",strokeWidth:A}),e.jsx("line",{x1:M,y1:y,x2:M,y2:N,stroke:"rgba(235, 171, 204,0.15)",strokeWidth:D})]})})()}),e.jsx(Pt,{data:n,getX:_,getY:G,isFullScreen:c,orientation:v,responsiveFontSize:se,onPointInteraction:pe,clearActivePoint:me,activePoint:g,padding:d,chartHeight:N,chartWidth:j,temperatureField:"displayTemperature",textRowHeight:H,compact:!1,reduceMotion:F,showInterpretation:a,ovulationDetails:s,baselineStartIndex:Ie,firstHighIndex:ye,baselineIndices:Oe})]}),g&&e.jsx(J.div,{ref:C,initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:10},transition:{duration:.12,ease:"easeOut"},children:e.jsx(gt,{point:g,position:Y,chartWidth:j,chartHeight:N,onToggleIgnore:xe,onEdit:$,onClose:me,onTogglePeak:x,currentPeakIsoDate:m})})]})]})};function Yt(r,c){if(!r||!c)return[];const v=typeof r=="string"?Fe(r):r;return[...Array(c)].map((p,$)=>{const x=ht(v,$),w=Ue(x,"yyyy-MM-dd"),S=Ue(x,"dd/MM"),f=tt(Le(x),Le(v))+1;return{date:S,isoDate:w,cycleDay:f,temperature:null,mucusSensation:null,mucusAppearance:null,id:`placeholder-${w}`,ignored:!1,peak_marker:null}})}const ts=()=>{const{cycleId:r}=ft(),{currentCycle:c,archivedCycles:v,isLoading:p,addOrUpdateDataPoint:$,toggleIgnoreRecord:x,getCycleById:w}=bt(),[S,f]=b.useState(null),[a,F]=b.useState(!1),[T,m]=b.useState(!1),u=!r||r===c.id,C=u?null:v.find(t=>t.id===r);b.useEffect(()=>{if(u){f(null),F(!1),m(!1);return}if(C){f(null),F(!1),m(!1);return}let t=!0;return F(!0),w(r).then(i=>{t&&(i?(f(i),m(!1)):(f(null),m(!0)))}).catch(()=>{t&&(f(null),m(!0))}).finally(()=>{t&&F(!1)}),()=>{t=!1}},[u,C,w,r]);const o=u?c:C||S,g=!u&&!C,k=!u&&(o==null?void 0:o.id),Y=u?p&&!(c!=null&&c.id):a||p&&!C&&!S,[n,Q]=b.useState(typeof window<"u"&&window.innerWidth>window.innerHeight?"landscape":"portrait"),[Z,V]=b.useState(!1),[ve,d]=b.useState(!1),[H,G]=b.useState(null),[_,pe]=b.useState(!1),[xe,se]=b.useState(!1),me=b.useRef(!1),ce=!!(H&&String(H.id||"").startsWith("placeholder-"));if(b.useEffect(()=>{const t=async()=>{var h,P;const i=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement);if(V(i),!i){try{const E=typeof window<"u"?(h=window.screen)==null?void 0:h.orientation:null;await((P=E==null?void 0:E.unlock)==null?void 0:P.call(E))}catch{}Q("portrait")}};return document.addEventListener("fullscreenchange",t),document.addEventListener("webkitfullscreenchange",t),document.addEventListener("mozfullscreenchange",t),document.addEventListener("MSFullscreenChange",t),()=>{document.removeEventListener("fullscreenchange",t),document.removeEventListener("webkitfullscreenchange",t),document.removeEventListener("mozfullscreenchange",t),document.removeEventListener("MSFullscreenChange",t)}},[]),b.useLayoutEffect(()=>{window.dispatchEvent(new Event("resize"))},[n,Z]),Y)return e.jsx(Ge,{children:e.jsx("div",{className:"flex h-full flex-col items-center justify-center space-y-4 bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100 px-4 py-8 text-center text-pink-600",children:e.jsx("p",{children:"Cargando…"})})});if(!(o!=null&&o.id))return r&&T?e.jsx(Ge,{children:e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 px-4 py-8 text-center text-pink-600",children:[e.jsx("p",{children:"No se encontró el ciclo solicitado."}),e.jsx(Te,{asChild:!0,className:"bg-gradient-to-r from-pink-500 to-rose-500 text-white shadow",children:e.jsx(He,{to:"/archived-cycles",children:"Volver a Mis Ciclos"})})]})}):e.jsx(Ge,{children:e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 px-4 py-8 text-center text-pink-600",children:[e.jsx("p",{children:"No hay ciclo activo."}),e.jsx(Te,{asChild:!0,className:"bg-gradient-to-r from-pink-500 to-rose-500 text-white shadow",children:e.jsx(He,{to:"/records",children:"Ir a Mis Registros"})})]})});const Ie=28,Oe=10,ye=Fe(o.startDate),s=o.data||[],L=b.useMemo(()=>{const t=Array.isArray(s)?s.find(i=>(i==null?void 0:i.peak_marker)==="peak"):null;return(t==null?void 0:t.isoDate)||null},[s]),l=s.reduce((t,i)=>{const h=Fe(i.isoDate);return h>t?h:t},ye),W=Le(new Date),j=l>W?l:W,N=tt(Le(j),ye),U=Math.max(Ie,N+1),z=Yt(ye,U).map(t=>{const i=s.find(h=>h.isoDate===t.isoDate);return i?{...i,date:t.date}:t}),ee=n==="portrait"?Oe:Ie;let Me=0;if(n!=="landscape"){const t=tt(new Date,Le(ye)),i=Math.min(Math.max(t,0),U-1);let h=Math.min(U,i+1);i<ee-1&&(h=Math.min(U,ee)),Me=Math.max(0,h-ee)}const we={background:"linear-gradient(135deg, #FFFAFC 0%, #f7eaef 100%)"},R=Z?we:{...we,height:n==="landscape"?"calc(min(100dvh, 100dvw) - var(--bottom-nav-safe))":"calc(100dvh - var(--bottom-nav-safe))",maxHeight:"100vh",paddingBottom:"env(safe-area-inset-bottom)"},K=t=>{G(t),d(!0)},re=async(t,i)=>{try{if(await x(t,i),g){const h=await w(t);h&&f(h)}}catch(h){console.error("Error toggling ignore state:",h)}},ge=async(t,i=!0)=>{if(!(o!=null&&o.id)||!(t!=null&&t.isoDate))return;const h=E=>{if(E==null||E==="")return null;const I=parseFloat(String(E).replace(",","."));return Number.isFinite(I)?I:null},P=i??!(t.peak_marker==="peak"||t.peakStatus==="P");pe(!0);try{const E=t.timestamp?Ue(Fe(t.timestamp),"HH:mm"):Ue(new Date,"HH:mm");let I=Array.isArray(t.measurements)&&t.measurements.length>0?t.measurements:[{temperature:t.temperature_chart??t.temperature_raw??null,temperature_corrected:t.temperature_corrected??null,time:E,time_corrected:t.time_corrected??E,selected:!0,use_corrected:t.use_corrected??!1}];I.length===0&&(I=[{temperature:null,temperature_corrected:null,time:E,time_corrected:E,selected:!0,use_corrected:!1}]);const Ee=I.map((B,he)=>{const Ce=B.time||E,Ae=B.time_corrected||Ce;return{temperature:h(B.temperature??B.temperature_raw),time:Ce,selected:he===0?!0:!!B.selected,temperature_corrected:h(B.temperature_corrected),time_corrected:Ae,use_corrected:!!B.use_corrected}});Ee.some(B=>B.selected)||(Ee[0].selected=!0);const oe={isoDate:t.isoDate,measurements:Ee,mucusSensation:t.mucus_sensation??t.mucusSensation??"",mucusAppearance:t.mucus_appearance??t.mucusAppearance??"",fertility_symbol:t.fertility_symbol??"none",observations:t.observations??"",ignored:t.ignored??!1,peak_marker:P?"peak":null},de=t!=null&&t.id&&!String(t.id).startsWith("placeholder-")?t:null;await $(oe,de,o.id)}catch(E){console.error("Error toggling peak marker:",E)}finally{pe(!1)}},M=async(t,{keepFormOpen:i=!1}={})=>{if(o!=null&&o.id){pe(!0);try{if(await $(t,H,o.id),g){const h=await w(o.id);h&&f(h)}i||(d(!1),G(null))}finally{pe(!1)}}},be=()=>{d(!1),G(null)},te=t=>{G(t)},q=()=>{se(t=>!t)},je=t=>{if(t.preventDefault(),me.current){me.current=!1;return}q()},ke=t=>{t.pointerType==="touch"&&(t.preventDefault(),me.current=!0,q())},ne=async()=>{var h;const t=document.documentElement,i=typeof window<"u"?(h=window.screen)==null?void 0:h.orientation:null;if(Z){if(i!=null&&i.unlock)try{await i.unlock()}catch(P){console.error(P)}try{const P=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen,E=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;P&&E&&await P.call(document)}catch(P){console.error(P)}Q("portrait"),V(!1)}else{let P=!1,E=!1;try{const I=t.requestFullscreen||t.webkitRequestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen;E=!!I,I&&(await I.call(t),P=!0)}catch(I){console.error(I)}if(i!=null&&i.lock)try{await i.lock("landscape")}catch(I){console.error(I)}Q("landscape"),V(P||!E)}};return e.jsx(Ge,{hideBottomNav:Z,children:e.jsxs("div",{className:Z?"fixed inset-0 z-50 h-[100dvh] w-[100dvw] overflow-x-auto overflow-y-auto":"relative w-full overflow-x-auto overflow-y-auto",style:R,children:[k&&!Z&&e.jsx(Te,{asChild:!0,variant:"ghost",className:"absolute top-4 left-4 z-10 bg-white/80 text-slate-700 hover:bg-[#E27DBF]/20",children:e.jsxs(He,{to:`/cycle/${o.id}`,className:"flex items-center gap-1",children:[e.jsx(kt,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline"})]})}),e.jsx(Te,{onClick:je,onPointerUp:ke,variant:"ghost",size:"icon",className:`absolute top-4 right-20 z-10 p-2 rounded-full transition-colors ${xe?"bg-[#E27DBF] text-white hover:bg-[#d46ab3]":"bg-white/80 text-slate-700 hover:bg-[#E27DBF]/20"}`,children:xe?e.jsx(Et,{className:"h-4 w-4"}):e.jsx(Ct,{className:"h-4 w-4"})}),e.jsx(Te,{onClick:ne,className:"absolute top-4 right-4 z-10 bg-white/80 hover:bg-white text-gray-700 p-2 rounded-full shadow","aria-label":Z?"Salir de pantalla completa":"Rotar gráfico",children:e.jsx(St,{className:"w-5 h-5"})}),e.jsx(Ut,{data:z,isFullScreen:Z,orientation:n,onToggleIgnore:re,onEdit:K,onTogglePeak:ge,cycleId:o.id,initialScrollIndex:Me,visibleDays:ee,showInterpretation:xe,reduceMotion:!0,forceLandscape:n==="landscape",currentPeakIsoDate:L}),e.jsx(jt,{open:ve,onOpenChange:t=>{t||be()},children:e.jsx(wt,{hideClose:!0,className:"bg-transparent border-none p-0 text-gray-800 w-[90vw] sm:w-auto max-w-md sm:max-w-lg md:max-w-xl max-h-[85vh] overflow-y-auto",children:e.jsx(mt,{onSubmit:M,onCancel:be,initialData:H,cycleStartDate:o.startDate,cycleEndDate:o.endDate,isProcessing:_,isEditing:!!H&&!ce,cycleData:o.data,onDateSelect:te})})})]})})};export{ts as default};
