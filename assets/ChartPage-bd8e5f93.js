import{c as dt,m as de,j as e,r as x,s as Ae,p as De,D as ht,e as ut,f as Ue,d as tt,h as ft,M as $e,B as Ge,L as Ve}from"./index-c55d5272.js";import{g as pt,i as xt,f as mt,c as gt,D as yt}from"./computePeakStatuses-31c2acae.js";import{C as bt}from"./ChartTooltip-eaa4a487.js";import{u as wt,D as jt,a as kt}from"./useCycleData-5dcb71a4.js";import{A as St}from"./arrow-left-b07553e7.js";import{E as Ct,a as It}from"./eye-eb92638a.js";import"./input-e74c5c89.js";import"./label-43470110.js";import"./checkbox-423022af.js";import"./badge-537eb28b.js";const Et=dt("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),Mt=({padding:s,chartWidth:d,chartHeight:R,tempMin:L,tempMax:Q,tempRange:I,getY:v,getX:b,allDataPoints:m=[],responsiveFontSize:h,isFullScreen:Y,showLeftLabels:H=!1,reduceMotion:k=!1})=>{const C={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.3,ease:"easeOut"}}},D=[];if(I>0){const i=I<=2.5?.1:.5;for(let u=L;u<=Q+1e-9;u+=i)D.push(parseFloat(u.toFixed(1)))}else for(let i=35.8;i<=37.2+1e-9;i+=.1)D.push(parseFloat(i.toFixed(1)));const o=k?"g":de.g;return e.jsxs(e.Fragment,{children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"bgGradientChart",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(254, 242, 242, 0.95)"}),e.jsx("stop",{offset:"30%",stopColor:"rgba(255, 241, 242, 0.9)"}),e.jsx("stop",{offset:"70%",stopColor:"rgba(255, 245, 255, 0.95)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(254, 242, 242, 0.8)"})]}),e.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),e.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),e.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),e.jsxs("filter",{id:"chartGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsx("filter",{id:"textShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodColor:"rgba(255, 255, 255, 0.8)"})}),e.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[e.jsx("rect",{width:"6",height:"6",fill:"#ef4444"}),e.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(255,255,255,0.85)"})]})]}),e.jsx("rect",{x:s.left,y:s.top,width:d-s.left-s.right,height:R-s.top-s.bottom,fill:"url(#bgGradientChart)",opacity:2,rx:12,style:{filter:"drop-shadow(0 4px 12px rgba(244, 114, 182, 0.1))"}}),D.map((i,u)=>{const w=v(i),n=i.toFixed(1).endsWith(".0")||i.toFixed(1).endsWith(".5"),F=n?i.toFixed(1):`.${i.toFixed(1).split(".")[1]}`;return e.jsxs(o,{...k?{}:{variants:C},children:[e.jsx("line",{x1:s.left,y1:w,x2:d-s.right,y2:w,stroke:n?"rgba(244, 114, 182, 0.3)":"rgba(244, 114, 182, 0.15)",strokeWidth:n?3:2,strokeDasharray:n?"0":"4,4",style:{filter:n?"drop-shadow(0 1px 3px rgba(244, 114, 182, 0.15))":"none",opacity:n?1:.7}}),H&&e.jsx("text",{x:s.left-h(1),y:w+h(.35),textAnchor:"end",fontSize:h(n?1.1:1),fontWeight:n?"700":"600",fill:n?"#E91E63":"#EC4899",style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:F}),e.jsx("text",{x:d-s.right+h(1),y:w+h(.35),textAnchor:"start",fontSize:h(n?1.1:1),fontWeight:n?"700":"600",fill:n?"#E91E63":"#EC4899",style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:F})]},`temp-tick-${u}`)}),m.map((i,u)=>{const w=b(u);return e.jsx("line",{x1:w,y1:s.top,x2:w,y2:R-s.bottom,stroke:"rgba(244, 114, 182, 0.08)",strokeWidth:2.8,style:{filter:"drop-shadow(0 0 1px rgba(244, 114, 182, 0.05))"}},`day-grid-${u}`)}),e.jsx("rect",{x:s.left,y:s.top,width:d-s.left-s.right,height:R-s.top-s.bottom,fill:"none",stroke:"rgba(244, 114, 182, 0.4)",strokeWidth:4,rx:8,style:{filter:"drop-shadow(0 4px 12px rgba(244, 114, 182, 0.15))",strokeDasharray:"0"}}),H&&e.jsx(o,{...k?{}:{variants:C},children:e.jsx("text",{x:s.left+h(1.2),y:s.top+h(1.5),textAnchor:"middle",fontSize:h(1.4),fontWeight:"800",fill:"#E91E63",style:{filter:"url(#textShadow)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:"°C"})})]})},vt=({data:s,allDataPoints:d,getX:R,getY:L,baselineY:Q,temperatureField:I="temperature",reduceMotion:v=!1})=>{if(!s||s.length<2)return null;let b="",m=null;const h=[];if(d.forEach((k,C)=>{const D=s.find(o=>o.id===k.id);if(D&&D[I]!==null&&D[I]!==void 0&&!D.ignored){const o=R(C),i=L(D[I]);h.push({x:o,y:i}),m!==null&&C===m+1?b+=` L ${o} ${i}`:b+=`${b?" ":""}M ${o} ${i}`,m=C}}),h.length<2)return null;const Y=b.includes("L"),H=h.length>1?h.map(({x:k,y:C},D)=>`${D===0?"M":"L"} ${k} ${C}`).join(" "):"";return e.jsxs(e.Fragment,{children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),e.jsx("stop",{offset:"30%",stopColor:"#EC4899"}),e.jsx("stop",{offset:"70%",stopColor:"#E91E63"}),e.jsx("stop",{offset:"100%",stopColor:"#C2185B"})]}),e.jsxs("linearGradient",{id:"tempLineGradientChartGlow",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(244, 114, 182, 0.6)"}),e.jsx("stop",{offset:"30%",stopColor:"rgba(236, 72, 153, 0.7)"}),e.jsx("stop",{offset:"70%",stopColor:"rgba(233, 30, 99, 0.8)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(194, 24, 91, 0.6)"})]}),e.jsxs("filter",{id:"lineGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"4",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsx("filter",{id:"lineShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"3",floodColor:"rgba(244, 114, 182, 0.4)"})})]}),Y&&(v?e.jsx("path",{d:b,fill:"none",stroke:"url(#tempLineGradientChartGlow)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:.4,style:{filter:"url(#lineGlow)"}}):e.jsx(de.path,{d:b,fill:"none",stroke:"url(#tempLineGradientChartGlow)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",opacity:.4,style:{filter:"url(#lineGlow)"},initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.4},transition:{duration:.8,ease:"easeInOut",delay:.2}})),H&&(v?e.jsx("path",{d:H,fill:"none",stroke:"#d587b1",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.65}):e.jsx(de.path,{d:H,fill:"none",stroke:"#d587b1",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.65,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.65},transition:{duration:.8,ease:"easeInOut"}})),Y&&(v?e.jsx("path",{d:b,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#lineShadow)"}}):e.jsx(de.path,{d:b,fill:"none",stroke:"url(#tempLineGradientChart)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#lineShadow)"},initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:1},transition:{duration:1,ease:"easeInOut",delay:.4}})),Y&&(v?e.jsx("path",{d:b,fill:"none",stroke:"rgba(255, 255, 255, 0.6)",strokeWidth:"0.3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.8}):e.jsx(de.path,{d:b,fill:"none",stroke:"rgba(255, 255, 255, 0.6)",strokeWidth:"0.3",strokeLinecap:"round",strokeLinejoin:"round",opacity:.8,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:.8},transition:{duration:1.2,ease:"easeInOut",delay:.6}}))]})},st="#1565C0",ot="#2E7D32",it="#6A1B9A",Lt="#EFF6FF",At="#EEF2FF",Dt="#ECFDF5",Ft="#F0FDFA",Bt="#F5F3FF",Pt="#FAF5FF",Rt="rgba(148, 163, 184, 0.35)",Tt="rgba(226, 232, 240, 0.6)",Nt="rgba(148, 163, 184, 0.5)",lt="✖",Xe="#7f1d1d",Ke="#ec4899",at="drop-shadow(0 2px 4px rgba(244, 114, 182, 0.35))",_t="#be185d",Wt="#2563eb",Ot="#be185d",Gt=s=>{if(!s)return"";const[d,R]=s.split("/");return`${parseInt(d,10)}/${parseInt(R,10)}`},Je=(s="",d,R,L="–")=>{if(!s)return[L,""];if(s.length<=d)return[s,""];if(R){const m=s.slice(0,d),h=s.slice(d,d*2);return[m,h]}const Q=m=>{if(!m)return["",""];if(m.length<=d)return[m,""];const h=m.indexOf(" ",d);return h===-1?[m.slice(0,d),m.slice(d)]:[m.slice(0,h),m.slice(h+1)]},[I,v]=Q(s),[b]=Q(v.trimStart());return[I,b]},Qe=(s="",d,R="–")=>s?s.split(/\s+/).slice(0,d).join(" "):R,$t=({data:s,getX:d,getY:R,isFullScreen:L,orientation:Q,responsiveFontSize:I,onPointInteraction:v,clearActivePoint:b,activePoint:m,padding:h,chartHeight:Y,chartWidth:H,temperatureField:k="temperature_chart",textRowHeight:C,compact:D=!1,reduceMotion:o=!1,showInterpretation:i=!1,ovulationDetails:u=null,firstHighIndex:w=null,baselineIndices:n=[]})=>{const F={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},E={hidden:{opacity:0,scale:.3},visible:{opacity:1,scale:1,transition:{duration:.6,ease:[.34,1.56,.64,1],type:"spring",stiffness:120,damping:12}}},$=Y-h.bottom,ee=$+C*1,g=$+C*2,X=$+C*3,B=$+C*(L?5:4.5),U=$+C*(L?7:6),ie=$+C*(L?9:7.5),fe=H-h.left-h.right,ae=C*(L?2:1.5),he=o?"g":de.g,ue=Array.isArray(s)?s.length:0,je=x.useMemo(()=>Ae(new Date),[]),xe=x.useMemo(()=>{if(!i)return new Map;const r=Array.isArray(u==null?void 0:u.highSequenceIndices)?u.highSequenceIndices:[],N=new Map;return r.forEach((y,W)=>{const T=Number(y);Number.isInteger(T)&&T>=0&&T<ue&&!N.has(T)&&N.set(T,W+1)}),N},[i,u,ue]),se=x.useMemo(()=>{if(!i)return new Map;const r=Array.isArray(n)?n:[];if(!r.length)return new Map;const N=new Set,y=[],W=z=>{const te=Number(z);Number.isInteger(te)&&te>=0&&te<ue&&!N.has(te)&&(N.add(te),y.push(te))};if(r.forEach(z=>{W(z)}),w!=null){const z=Number(w);Number.isInteger(z)&&W(z-1)}if(!y.length)return new Map;const T=[...y].sort((z,te)=>z-te),K=new Map;let O=1;for(let z=T.length-1;z>=0&&!(O>6);z-=1)K.set(T[z],O),O+=1;return K},[i,n,ue,w]);return e.jsxs(e.Fragment,{children:[e.jsxs("defs",{children:[e.jsx("filter",{id:"rowShadowChart",x:"-10%",y:"-10%",width:"120%",height:"120%",children:e.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"4",floodColor:"rgba(244, 114, 182, 0.2)"})}),e.jsxs("filter",{id:"pointGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("linearGradient",{id:"sensationGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:Lt}),e.jsx("stop",{offset:"100%",stopColor:At})]}),e.jsxs("linearGradient",{id:"appearanceGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:Dt}),e.jsx("stop",{offset:"100%",stopColor:Ft})]}),e.jsxs("linearGradient",{id:"observationGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:Bt}),e.jsx("stop",{offset:"100%",stopColor:Pt})]}),e.jsxs("radialGradient",{id:"tempPointGradientChart",cx:"30%",cy:"30%",children:[e.jsx("stop",{offset:"0%",stopColor:"#FCE7F3"}),e.jsx("stop",{offset:"40%",stopColor:"#F472B6"}),e.jsx("stop",{offset:"80%",stopColor:"#E91E63"}),e.jsx("stop",{offset:"100%",stopColor:"#C2185B"})]}),e.jsxs("radialGradient",{id:"tempPointIgnoredGradient",cx:"30%",cy:"30%",children:[e.jsx("stop",{offset:"0%",stopColor:"#FFFFFF"}),e.jsx("stop",{offset:"80%",stopColor:"#F8FAFC"}),e.jsx("stop",{offset:"100%",stopColor:"#E2E8F0"})]}),e.jsxs("radialGradient",{id:"ovulationPointGradient",cx:"30%",cy:"30%",children:[e.jsx("stop",{offset:"0%",stopColor:"#bfdbfe"}),e.jsx("stop",{offset:"45%",stopColor:"#60a5fa"}),e.jsx("stop",{offset:"85%",stopColor:"#2563eb"}),e.jsx("stop",{offset:"100%",stopColor:"#1d4ed8"})]})]}),!D&&e.jsxs("g",{children:[e.jsx("rect",{x:h.left,y:B-ae/2,width:fe,height:ae,fill:"url(#sensationGradientChart)",rx:4,style:{filter:"url(#rowShadowChart)"}}),e.jsx("rect",{x:h.left,y:U-ae/2,width:fe,height:ae,fill:"url(#appearanceGradientChart)",rx:4,style:{filter:"url(#rowShadowChart)"}}),e.jsx("rect",{x:h.left,y:ie-ae/2,width:fe,height:ae,fill:"url(#observationGradientChart)",rx:4,style:{filter:"url(#rowShadowChart)"}})]}),L&&Q!=="portrait"&&e.jsx(de.g,{variants:F,children:[{label:"Fecha",row:1,color:L?"#374151":"#6B7280"},{label:"Día",row:2,color:L?"#374151":"#6B7280"},{label:"Símbolo",row:3,color:L?"#374151":"#6B7280"},{label:"Sens.",row:L?5:4.5,color:st},{label:"Apar.",row:L?7:6,color:ot},{label:"Observ.",row:L?9:7.5,color:it}].map(({label:r,row:N,color:y})=>e.jsx("text",{x:h.left-I(.5),y:$+C*N,textAnchor:"end",fontSize:I(1.05),fontWeight:"700",fill:y,style:{filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:r},r))}),s.map((r,N)=>{const y=d(N),W=r[k]!=null?R(r[k]):$,T=r.temperature_raw,K=r.temperature_corrected,O=r.use_corrected&&T!=null&&K!=null&&Math.abs(K-T)>.01,z=O?R(T):null,te=L?"#374151":"#6B7280",le=r[k]!=null;le||r.mucus_sensation||r.mucus_appearance||r.fertility_symbol;const Ee=String(r.id||"").startsWith("placeholder-"),a=u==null?void 0:u.peakDayIndex,c=i&&a!=null&&!r.ignored&&le&&N===a,l=pt(r.fertility_symbol);let A="transparent";if(l!=null&&l.color){const ce=l.color.replace(/^bg-/,"");ce==="red-500"?A="#ef4444":ce==="white"?A="#ffffff":ce==="green-500"?A="#22c55e":ce==="pink-300"?A="#f9a8d4":ce==="yellow-400"&&(A="#facc15")}const f=r.isoDate?xt(Ae(De(r.isoDate)),Ae(new Date)):!1,p=I(L?1.8:2),G=X-p*.75+p/2+2,q=r.peakStatus?String(r.peakStatus).toUpperCase():null,S=q==="P"||q==="X",oe=q&&!S,me=S?lt:q||"–",pe=S||["1","2","3"].includes(q),t=!Ee&&l.value!=="none",M=!!r.isoDate&&!f?{pointerEvents:"all",style:{cursor:"pointer"},onClick:ce=>v(r,N,ce)}:{},_=(r.isoDate?mt(De(r.isoDate),je):!1)?Ot:te,V=xe.has(N),Me=V?xe.get(N):null,ge=se.has(N),ke=ge?se.get(N):null,Z=I(L?.75:1.2),Se=Math.max(.5,Z*.18),ve=W-Z*(L?2.6:1.8),Fe=W+Z*(L?1.9:1.6),Le=L?4:7,Re=2,[qe,Te]=Je(L?Qe(r.mucus_sensation,Re,f?"":"–"):r.mucus_sensation,Le,!1,f?"":"–"),[Ye,Ne]=Je(L?Qe(r.mucus_appearance,Re,f?"":"–"):r.mucus_appearance,Le,!1,f?"":"–"),[ze,_e]=Je(L?Qe(r.observations,Re,""):r.observations,Le,!1,"");return e.jsxs(he,{...o?{}:{variants:F},...M,children:[le&&e.jsxs(he,{...o?{}:{variants:E},children:[O&&z!==null&&e.jsxs("g",{pointerEvents:"none",children:[e.jsx("line",{x1:y,y1:z,x2:y,y2:W,stroke:Rt,strokeWidth:1,strokeDasharray:"4 4"}),e.jsx("circle",{cx:y,cy:z,r:3.5,fill:Tt,stroke:Nt,strokeWidth:1}),e.jsx("circle",{cx:y,cy:z,r:1.2,fill:"rgba(255, 255, 255, 0.6)"})]}),e.jsx("circle",{cx:y,cy:W,r:c?2:1.5,fill:c?"rgba(59, 130, 246, 0.28)":"rgba(244, 114, 182, 0.2)",opacity:.85,style:{filter:"url(#pointGlow)"}}),e.jsx("circle",{cx:y,cy:W,r:c?4.2:3.5,fill:"none",stroke:r.ignored?"rgba(148, 163, 184, 0.4)":c?"rgba(37, 99, 235, 0.55)":"rgba(244, 114, 182, 0.3)",strokeWidth:c?2:1.5,opacity:c?.9:.6}),e.jsx("circle",{cx:y,cy:W,r:c?4.6:4,fill:r.ignored?"url(#tempPointIgnoredGradient)":c?"url(#ovulationPointGradient)":"url(#tempPointGradientChart)",stroke:r.use_corrected?"#941616":r.ignored?"#94A3B8":c?"#1d4ed8":"#E91E63",strokeWidth:r.ignored?2:c?3.2:3,style:{filter:c?"drop-shadow(0 3px 8px rgba(37, 99, 235, 0.45))":"drop-shadow(0 3px 6px rgba(244, 114, 182, 0.4))",cursor:"pointer"},pointerEvents:"all",onClick:ce=>v(r,N,ce)}),!r.ignored&&e.jsx("circle",{cx:y,cy:W,r:c?1.8:1.5,fill:c?"rgba(239, 246, 255, 0.95)":"rgba(255, 255, 255, 0.9)",style:{filter:c?"drop-shadow(0 1px 3px rgba(37, 99, 235, 0.45))":"drop-shadow(0 1px 2px rgba(244, 114, 182, 0.3))"}}),c&&e.jsx("circle",{cx:y,cy:W,r:6.5,fill:"none",stroke:"rgba(37, 99, 235, 0.35)",strokeWidth:1.2,strokeDasharray:"4 3"}),i&&le&&!r.ignored&&V&&e.jsx("g",{pointerEvents:"none",children:e.jsx("text",{x:y,y:ve,textAnchor:"middle",fontSize:Z,fontWeight:"900",fill:_t,strokeWidth:Se,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',paintOrder:"stroke",filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:Me})}),i&&le&&!r.ignored&&ge&&e.jsx("g",{pointerEvents:"none",children:e.jsx("text",{x:y,y:Fe,textAnchor:"middle",fontSize:Z,fontWeight:"800",fill:Wt,stroke:"#ffffff",strokeWidth:Se,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',paintOrder:"stroke",filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.85))"},children:ke})})]}),e.jsx("text",{x:y,y:ee,textAnchor:"middle",fontSize:I(1.05),fontWeight:"900",fill:_,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:Gt(r.date)}),e.jsx("text",{x:y,y:g,textAnchor:"middle",fontSize:I(1),fontWeight:"900",fill:_,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:r.cycleDay}),t?e.jsxs("g",{children:[e.jsx("rect",{x:y-p/2+1,y:X-p*.75+1,width:p,height:p,fill:"rgba(0, 0, 0, 0.1)",rx:p*.3,opacity:.5}),e.jsx("rect",{x:y-p/2-4,y:X-p*.75,width:p*1.4,height:p,fill:l.pattern==="spotting-pattern"?"url(#spotting-pattern-chart)":A,stroke:l.value==="white"?"#CBD5E1":"rgba(233, 30, 99, 0.4)",strokeWidth:l.value==="white"?2:1,rx:p*.2,style:{filter:"drop-shadow(0 2px 4px rgba(244, 114, 182, 0.25))"}}),q&&e.jsx("g",{pointerEvents:"none",children:S?e.jsx("text",{x:y,y:G,textAnchor:"middle",fontSize:I(1.35),fontWeight:"900",fill:Ke,stroke:"#fff",strokeWidth:1.5,paintOrder:"stroke",style:{filter:at},children:lt}):e.jsx("text",{x:y,y:G,textAnchor:"middle",fontSize:I(q?1.1:1),fontWeight:"800",fill:Xe,style:{filter:"drop-shadow(0 1px 1px rgba(255,255,255,0.9))"},children:q})})]}):e.jsxs("g",{children:[pe&&e.jsx("rect",{x:y-p/2-4,y:X-p*.75,width:p*1.4,height:p,fill:"transparent",stroke:S?Ke:Xe,strokeWidth:1,rx:p*.2}),e.jsx("text",{x:y,y:G,textAnchor:"middle",fontSize:I(S?1.35:oe?1.1:1),fill:S?Ke:oe?Xe:te,fontWeight:S?"900":oe?"800":"500",style:{filter:S?at:oe?"drop-shadow(0 1px 1px rgba(255,255,255,0.9))":"drop-shadow(0 1px 1px rgba(255, 255, 255, 0.8))"},children:me})]}),!D&&e.jsxs("text",{x:y,y:B,textAnchor:"middle",fontSize:I(.9),fontWeight:"700",fill:st,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[e.jsx("tspan",{x:y,dy:0,children:qe}),Te&&e.jsx("tspan",{x:y,dy:I(1.1),children:Te})]}),!D&&e.jsxs("text",{x:y,y:U,textAnchor:"middle",fontSize:I(.9),fontWeight:"700",fill:ot,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[e.jsx("tspan",{x:y,dy:0,children:Ye}),Ne&&e.jsx("tspan",{x:y,dy:I(1.1),children:Ne})]}),!D&&e.jsxs("text",{x:y,y:ie,textAnchor:"middle",fontSize:I(.9),fontWeight:"700",fill:it,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',filter:"drop-shadow(0 1px 2px rgba(255, 255, 255, 0.9))"},children:[e.jsx("tspan",{x:y,dy:0,children:ze}),_e&&e.jsx("tspan",{x:y,dy:I(1.1),children:_e})]})]},`pt-${N}-${r.isoDate||r.timestamp}`)})]})},Ut="#1565C0",qt="#2E7D32",Yt="#6A1B9A",zt=({padding:s,chartHeight:d,tempMin:R,tempMax:L,tempRange:Q,getY:I,responsiveFontSize:v,textRowHeight:b,isFullScreen:m})=>{const h={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},Y=[];if(Q>0){const k=Q<=2.5?.1:.5;for(let C=R;C<=L+1e-9;C+=k)Y.push(parseFloat(C.toFixed(1)))}else for(let k=35.8;k<=37.2+1e-9;k+=.1)Y.push(parseFloat(k.toFixed(1)));const H=d-s.bottom;return e.jsxs("svg",{width:s.left,height:d,className:"font-sans pointer-events-none",children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"legendBgGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(255, 228, 230, 1)"}),e.jsx("stop",{offset:"30%",stopColor:"rgba(255, 229, 235, 1)  "}),e.jsx("stop",{offset:"70%",stopColor:"rgba(255, 241, 242, 1)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(255, 236, 240, 0.6)"})]}),e.jsxs("linearGradient",{id:"legendAccentGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),e.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),e.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),e.jsx("filter",{id:"legendShadowChart",x:"-20%",y:"-20%",width:"140%",height:"140%",children:e.jsx("feDropShadow",{dx:"0",dy:"3",stdDeviation:"4",floodColor:"rgba(244, 114, 182, 0.2)"})}),e.jsx("filter",{id:"textShadowLegend",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodColor:"rgba(255, 255, 255, 0.9)"})})]}),e.jsx("rect",{x:0,y:H+b*.5,width:s.left,height:b*(m?9.5:8),fill:"url(#legendBgGradientChart)",rx:12,style:{filter:"url(#legendShadowChart)"}}),Y.map((k,C)=>{const D=I(k),o=k.toFixed(1).endsWith(".0")||k.toFixed(1).endsWith(".5"),i=o?k.toFixed(1):`.${k.toFixed(1).split(".")[1]}`;return e.jsx(de.g,{variants:h,children:e.jsx("text",{x:s.left-v(1.2),y:D+v(.35),textAnchor:"end",fontSize:v(o?1.15:1),fontWeight:o?"800":"700",fill:o?"#E91E63":"#EC4899",style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:i})},`temp-tick-fixed-${C}`)}),e.jsx(de.g,{variants:h,children:[{label:"Fecha",row:1,color:"#374151",icon:null},{label:"Día",row:2,color:"#374151",icon:null},{label:"Símbolo",row:3,color:"#374151",icon:null},{label:"Sens.",row:m?5:4.5,color:Ut,icon:"◊"},{label:"Apar.",row:m?7:6,color:qt,icon:"○"},{label:"Observ.",row:m?9:7.5,color:Yt,icon:"✦"}].map(({label:k,row:C,color:D,icon:o})=>e.jsxs("g",{children:[o&&e.jsx("text",{x:s.left-v(2.8),y:H+b*C,textAnchor:"middle",fontSize:v(.8),fontWeight:"600",fill:D,opacity:.7,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:o}),e.jsx("text",{x:s.left-v(.8),y:H+b*C,textAnchor:"end",fontSize:v(1.05),fontWeight:"800",fill:D,style:{filter:"url(#textShadowLegend)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:k})]},k))})]})},Ze=35.8,et=37.2,Ht=(s=[])=>{var D;const d=o=>o&&o.displayTemperature!=null&&!o.ignored,Q=o=>{if(!o||o.length!==6)return null;const i=o.map(n=>n.temp);if(i.some(n=>!Number.isFinite(n)))return null;const u=i.reduce((n,F)=>F>n?F:n,i[0]),w=i.reduce((n,F)=>F>=u-.05&&F<u?n+1:n,0);return w>=2?null:{baselineTemp:u,baselineStartIndex:o[0].index,baselineIndices:o.map(n=>n.index),baselineBorderlineCount:w}},I=o=>{const i=[];for(let u=o;u<s.length;u+=1){const w=s[u];if(!d(w))continue;const n=w.displayTemperature;if(Number.isFinite(n)&&(i.push({index:u,temp:n}),i.length>6&&i.shift(),i.length===6)){const F=Q(i);if(!F)continue;let E=null;for(let $=u+1;$<s.length;$+=1){const ee=s[$];if(!d(ee))continue;const g=ee.displayTemperature;if(Number.isFinite(g)&&g>F.baselineTemp){E=$;break}}return{baselineTemp:F.baselineTemp,baselineStartIndex:F.baselineStartIndex,baselineIndices:F.baselineIndices,baselineBorderlineCount:F.baselineBorderlineCount,firstHighIndex:E}}}return null},v={confirmed:!1,confirmationIndex:null,infertileStartIndex:null,rule:null,highSequenceIndices:[],usedIndices:[],ovulationIndex:null};let b=null,m=null,h=null,Y=[],H=v,k=0;const C=({baselineTemp:o,firstHighIndex:i})=>{if(i==null)return{confirmed:!1};const u=o+.2,w=[],n=[],F=new Set,E=B=>{B==null||F.has(B)||(F.add(B),n.push(B))};let $=null,ee=!1;const g=i>0?i-1:null,X=()=>g!=null?[g,...n]:[...n];for(let B=i;B<s.length;B++){const U=s[B];if(!d(U))break;const ie=U.displayTemperature;if(!Number.isFinite(ie))break;if(ie>o){if(E(B),w.push({index:B,temp:ie}),w.length===3&&w[2].temp>=u)return{confirmed:!0,confirmationIndex:w[2].index,usedIndices:X(),highSequenceIndices:[...n],rule:"3-high"};if(w.length===4&&w[2].temp<u&&w[3].temp>o)return{confirmed:!0,confirmationIndex:w[3].index,usedIndices:X(),highSequenceIndices:[...n],rule:"german-3+1"};if($!==null&&w.length===3&&w[2].temp>=u)return{confirmed:!0,confirmationIndex:w[2].index,usedIndices:X(),highSequenceIndices:[...n],rule:"german-2nd-exception"};if(w.length===5&&w[3].temp>o&&w[4].temp>=u)return{confirmed:!0,confirmationIndex:w[4].index,usedIndices:X(),highSequenceIndices:[...n],rule:"5-high"};continue}if(ie>=o-.05&&$===null&&w.length>0&&w.length<3){$=B,E(B),w.push({index:B,temp:o});continue}if(!ee&&w.length>0&&w.length<3){ee=!0,E(B);continue}break}return{confirmed:!1,usedIndices:X(),highSequenceIndices:[...n]}};for(;k<s.length;){const o=I(k);if(!o)break;if(b=o.baselineTemp,m=o.baselineStartIndex,Y=Array.isArray(o.baselineIndices)?[...o.baselineIndices]:[],h=o.firstHighIndex,o.baselineBorderlineCount,h==null){k=m+1;continue}const i=C(o);if(i!=null&&i.requireRebaseline){k=m+1;continue}if(i!=null&&i.confirmed){const u=(D=i.highSequenceIndices)!=null&&D.length?i.highSequenceIndices[0]:null;H={confirmed:!0,confirmationIndex:i.confirmationIndex,infertileStartIndex:i.confirmationIndex,rule:i.rule,highSequenceIndices:i.highSequenceIndices??i.usedIndices,usedIndices:i.usedIndices,ovulationIndex:h??u??null};break}k=m+1}return{baselineTemp:b,baselineStartIndex:m,firstHighIndex:h,baselineIndices:Y,ovulationDetails:H}},Vt=(s,d,R,L,Q,I=5,v=!1)=>{const b=x.useRef(null),m=x.useRef(null),[h,Y]=x.useState({width:0,height:0}),[H,k]=x.useState(null),[C,D]=x.useState({x:0,y:0}),[o,i]=x.useState(null),u=x.useCallback(()=>{k(null),i(null)},[]),w=x.useMemo(()=>gt(s),[s]),n=x.useMemo(()=>{const a=l=>{if(l==null||l==="")return null;const A=parseFloat(String(l).replace(",","."));return Number.isFinite(A)?A:null},c=l=>{if(!l)return null;const A=a(l.temperature),f=a(l.temperature_corrected);return l.use_corrected&&f!==null?f:A!==null?A:f!==null?f:null};return s.map(l=>{const A=[l==null?void 0:l.temperature_chart,l==null?void 0:l.temperature_raw,l==null?void 0:l.temperature_corrected];let f=null;for(const G of A)if(G!=null&&G!==""){f=G;break}if(f==null&&Array.isArray(l==null?void 0:l.measurements)){const q=l.measurements.find(S=>S&&S.selected&&c(S)!==null)||l.measurements.find(S=>c(S)!==null);q&&(f=c(q))}const p=l==null?void 0:l.isoDate;return{...l,displayTemperature:a(f),peakStatus:p&&w[p]||null}})},[s,w]);x.useLayoutEffect(()=>{const a=()=>{if(!b.current)return;const l=b.current.parentElement||b.current;let A=l.clientWidth||600,f=l.clientHeight||400,p=b.current.clientWidth>0?b.current.clientWidth:A,G,q;if(d){let S=window.innerWidth,oe=window.innerHeight;if(v&&oe>S&&([S,oe]=[oe,S]),p=S,R==="portrait"&&!v){const me=Math.max(30,S*.05);G=(S-me)/I*s.length}else G=S/I*s.length;q=oe}else G=p/I*s.length,q=f;Y({width:G,height:q})};a(),window.addEventListener("resize",a);let c;if(b.current){const l=b.current.parentElement||b.current;c=new ResizeObserver(a),c.observe(l)}return()=>{window.removeEventListener("resize",a),c&&c.disconnect()}},[d,s.length,I,R,v]);const F=x.useMemo(()=>n.filter(a=>a&&a.isoDate&&!a.ignored&&a.displayTemperature!==null&&a.displayTemperature!==void 0),[n]),E=x.useMemo(()=>n.filter(a=>a&&a.isoDate),[n]),$=F.length>0,ee=x.useMemo(()=>{var a;if(!E.length)return null;for(let c=0;c<E.length;c+=1)if(((a=E[c])==null?void 0:a.peakStatus)==="P")return c;return null},[E]),g=x.useMemo(()=>{var A;if(!E.length)return null;let a=null;for(let f=0;f<E.length;f+=1)if(((A=E[f])==null?void 0:A.peakStatus)==="3"){a=f;break}if(a!=null){const f=a+1;return f>=E.length?a:f}if(ee==null)return null;const c=E[ee];if(!(c!=null&&c.isoDate))return null;const l=De(c.isoDate);for(let f=ee+1;f<E.length;f+=1){const p=E[f];if(!(p!=null&&p.isoDate))continue;if(ht(De(p.isoDate),l)>=4)return f}return null},[E,ee]),{baselineTemp:X,baselineStartIndex:B,firstHighIndex:U,baselineIndices:ie,ovulationDetails:fe}=x.useMemo(()=>Ht(n),[n]),ae=x.useMemo(()=>({...fe??{confirmed:!1,confirmationIndex:null,infertileStartIndex:null,rule:null,highSequenceIndices:[],usedIndices:[],ovulationIndex:null},peakDayIndex:ee,peakInfertilityStartIndex:g}),[fe,ee,g]),{tempMin:he,tempMax:ue}=x.useMemo(()=>{const a=F.map(S=>S.displayTemperature).filter(S=>S!=null);if(a.length===0)return{tempMin:Ze,tempMax:et};const c=et-Ze,l=Math.min(...a),A=Math.max(...a);let f=Math.min(l,Ze),p=Math.max(A,et);const G=S=>Math.floor(S*10)/10,q=S=>Math.ceil(S*10)/10;if(f=G(f),p=q(p),p-f<c){const S=(f+p)/2;f=G(S-c/2),p=q(S+c/2)}return Math.abs(f-l)<1e-9&&(f=G(f-.1)),Math.abs(p-A)<1e-9&&(p=q(p+.1)),{tempMin:parseFloat(f.toFixed(1)),tempMax:parseFloat(p.toFixed(1))}},[F]),je=ue-he,xe=h.width,se=h.height,r=9,N=(a=1)=>{if(!d)return r*a;const c=Math.min(xe,se);return Math.max(8,Math.min(r*a,c/(E.length>0?40/a:40)))},y=N(d?1.6:2.5),W=v||R==="landscape",K=y*(W?9:5),O={top:d?Math.max(W?6:12,se*(W?.015:.03)):12,right:d?Math.max(W?35:30,xe*(W?.02:.05)):50,bottom:(d?Math.max(W?0:40,se*(W?0:.11)):60)+K+25,left:d?Math.max(W?45:20,xe*(W?.02:.05)):50},z=a=>{if(a==null||je===0)return se-O.bottom;const c=se-O.top-O.bottom;return c<=0?se-O.bottom:se-O.bottom-(a-he)/je*c},te=a=>{const c=d&&!(v||R==="landscape")?5:10,l=d&&!(v||R==="landscape")?25:0,A=xe-O.left-O.right-c-l*(E.length-1);if(A<=0)return O.left+c+l*a;const f=E.length>1?E.length-1:1;return f===0||E.length===0?O.left+c+l*a:O.left+c+a*(A/(E.length===1?1:f))+l*a},le=(a,c,l)=>{if(!a){u();return}const A=b.current.getBoundingClientRect();let f,p;if(l.type.startsWith("touch")){const oe=l.changedTouches[0];f=oe.clientX,p=oe.clientY}else f=l.clientX,p=l.clientY;const G=te(c),q=a.displayTemperature??a.temperature_chart??null,S=z(q);D({svgX:G,svgY:S,clientX:f-A.left+b.current.scrollLeft,clientY:p-A.top+b.current.scrollTop}),i(c),k(a)};return x.useEffect(()=>{const a=c=>{var l;if(m.current&&!m.current.contains(c.target)){const A=(l=b.current)==null?void 0:l.querySelectorAll("circle, text, rect");let f=!1;if(A){for(let p of A)if(p.contains(c.target)){f=!0;break}}f||u()}};return H&&(document.addEventListener("mousedown",a),document.addEventListener("touchstart",a)),()=>{document.removeEventListener("mousedown",a),document.removeEventListener("touchstart",a)}},[H,u]),{chartRef:b,tooltipRef:m,dimensions:h,activePoint:H,activeIndex:o,tooltipPosition:C,processedData:n,validDataForLine:F,allDataPoints:E,tempMin:he,tempMax:ue,tempRange:je,padding:O,textRowHeight:y,setActivePoint:k,setActiveIndex:i,getY:z,getX:te,handlePointInteraction:le,clearActivePoint:u,handleToggleIgnore:a=>{L&&a&&(L(Q,a),u())},responsiveFontSize:N,baselineTemp:X,baselineStartIndex:B,baselineIndices:ie,firstHighIndex:U,ovulationDetails:ae,hasTemperatureData:$}},Xt=({data:s,isFullScreen:d,orientation:R,onToggleIgnore:L,onEdit:Q,onTogglePeak:I,cycleId:v,initialScrollIndex:b=0,visibleDays:m=5,showInterpretation:h=!1,reduceMotion:Y=!1,forceLandscape:H=!1,currentPeakIsoDate:k=null})=>{const{chartRef:C,tooltipRef:D,dimensions:o,activePoint:i,activeIndex:u,tooltipPosition:w,allDataPoints:n,validDataForLine:F,tempMin:E,tempMax:$,tempRange:ee,padding:g,textRowHeight:X,getY:B,getX:U,handlePointInteraction:ie,handleToggleIgnore:fe,responsiveFontSize:ae,clearActivePoint:he,baselineTemp:ue,baselineStartIndex:je,baselineIndices:xe,firstHighIndex:se,ovulationDetails:r,hasTemperatureData:N}=Vt(s,d,R,L,v,m,H),y=x.useRef(null);if(!y.current){const P=Math.random().toString(36).slice(2,10);y.current=`fertility-chart-${v??"default"}-${P}`}const W=y.current;if(!n||n.length===0)return e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-pink-100 to-rose-100 rounded-full mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-pink-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),e.jsx("p",{className:"text-slate-400 font-medium",children:"No hay datos para mostrar en el gráfico"})]});const T=o.width,K=o.height,O=ue!=null?B(ue):null,z=!!(r!=null&&r.confirmed),te=ue!=null,le=U(0),Ee=n.length>0?U(n.length-1):T-g.right,a=z?"#F59E0B":"#94A3B8",c=z?"6 4":"4 4",l=z?1:.7,A=3,f=T===0,p=u!=null?U(u):null,G=u!=null?u>0?U(u-1):p:null,q=u!=null?u<n.length-1?U(u+1):p:null,S=Math.max((T-g.left-g.right)/Math.max(n.length,1),0),oe=u!=null?Math.max((q!=null&&G!=null?q-G:0)||S,S,0):0,me=x.useMemo(()=>{const P=new Map;return F.forEach(J=>{J&&J.id!=null&&P.set(J.id,J)}),P},[F]),pe=x.useMemo(()=>r!=null&&r.confirmed&&Number.isFinite(r==null?void 0:r.infertileStartIndex)?r.infertileStartIndex:null,[r]),t=x.useMemo(()=>Number.isFinite(r==null?void 0:r.peakInfertilityStartIndex)?r.peakInfertilityStartIndex:null,[r]),j=x.useMemo(()=>pe==null||t==null?null:Math.max(pe,t),[pe,t]),M=Math.max(K-g.top-g.bottom,0),ne=`${W}-temperature-below`,_=`${W}-temperature-above`,V=x.useCallback(P=>!Number.isFinite(P)||!n.length||P<=0?g.left:U(P),[n,U,g.left]),Me=x.useCallback(P=>!Number.isFinite(P)||!n.length||P>=n.length-1?T-g.right:U(P+1),[n,T,U,g.right]),ge=x.useCallback((P,J,{inclusiveEnd:re=!0}={})=>{if(!Number.isFinite(P)||!Number.isFinite(J)||n.length===0)return null;const ye=we=>Math.max(0,Math.min(n.length-1,Math.floor(we))),Ce=we=>Math.max(0,Math.min(n.length-1,Math.floor(we))),He=we=>Math.max(0,Math.min(n.length,Math.floor(we))),Be=ye(P),Ie=re?Ce(J):He(J),Oe=Be<=0?g.left:V(Be);let be;re?be=Ie>=n.length-1?T-g.right:Me(Ie):Ie<=0?be=g.left:Ie>=n.length?be=T-g.right:be=V(Ie);const Pe=Math.max(be-Oe,0);return Pe<=0?null:{x:Oe,width:Pe}},[n,T,V,Me,g.left,g.right]),ke=x.useMemo(()=>{if(!N||M<=0)return{below:null,above:null};const P=K-g.bottom,J=g.top,re=n.map((be,Pe)=>{const we=be?me.get(be.id):null;return!we||!Number.isFinite(we.displayTemperature)?null:{index:Pe,x:U(Pe),y:B(we.displayTemperature)}}).filter(Boolean);if(!re.length)return{below:null,above:null};const ye=re[0],Ce=re[re.length-1],He=V(ye.index),Be=T-g.right,Ie=[...re];Ie[Ie.length-1].x!==Be&&Ie.push({index:Ce.index,x:Be,y:Ce.y});const Oe=be=>[`M ${He} ${be}`,`L ${ye.x} ${ye.y}`,...Ie.slice(1).map(({x:we,y:ct})=>`L ${we} ${ct}`),`L ${Be} ${be}`,"Z"].join(" ");return{below:Oe(P),above:Oe(J)}},[n,M,K,T,V,U,B,N,g.bottom,g.right,g.top,me]),Z=x.useMemo(()=>{if(!h||!(r!=null&&r.confirmed)||pe==null||M<=0)return null;const P=j==null,J=j??n.length-1;return J<pe?null:ge(pe,J,{inclusiveEnd:P})},[h,r,pe,M,j,n.length,ge]),Se=x.useMemo(()=>{if(!h||t==null||M<=0)return null;const P=j==null,J=j??n.length-1;return J<t?null:ge(t,J,{inclusiveEnd:P})},[h,t,M,j,n.length,ge]),ve=x.useMemo(()=>!h||j==null||M<=0?null:ge(j,n.length-1),[h,j,M,n.length,ge]),Fe=x.useMemo(()=>{if(!h||!(r!=null&&r.confirmed))return null;const P=Array.isArray(r==null?void 0:r.highSequenceIndices)?r.highSequenceIndices:[];if(P.length<2)return null;const J=P.map(re=>{if(re==null||re<0||re>=n.length)return null;const ye=n[re],Ce=me.get(ye==null?void 0:ye.id);return!Ce||!Number.isFinite(Ce.displayTemperature)?null:{x:U(re),y:B(Ce.displayTemperature)}}).filter(Boolean);return J.length<2?null:J.map(({x:re,y:ye},Ce)=>`${Ce===0?"M":"L"} ${re} ${ye}`).join(" ")},[h,r,n,me,U,B]),[Le,Re]=x.useState({w:typeof window<"u"?window.innerWidth:0,h:typeof window<"u"?window.innerHeight:0}),qe=Le.w<Le.h;x.useEffect(()=>{const P=()=>Re({w:window.innerWidth,h:window.innerHeight});return window.addEventListener("resize",P),window.addEventListener("orientationchange",P),()=>{window.removeEventListener("resize",P),window.removeEventListener("orientationchange",P)}},[]),x.useEffect(()=>{if(!C.current)return;const P=C.current.clientWidth/m;C.current.scrollLeft=Math.max(0,P*b)},[b,m,o.width,R]);const Te=H&&qe,Ye=Te,Ne="w-full h-full bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100",ze=d?`${Ne} min-h-full ${Ye?"flex items-stretch justify-start overflow-y-auto overflow-x-hidden":"flex items-center justify-start overflow-x-auto overflow-y-hidden"}`:`${Ne} overflow-x-auto overflow-y-hidden border border-pink-100/50`,_e=!d||R==="portrait",ce=14,nt=`linear-gradient(to right, transparent, rgba(0,0,0,0.95) ${ce}px, rgba(0,0,0,0.95) calc(100% - ${ce}px), transparent)`,rt=`linear-gradient(to bottom, transparent, rgba(0,0,0,0.95) ${ce}px, rgba(0,0,0,0.95) calc(100% - ${ce}px), transparent)`,We={maskImage:`${nt}, ${rt}`,maskMode:"alpha",maskRepeat:"no-repeat",maskSize:"100% 100%",maskComposite:"intersect",WebkitMaskImage:`${nt}, ${rt}`,WebkitMaskRepeat:"no-repeat",WebkitMaskSize:"100% 100%",WebkitMaskComposite:"source-in"};return e.jsxs(de.div,{className:"relative w-full h-full",initial:!1,children:[_e&&e.jsx("div",{className:"absolute left-0 top-0 h-full bg-transparent pointer-events-none z-10",style:{width:g.left},children:e.jsx(zt,{padding:g,chartHeight:K,tempMin:E,tempMax:$,tempRange:ee,getY:B,responsiveFontSize:ae,textRowHeight:X,isFullScreen:d})}),e.jsxs(de.div,{ref:C,className:`relative p-0 ${d?"":"rounded-2xl"} ${ze}`,style:{boxShadow:d?"inset 0 1px 3px rgba(244, 114, 182, 0.1)":"0 8px 32px rgba(244, 114, 182, 0.12), 0 2px 8px rgba(244, 114, 182, 0.08)",...Te?{position:"absolute",top:0,left:0,width:`${Le.h}px`,height:`${Le.w}px`,transform:"rotate(90deg) translateY(-100%)",transformOrigin:"top left"}:{}},initial:!1,children:[f&&e.jsx("div",{className:"flex items-center justify-center w-full h-full text-slate-400",children:"Cargando..."}),e.jsxs(de.svg,{width:T,height:K,className:"font-sans flex-shrink-0",viewBox:`0 0 ${T} ${K}`,preserveAspectRatio:"xMidYMid meet",initial:!1,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"tempLineGradientChart",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"#F472B6"}),e.jsx("stop",{offset:"50%",stopColor:"#EC4899"}),e.jsx("stop",{offset:"100%",stopColor:"#E91E63"})]}),e.jsxs("linearGradient",{id:"tempAreaGradientChart",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(244,114,182,0.25)"}),e.jsx("stop",{offset:"50%",stopColor:"rgba(236,72,153,0.15)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(233,30,99,0.05)"})]}),e.jsxs("pattern",{id:"spotting-pattern-chart",patternUnits:"userSpaceOnUse",width:"6",height:"6",children:[e.jsx("rect",{width:"6",height:"6",fill:"#ef4444"}),e.jsx("circle",{cx:"3",cy:"3",r:"1.5",fill:"rgba(255,255,255,0.85)"})]}),e.jsxs("filter",{id:"chartShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("filter",{id:"baselineGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("pattern",{id:"temperatureInfertilityPattern",patternUnits:"userSpaceOnUse",width:"14",height:"14",children:[e.jsx("rect",{width:"14",height:"14",fill:"rgba(191, 219, 254, 0.45)"}),e.jsx("path",{d:"M0 0 L14 14",stroke:"rgba(59, 130, 246, 0.55)",strokeWidth:"1.4"}),e.jsx("path",{d:"M14 0 L0 14",stroke:"rgba(59, 130, 246, 0.55)",strokeWidth:"1.4"})]}),e.jsxs("pattern",{id:"peakInfertilityPattern",patternUnits:"userSpaceOnUse",width:"12",height:"12",children:[e.jsx("rect",{width:"12",height:"12",fill:"rgba(167, 243, 208, 0.42)"}),e.jsx("circle",{cx:"3",cy:"3",r:"1.7",fill:"rgba(13, 148, 136, 0.55)"}),e.jsx("circle",{cx:"9",cy:"9",r:"1.7",fill:"rgba(13, 148, 136, 0.55)"})]}),e.jsxs("pattern",{id:"absoluteInfertilityPattern",patternUnits:"userSpaceOnUse",width:"16",height:"16",children:[e.jsx("rect",{width:"16",height:"16",fill:"rgba(56, 189, 248, 0.45)"}),e.jsx("path",{d:"M0 0 L16 16",stroke:"rgba(13, 148, 136, 0.6)",strokeWidth:"1.2"}),e.jsx("path",{d:"M16 0 L0 16",stroke:"rgba(13, 148, 136, 0.6)",strokeWidth:"1.2"}),e.jsx("circle",{cx:"4",cy:"12",r:"1.6",fill:"rgba(19, 78, 74, 0.6)"}),e.jsx("circle",{cx:"12",cy:"4",r:"1.6",fill:"rgba(19, 78, 74, 0.6)"})]}),N&&ke.below&&e.jsx("clipPath",{id:ne,clipPathUnits:"userSpaceOnUse",children:e.jsx("path",{d:ke.below})}),N&&ke.above&&e.jsx("clipPath",{id:_,clipPathUnits:"userSpaceOnUse",children:e.jsx("path",{d:ke.above})})]}),e.jsx("rect",{width:"100%",height:"100%",fill:"transparent"}),e.jsx(Mt,{padding:g,chartWidth:T,chartHeight:K,tempMin:E,tempMax:$,tempRange:ee,getY:B,getX:U,allDataPoints:n,responsiveFontSize:ae,isFullScreen:d,showLeftLabels:!_e,reduceMotion:Y}),h&&e.jsxs(e.Fragment,{children:[Se&&(N&&ke.below?e.jsx("rect",{x:Se.x,y:g.top,width:Se.width,height:M,fill:"url(#peakInfertilityPattern)",opacity:.75,pointerEvents:"none",clipPath:`url(#${ne})`,style:We}):e.jsx("rect",{x:Se.x,y:g.top,width:Se.width,height:M,fill:"url(#peakInfertilityPattern)",opacity:.75,pointerEvents:"none",style:We})),Z&&(N&&ke.above?e.jsx("rect",{x:Z.x,y:g.top,width:Z.width,height:M,fill:"url(#temperatureInfertilityPattern)",opacity:.7,pointerEvents:"none",clipPath:`url(#${_})`,style:We}):e.jsx("rect",{x:Z.x,y:g.top,width:Z.width,height:M,fill:"url(#temperatureInfertilityPattern)",opacity:.7,pointerEvents:"none",style:We})),ve&&e.jsx("rect",{x:ve.x,y:g.top,width:ve.width,height:M,fill:"url(#absoluteInfertilityPattern)",opacity:.5,pointerEvents:"none",style:We})]}),h&&te&&O!==null&&(Y?e.jsx("line",{x1:le,y1:O,x2:Ee,y2:O,stroke:a,strokeWidth:A,strokeDasharray:c,opacity:l}):e.jsx(de.path,{d:`M ${le} ${O} L ${Ee} ${O}`,stroke:a,strokeWidth:A,strokeDasharray:c,opacity:l,initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:l},transition:{duration:4,ease:"easeInOut",delay:.5}})),e.jsx(vt,{data:F,allDataPoints:n,getX:U,getY:B,baselineY:K-g.bottom,temperatureField:"displayTemperature",reduceMotion:Y}),Fe&&e.jsx("path",{d:Fe,fill:"none",stroke:"#cc0e93",strokeWidth:6,strokeLinecap:"round",strokeLinejoin:"round",opacity:.85,style:{filter:"drop-shadow(0 2px 6px rgba(206, 14, 147, 0.4))"},pointerEvents:"none"}),u!==null&&p!==null&&oe>0&&e.jsx("g",{pointerEvents:"none",children:(()=>{const P=K-g.bottom,J=Math.max(3,Math.min(14,oe*.4)),re=Math.max(J*2,X*.85);return e.jsxs(e.Fragment,{children:[e.jsx("line",{x1:p,y1:0,x2:p,y2:P,stroke:"rgba(235, 171, 204,0.15)",strokeWidth:J}),e.jsx("line",{x1:p,y1:P,x2:p,y2:K,stroke:"rgba(235, 171, 204,0.15)",strokeWidth:re})]})})()}),e.jsx($t,{data:n,getX:U,getY:B,isFullScreen:d,orientation:R,responsiveFontSize:ae,onPointInteraction:ie,clearActivePoint:he,activePoint:i,padding:g,chartHeight:K,chartWidth:T,temperatureField:"displayTemperature",textRowHeight:X,compact:!1,reduceMotion:Y,showInterpretation:h,ovulationDetails:r,baselineStartIndex:je,firstHighIndex:se,baselineIndices:xe})]}),i&&e.jsx(de.div,{ref:D,initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:10},transition:{duration:.12,ease:"easeOut"},children:e.jsx(bt,{point:i,position:w,chartWidth:T,chartHeight:K,onToggleIgnore:fe,onEdit:Q,onClose:he,onTogglePeak:I,currentPeakIsoDate:k})})]})]})};function Kt(s,d){if(!s||!d)return[];const R=typeof s=="string"?De(s):s;return[...Array(d)].map((L,Q)=>{const I=ut(R,Q),v=Ue(I,"yyyy-MM-dd"),b=Ue(I,"dd/MM"),m=tt(Ae(I),Ae(R))+1;return{date:b,isoDate:v,cycleDay:m,temperature:null,mucusSensation:null,mucusAppearance:null,id:`placeholder-${v}`,ignored:!1,peak_marker:null}})}const an=()=>{const{cycleId:s}=ft(),{currentCycle:d,archivedCycles:R,isLoading:L,addOrUpdateDataPoint:Q,toggleIgnoreRecord:I,getCycleById:v}=wt(),[b,m]=x.useState(null),[h,Y]=x.useState(!1),[H,k]=x.useState(!1),C=!s||s===d.id,D=C?null:R.find(t=>t.id===s);x.useEffect(()=>{if(C){m(null),Y(!1),k(!1);return}if(D){m(null),Y(!1),k(!1);return}let t=!0;return Y(!0),v(s).then(j=>{t&&(j?(m(j),k(!1)):(m(null),k(!0)))}).catch(()=>{t&&(m(null),k(!0))}).finally(()=>{t&&Y(!1)}),()=>{t=!1}},[C,D,v,s]);const o=C?d:D||b,i=!C&&!D,u=!C&&(o==null?void 0:o.id),w=C?L&&!(d!=null&&d.id):h||L&&!D&&!b,[n,F]=x.useState(typeof window<"u"&&window.innerWidth>window.innerHeight?"landscape":"portrait"),[E,$]=x.useState(!1),[ee,g]=x.useState(!1),[X,B]=x.useState(null),[U,ie]=x.useState(!1),[fe,ae]=x.useState(!1),he=x.useRef(!1),ue=!!(X&&String(X.id||"").startsWith("placeholder-"));if(x.useEffect(()=>{const t=async()=>{var M,ne;const j=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement);if($(j),!j){try{const _=typeof window<"u"?(M=window.screen)==null?void 0:M.orientation:null;await((ne=_==null?void 0:_.unlock)==null?void 0:ne.call(_))}catch{}F("portrait")}};return document.addEventListener("fullscreenchange",t),document.addEventListener("webkitfullscreenchange",t),document.addEventListener("mozfullscreenchange",t),document.addEventListener("MSFullscreenChange",t),()=>{document.removeEventListener("fullscreenchange",t),document.removeEventListener("webkitfullscreenchange",t),document.removeEventListener("mozfullscreenchange",t),document.removeEventListener("MSFullscreenChange",t)}},[]),x.useLayoutEffect(()=>{window.dispatchEvent(new Event("resize"))},[n,E]),w)return e.jsx($e,{children:e.jsx("div",{className:"flex h-full flex-col items-center justify-center space-y-4 bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100 px-4 py-8 text-center text-pink-600",children:e.jsx("p",{children:"Cargando…"})})});if(!(o!=null&&o.id))return s&&H?e.jsx($e,{children:e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 px-4 py-8 text-center text-pink-600",children:[e.jsx("p",{children:"No se encontró el ciclo solicitado."}),e.jsx(Ge,{asChild:!0,className:"bg-gradient-to-r from-pink-500 to-rose-500 text-white shadow",children:e.jsx(Ve,{to:"/archived-cycles",children:"Volver a Mis Ciclos"})})]})}):e.jsx($e,{children:e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 px-4 py-8 text-center text-pink-600",children:[e.jsx("p",{children:"No hay ciclo activo."}),e.jsx(Ge,{asChild:!0,className:"bg-gradient-to-r from-pink-500 to-rose-500 text-white shadow",children:e.jsx(Ve,{to:"/records",children:"Ir a Mis Registros"})})]})});const je=28,xe=10,se=De(o.startDate),r=o.data||[],N=x.useMemo(()=>{const t=Array.isArray(r)?r.find(j=>(j==null?void 0:j.peak_marker)==="peak"):null;return(t==null?void 0:t.isoDate)||null},[r]),y=r.reduce((t,j)=>{const M=De(j.isoDate);return M>t?M:t},se),W=Ae(new Date),T=y>W?y:W,K=tt(Ae(T),se),O=Math.max(je,K+1),te=Kt(se,O).map(t=>{const j=r.find(M=>M.isoDate===t.isoDate);return j?{...j,date:t.date}:t}),le=n==="portrait"?xe:je;let Ee=0;if(n!=="landscape"){const t=tt(new Date,Ae(se)),j=Math.min(Math.max(t,0),O-1);let M=Math.min(O,j+1);j<le-1&&(M=Math.min(O,le)),Ee=Math.max(0,M-le)}const a={background:"linear-gradient(135deg, #FFFAFC 0%, #f7eaef 100%)"},c=E?a:{...a,height:n==="landscape"?"calc(min(100dvh, 100dvw) - var(--bottom-nav-safe))":"calc(100dvh - var(--bottom-nav-safe))",maxHeight:"100vh",paddingBottom:"env(safe-area-inset-bottom)"},l=t=>{B(t),g(!0)},A=async(t,j)=>{try{if(await I(t,j),i){const M=await v(t);M&&m(M)}}catch(M){console.error("Error toggling ignore state:",M)}},f=async(t,j=!0)=>{if(!(o!=null&&o.id)||!(t!=null&&t.isoDate))return;const M=_=>{if(_==null||_==="")return null;const V=parseFloat(String(_).replace(",","."));return Number.isFinite(V)?V:null},ne=j??!(t.peak_marker==="peak"||t.peakStatus==="P");ie(!0);try{const _=t.timestamp?Ue(De(t.timestamp),"HH:mm"):Ue(new Date,"HH:mm");let V=Array.isArray(t.measurements)&&t.measurements.length>0?t.measurements:[{temperature:t.temperature_chart??t.temperature_raw??null,temperature_corrected:t.temperature_corrected??null,time:_,time_corrected:t.time_corrected??_,selected:!0,use_corrected:t.use_corrected??!1}];V.length===0&&(V=[{temperature:null,temperature_corrected:null,time:_,time_corrected:_,selected:!0,use_corrected:!1}]);const Me=V.map((Z,Se)=>{const ve=Z.time||_,Fe=Z.time_corrected||ve;return{temperature:M(Z.temperature??Z.temperature_raw),time:ve,selected:Se===0?!0:!!Z.selected,temperature_corrected:M(Z.temperature_corrected),time_corrected:Fe,use_corrected:!!Z.use_corrected}});Me.some(Z=>Z.selected)||(Me[0].selected=!0);const ge={isoDate:t.isoDate,measurements:Me,mucusSensation:t.mucus_sensation??t.mucusSensation??"",mucusAppearance:t.mucus_appearance??t.mucusAppearance??"",fertility_symbol:t.fertility_symbol??"none",observations:t.observations??"",ignored:t.ignored??!1,peak_marker:ne?"peak":null},ke=t!=null&&t.id&&!String(t.id).startsWith("placeholder-")?t:null;await Q(ge,ke,o.id)}catch(_){console.error("Error toggling peak marker:",_)}finally{ie(!1)}},p=async(t,{keepFormOpen:j=!1}={})=>{if(o!=null&&o.id){ie(!0);try{if(await Q(t,X,o.id),i){const M=await v(o.id);M&&m(M)}j||(g(!1),B(null))}finally{ie(!1)}}},G=()=>{g(!1),B(null)},q=t=>{B(t)},S=()=>{ae(t=>!t)},oe=t=>{if(t.preventDefault(),he.current){he.current=!1;return}S()},me=t=>{t.pointerType==="touch"&&(t.preventDefault(),he.current=!0,S())},pe=async()=>{var M;const t=document.documentElement,j=typeof window<"u"?(M=window.screen)==null?void 0:M.orientation:null;if(E){if(j!=null&&j.unlock)try{await j.unlock()}catch(ne){console.error(ne)}try{const ne=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen,_=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;ne&&_&&await ne.call(document)}catch(ne){console.error(ne)}F("portrait"),$(!1)}else{let ne=!1,_=!1;try{const V=t.requestFullscreen||t.webkitRequestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen;_=!!V,V&&(await V.call(t),ne=!0)}catch(V){console.error(V)}if(j!=null&&j.lock)try{await j.lock("landscape")}catch(V){console.error(V)}F("landscape"),$(ne||!_)}};return e.jsx($e,{hideBottomNav:E,children:e.jsxs("div",{className:E?"fixed inset-0 z-50 h-[100dvh] w-[100dvw] overflow-x-auto overflow-y-auto":"relative w-full overflow-x-auto overflow-y-auto",style:c,children:[u&&!E&&e.jsx(Ge,{asChild:!0,variant:"ghost",className:"absolute top-4 left-4 z-10 bg-white/80 text-slate-700 hover:bg-[#E27DBF]/20",children:e.jsxs(Ve,{to:`/cycle/${o.id}`,className:"flex items-center gap-1",children:[e.jsx(St,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline"})]})}),e.jsx(Ge,{onClick:oe,onPointerUp:me,variant:"ghost",size:"icon",className:`absolute top-4 right-20 z-10 p-2 rounded-full transition-colors ${fe?"bg-[#E27DBF] text-white hover:bg-[#d46ab3]":"bg-white/80 text-slate-700 hover:bg-[#E27DBF]/20"}`,children:fe?e.jsx(Ct,{className:"h-4 w-4"}):e.jsx(It,{className:"h-4 w-4"})}),e.jsx(Ge,{onClick:pe,className:"absolute top-4 right-4 z-10 bg-white/80 hover:bg-white text-gray-700 p-2 rounded-full shadow","aria-label":E?"Salir de pantalla completa":"Rotar gráfico",children:e.jsx(Et,{className:"w-5 h-5"})}),e.jsx(Xt,{data:te,isFullScreen:E,orientation:n,onToggleIgnore:A,onEdit:l,onTogglePeak:f,cycleId:o.id,initialScrollIndex:Ee,visibleDays:le,showInterpretation:fe,reduceMotion:!0,forceLandscape:n==="landscape",currentPeakIsoDate:N}),e.jsx(jt,{open:ee,onOpenChange:t=>{t||G()},children:e.jsx(kt,{hideClose:!0,className:"bg-transparent border-none p-0 text-gray-800 w-[90vw] sm:w-auto max-w-md sm:max-w-lg md:max-w-xl max-h-[85vh] overflow-y-auto",children:e.jsx(yt,{onSubmit:p,onCancel:G,initialData:X,cycleStartDate:o.startDate,cycleEndDate:o.endDate,isProcessing:U,isEditing:!!X&&!ue,cycleData:o.data,onDateSelect:q})})})]})})};export{an as default};
