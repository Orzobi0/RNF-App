import{c as ut,f as V,l as Ot,k as G,n as ye,o as J,r as o,N as Bt,j as r,v as $t,O as Vt,u as Ut,Q as dt,S as ge,B,L as Fe,X as Ht}from"./index-D1odW1ad.js";import{F as Wt}from"./FertilityChart-DdB9dd-i.js";import{u as Yt,D as qt,a as Gt}from"./useCycleData-CiVYlgIv.js";import{D as Jt}from"./DataEntryForm-DsrJTi3f.js";import{C as Le}from"./computePeakStatuses-BuckH43K.js";import{L as Kt}from"./label-D3rGbgm4.js";import{a as Qt,b as Xt,c as Zt}from"./useFertilityChart-8sBD0Slj.js";import{A as ea}from"./arrow-left-C9ySiarT.js";import{E as ta,a as aa}from"./eye-C7LCdnit.js";import"./peak-mode-button-BZ-YtFep.js";import"./input-CElQ2eSE.js";import"./badge-CmDzsC2c.js";import"./useBackClose-C7RhtkvF.js";const ra=ut("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),sa=ut("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);function na(l,d){if(!l||!d)return[];const f=typeof l=="string"?V(l):l;return[...Array(d)].map((b,D)=>{const w=Ot(f,D),U=G(w,"yyyy-MM-dd"),P=G(w,"dd/MM"),R=ye(J(w),J(f))+1;return{date:P,isoDate:U,cycleDay:R,temperature:null,mucusSensation:null,mucusAppearance:null,had_relations:!1,hadRelations:!1,id:`placeholder-${U}`,ignored:!1,peak_marker:null}})}const oa=({isOpen:l,onClose:d,children:f,ariaLabel:b,containerClassName:D="",backdropClassName:w="bg-black/40"})=>{if(o.useEffect(()=>{if(!l)return;const R=H=>{H.key==="Escape"&&typeof d=="function"&&d()};document.addEventListener("keydown",R);const{body:C}=document,xe=C.style.overflow;return C.style.overflow="hidden",()=>{document.removeEventListener("keydown",R),C.style.overflow=xe}},[l,d]),!l||typeof document>"u")return null;const U=()=>{typeof d=="function"&&d()},P=R=>{R.stopPropagation()};return Bt.createPortal(r.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center px-4 py-8",children:[r.jsx("div",{className:`absolute inset-0 ${w}`,onClick:U,"aria-hidden":"true"}),r.jsx("div",{role:"dialog","aria-modal":"true","aria-label":b??void 0,className:`relative z-[101] w-full max-w-md overflow-hidden rounded-3xl bg-white shadow-2xl shadow-rose-200/50 focus:outline-none focus-visible:ring-2 focus-visible:ring-pink-200 ${D}`,onClick:P,children:f})]}),document.body)},_e="fertility-chart-settings",oe=l=>l?String(l).toUpperCase().replace(/-/g,""):"",la=l=>{const d=oe(l);return d==="T8"?"T-8":d==="CPM"?"CPM":l??""},ia=l=>l==="conservador"?"estandar":l==="estandar"?l:null,ze=()=>({calculators:{cpm:!0,t8:!0},postpartum:!1,combineMode:"estandar"}),ct={showRelationsRow:!0,fertilityStartConfig:ze()},ca=[{key:"cpm",label:"CPM"},{key:"t8",label:"T-8"}],$=l=>{const d=ze(),f={calculators:{...d.calculators},postpartum:d.postpartum,combineMode:d.combineMode};if(l&&typeof l=="object"){Object.keys(f.calculators).forEach(w=>{typeof l?.calculators?.[w]=="boolean"&&(f.calculators[w]=l.calculators[w])});const b=ia(l.combineMode);b&&(f.combineMode=b);const D=dt(l.postpartum);D!==null&&(f.postpartum=D)}return f},Ia=()=>{const{cycleId:l}=$t(),d=Vt(),{currentCycle:f,archivedCycles:b,isLoading:D,addOrUpdateDataPoint:w,toggleIgnoreRecord:U,getCycleById:P}=Yt(),[R,C]=o.useState(null),[xe,H]=o.useState(!1),[ft,K]=o.useState(!1),k=!l||l===f.id,Q=k?null:b.find(e=>e.id===l);o.useEffect(()=>{if(k){C(null),H(!1),K(!1);return}if(Q){C(null),H(!1),K(!1);return}let e=!0;return H(!0),P(l).then(a=>{e&&(a?(C(a),K(!1)):(C(null),K(!0)))}).catch(()=>{e&&(C(null),K(!0))}).finally(()=>{e&&H(!1)}),()=>{e=!1}},[k,Q,P,l]);const c=k?f:Q||R,Oe=!k&&!Q,we=!k&&c?.id,mt=k?D&&!f?.id:xe||D&&!Q&&!R,{preferences:p,savePreferences:W}=Ut(),Be=p?.manualCpm,$e=p?.manualCpmBase,Ve=p?.manualT8,Ue=p?.manualT8Base,M=["auto","manual","none"].includes(p?.cpmMode)?p.cpmMode:"auto",A=["auto","manual","none"].includes(p?.t8Mode)?p.t8Mode:"auto",He=o.useMemo(()=>{if(!we||!c?.startDate)return"";const e=n=>{if(!n)return null;try{return G(V(n),"dd/MM/yyyy")}catch(s){return console.error("Error formatting cycle date",s),n}},a=e(c.startDate),t=e(c.endDate)??"Sin fecha de fin";return a?`Ciclo ${a} - ${t}`:""},[we,c?.startDate,c?.endDate]),le=o.useMemo(()=>{const e=[];return Array.isArray(b)&&b.length>0&&e.push(...b),f?.id&&e.push(f),c?.id&&!e.some(a=>a?.id===c.id)&&e.push(c),e},[b,f,c]),[ie,We]=o.useState(typeof window<"u"&&window.innerWidth>window.innerHeight?"landscape":"portrait"),[v,Ye]=o.useState(!1),[ce,qe]=o.useState(!1),[pt,ue]=o.useState(!1),[X,de]=o.useState(null),[ht,be]=o.useState(null),[gt,fe]=o.useState(!1),[Ce,yt]=o.useState(!1),[Ge,ve]=o.useState(!1),[E,Se]=o.useState(null),[Y,me]=o.useState(()=>{const e={showRelationsRow:ct.showRelationsRow,fertilityStartConfig:$(ct.fertilityStartConfig)};if(typeof window>"u")return e;try{const a=window.localStorage.getItem(_e);if(a){const t=JSON.parse(a),n={...e,...t};typeof t?.showRelationsRow=="boolean"?n.showRelationsRow=t.showRelationsRow:t?.showRelationsRow!=null&&(n.showRelationsRow=!!t.showRelationsRow),n.fertilityStartConfig=$(t?.fertilityStartConfig);const s=dt(t?.fertilityStartConfig?.postpartum);if(t?.fertilityStartConfig?.postpartum!=null&&s===null)try{window.localStorage.setItem(_e,JSON.stringify({...t,fertilityStartConfig:n.fertilityStartConfig}))}catch(i){console.warn("No se pudieron limpiar los ajustes del gráfico.",i)}return n}}catch(a){console.warn("No se pudieron cargar los ajustes del gráfico.",a)}return e});o.useEffect(()=>{p&&me(e=>{const a=$(e.fertilityStartConfig),t=$(p.fertilityStartConfig);let n=!1;return typeof p.showRelationsRow=="boolean"&&e.showRelationsRow!==p.showRelationsRow&&(n=!0),a.combineMode!==t.combineMode&&(n=!0),a.postpartum!==t.postpartum&&(n=!0),Object.keys(a.calculators??{}).some(s=>a.calculators?.[s]!==t.calculators?.[s])&&(n=!0),n?{...e,showRelationsRow:typeof p.showRelationsRow=="boolean"?p.showRelationsRow:e.showRelationsRow,fertilityStartConfig:t}:e})},[p]);const h=o.useMemo(()=>$(Y.fertilityStartConfig),[Y.fertilityStartConfig]),xt=o.useMemo(()=>({...h,calculators:{...h.calculators,cpm:h.calculators.cpm&&M!=="none",t8:h.calculators.t8&&A!=="none"}}),[h,M,A]);o.useEffect(()=>{if(!(typeof window>"u"))try{const e={...Y,fertilityStartConfig:h};window.localStorage.setItem(_e,JSON.stringify(e))}catch(e){console.warn("No se pudieron guardar los ajustes del gráfico.",e)}},[Y,h]);const Ie=o.useRef(!1),pe=o.useRef(0),T=o.useRef(null),F=o.useRef(null),wt=!!(X&&String(X.id||"").startsWith("placeholder-"));if(o.useEffect(()=>{if(typeof document>"u")return;const e=document.body,a=document.documentElement;if(v){T.current===null&&(T.current=e.style.overflow),F.current===null&&(F.current=a.style.overflow),e.style.overflow="hidden",a.style.overflow="hidden";return}return T.current!==null&&(e.style.overflow=T.current,T.current=null),F.current!==null&&(a.style.overflow=F.current,F.current=null),()=>{T.current!==null&&(e.style.overflow=T.current,T.current=null),F.current!==null&&(a.style.overflow=F.current,F.current=null)}},[v]),o.useLayoutEffect(()=>{window.dispatchEvent(new Event("resize"))},[ie,v]),o.useEffect(()=>{if(typeof window>"u")return;const e=()=>{if(ce)return;const a=window.innerWidth>window.innerHeight?"landscape":"portrait";We(t=>t===a?t:a)};return window.addEventListener("resize",e),window.addEventListener("orientationchange",e),e(),()=>{window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e)}},[ce]),mt)return r.jsx(ge,{children:r.jsx("div",{className:"flex h-full flex-col items-center justify-center space-y-4 bg-gradient-to-br from-rose-100 via-pink-100 to-rose-100 px-4 py-8 text-center text-fertiliapp-fuerte",children:r.jsx("p",{children:"Cargando…"})})});if(!c?.id)return l&&ft?r.jsx(ge,{children:r.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 px-4 py-8 text-center text-fertiliapp-fuerte",children:[r.jsx("p",{children:"No se encontró el ciclo solicitado."}),r.jsx(B,{asChild:!0,className:"bg-fertiliapp-fuerte rounded-3xl text-white shadow",children:r.jsx(Fe,{to:"/archived-cycles",children:"Volver a Mis Ciclos"})})]})}):r.jsx(ge,{children:r.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 px-4 py-8 text-center text-fertiliapp-fuerte",children:[r.jsx("p",{children:"No hay ciclo activo."}),r.jsx(B,{asChild:!0,className:"bg-fertiliapp-fuerte rounded-3xl text-white shadow",children:r.jsx(Fe,{to:"/records",children:"Ir a Mis Registros"})})]})});const Je=28,Ke=10,bt=25,Z=V(c.startDate),ee=c.data||[],Ct=o.useMemo(()=>(Array.isArray(ee)?ee.find(a=>a?.peak_marker==="peak"):null)?.isoDate||null,[ee]),Ne=ee.reduce((e,a)=>{const t=V(a.isoDate);return t>e?t:e},Z),Qe=J(new Date),Xe=!k,je=Xe&&c?.endDate?J(V(c.endDate)):null,vt=Xe?je??Ne:Ne>Qe?Ne:Qe,St=ye(J(vt),Z),Ze=Math.max(Je,St+1),et=je?ye(je,Z)+1:null,te=et?Math.min(Ze,et):Ze,ae=na(Z,te).map(e=>{const a=ee.find(t=>t.isoDate===e.isoDate);return a?{...a,date:e.date}:e}),De=ce?"landscape":ie,re=v?De==="portrait"?Ke:bt:De==="portrait"?Ke:Je;let Re=0;if(De!=="landscape"){const e=ye(new Date,J(Z)),a=Math.min(Math.max(e,0),te-1);let t=Math.min(te,a+1);a<re-1&&(t=Math.min(te,re)),Re=Math.max(0,t-re)}else Re=Math.max(0,te-re);const tt={backgroundColor:"#fff7fb",backgroundImage:`
      radial-gradient(120% 120% at 0% 0%, rgba(251,113,133,0.18) 0, transparent 55%),
      radial-gradient(110% 110% at 100% 0%, rgba(244,114,182,0.16) 0, transparent 55%),
      radial-gradient(130% 130% at 0% 100%, rgba(251,113,133,0.08) 0, transparent 60%),
      radial-gradient(140% 140% at 100% 100%, rgba(255,255,255,0.9) 0, rgba(255,247,250,0.3) 40%, transparent 70%)
    `},he="calc(var(--app-vh, 1vh) * 100)",at="var(--bottom-nav-safe)",It=v?{...tt,height:he,maxHeight:he,paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"}:{...tt,height:`calc(${he} - ${at})`,maxHeight:`calc(${he} - ${at})`,paddingTop:"env(safe-area-inset-top)"},Nt=(e,a=null)=>{de(e),be(a??null),ue(!0)},jt=async(e,a)=>{try{if(await U(e,a),Oe){const t=await P(e);t&&C(t)}}catch(t){console.error("Error toggling ignore state:",t)}},Dt=e=>{const a=e===!0;me(t=>({...t,showRelationsRow:a})),typeof W=="function"&&W({showRelationsRow:a}).catch(t=>{console.error("Failed to persist relations row preference",t)})},Rt=(e,a)=>{let t=null;me(n=>{const s=$(n.fertilityStartConfig),i=a===!0;return s.calculators?.[e]===i?n:(t={...s,calculators:{...s.calculators,[e]:i}},{...n,fertilityStartConfig:t})}),t&&typeof W=="function"&&W({fertilityStartConfig:t}).catch(n=>{console.error("Failed to persist calculator preference",n)})},kt=e=>{let a=null;me(t=>{const n=$(t.fertilityStartConfig),s=e===!0;if(n.postpartum===s)return t;const m={...n.calculators??ze().calculators,cpm:!s,t8:!s};return a={...n,postpartum:s,calculators:m},{...t,fertilityStartConfig:a}}),a&&typeof W=="function"&&W({fertilityStartConfig:a}).catch(t=>{console.error("Failed to persist postpartum preference",t)})},ke=d?.state?.fertilityCalculatorCandidates,Me=c?.fertilityCalculatorCandidates,Ae=o.useMemo(()=>{const e=[Array.isArray(ke)?ke:null,Array.isArray(Me)?Me:null].find(a=>Array.isArray(a)&&a.length>0);return e?e.map(a=>{if(!a)return null;const{source:t,day:n,reason:s}=a;if(t!=="CPM"&&t!=="T8")return null;const i=Number(n);return Number.isFinite(i)?{source:t,day:i,reason:typeof s=="string"?s:""}:null}).filter(Boolean):null},[ke,Me]),Pe=o.useMemo(()=>{const e=Qt(le),a=Xt(le,Zt),t=[];return M==="auto"&&e&&t.push(e),A==="auto"&&a&&t.push(a),t},[le,M,A]),rt=o.useMemo(()=>{const e=[],a=(t,n,s,i)=>{if(t!=="manual")return;const m=Number(s);if(!Number.isFinite(m)||m<=0)return;const S=Number(i),z=Number.isFinite(S)&&S>0,g=z?Number.isInteger(S)?`${S}`:`${Number(S.toFixed(2))}`:null,q=z?n==="CPM"?`ciclo base: ${g} días`:`base ${la(n)}: ${g}`:null,O=q?`Manual desde dashboard (${q})`:"Manual desde dashboard";e.push({source:n,day:Math.max(1,m),reason:O,kind:"calculator",isManual:!0,manualBase:z?S:null})};return a(M,"CPM",Be,$e),a(A,"T8",Ve,Ue),e},[M,Be,$e,Ve,Ue,A]),Mt=o.useMemo(()=>{const e=new Map;(Array.isArray(Ae)?Ae:[]).forEach(s=>{const i=oe(s?.source);i&&e.set(i,s)});const a=new Map;rt.forEach(s=>{const i=oe(s?.source);i&&a.set(i,s)});const t=M==="manual"?a.get("CPM")??e.get("CPM")??null:M==="auto"?Pe.find(s=>oe(s?.source)==="CPM")??null:null,n=A==="manual"?a.get("T8")??e.get("T8")??null:A==="auto"?Pe.find(s=>oe(s?.source)==="T8")??null:null;return[t,n].filter(Boolean)},[Pe,M,rt,Ae,A]),At=async(e,a=!0)=>{if(!c?.id||!e?.isoDate)return;const t=s=>{if(s==null||s==="")return null;const i=parseFloat(String(s).replace(",","."));return Number.isFinite(i)?i:null},n=a??!(e.peak_marker==="peak"||e.peakStatus==="P");fe(!0);try{const s=e.timestamp?G(V(e.timestamp),"HH:mm"):G(new Date,"HH:mm");let i=Array.isArray(e.measurements)&&e.measurements.length>0?e.measurements:[{temperature:e.temperature_chart??e.temperature_raw??null,temperature_corrected:e.temperature_corrected??null,time:s,time_corrected:e.time_corrected??s,selected:!0,use_corrected:e.use_corrected??!1}];i.length===0&&(i=[{temperature:null,temperature_corrected:null,time:s,time_corrected:s,selected:!0,use_corrected:!1}]);const m=i.map((g,q)=>{const O=g.time||s,y=g.time_corrected||O;return{temperature:t(g.temperature??g.temperature_raw),time:O,selected:q===0?!0:!!g.selected,temperature_corrected:t(g.temperature_corrected),time_corrected:y,use_corrected:!!g.use_corrected}});m.some(g=>g.selected)||(m[0].selected=!0);const S={isoDate:e.isoDate,measurements:m,mucusSensation:e.mucus_sensation??e.mucusSensation??"",mucusAppearance:e.mucus_appearance??e.mucusAppearance??"",fertility_symbol:e.fertility_symbol??"none",observations:e.observations??"",had_relations:e.had_relations??e.hadRelations??!1,ignored:e.ignored??!1,peak_marker:n?"peak":null},z=e?.id&&!String(e.id).startsWith("placeholder-")?e:null;await w(S,z,c.id)}catch(s){console.error("Error toggling peak marker:",s)}finally{fe(!1)}},Ee=o.useCallback(()=>{ue(!1),de(null),be(null)},[]),Pt=async(e,{keepFormOpen:a=!1}={})=>{if(c?.id){fe(!0),a&&(pe.current=Date.now()+500);try{if(await w(e,X,c.id),Oe){const t=await P(c.id);t&&C(t)}a||(ue(!1),de(null),be(null))}finally{fe(!1)}}},Et=e=>{de(e)},st=()=>{yt(e=>!e)},nt=o.useCallback(()=>{Se(null)},[]),Tt=e=>{if(e.preventDefault(),Ie.current){Ie.current=!1;return}st()},Ft=e=>{e.pointerType==="touch"&&(e.preventDefault(),Ie.current=!0,st())},Lt=o.useCallback(e=>{if(e){ue(!0);return}Date.now()<pe.current||Ee()},[Ee]),_=o.useCallback(e=>{if(!Number.isInteger(e)||e<0||e>=ae.length)return"—";const a=ae[e],t=a?.isoDate??a?.date;if(!t)return"—";try{const n=typeof t=="string"?V(t):t;return G(n,"dd/MM")}catch(n){return console.error("Error formatting date from index",n),"—"}},[ae]),_t=o.useCallback((e={})=>{if(!e)return;const a=e.phase??null,t=e.reasons??{},n=t?.aggregate??null,s=Array.isArray(n?.usedCandidates)?n.usedCandidates:[],i=t?.window??t?.fertileWindow??null,m=Number.isInteger(t?.startIndex)?t.startIndex:Number.isInteger(t?.fertileStartFinalIndex)?t.fertileStartFinalIndex:null,S=!!h?.postpartum,z=!S&&!!(h?.calculators?.cpm||h?.calculators?.t8),g=u=>(u?.source??u?.originalSource??"").toString().toUpperCase(),q=()=>{const u=Number.isInteger(m)?m+1:null;return u?{candidate:s.find(x=>Number.isFinite(x?.day)&&Math.round(x.day)===u)??s[0]??null,dayNumber:u}:{candidate:null,dayNumber:null}},O=()=>{const{candidate:u}=q(),N=g(u);if(N==="CPM")return"alcanzar valor CPM";if(N==="T8"||N==="T-8")return"alcanzar valor T-8";if(t?.source==="marker"||t?.details?.explicitStartDay!=null)return"marcador";const x=(u?.reason??"").toUpperCase(),L=x.includes("S")||x.includes("BIP");return!x&&!N?null:L?"cambio en la sensación":"presencia de moco"};let y="",I="",j=null;if(a==="relativeInfertile"){y="Relativamente infértil";const u=Number.isInteger(e?.limitIndex)?e.limitIndex:Number.isInteger(e?.endIndex)?e.endIndex:Number.isInteger(e?.todayIndex)?e.todayIndex:null,N=Number.isInteger(m)&&Number.isInteger(u)&&m<=u,x=O(),L=_(m);N?(I=`Fin de fase por ${x??"—"}.`,j=L!=="—"?`Inicio fértil: ${L}.`:null):z?I="A la espera de cálculo (CPM/T-8) o signos de moco/sensación.":I="A la espera de signos de moco/sensación."}else if(a==="fertile"){y="Fase fértil";const u=O()??"—",x=_(m)??"—",L=Number.isFinite(i?.endIndex),se=Number.isInteger(i?.mucusInfertileStartIndex),ne=Number.isInteger(i?.temperatureInfertileStartIndex);I=`Iniciada el ${x} por ${u}.`,L?se&&ne?j="Finalizada por doble criterio.":se?j="Finalizada por día pico.":ne&&(j="Finalizada por temperatura."):j="A la espera de cierre por día pico y/o confirmación de temperatura."}else if(a==="postOvulatory"){const u=(e?.displayLabel??e?.label??"").toLowerCase(),N=e?.status??t?.status??null,x=_(Number.isInteger(t?.temperature?.confirmationIndex)?t.temperature.confirmationIndex:Number.isInteger(t?.temperature?.startIndex)?t.temperature.startIndex:i?.temperatureInfertileStartIndex),L=_(t?.mucus?.peakDayIndex),se=_(Number.isInteger(t?.mucus?.infertileStartIndex)?t.mucus.infertileStartIndex:e?.startIndex),ne=_(e?.startIndex);if(N==="absolute"||e?.displayLabel==="Infertilidad absoluta")y="Infertilidad postovulatoria confirmada",I=`Comienza el ${ne}.`,j=`Confirmada por temperatura (${x}) y 3.º/4.º día postpico (${se}).`;else if(u.includes("moco")){y="Infertilidad post-pico";const ot=Number.isInteger(t?.mucus?.infertileStartIndex)?t.mucus.infertileStartIndex:Number.isInteger(e?.startIndex)?e.startIndex:null,lt=Number.isInteger(t?.mucus?.peakDayIndex)?t.mucus.peakDayIndex:null;let Te="día postpico";if(Number.isInteger(ot)&&Number.isInteger(lt)){const it=ot-lt;it===3?Te="3.º día postpico":it===4&&(Te="4.º día postpico")}I=`Alcanzada el ${ne} por ${Te}. Día pico: ${L}.`,j="A la espera de confirmación por temperatura."}else u.includes("temperatura")?(y="Infertilidad postovulatoria por temperatura",I=`Temperatura confirmada el ${x}.`,j="A la espera de determinación del día pico."):(y="Fase postovulatoria",I="Interpretación postovulatoria disponible.",j=N==="pending"?"Pendiente completar el segundo criterio.":null)}else if(a==="nodata")(t?.status??e?.status??null)==="no-fertile-window"?(y="Sin ventana fértil identificable",I="No se ha identificado un inicio fértil claro en este ciclo (ni por moco, ni por calculadora, ni por marcador explícito)."):(y="Sin datos suficientes",I="Añade registros de sensación, moco o temperatura para interpretar el ciclo.");else if(e?.message)y=e.message;else return;y&&Se({title:y,message:I,description:j,postpartumActive:S})},[h,_,ae.length,Se]),zt=()=>{if(!v){Ye(!0),qe(!0);return}qe(!1);const e=typeof window<"u"&&window.innerWidth>window.innerHeight?"landscape":"portrait";We(e),Ye(!1)};return r.jsx(ge,{hideBottomNav:v,children:r.jsxs("div",{className:v?"fixed inset-0 z-50 h-app w-[100vw] overflow-y-auto overflow-x-hidden":"relative w-full h-full overflow-y-auto overflow-x-hidden",style:It,children:[we&&!v&&r.jsx(B,{asChild:!0,variant:"ghost",className:"absolute top-4 left-4 z-10 bg-white/20 text-slate-700 hover:brightness-95",children:r.jsxs(Fe,{to:`/cycle/${c.id}`,className:"flex items-center gap-1",children:[r.jsx(ea,{className:"h-4 w-4"}),He&&r.jsx("span",{className:"ml-1 text-xs font-semibold text-slate-700 sm:text-sm",children:He})]})}),r.jsx(B,{onClick:()=>ve(e=>!e),variant:"ghost",size:"icon",className:"absolute top-16 right-4 z-10 p-2 rounded-full bg-white/20 shadow-lg shadow-secundario text-secundario border hover:brightness-95","aria-label":"Ajustes",children:r.jsx(sa,{className:"h-4 w-4"})}),r.jsx(B,{onClick:Tt,onPointerUp:Ft,variant:"ghost",size:"icon",className:`absolute top-4 right-20 z-10 p-2 rounded-full transition-colors ${Ce?"bg-fertiliapp-fuerte text-white shadow-lg shadow-fertiliapp-fuerte/50 border-fertiliapp-fuerte/70":"bg-white/20 text-fertiliapp-fuerte border border-fertiliapp-fuerte hover:brightness-95 shadow-md"}`,children:Ce?r.jsx(ta,{className:"h-4 w-4"}):r.jsx(aa,{className:"h-4 w-4"})}),r.jsx(B,{onClick:zt,className:"absolute top-4 right-4 z-10 bg-white/20 rounded-full text-slate-600 hover:bg-pink-50/80 shadow-md border border-slate-400/50 backdrop-blur-sm","aria-label":v?"Salir de pantalla completa":"Rotar gráfico",children:r.jsx(ra,{className:"w-4 h-4"})}),r.jsx(Wt,{data:ae,isFullScreen:v,orientation:ie,onToggleIgnore:jt,onEdit:Nt,onTogglePeak:At,cycleId:c.id,initialScrollIndex:Re,visibleDays:re,showInterpretation:Ce,reduceMotion:!0,forceLandscape:ce||ie==="landscape",currentPeakIsoDate:Ct,showRelationsRow:Y.showRelationsRow,fertilityStartConfig:xt,fertilityCalculatorCycles:le,fertilityCalculatorCandidates:Mt,onShowPhaseInfo:_t,isArchivedCycle:!k,cycleEndDate:c?.endDate??null}),Ge&&r.jsx("div",{className:"fixed inset-0 z-40 bg-black/30",onClick:()=>ve(!1),"aria-hidden":"true"}),r.jsx("div",{className:`fixed top-0 right-0 z-50 h-app w-72 sm:w-80 transform transition-transform duration-300 ease-in-out ${Ge?"translate-x-0":"translate-x-full"}`,role:"dialog","aria-modal":"true",children:r.jsxs("div",{className:"flex h-full flex-col gap-6 border-xl rounded-xl border-rose-100/60 bg-white p-6 shadow-xl",children:[r.jsxs("div",{className:"flex items-start justify-between gap-4",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-lg font-semibold text-titulo",children:"Ajustes del gráfico"}),r.jsx("p",{className:"text-sm text-slate-500",children:"Personaliza la visualización del gráfico"})]}),r.jsx(B,{variant:"ghost",size:"icon",className:"h-8 w-8 text-slate-400 hover:text-slate-600",onClick:()=>ve(!1),"aria-label":"Cerrar ajustes del gráfico",children:"×"})]}),r.jsxs("div",{className:"space-y-4 overflow-y-auto pr-1",children:[r.jsxs("div",{className:"rounded-2xl border border-pink-100/70 bg-pink-50/40 p-4 flex items-start justify-between gap-3",children:[r.jsxs("div",{className:"max-w-xs",children:[r.jsx(Kt,{htmlFor:"toggle-relations-row",className:"text-sm font-semibold text-slate-700",children:"Mostrar fila RS"}),r.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Añade una fila dedicada a las relaciones sexuales debajo de la gráfica."})]}),r.jsx(Le,{id:"toggle-relations-row",checked:Y.showRelationsRow,onCheckedChange:Dt,className:"mt-1"})]}),r.jsx("div",{className:"rounded-2xl border border-red-100/70 bg-red-50/40 p-3",children:r.jsxs("div",{className:"flex items-start justify-between gap-3 pt-1",children:[r.jsx("div",{className:"max-w-[65%]",children:r.jsx("p",{className:"text-sm font-semibold text-slate-700",children:"Modo postparto"})}),r.jsx(Le,{checked:!!h.postpartum,onCheckedChange:kt,className:"mt-1"})]})}),r.jsxs("div",{className:"rounded-2xl border border-amber-100/70 bg-amber-50/40 p-4 space-y-3",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-sm font-semibold text-slate-700",children:"Calculadoras complementarias"}),r.jsx("p",{className:"text-xs text-slate-500",children:"CPM y T-8 se combinan con los perfiles activos, salvo que actives el modo posparto."})]}),h.postpartum&&r.jsx("p",{className:"text-xs font-medium text-rose-500",children:"El modo posparto está activo: CPM y T-8 se omiten del cálculo final."}),r.jsx("div",{className:"space-y-2",children:ca.map(e=>r.jsxs("div",{className:"flex items-center justify-between gap-3",children:[r.jsx("span",{className:"text-sm text-slate-700",children:e.label}),r.jsx(Le,{checked:!!h.calculators?.[e.key],disabled:!!h.postpartum,onCheckedChange:a=>Rt(e.key,a)})]},e.key))})]})]})]})}),r.jsx(oa,{isOpen:!!E,onClose:nt,ariaLabel:"Detalle de interpretación del ciclo",containerClassName:"p-6",children:E&&r.jsxs("div",{className:"space-y-3 text-left",children:[r.jsxs("div",{className:"flex items-start justify-between gap-3",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("h2",{className:"text-lg font-semibold text-fertiliapp-fuerte",children:E.title}),E.postpartumActive&&r.jsx("span",{className:"rounded-full border border-rose-200 bg-rose-50 px-3 py-1 text-[11px] font-semibold text-rose-600",children:"Modo postparto"})]}),r.jsx("button",{type:"button",onClick:nt,className:"rounded-full p-1 text-slate-400 transition hover:bg-slate-100 hover:text-slate-600 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-pink-200","aria-label":"Cerrar detalle de interpretación",children:r.jsx(Ht,{className:"h-5 w-5"})})]}),E.message&&r.jsx("p",{className:"text-sm leading-relaxed text-slate-700",children:E.message}),E.description&&r.jsx("p",{className:"text-sm leading-relaxed text-slate-500",children:E.description})]})}),r.jsx(qt,{open:pt,onOpenChange:Lt,children:r.jsx(Gt,{hideClose:!0,className:"bg-transparent border-none p-0 text-gray-800 w-[90vw] sm:w-auto max-w-md sm:max-w-lg md:max-w-xl max-h-[85vh] overflow-y-auto",onInteractOutside:e=>{Date.now()<pe.current&&e.preventDefault()},onPointerDownOutside:e=>{Date.now()<pe.current&&e.preventDefault()},children:r.jsx(Jt,{onSubmit:Pt,onCancel:Ee,initialData:X,cycleStartDate:c.startDate,cycleEndDate:c.endDate,isProcessing:gt,isEditing:!!X&&!wt,cycleData:c.data,onDateSelect:Et,initialSectionKey:ht})})})]})})};export{Ia as default};
